(()=>{"use strict";var t,e,i,s,a,h={7906:(t,e,i)=>{i.a(t,(async(t,e)=>{try{var s=i(1312),a=i(5637),h=i(1302),n=i(6948),r=i(8317),o=i(8738),l=i(3764),c=i(4818),d=i(1183),m=i(8950),u=i(4583),p=i(1673),f=i(1122),g=i(2682),A=i(8665),S=i(9298),y=i(1069),C=i(3554),T=i(353),I=i(2634),w=i(4544),b=i(2215),v=i(3955),O=i(7953),E=i(2646),k=i(3937),L=(i(8902),i(4702)),P=i(6666),M=i(3819),B=i(2595),z=i(198),_=i(818),D=i(5599),N=i(1023),R=i(6169),Y=i(2630),X=i(5327),x=i(670),F=i(9456),H=i(8268),Z=i(8412),j=i(3606),q=i(4197),U=i(254),W=i(7628),G=i(123),K=i(9234),V=i(3867),$=i(1651),J=i(182),Q=i(7018),tt=i(2164),et=i(7604),it=i(3795),st=i(4909);class t extends $.K{load=async()=>{if(this.alreadyStarted)this.errorStarted=!0;else{this.alreadyStarted=!0;try{await this.showProgress(10,"Connecting to fileserver"),await L.A.load(await(await fetch("bz2.wasm")).arrayBuffer()),this.db=new w.A(await w.A.openDatabase());const t=new y.A(new Uint8Array(await(0,K.Is)(`${$.K.httpAddress}/crc`)));for(let e=0;e<9;e++)this.archiveChecksums[e]=t.g4;$.K.lowMemory||await this.setMidi("scape_main",12345678,4e4);const e=await this.loadArchive("title","title screen",this.archiveChecksums[1],10);this.titleArchive=e,this.fontPlain11=g.A.fromArchive(e,"p11"),this.fontPlain12=g.A.fromArchive(e,"p12"),this.fontBold12=g.A.fromArchive(e,"b12"),this.fontQuill8=g.A.fromArchive(e,"q8"),await this.loadTitleBackground(),this.loadTitleImages();const i=await this.loadArchive("config","config",this.archiveChecksums[2],15),m=await this.loadArchive("interface","interface",this.archiveChecksums[3],20),S=await this.loadArchive("media","2d graphics",this.archiveChecksums[4],30),C=await this.loadArchive("models","3d graphics",this.archiveChecksums[5],40),T=await this.loadArchive("textures","textures",this.archiveChecksums[6],60),I=await this.loadArchive("wordenc","chat system",this.archiveChecksums[7],65),b=await this.loadArchive("sounds","sound effects",this.archiveChecksums[8],70);this.levelTileFlags=new V.De(x.A.LEVELS,x.A.SIZE,x.A.SIZE),this.levelHeightmap=new V.Bb(x.A.LEVELS,x.A.SIZE+1,x.A.SIZE+1),this.levelHeightmap&&(this.scene=new z.A(this.levelHeightmap,x.A.SIZE,x.A.LEVELS,x.A.SIZE));for(let t=0;t<x.A.LEVELS;t++)this.levelCollisionMap[t]=new x.A;this.imageMinimap=new f.A(512,512),await this.showProgress(75,"Unpacking media"),this.imageInvback=p.A.fromArchive(S,"invback",0),this.imageChatback=p.A.fromArchive(S,"chatback",0),this.imageMapback=p.A.fromArchive(S,"mapback",0),this.imageBackbase1=p.A.fromArchive(S,"backbase1",0),this.imageBackbase2=p.A.fromArchive(S,"backbase2",0),this.imageBackhmid1=p.A.fromArchive(S,"backhmid1",0);for(let t=0;t<13;t++)this.imageSideicons[t]=p.A.fromArchive(S,"sideicons",t);this.imageCompass=f.A.fromArchive(S,"compass",0);try{for(let t=0;t<50;t++)22!==t&&(this.imageMapscene[t]=p.A.fromArchive(S,"mapscene",t))}catch(t){}try{for(let t=0;t<50;t++)this.imageMapfunction[t]=f.A.fromArchive(S,"mapfunction",t)}catch(t){}try{for(let t=0;t<20;t++)this.imageHitmarks[t]=f.A.fromArchive(S,"hitmarks",t)}catch(t){}try{for(let t=0;t<20;t++)this.imageHeadicons[t]=f.A.fromArchive(S,"headicons",t)}catch(t){}this.imageMapflag=f.A.fromArchive(S,"mapflag",0);for(let t=0;t<8;t++)this.imageCrosses[t]=f.A.fromArchive(S,"cross",t);this.imageMapdot0=f.A.fromArchive(S,"mapdots",0),this.imageMapdot1=f.A.fromArchive(S,"mapdots",1),this.imageMapdot2=f.A.fromArchive(S,"mapdots",2),this.imageMapdot3=f.A.fromArchive(S,"mapdots",3),this.imageScrollbar0=p.A.fromArchive(S,"scrollbar",0),this.imageScrollbar1=p.A.fromArchive(S,"scrollbar",1),this.imageRedstone1=p.A.fromArchive(S,"redstone1",0),this.imageRedstone2=p.A.fromArchive(S,"redstone2",0),this.imageRedstone3=p.A.fromArchive(S,"redstone3",0),this.imageRedstone1h=p.A.fromArchive(S,"redstone1",0),this.imageRedstone1h?.flipHorizontally(),this.imageRedstone2h=p.A.fromArchive(S,"redstone2",0),this.imageRedstone2h?.flipHorizontally(),this.imageRedstone1v=p.A.fromArchive(S,"redstone1",0),this.imageRedstone1v?.flipVertically(),this.imageRedstone2v=p.A.fromArchive(S,"redstone2",0),this.imageRedstone2v?.flipVertically(),this.imageRedstone3v=p.A.fromArchive(S,"redstone3",0),this.imageRedstone3v?.flipVertically(),this.imageRedstone1hv=p.A.fromArchive(S,"redstone1",0),this.imageRedstone1hv?.flipHorizontally(),this.imageRedstone1hv?.flipVertically(),this.imageRedstone2hv=p.A.fromArchive(S,"redstone2",0),this.imageRedstone2hv?.flipHorizontally(),this.imageRedstone2hv?.flipVertically();const v=f.A.fromArchive(S,"backleft1",0);this.areaBackleft1=new d.A(v.width,v.height),v.blitOpaque(0,0);const E=f.A.fromArchive(S,"backleft2",0);this.areaBackleft2=new d.A(E.width,E.height),E.blitOpaque(0,0);const P=f.A.fromArchive(S,"backright1",0);this.areaBackright1=new d.A(P.width,P.height),P.blitOpaque(0,0);const M=f.A.fromArchive(S,"backright2",0);this.areaBackright2=new d.A(M.width,M.height),M.blitOpaque(0,0);const B=f.A.fromArchive(S,"backtop1",0);this.areaBacktop1=new d.A(B.width,B.height),B.blitOpaque(0,0);const _=f.A.fromArchive(S,"backtop2",0);this.areaBacktop2=new d.A(_.width,_.height),_.blitOpaque(0,0);const D=f.A.fromArchive(S,"backvmid1",0);this.areaBackvmid1=new d.A(D.width,D.height),D.blitOpaque(0,0);const N=f.A.fromArchive(S,"backvmid2",0);this.areaBackvmid2=new d.A(N.width,N.height),N.blitOpaque(0,0);const R=f.A.fromArchive(S,"backvmid3",0);this.areaBackvmid3=new d.A(R.width,R.height),R.blitOpaque(0,0);const Y=f.A.fromArchive(S,"backhmid2",0);this.areaBackhmid2=new d.A(Y.width,Y.height),Y.blitOpaque(0,0);const X=(21*Math.random()|0)-10,F=(21*Math.random()|0)-10,H=(21*Math.random()|0)-10,Z=(41*Math.random()|0)-20;for(let t=0;t<50;t++)this.imageMapfunction[t]&&this.imageMapfunction[t]?.translate(X+Z,F+Z,H+Z),this.imageMapscene[t]&&this.imageMapscene[t]?.translate(X+Z,F+Z,H+Z);await this.showProgress(80,"Unpacking textures"),u.A.unpackTextures(T),u.A.setBrightness(.8),u.A.initPool(20),await this.showProgress(83,"Unpacking models"),A.A.unpack(C),J.A.unpack(C),Q.A.unpack(C),await this.showProgress(86,"Unpacking config"),s.A.unpack(i),a.A.unpack(i),tt.A.unpack(i),h.A.unpack(i,$.K.members),n.A.unpack(i),r.A.unpack(i),o.A.unpack(i),l.A.unpack(i),$.K.lowMemory||(await this.showProgress(90,"Unpacking sounds"),k.A.unpack(b)),await this.showProgress(92,"Unpacking interfaces"),c.A.unpack(m,S,[this.fontPlain11,this.fontPlain12,this.fontBold12,this.fontQuill8]),await this.showProgress(97,"Preparing game engine");for(let t=0;t<33;t++){let e=999,i=0;for(let s=0;s<35;s++)if(0===this.imageMapback.pixels[s+t*this.imageMapback.width])999===e&&(e=s);else if(999!==e){i=s;break}this.compassMaskLineOffsets[t]=e,this.compassMaskLineLengths[t]=i-e}for(let t=9;t<160;t++){let e=999,i=0;for(let s=10;s<168;s++)if(0===this.imageMapback.pixels[s+t*this.imageMapback.width]&&(s>34||t>34))999===e&&(e=s);else if(999!==e){i=s;break}this.minimapMaskLineOffsets[t-9]=e-21,this.minimapMaskLineLengths[t-9]=i-e}u.A.init3D(479,96),this.areaChatbackOffsets=u.A.lineOffset,u.A.init3D(190,261),this.areaSidebarOffsets=u.A.lineOffset,u.A.init3D(512,334),this.areaViewportOffsets=u.A.lineOffset;const j=new Int32Array(9);for(let t=0;t<9;t++){const e=32*t+128+15,i=3*e+600,s=u.A.sin[e];j[t]=i*s>>16}z.A.init(512,334,500,800,j),O.A.unpack(I),this.initializeLevelExperience()}catch(t){console.error(t),this.errorLoading=!0}}};update=async()=>{this.errorStarted||this.errorLoading||this.errorHost||(this.loopCycle++,this.ingame?await this.updateGame():await this.updateTitleScreen())};draw=async()=>{this.errorStarted||this.errorLoading||this.errorHost?this.drawError():(this.ingame?this.drawGame():await this.drawTitleScreen(),this.dragCycles=0)};refresh=()=>{this.redrawTitleBackground=!0};showProgress=async(t,e)=>{console.log(`${t}%: ${e}`),await this.loadTitle(),this.titleArchive?(this.imageTitle4?.bind(),this.fontBold12?.drawStringCenter(180,54,"RuneScape is loading - please wait...",S.A.WHITE),m.A.drawRect(28,62,304,34,S.A.PROGRESS_RED),m.A.drawRect(29,63,302,32,S.A.BLACK),m.A.fillRect(30,64,3*t,30,S.A.PROGRESS_RED),m.A.fillRect(30+3*t,64,300-3*t,30,S.A.BLACK),this.fontBold12?.drawStringCenter(180,85,e,S.A.WHITE),this.imageTitle4?.draw(214,186),this.redrawTitleBackground&&(this.redrawTitleBackground=!1,this.flameActive||(this.imageTitle0?.draw(0,0),this.imageTitle1?.draw(661,0)),this.imageTitle2?.draw(128,0),this.imageTitle3?.draw(214,386),this.imageTitle5?.draw(0,265),this.imageTitle6?.draw(574,265),this.imageTitle7?.draw(128,186),this.imageTitle8?.draw(574,186)),await(0,K.fb)(5)):await super.showProgress(t,e)};runFlames=()=>{this.flameActive&&(this.updateFlames(),this.updateFlames(),this.drawFlames())};loadTitle=async()=>{this.imageTitle2||(this.drawArea=null,this.areaChatback=null,this.areaMapback=null,this.areaSidebar=null,this.areaViewport=null,this.areaBackbase1=null,this.areaBackbase2=null,this.areaBackhmid1=null,this.imageTitle0=new d.A(128,265),m.A.clear(),this.imageTitle1=new d.A(128,265),m.A.clear(),this.imageTitle2=new d.A(533,186),m.A.clear(),this.imageTitle3=new d.A(360,146),m.A.clear(),this.imageTitle4=new d.A(360,200),m.A.clear(),this.imageTitle5=new d.A(214,267),m.A.clear(),this.imageTitle6=new d.A(215,267),m.A.clear(),this.imageTitle7=new d.A(86,79),m.A.clear(),this.imageTitle8=new d.A(87,79),m.A.clear(),this.titleArchive&&(await this.loadTitleBackground(),this.loadTitleImages()),this.redrawTitleBackground=!0)};loadTitleBackground=async()=>{if(!this.titleArchive)return;const t=await f.A.fromJpeg(this.titleArchive,"title");this.imageTitle0?.bind(),t.blitOpaque(0,0),this.imageTitle1?.bind(),t.blitOpaque(-661,0),this.imageTitle2?.bind(),t.blitOpaque(-128,0),this.imageTitle3?.bind(),t.blitOpaque(-214,-386),this.imageTitle4?.bind(),t.blitOpaque(-214,-186),this.imageTitle5?.bind(),t.blitOpaque(0,-265),this.imageTitle6?.bind(),t.blitOpaque(-128,-186),this.imageTitle7?.bind(),t.blitOpaque(-128,-186),this.imageTitle8?.bind(),t.blitOpaque(-574,-186),t.flipHorizontally(),this.imageTitle0?.bind(),t.blitOpaque(394,0),this.imageTitle1?.bind(),t.blitOpaque(-267,0),this.imageTitle2?.bind(),t.blitOpaque(266,0),this.imageTitle3?.bind(),t.blitOpaque(180,-386),this.imageTitle4?.bind(),t.blitOpaque(180,-186),this.imageTitle5?.bind(),t.blitOpaque(394,-265),this.imageTitle6?.bind(),t.blitOpaque(-180,-265),this.imageTitle7?.bind(),t.blitOpaque(212,-186),this.imageTitle8?.bind(),t.blitOpaque(-180,-186);const e=f.A.fromArchive(this.titleArchive,"logo");this.imageTitle2?.bind(),e.draw((this.width/2|0)-(e.width/2|0)-128,18)};updateFlameBuffer=t=>{if(this.flameBuffer0&&this.flameBuffer1){this.flameBuffer0.fill(0);for(let t=0;t<5e3;t++){const t=128*Math.random()*256|0;this.flameBuffer0[t]=256*Math.random()|0}for(let t=0;t<20;t++){for(let t=1;t<255;t++)for(let e=1;e<127;e++){const i=e+(t<<7);this.flameBuffer1[i]=(this.flameBuffer0[i-1]+this.flameBuffer0[i+1]+this.flameBuffer0[i-128]+this.flameBuffer0[i+128])/4|0}const t=this.flameBuffer0;this.flameBuffer0=this.flameBuffer1,this.flameBuffer1=t}if(t){let e=0;for(let i=0;i<t.height;i++)for(let s=0;s<t.width;s++)if(0!==t.pixels[e++]){const e=s+t.cropX+16+(i+t.cropY+16<<7);this.flameBuffer0[e]=0}}}};loadTitleImages=()=>{if(this.titleArchive){this.imageTitlebox=p.A.fromArchive(this.titleArchive,"titlebox"),this.imageTitlebutton=p.A.fromArchive(this.titleArchive,"titlebutton");for(let t=0;t<12;t++)this.imageRunes[t]=p.A.fromArchive(this.titleArchive,"runes",t);this.imageFlamesLeft=new f.A(128,265),this.imageFlamesRight=new f.A(128,265),this.imageTitle0&&(0,K.n2)(this.imageTitle0.pixels,0,this.imageFlamesLeft.pixels,0,33920),this.imageTitle1&&(0,K.n2)(this.imageTitle1.pixels,0,this.imageFlamesRight.pixels,0,33920),this.flameGradient0=new Int32Array(256);for(let t=0;t<64;t++)this.flameGradient0[t]=262144*t;for(let t=0;t<64;t++)this.flameGradient0[t+64]=1024*t+S.A.RED;for(let t=0;t<64;t++)this.flameGradient0[t+128]=4*t+S.A.YELLOW;for(let t=0;t<64;t++)this.flameGradient0[t+192]=S.A.WHITE;this.flameGradient1=new Int32Array(256);for(let t=0;t<64;t++)this.flameGradient1[t]=1024*t;for(let t=0;t<64;t++)this.flameGradient1[t+64]=4*t+S.A.GREEN;for(let t=0;t<64;t++)this.flameGradient1[t+128]=262144*t+S.A.CYAN;for(let t=0;t<64;t++)this.flameGradient1[t+192]=S.A.WHITE;this.flameGradient2=new Int32Array(256);for(let t=0;t<64;t++)this.flameGradient2[t]=4*t;for(let t=0;t<64;t++)this.flameGradient2[t+64]=262144*t+S.A.BLUE;for(let t=0;t<64;t++)this.flameGradient2[t+128]=1024*t+S.A.MAGENTA;for(let t=0;t<64;t++)this.flameGradient2[t+192]=S.A.WHITE;this.flameGradient=new Int32Array(256),this.flameBuffer0=new Int32Array(32768),this.flameBuffer1=new Int32Array(32768),this.updateFlameBuffer(null),this.flameBuffer3=new Int32Array(32768),this.flameBuffer2=new Int32Array(32768),this.showProgress(10,"Connecting to fileserver").then((()=>{this.flameActive||(this.flameActive=!0,this.flamesInterval=setInterval(this.runFlames,35))}))}};updateTitleScreen=async()=>{if(0===this.titleScreenState){let t=(this.width/2|0)-80,e=20+(this.height/2|0);e+=20,1===this.mouseClickButton&&this.mouseClickX>=t-75&&this.mouseClickX<=t+75&&this.mouseClickY>=e-20&&this.mouseClickY<=e+20&&(this.titleScreenState=3,this.titleLoginField=0),t=80+(this.width/2|0),1===this.mouseClickButton&&this.mouseClickX>=t-75&&this.mouseClickX<=t+75&&this.mouseClickY>=e-20&&this.mouseClickY<=e+20&&(this.loginMessage0="",this.loginMessage1="Enter your username & password.",this.titleScreenState=2,this.titleLoginField=0)}else if(2===this.titleScreenState){let t=(this.height/2|0)-40;t+=30,t+=25,1===this.mouseClickButton&&this.mouseClickY>=t-15&&this.mouseClickY<t&&(this.titleLoginField=0),t+=15,1===this.mouseClickButton&&this.mouseClickY>=t-15&&this.mouseClickY<t&&(this.titleLoginField=1);let e=(this.width/2|0)-80,i=50+(this.height/2|0);for(i+=20,1===this.mouseClickButton&&this.mouseClickX>=e-75&&this.mouseClickX<=e+75&&this.mouseClickY>=i-20&&this.mouseClickY<=i+20&&await this.login(this.username,this.password,!1),e=80+(this.width/2|0),1===this.mouseClickButton&&this.mouseClickX>=e-75&&this.mouseClickX<=e+75&&this.mouseClickY>=i-20&&this.mouseClickY<=i+20&&(this.titleScreenState=0,this.username="",this.password="");;){const t=this.pollKey();if(-1===t)return;let e=!1;for(let i=0;i<g.A.CHARSET.length;i++)if(String.fromCharCode(t)===g.A.CHARSET.charAt(i)){e=!0;break}0===this.titleLoginField?(8===t&&this.username.length>0&&(this.username=this.username.substring(0,this.username.length-1)),9!==t&&10!==t&&13!==t||(this.titleLoginField=1),e&&(this.username=this.username+String.fromCharCode(t)),this.username.length>12&&(this.username=this.username.substring(0,12))):1===this.titleLoginField&&(8===t&&this.password.length>0&&(this.password=this.password.substring(0,this.password.length-1)),9!==t&&10!==t&&13!==t||(this.titleLoginField=0),e&&(this.password=this.password+String.fromCharCode(t)),this.password.length>20&&(this.password=this.password.substring(0,20)))}}else if(3===this.titleScreenState){const t=this.width/2|0;let e=50+(this.height/2|0);e+=20,1===this.mouseClickButton&&this.mouseClickX>=t-75&&this.mouseClickX<=t+75&&this.mouseClickY>=e-20&&this.mouseClickY<=e+20&&(this.titleScreenState=0)}};drawTitleScreen=async()=>{if(await this.loadTitle(),this.imageTitle4?.bind(),this.imageTitlebox?.draw(0,0),0===this.titleScreenState){let t=180,e=80;this.fontBold12?.drawStringTaggableCenter(t,e,"Welcome to RuneScape",S.A.YELLOW,!0),t=100,e=120,this.imageTitlebutton?.draw(t-73,e-20),this.fontBold12?.drawStringTaggableCenter(t,e+5,"New user",S.A.WHITE,!0),t=260,this.imageTitlebutton?.draw(t-73,e-20),this.fontBold12?.drawStringTaggableCenter(t,e+5,"Existing User",S.A.WHITE,!0)}else if(2===this.titleScreenState){let t=100,e=60;this.loginMessage0.length>0?(this.fontBold12?.drawStringTaggableCenter(180,e-15,this.loginMessage0,S.A.YELLOW,!0),this.fontBold12?.drawStringTaggableCenter(180,e,this.loginMessage1,S.A.YELLOW,!0),e+=30):(this.fontBold12?.drawStringTaggableCenter(180,e-7,this.loginMessage1,S.A.YELLOW,!0),e+=30),this.fontBold12?.drawStringTaggable(90,e,`Username: ${this.username}${0===this.titleLoginField&&this.loopCycle%40<20?"@yel@|":""}`,S.A.WHITE,!0),e+=15,this.fontBold12?.drawStringTaggable(92,e,`Password: ${M.A.toAsterisks(this.password)}${1===this.titleLoginField&&this.loopCycle%40<20?"@yel@|":""}`,S.A.WHITE,!0),e=150,this.imageTitlebutton?.draw(t-73,e-20),this.fontBold12?.drawStringTaggableCenter(t,e+5,"Login",S.A.WHITE,!0),t=260,this.imageTitlebutton?.draw(t-73,e-20),this.fontBold12?.drawStringTaggableCenter(t,e+5,"Cancel",S.A.WHITE,!0)}else if(3===this.titleScreenState){this.fontBold12?.drawStringTaggableCenter(180,40,"Create a free account",S.A.YELLOW,!0);const t=180;let e=65;this.fontBold12?.drawStringTaggableCenter(180,e,"To create a new account you need to",S.A.WHITE,!0),e+=15,this.fontBold12?.drawStringTaggableCenter(180,e,"go back to the main RuneScape webpage",S.A.WHITE,!0),e+=15,this.fontBold12?.drawStringTaggableCenter(180,e,"and choose the red 'create account'",S.A.WHITE,!0),e+=15,this.fontBold12?.drawStringTaggableCenter(180,e,"button at the top right of that page.",S.A.WHITE,!0),e=150,this.imageTitlebutton?.draw(t-73,e-20),this.fontBold12?.drawStringTaggableCenter(t,e+5,"Cancel",S.A.WHITE,!0)}this.imageTitle4?.draw(214,186),this.redrawTitleBackground&&(this.redrawTitleBackground=!1,this.imageTitle2?.draw(128,0),this.imageTitle3?.draw(214,386),this.imageTitle5?.draw(0,265),this.imageTitle6?.draw(574,265),this.imageTitle7?.draw(128,186),this.imageTitle8?.draw(574,186))};login=async(t,e,i)=>{try{i||(this.loginMessage0="",this.loginMessage1="Connecting to server...",await this.drawTitleScreen()),this.stream=new C.A(await C.A.openSocket({host:$.K.serverAddress,port:43594+$.K.portOffset})),await(this.stream?.readBytes(this.in.data,0,8)),this.in.pos=0,this.serverSeed=this.in.g8;const s=new Int32Array([Math.floor(99999999*Math.random()),Math.floor(99999999*Math.random()),Number(this.serverSeed>>32n),Number(this.serverSeed&BigInt(4294967295))]);this.out.pos=0,this.out.p1(10),this.out.p4(s[0]),this.out.p4(s[1]),this.out.p4(s[2]),this.out.p4(s[3]),this.out.p4(0),this.out.pjstr(t),this.out.pjstr(e),this.out.rsaenc($.K.modulus,$.K.exponent),this.loginout.pos=0,i?this.loginout.p1(18):this.loginout.p1(16),this.loginout.p1(this.out.pos+36+1+1),this.loginout.p1($.K.clientversion),this.loginout.p1($.K.lowMemory?1:0);for(let t=0;t<9;t++)this.loginout.p4(this.archiveChecksums[t]);this.loginout.pdata(this.out.data,this.out.pos,0),this.out.random=new I.A(s);for(let t=0;t<4;t++)s[t]+=50;this.randomIn=new I.A(s),this.stream?.write(this.loginout.data,this.loginout.pos);const a=await this.stream.read();if(1===a)return await(0,K.fb)(2e3),void await this.login(t,e,i);if(2===a||18===a){this.rights=18===a,B.A.setDisabled(),this.ingame=!0,this.out.pos=0,this.in.pos=0,this.packetType=-1,this.lastPacketType0=-1,this.lastPacketType1=-1,this.lastPacketType2=-1,this.packetSize=0,this.idleNetCycles=0,this.systemUpdateTimer=0,this.idleTimeout=0,this.hintType=0,this.menuSize=0,this.menuVisible=!1,this.idleCycles=0;for(let t=0;t<100;t++)this.messageText[t]=null;this.objSelected=0,this.spellSelected=0,this.sceneState=0,this.waveCount=0,this.cameraAnticheatOffsetX=(100*Math.random()|0)-50,this.cameraAnticheatOffsetZ=(110*Math.random()|0)-55,this.cameraAnticheatAngle=(80*Math.random()|0)-40,this.minimapAnticheatAngle=(120*Math.random()|0)-60,this.minimapZoom=(30*Math.random()|0)-20,this.orbitCameraYaw=(20*Math.random()|0)-10&2047,this.minimapLevel=-1,this.flagSceneTileX=0,this.flagSceneTileZ=0,this.playerCount=0,this.npcCount=0;for(let t=0;t<this.MAX_PLAYER_COUNT;t++)this.players[t]=null,this.playerAppearanceBuffer[t]=null;for(let t=0;t<8192;t++)this.npcs[t]=null;this.localPlayer=this.players[this.LOCAL_PLAYER_INDEX]=new H.A,this.projectiles.clear(),this.spotanims.clear(),this.temporaryLocs.clear();for(let t=0;t<x.A.LEVELS;t++)for(let e=0;e<x.A.SIZE;e++)for(let i=0;i<x.A.SIZE;i++)this.levelObjStacks[t][e][i]=null;this.spawnedLocations=new P.A,this.friendCount=0,this.stickyChatInterfaceId=-1,this.chatInterfaceId=-1,this.viewportInterfaceId=-1,this.sidebarInterfaceId=-1,this.pressedContinueOption=!1,this.selectedTab=3,this.chatbackInputOpen=!1,this.menuVisible=!1,this.showSocialInput=!1,this.modalMessage=null,this.inMultizone=0,this.flashingTab=-1,this.designGenderMale=!0,this.validateCharacterDesign();for(let t=0;t<5;t++)this.designColors[t]=0;return $.K.oplogic1=0,$.K.oplogic2=0,$.K.oplogic3=0,$.K.oplogic4=0,$.K.oplogic5=0,$.K.oplogic6=0,$.K.oplogic7=0,$.K.oplogic8=0,$.K.oplogic9=0,void this.prepareGameScreen()}if(3===a)return this.loginMessage0="",void(this.loginMessage1="Invalid username or password.");if(4===a)return this.loginMessage0="Your account has been disabled.",void(this.loginMessage1="Please check your message-centre for details.");if(5===a)return this.loginMessage0="Your account is already logged in.",void(this.loginMessage1="Try again in 60 secs...");if(6===a)return this.loginMessage0="RuneScape has been updated!",void(this.loginMessage1="Please reload this page.");if(7===a)return this.loginMessage0="This world is full.",void(this.loginMessage1="Please use a different world.");if(8===a)return this.loginMessage0="Unable to connect.",void(this.loginMessage1="Login server offline.");if(9===a)return this.loginMessage0="Login limit exceeded.",void(this.loginMessage1="Too many connections from your address.");if(10===a)return this.loginMessage0="Unable to connect.",void(this.loginMessage1="Bad session id.");if(11===a)return this.loginMessage1="Login server rejected session.",void(this.loginMessage1="Please try again.");if(12===a)return this.loginMessage0="You need a members account to login to this world.",void(this.loginMessage1="Please subscribe, or use a different world.");if(13===a)return this.loginMessage0="Could not complete login.",void(this.loginMessage1="Please try using a different world.");if(14===a)return this.loginMessage0="The server is being updated.",void(this.loginMessage1="Please wait 1 minute and try again.");if(15===a)return this.ingame=!0,this.out.pos=0,this.in.pos=0,this.packetType=-1,this.lastPacketType0=-1,this.lastPacketType1=-1,this.lastPacketType2=-1,this.packetSize=0,this.idleNetCycles=0,this.systemUpdateTimer=0,this.menuSize=0,void(this.menuVisible=!1);if(16===a)return this.loginMessage0="Login attempts exceeded.",void(this.loginMessage1="Please wait 1 minute and try again.");17===a&&(this.loginMessage0="You are standing in a members-only area.",this.loginMessage1="To play on this world move to a free area first")}catch(t){console.log(t),this.loginMessage0="",this.loginMessage1="Error connecting to server."}};updateGame=async()=>{if(null!==this.players){this.systemUpdateTimer>1&&this.systemUpdateTimer--,this.idleTimeout>0&&this.idleTimeout--;for(let t=0;t<5&&await this.read();t++);if(this.ingame){for(let t=0;t<this.waveCount;t++)if(this.waveDelay[t]<=0){try{const e=k.A.generate(this.waveIds[t],this.waveLoops[t]);if(!e)throw new Error;Date.now()+(e.pos/22|0)>this.lastWaveStartTime+(this.lastWaveLength/22|0)&&(this.lastWaveLength=e.pos,this.lastWaveStartTime=Date.now(),this.lastWaveId=this.waveIds[t],this.lastWaveLoops=this.waveLoops[t],await(0,G.MG)(e.data.slice(0,e.pos),this.waveVolume))}catch(t){console.error(t)}this.waveCount--;for(let e=t;e<this.waveCount;e++)this.waveIds[e]=this.waveIds[e+1],this.waveLoops[e]=this.waveLoops[e+1],this.waveDelay[e]=this.waveDelay[e+1];t--}else this.waveDelay[t]--;this.nextMusicDelay>0&&(this.nextMusicDelay-=20,this.nextMusicDelay<0&&(this.nextMusicDelay=0),0===this.nextMusicDelay&&this.midiActive&&!$.K.lowMemory&&this.currentMidi&&await this.setMidi(this.currentMidi,this.midiCrc,this.midiSize));const t=B.A.flush();if(t&&(this.out.p1isaac(v.A.EVENT_TRACKING),this.out.p2(t.pos),this.out.pdata(t.data,t.pos,0),t.release()),this.idleNetCycles++,this.idleNetCycles>750&&await this.tryReconnect(),this.updatePlayers(),this.updateNpcs(),this.updateEntityChats(),this.updateTemporaryLocs(),(1===this.actionKey[1]||1===this.actionKey[2]||1===this.actionKey[3]||1===this.actionKey[4])&&this.cameraMovedWrite++>5&&(this.cameraMovedWrite=0,this.out.p1isaac(v.A.EVENT_CAMERA_POSITION),this.out.p2(this.orbitCameraPitch),this.out.p2(this.orbitCameraYaw),this.out.p1(this.minimapAnticheatAngle),this.out.p1(this.minimapZoom)),this.sceneDelta++,0!==this.crossMode&&(this.crossCycle+=20,this.crossCycle>=400&&(this.crossMode=0)),0!==this.selectedArea&&(this.selectedCycle++,this.selectedCycle>=15&&(2===this.selectedArea&&(this.redrawSidebar=!0),3===this.selectedArea&&(this.redrawChatback=!0),this.selectedArea=0)),0!==this.objDragArea&&(this.objDragCycles++,(this.mouseX>this.objGrabX+5||this.mouseX<this.objGrabX-5||this.mouseY>this.objGrabY+5||this.mouseY<this.objGrabY-5)&&(this.objGrabThreshold=!0),0===this.mouseButton)){if(2===this.objDragArea&&(this.redrawSidebar=!0),3===this.objDragArea&&(this.redrawChatback=!0),this.objDragArea=0,this.objGrabThreshold&&this.objDragCycles>=5){if(this.hoveredSlotParentId=-1,this.handleInput(),this.hoveredSlotParentId===this.objDragInterfaceId&&this.hoveredSlot!==this.objDragSlot){const t=c.A.instances[this.objDragInterfaceId];if(t.invSlotObjId){const e=t.invSlotObjId[this.hoveredSlot];t.invSlotObjId[this.hoveredSlot]=t.invSlotObjId[this.objDragSlot],t.invSlotObjId[this.objDragSlot]=e}if(t.invSlotObjCount){const e=t.invSlotObjCount[this.hoveredSlot];t.invSlotObjCount[this.hoveredSlot]=t.invSlotObjCount[this.objDragSlot],t.invSlotObjCount[this.objDragSlot]=e}this.out.p1isaac(v.A.INV_BUTTOND),this.out.p2(this.objDragInterfaceId),this.out.p2(this.objDragSlot),this.out.p2(this.hoveredSlot)}}else(1===this.mouseButtonsOption||this.isAddFriendOption(this.menuSize-1))&&this.menuSize>2?this.showContextMenu():this.menuSize>0&&await this.useMenuOption(this.menuSize-1);this.selectedCycle=10,this.mouseClickButton=0}if($.K.cyclelogic3++,$.K.cyclelogic3>127&&($.K.cyclelogic3=0,this.out.p1isaac(v.A.ANTICHEAT_CYCLELOGIC3),this.out.p3(4991788)),-1!==z.A.clickTileX&&this.localPlayer){const t=z.A.clickTileX,e=z.A.clickTileZ,i=this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],t,e,0,0,0,0,0,0,!0);z.A.clickTileX=-1,i&&(this.crossX=this.mouseClickX,this.crossY=this.mouseClickY,this.crossMode=1,this.crossCycle=0)}1===this.mouseClickButton&&this.modalMessage&&(this.modalMessage=null,this.redrawChatback=!0,this.mouseClickButton=0),await this.handleMouseInput(),this.handleMinimapInput(),this.handleTabInput(),this.handleChatSettingsInput(),1!==this.mouseButton&&1!==this.mouseClickButton||this.dragCycles++,2===this.sceneState&&this.updateOrbitCamera(),2===this.sceneState&&this.cutscene&&this.applyCutscene();for(let t=0;t<5;t++)this.cameraModifierCycle[t]++;if(await this.handleInputKey(),this.idleCycles++,this.idleCycles>4500&&(this.idleTimeout=250,this.idleCycles-=500,this.out.p1isaac(v.A.IDLE_TIMER)),this.cameraOffsetCycle++,this.cameraOffsetCycle>500){this.cameraOffsetCycle=0;const t=8*Math.random()|0;1&~t||(this.cameraAnticheatOffsetX+=this.cameraOffsetXModifier),2&~t||(this.cameraAnticheatOffsetZ+=this.cameraOffsetZModifier),4&~t||(this.cameraAnticheatAngle+=this.cameraOffsetYawModifier)}if(this.cameraAnticheatOffsetX<-50&&(this.cameraOffsetXModifier=2),this.cameraAnticheatOffsetX>50&&(this.cameraOffsetXModifier=-2),this.cameraAnticheatOffsetZ<-55&&(this.cameraOffsetZModifier=2),this.cameraAnticheatOffsetZ>55&&(this.cameraOffsetZModifier=-2),this.cameraAnticheatAngle<-40&&(this.cameraOffsetYawModifier=1),this.cameraAnticheatAngle>40&&(this.cameraOffsetYawModifier=-1),this.minimapOffsetCycle++,this.minimapOffsetCycle>500){this.minimapOffsetCycle=0;const t=8*Math.random()|0;1&~t||(this.minimapAnticheatAngle+=this.minimapAngleModifier),2&~t||(this.minimapZoom+=this.minimapZoomModifier)}this.minimapAnticheatAngle<-60&&(this.minimapAngleModifier=2),this.minimapAnticheatAngle>60&&(this.minimapAngleModifier=-2),this.minimapZoom<-20&&(this.minimapZoomModifier=1),this.minimapZoom>10&&(this.minimapZoomModifier=-1),$.K.cyclelogic4++,$.K.cyclelogic4>110&&($.K.cyclelogic4=0,this.out.p1isaac(v.A.ANTICHEAT_CYCLELOGIC4),this.out.p4(0)),this.heartbeatTimer++,this.heartbeatTimer>50&&this.out.p1isaac(v.A.NO_TIMEOUT);try{this.stream&&this.out.pos>0&&(this.stream.write(this.out.data,this.out.pos),this.out.pos=0,this.heartbeatTimer=0)}catch(t){console.log(t),await this.tryReconnect()}}}};drawGame=()=>{if(null===this.players)return;this.redrawTitleBackground&&(this.redrawTitleBackground=!1,this.areaBackleft1?.draw(0,11),this.areaBackleft2?.draw(0,375),this.areaBackright1?.draw(729,5),this.areaBackright2?.draw(752,231),this.areaBacktop1?.draw(0,0),this.areaBacktop2?.draw(561,0),this.areaBackvmid1?.draw(520,11),this.areaBackvmid2?.draw(520,231),this.areaBackvmid3?.draw(501,375),this.areaBackhmid2?.draw(0,345),this.redrawSidebar=!0,this.redrawChatback=!0,this.redrawSideicons=!0,this.redrawPrivacySettings=!0,2!==this.sceneState&&(this.areaViewport?.draw(8,11),this.areaMapback?.draw(561,5))),2===this.sceneState&&this.drawScene(),this.menuVisible&&1===this.menuArea&&(this.redrawSidebar=!0);let t=!1;if(-1!==this.sidebarInterfaceId&&(t=this.updateInterfaceAnimation(this.sidebarInterfaceId,this.sceneDelta),t&&(this.redrawSidebar=!0)),2===this.selectedArea&&(this.redrawSidebar=!0),2===this.objDragArea&&(this.redrawSidebar=!0),this.redrawSidebar&&(this.drawSidebar(),this.redrawSidebar=!1),-1===this.chatInterfaceId){this.chatInterface.scrollPosition=this.chatScrollHeight-this.chatScrollOffset-77,this.mouseX>453&&this.mouseX<565&&this.mouseY>350&&this.handleScrollInput(this.mouseX-22,this.mouseY-375,this.chatScrollHeight,77,!1,463,0,this.chatInterface);let t=this.chatScrollHeight-this.chatInterface.scrollPosition-77;t<0&&(t=0),t>this.chatScrollHeight-77&&(t=this.chatScrollHeight-77),this.chatScrollOffset!==t&&(this.chatScrollOffset=t,this.redrawChatback=!0)}-1!==this.chatInterfaceId&&(t=this.updateInterfaceAnimation(this.chatInterfaceId,this.sceneDelta),t&&(this.redrawChatback=!0)),3===this.selectedArea&&(this.redrawChatback=!0),3===this.objDragArea&&(this.redrawChatback=!0),this.modalMessage&&(this.redrawChatback=!0),this.menuVisible&&2===this.menuArea&&(this.redrawChatback=!0),this.redrawChatback&&(this.drawChatback(),this.redrawChatback=!1),2===this.sceneState&&(this.drawMinimap(),this.areaMapback?.draw(561,5)),-1!==this.flashingTab&&(this.redrawSideicons=!0),this.redrawSideicons&&(-1!==this.flashingTab&&this.flashingTab===this.selectedTab&&(this.flashingTab=-1,this.out.p1isaac(v.A.TUTORIAL_CLICKSIDE),this.out.p1(this.selectedTab)),this.redrawSideicons=!1,this.areaBackhmid1?.bind(),this.imageBackhmid1?.draw(0,0),-1===this.sidebarInterfaceId&&(-1!==this.tabInterfaceId[this.selectedTab]&&(0===this.selectedTab?this.imageRedstone1?.draw(29,30):1===this.selectedTab?this.imageRedstone2?.draw(59,29):2===this.selectedTab?this.imageRedstone2?.draw(87,29):3===this.selectedTab?this.imageRedstone3?.draw(115,29):4===this.selectedTab?this.imageRedstone2h?.draw(156,29):5===this.selectedTab?this.imageRedstone2h?.draw(184,29):6===this.selectedTab&&this.imageRedstone1h?.draw(212,30)),-1!==this.tabInterfaceId[0]&&(0!==this.flashingTab||this.loopCycle%20<10)&&this.imageSideicons[0]?.draw(35,34),-1!==this.tabInterfaceId[1]&&(1!==this.flashingTab||this.loopCycle%20<10)&&this.imageSideicons[1]?.draw(59,32),-1!==this.tabInterfaceId[2]&&(2!==this.flashingTab||this.loopCycle%20<10)&&this.imageSideicons[2]?.draw(86,32),-1!==this.tabInterfaceId[3]&&(3!==this.flashingTab||this.loopCycle%20<10)&&this.imageSideicons[3]?.draw(121,33),-1!==this.tabInterfaceId[4]&&(4!==this.flashingTab||this.loopCycle%20<10)&&this.imageSideicons[4]?.draw(157,34),-1!==this.tabInterfaceId[5]&&(5!==this.flashingTab||this.loopCycle%20<10)&&this.imageSideicons[5]?.draw(185,32),-1!==this.tabInterfaceId[6]&&(6!==this.flashingTab||this.loopCycle%20<10)&&this.imageSideicons[6]?.draw(212,34)),this.areaBackhmid1?.draw(520,165),this.areaBackbase2?.bind(),this.imageBackbase2?.draw(0,0),-1===this.sidebarInterfaceId&&(-1!==this.tabInterfaceId[this.selectedTab]&&(7===this.selectedTab?this.imageRedstone1v?.draw(49,0):8===this.selectedTab?this.imageRedstone2v?.draw(81,0):9===this.selectedTab?this.imageRedstone2v?.draw(108,0):10===this.selectedTab?this.imageRedstone3v?.draw(136,1):11===this.selectedTab?this.imageRedstone2hv?.draw(178,0):12===this.selectedTab?this.imageRedstone2hv?.draw(205,0):13===this.selectedTab&&this.imageRedstone1hv?.draw(233,0)),-1!==this.tabInterfaceId[8]&&(8!==this.flashingTab||this.loopCycle%20<10)&&this.imageSideicons[7]?.draw(80,2),-1!==this.tabInterfaceId[9]&&(9!==this.flashingTab||this.loopCycle%20<10)&&this.imageSideicons[8]?.draw(107,3),-1!==this.tabInterfaceId[10]&&(10!==this.flashingTab||this.loopCycle%20<10)&&this.imageSideicons[9]?.draw(142,4),-1!==this.tabInterfaceId[11]&&(11!==this.flashingTab||this.loopCycle%20<10)&&this.imageSideicons[10]?.draw(179,2),-1!==this.tabInterfaceId[12]&&(12!==this.flashingTab||this.loopCycle%20<10)&&this.imageSideicons[11]?.draw(206,2),-1!==this.tabInterfaceId[13]&&(13!==this.flashingTab||this.loopCycle%20<10)&&this.imageSideicons[12]?.draw(230,2)),this.areaBackbase2?.draw(501,492),this.areaViewport?.bind()),this.redrawPrivacySettings&&(this.redrawPrivacySettings=!1,this.areaBackbase1?.bind(),this.imageBackbase1?.draw(0,0),this.fontPlain12?.drawStringTaggableCenter(57,33,"Public chat",S.A.WHITE,!0),0===this.publicChatSetting&&this.fontPlain12?.drawStringTaggableCenter(57,46,"On",S.A.GREEN,!0),1===this.publicChatSetting&&this.fontPlain12?.drawStringTaggableCenter(57,46,"Friends",S.A.YELLOW,!0),2===this.publicChatSetting&&this.fontPlain12?.drawStringTaggableCenter(57,46,"Off",S.A.RED,!0),3===this.publicChatSetting&&this.fontPlain12?.drawStringTaggableCenter(57,46,"Hide",S.A.CYAN,!0),this.fontPlain12?.drawStringTaggableCenter(186,33,"Private chat",S.A.WHITE,!0),0===this.privateChatSetting&&this.fontPlain12?.drawStringTaggableCenter(186,46,"On",S.A.GREEN,!0),1===this.privateChatSetting&&this.fontPlain12?.drawStringTaggableCenter(186,46,"Friends",S.A.YELLOW,!0),2===this.privateChatSetting&&this.fontPlain12?.drawStringTaggableCenter(186,46,"Off",S.A.RED,!0),this.fontPlain12?.drawStringTaggableCenter(326,33,"Trade/duel",S.A.WHITE,!0),0===this.tradeChatSetting&&this.fontPlain12?.drawStringTaggableCenter(326,46,"On",S.A.GREEN,!0),1===this.tradeChatSetting&&this.fontPlain12?.drawStringTaggableCenter(326,46,"Friends",S.A.YELLOW,!0),2===this.tradeChatSetting&&this.fontPlain12?.drawStringTaggableCenter(326,46,"Off",S.A.RED,!0),this.fontPlain12?.drawStringTaggableCenter(462,38,"Report abuse",S.A.WHITE,!0),this.areaBackbase1?.draw(0,471),this.areaViewport?.bind()),this.sceneDelta=0};drawScene=()=>{if(this.sceneCycle++,this.pushPlayers(),this.pushNpcs(),this.pushProjectiles(),this.pushSpotanims(),this.pushLocs(),!this.cutscene){let t=this.orbitCameraPitch;(this.cameraPitchClamp/256|0)>t&&(t=this.cameraPitchClamp/256|0),this.cameraModifierEnabled[4]&&this.cameraModifierWobbleScale[4]+128>t&&(t=this.cameraModifierWobbleScale[4]+128);const e=this.orbitCameraYaw+this.cameraAnticheatAngle&2047;if(this.localPlayer&&this.orbitCamera(this.orbitCameraX,this.getHeightmapY(this.currentLevel,this.localPlayer.x,this.localPlayer.z)-50,this.orbitCameraZ,e,t,3*t+600),$.K.cyclelogic2++,$.K.cyclelogic2>1802){$.K.cyclelogic2=0,this.out.p1isaac(v.A.ANTICHEAT_CYCLELOGIC2),this.out.p1(0);const t=this.out.pos;this.out.p2(29711),this.out.p1(70),this.out.p1(256*Math.random()|0),this.out.p1(242),this.out.p1(186),this.out.p1(39),this.out.p1(61),2*Math.random()|0||this.out.p1(13),2*Math.random()|0||this.out.p2(57856),this.out.p2(65536*Math.random()|0),this.out.psize1(this.out.pos-t)}}let t;t=this.cutscene?this.getTopLevelCutscene():this.getTopLevel();const e=this.cameraX,i=this.cameraY,s=this.cameraZ,a=this.cameraPitch,h=this.cameraYaw;let n;for(let t=0;t<5;t++)this.cameraModifierEnabled[t]&&(n=Math.random()*(2*this.cameraModifierJitter[t]+1)-this.cameraModifierJitter[t]+Math.sin(this.cameraModifierCycle[t]*(this.cameraModifierWobbleSpeed[t]/100))*this.cameraModifierWobbleScale[t]|0,0===t&&(this.cameraX+=n),1===t&&(this.cameraY+=n),2===t&&(this.cameraZ+=n),3===t&&(this.cameraYaw=this.cameraYaw+n&2047),4===t&&(this.cameraPitch+=n,this.cameraPitch<128&&(this.cameraPitch=128),this.cameraPitch>383&&(this.cameraPitch=383)));n=u.A.cycle,A.A.checkHover=!0,A.A.pickedCount=0,A.A.mouseX=this.mouseX-8,A.A.mouseY=this.mouseY-11,m.A.clear(),this.scene?.draw(this.cameraX,this.cameraY,this.cameraZ,t,this.cameraYaw,this.cameraPitch,this.loopCycle),this.scene?.clearTemporaryLocs(),this.draw2DEntityElements(),this.drawTileHint(),$.K.showDebug&&this.drawDebug(),this.updateTextures(n),this.draw3DEntityElements(),this.areaViewport?.draw(8,11),this.cameraX=e,this.cameraY=i,this.cameraZ=s,this.cameraPitch=a,this.cameraYaw=h};clearCaches=()=>{a.A.modelCacheStatic?.clear(),a.A.modelCacheDynamic?.clear(),n.A.modelCache?.clear(),h.A.modelCache?.clear(),h.A.iconCache?.clear(),H.A.modelCache?.clear(),o.A.modelCache?.clear()};projectFromEntity=(t,e)=>{this.projectFromGround(t.x,e,t.z)};projectFromGround=(t,e,i)=>{if(t<128||i<128||t>13056||i>13056)return this.projectX=-1,void(this.projectY=-1);const s=this.getHeightmapY(this.currentLevel,t,i)-e;this.project(t,s,i)};project=(t,e,i)=>{let s=t-this.cameraX,a=e-this.cameraY,h=i-this.cameraZ;const n=u.A.sin[this.cameraPitch],r=u.A.cos[this.cameraPitch],o=u.A.sin[this.cameraYaw],l=u.A.cos[this.cameraYaw];let c=h*o+s*l>>16;h=h*l-s*o>>16,s=c,c=a*r-h*n>>16,h=a*n+h*r>>16,a=c,h>=50?(this.projectX=u.A.centerX+((s<<9)/h|0),this.projectY=u.A.centerY+((a<<9)/h|0)):(this.projectX=-1,this.projectY=-1)};draw2DEntityElements=()=>{this.chatCount=0;for(let t=-1;t<this.playerCount+this.npcCount;t++){let e=null;if(e=-1===t?this.localPlayer:t<this.playerCount?this.players[this.playerIds[t]]:this.npcs[this.npcIds[t-this.playerCount]],e&&e.isVisible()){if(t<this.playerCount){let i=30;const s=e;if(0!==s.headicons&&(this.projectFromEntity(e,e.height+15),this.projectX>-1))for(let t=0;t<8;t++)s.headicons&1<<t&&(this.imageHeadicons[t]?.draw(this.projectX-12,this.projectY-i),i-=25);t>=0&&10===this.hintType&&this.hintPlayer===this.playerIds[t]&&(this.projectFromEntity(e,e.height+15),this.projectX>-1&&this.imageHeadicons[7]?.draw(this.projectX-12,this.projectY-i))}else 1===this.hintType&&this.hintNpc===this.npcIds[t-this.playerCount]&&this.loopCycle%20<10&&(this.projectFromEntity(e,e.height+15),this.projectX>-1&&this.imageHeadicons[2]?.draw(this.projectX-12,this.projectY-28));if(e.chat&&(t>=this.playerCount||0===this.publicChatSetting||3===this.publicChatSetting||1===this.publicChatSetting&&this.isFriend(e.name))&&(this.projectFromEntity(e,e.height),this.projectX>-1&&this.chatCount<$.K.MAX_CHATS&&this.fontBold12&&(this.chatWidth[this.chatCount]=this.fontBold12.stringWidth(e.chat)/2|0,this.chatHeight[this.chatCount]=this.fontBold12.height,this.chatX[this.chatCount]=this.projectX,this.chatY[this.chatCount]=this.projectY,this.chatColors[this.chatCount]=e.chatColor,this.chatStyles[this.chatCount]=e.chatStyle,this.chatTimers[this.chatCount]=e.chatTimer,this.chats[this.chatCount++]=e.chat,0===this.chatEffects&&1===e.chatStyle&&(this.chatHeight[this.chatCount]+=10,this.chatY[this.chatCount]+=5),0===this.chatEffects&&2===e.chatStyle&&(this.chatWidth[this.chatCount]=60))),e.combatCycle>this.loopCycle+100&&(this.projectFromEntity(e,e.height+15),this.projectX>-1)){let t=30*e.health/e.totalHealth|0;t>30&&(t=30),m.A.fillRect(this.projectX-15,this.projectY-3,t,5,S.A.GREEN),m.A.fillRect(this.projectX-15+t,this.projectY-3,30-t,5,S.A.RED)}if(e.combatCycle>this.loopCycle+330&&(this.projectFromEntity(e,e.height/2|0),this.projectX>-1&&(this.imageHitmarks[e.damageType]?.draw(this.projectX-12,this.projectY-12),this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+4,e.damage.toString(),S.A.BLACK),this.fontPlain11?.drawStringCenter(this.projectX-1,this.projectY+3,e.damage.toString(),S.A.WHITE))),$.K.showDebug){if(e.pathLength>0||e.forceMoveEndCycle>=this.loopCycle||e.forceMoveStartCycle>this.loopCycle){const t=64*e.size;this.debugDrawTileOverlay(128*e.pathTileX[0]+t,128*e.pathTileZ[0]+t,this.currentLevel,e.size,65535,!1)}this.debugDrawTileOverlay(e.x,e.z,this.currentLevel,e.size,6710886,!1);let i=0;if(this.projectFromEntity(e,e.height+30),t<this.playerCount){const t=e;if(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,t.name,S.A.WHITE),i-=15,-1!==t.lastMask&&this.loopCycle-t.lastMaskCycle<30){if(1&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Appearance Update",S.A.WHITE),i-=15),2&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Play Seq: "+t.primarySeqId,S.A.WHITE),i-=15),!(4&~t.lastMask)){let e=t.targetId;e>32767&&(e-=32768),this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Face Entity: "+e,S.A.WHITE),i-=15}8&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Say",S.A.WHITE),i-=15),16&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Hit: Type "+t.damageType+" Amount "+t.damage+" HP "+t.health+"/"+t.totalHealth,S.A.WHITE),i-=15),32&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Face Coord: "+t.lastFaceX/2+" "+t.lastFaceZ/2,S.A.WHITE),i-=15),64&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Chat",S.A.WHITE),i-=15),256&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Play Spotanim: "+t.spotanimId,S.A.WHITE),i-=15),512&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Exact Move",S.A.WHITE),i-=15)}}else{const t=e;let i=0;if(this.projectFromEntity(e,e.height+30),this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,t.type?.name??null,S.A.WHITE),i-=15,-1!==t.lastMask&&this.loopCycle-t.lastMaskCycle<30){if(2&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Play Seq: "+t.primarySeqId,S.A.WHITE),i-=15),!(4&~t.lastMask)){let e=t.targetId;e>32767&&(e-=32768),this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Face Entity: "+e,S.A.WHITE),i-=15}8&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Say",S.A.WHITE),i-=15),16&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Hit: Type "+t.damageType+" Amount "+t.damage+" HP "+t.health+"/"+t.totalHealth,S.A.WHITE),i-=15),32&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Change Type: "+t.type?.id??null,S.A.WHITE),i-=15),64&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Play Spotanim: "+t.spotanimId,S.A.WHITE),i-=15),128&~t.lastMask||(this.fontPlain11?.drawStringCenter(this.projectX,this.projectY+i,"Face Coord: "+t.lastFaceX/2+" "+t.lastFaceZ/2,S.A.WHITE),i-=15)}}}}}if($.K.showDebug)for(let t=0;t<this.userTileMarkers.length;t++){const e=this.userTileMarkers[t];!e||e.level!==this.currentLevel||e.x<0||e.z<0||e.x>=104||e.z>=104||this.debugDrawTileOverlay(128*e.x+64,128*e.z+64,e.level,1,16776960,!1)}for(let t=0;t<this.chatCount;t++){const e=this.chatX[t];let i=this.chatY[t];const s=this.chatWidth[t],a=this.chatHeight[t];let h=!0;for(;h;){h=!1;for(let n=0;n<t;n++)i+2>this.chatY[n]-this.chatHeight[n]&&i-a<this.chatY[n]+2&&e-s<this.chatX[n]+this.chatWidth[n]&&e+s>this.chatX[n]-this.chatWidth[n]&&this.chatY[n]-this.chatHeight[n]<i&&(i=this.chatY[n]-this.chatHeight[n],h=!0)}this.projectX=this.chatX[t],this.projectY=this.chatY[t]=i;const n=this.chats[t];if(0===this.chatEffects){let e=S.A.YELLOW;if(this.chatColors[t]<6&&(e=S.A.CHAT_COLORS[this.chatColors[t]]),6===this.chatColors[t]&&(e=this.sceneCycle%20<10?S.A.RED:S.A.YELLOW),7===this.chatColors[t]&&(e=this.sceneCycle%20<10?S.A.BLUE:S.A.CYAN),8===this.chatColors[t]&&(e=this.sceneCycle%20<10?45056:8454016),9===this.chatColors[t]){const i=150-this.chatTimers[t];i<50?e=1280*i+S.A.RED:i<100?e=S.A.YELLOW-327680*(i-50):i<150&&(e=5*(i-100)+S.A.GREEN)}if(10===this.chatColors[t]){const i=150-this.chatTimers[t];i<50?e=5*i+S.A.RED:i<100?e=S.A.MAGENTA-327680*(i-50):i<150&&(e=327680*(i-100)+S.A.BLUE-5*(i-100))}if(11===this.chatColors[t]){const i=150-this.chatTimers[t];i<50?e=S.A.WHITE-327685*i:i<100?e=327685*(i-50)+S.A.GREEN:i<150&&(e=S.A.WHITE-327680*(i-100))}if(0===this.chatStyles[t]&&(this.fontBold12?.drawStringCenter(this.projectX,this.projectY+1,n,S.A.BLACK),this.fontBold12?.drawStringCenter(this.projectX,this.projectY,n,e)),1===this.chatStyles[t]&&(this.fontBold12?.drawCenteredWave(this.projectX,this.projectY+1,n,S.A.BLACK,this.sceneCycle),this.fontBold12?.drawCenteredWave(this.projectX,this.projectY,n,e,this.sceneCycle)),2===this.chatStyles[t]){const i=this.fontBold12?.stringWidth(n)??0,s=(150-this.chatTimers[t])*(i+100)/150;m.A.setBounds(334,this.projectX+50,0,this.projectX-50),this.fontBold12?.drawString(this.projectX+50-s,this.projectY+1,n,S.A.BLACK),this.fontBold12?.drawString(this.projectX+50-s,this.projectY,n,e),m.A.resetBounds()}}else this.fontBold12?.drawStringCenter(this.projectX,this.projectY+1,n,S.A.BLACK),this.fontBold12?.drawStringCenter(this.projectX,this.projectY,n,S.A.YELLOW)}};drawTileHint=()=>{2===this.hintType&&this.imageHeadicons[2]&&(this.projectFromGround((this.hintTileX-this.sceneBaseTileX<<7)+this.hintOffsetX,2*this.hintHeight,(this.hintTileZ-this.sceneBaseTileZ<<7)+this.hintOffsetZ),this.projectX>-1&&this.loopCycle%20<10&&this.imageHeadicons[2].draw(this.projectX-12,this.projectY-28))};drawDebug=()=>{const t=507;let e=13;this.fontPlain11?.drawStringRight(t,e,`FPS: ${this.fps}`,S.A.YELLOW,!0),e+=13,this.fontPlain11?.drawStringRight(t,e,`Speed: ${this.ms.toFixed(4)} ms`,S.A.YELLOW,!0),e+=13,this.fontPlain11?.drawStringRight(t,e,`Average: ${this.msAvg.toFixed(4)} ms`,S.A.YELLOW,!0),e+=13,this.fontPlain11?.drawStringRight(t,e,`Slowest: ${this.slowestMS.toFixed(4)} ms`,S.A.YELLOW,!0),e+=13,this.fontPlain11?.drawStringRight(t,e,`Occluders: ${z.A.levelOccluderCount[z.A.topLevel]} Active: ${z.A.activeOccluderCount}`,S.A.YELLOW,!0),e+=13,this.lastTickFlag?this.fontPlain11?.drawStringRight(t,e,"tock",S.A.YELLOW,!0):this.fontBold12?.drawStringRight(t,e,"tick",S.A.YELLOW,!0)};debugDrawTileOverlay=(t,e,i,s,a,h)=>{const n=this.getHeightmapY(i,t,e),r=64*s;this.project(t-r,n,e-r);const o=this.projectX,l=this.projectY;this.project(t+r,n,e-r);const c=this.projectX,d=this.projectY;this.project(t-r,n,e+r);const u=this.projectX,p=this.projectY;this.project(t+r,n,e+r);const f=this.projectX,g=this.projectY;-1!==o&&-1!==c&&-1!==u&&-1!==f&&(h&&(m.A.drawLine(o,l,f,g,(16711422&a)>>1),m.A.drawLine(c,d,u,p,(16711422&a)>>1)),m.A.drawLine(o,l,c,d,a),m.A.drawLine(o,l,u,p,a),m.A.drawLine(c,d,f,g,a),m.A.drawLine(u,p,f,g,a))};draw3DEntityElements=()=>{if(this.drawPrivateMessages(),1===this.crossMode&&this.imageCrosses[this.crossCycle/100|0]?.draw(this.crossX-8-8,this.crossY-8-11),2===this.crossMode&&this.imageCrosses[4+(this.crossCycle/100|0)]?.draw(this.crossX-8-8,this.crossY-8-11),-1!==this.viewportInterfaceId&&(this.updateInterfaceAnimation(this.viewportInterfaceId,this.sceneDelta),this.drawInterface(c.A.instances[this.viewportInterfaceId],0,0,0)),this.drawWildyLevel(),this.menuVisible?0===this.menuArea&&this.drawMenu():(this.handleInput(),this.drawTooltip()),1===this.inMultizone&&(this.wildernessLevel>0||1===this.worldLocationState?this.imageHeadicons[1]?.draw(472,258):this.imageHeadicons[1]?.draw(472,296)),this.wildernessLevel>0&&(this.imageHeadicons[0]?.draw(472,296),this.fontPlain12?.drawStringCenter(484,329,"Level: "+this.wildernessLevel,S.A.YELLOW)),1===this.worldLocationState&&(this.imageHeadicons[6]?.draw(472,296),this.fontPlain12?.drawStringCenter(484,329,"Arena",S.A.YELLOW)),0!==this.systemUpdateTimer){let t=this.systemUpdateTimer/50|0;const e=t/60|0;t%=60,t<10?this.fontPlain12?.drawString(4,329,"System update in: "+e+":0"+t,S.A.YELLOW):this.fontPlain12?.drawString(4,329,"System update in: "+e+":"+t,S.A.YELLOW)}};drawPrivateMessages=()=>{if(0===this.splitPrivateChat)return;const t=this.fontPlain12;let e=0;0!==this.systemUpdateTimer&&(e=1);for(let i=0;i<100;i++){if(!this.messageText[i])continue;const s=this.messageType[i];let a;if((3===s||7===s)&&(7===s||0===this.privateChatSetting||1===this.privateChatSetting&&this.isFriend(this.messageSender[i]))&&(a=329-13*e,t?.drawString(4,a,"From "+this.messageSender[i]+": "+this.messageText[i],S.A.BLACK),t?.drawString(4,a-1,"From "+this.messageSender[i]+": "+this.messageText[i],S.A.CYAN),e++,e>=5))return;if(5===s&&this.privateChatSetting<2&&(a=329-13*e,t?.drawString(4,a,this.messageText[i],S.A.BLACK),t?.drawString(4,a-1,this.messageText[i],S.A.CYAN),e++,e>=5))return;if(6===s&&this.privateChatSetting<2&&(a=329-13*e,t?.drawString(4,a,"To "+this.messageSender[i]+": "+this.messageText[i],S.A.BLACK),t?.drawString(4,a-1,"To "+this.messageSender[i]+": "+this.messageText[i],S.A.CYAN),e++,e>=5))return}};drawWildyLevel=()=>{if(!this.localPlayer)return;const t=(this.localPlayer.x>>7)+this.sceneBaseTileX,e=(this.localPlayer.z>>7)+this.sceneBaseTileZ;if(this.wildernessLevel=t>=2944&&t<3392&&e>=3520&&e<6400?1+((e-3520)/8|0):t>=2944&&t<3392&&e>=9920&&e<12800?1+((e-9920)/8|0):0,this.worldLocationState=0,t>=3328&&t<3392&&e>=3200&&e<3264){const i=63&t,s=63&e;(i>=4&&i<=29&&s>=44&&s<=58||i>=36&&i<=61&&s>=44&&s<=58||i>=4&&i<=29&&s>=25&&s<=39||i>=36&&i<=61&&s>=25&&s<=39||i>=4&&i<=29&&s>=6&&s<=20||i>=36&&i<=61&&s>=6&&s<=20)&&(this.worldLocationState=1)}0===this.worldLocationState&&t>=3328&&t<=3393&&e>=3203&&e<=3325&&(this.worldLocationState=2),this.overrideChat=0,(t>=3053&&t<=3156&&e>=3056&&e<=3136||t>=3072&&t<=3118&&e>=9492&&e<=9535)&&(this.overrideChat=1),1===this.overrideChat&&t>=3139&&t<=3199&&e>=3008&&e<=3062&&(this.overrideChat=0)};drawSidebar=()=>{this.areaSidebar?.bind(),this.areaSidebarOffsets&&(u.A.lineOffset=this.areaSidebarOffsets),this.imageInvback?.draw(0,0),-1!==this.sidebarInterfaceId?this.drawInterface(c.A.instances[this.sidebarInterfaceId],0,0,0):-1!==this.tabInterfaceId[this.selectedTab]&&this.drawInterface(c.A.instances[this.tabInterfaceId[this.selectedTab]],0,0,0),this.menuVisible&&1===this.menuArea&&this.drawMenu(),this.areaSidebar?.draw(562,231),this.areaViewport?.bind(),this.areaViewportOffsets&&(u.A.lineOffset=this.areaViewportOffsets)};drawChatback=()=>{if(this.areaChatback?.bind(),this.areaChatbackOffsets&&(u.A.lineOffset=this.areaChatbackOffsets),this.imageChatback?.draw(0,0),this.showSocialInput)this.fontBold12?.drawStringCenter(239,40,this.socialMessage,S.A.BLACK),this.fontBold12?.drawStringCenter(239,60,this.socialInput+"*",S.A.DARKBLUE);else if(this.chatbackInputOpen)this.fontBold12?.drawStringCenter(239,40,"Enter amount:",S.A.BLACK),this.fontBold12?.drawStringCenter(239,60,this.chatbackInput+"*",S.A.DARKBLUE);else if(this.modalMessage)this.fontBold12?.drawStringCenter(239,40,this.modalMessage,S.A.BLACK),this.fontBold12?.drawStringCenter(239,60,"Click to continue",S.A.DARKBLUE);else if(-1!==this.chatInterfaceId)this.drawInterface(c.A.instances[this.chatInterfaceId],0,0,0);else if(-1===this.stickyChatInterfaceId){const t=this.fontPlain12;let e=0;m.A.setBounds(0,0,463,77);for(let i=0;i<100;i++){const s=this.messageText[i];if(!s)continue;const a=this.messageType[i],h=this.chatScrollOffset+70-14*e;0===a&&(h>0&&h<110&&t?.drawString(4,h,s,S.A.BLACK),e++),1===a&&(h>0&&h<110&&(t?.drawString(4,h,this.messageSender[i]+":",S.A.WHITE),t?.drawString(t.stringWidth(this.messageSender[i])+12,h,s,S.A.BLUE)),e++),2===a&&(0===this.publicChatSetting||1===this.publicChatSetting&&this.isFriend(this.messageSender[i]))&&(h>0&&h<110&&(t?.drawString(4,h,this.messageSender[i]+":",S.A.BLACK),t?.drawString(t.stringWidth(this.messageSender[i])+12,h,s,S.A.BLUE)),e++),3!==a&&7!==a||0!==this.splitPrivateChat||!(7===a||0===this.privateChatSetting||1===this.privateChatSetting&&this.isFriend(this.messageSender[i]))||(h>0&&h<110&&(t?.drawString(4,h,"From "+this.messageSender[i]+":",S.A.BLACK),t?.drawString(t.stringWidth("From "+this.messageSender[i])+12,h,s,S.A.DARKRED)),e++),4===a&&(0===this.tradeChatSetting||1===this.tradeChatSetting&&this.isFriend(this.messageSender[i]))&&(h>0&&h<110&&t?.drawString(4,h,this.messageSender[i]+" "+this.messageText[i],S.A.TRADE_MESSAGE),e++),5===a&&0===this.splitPrivateChat&&this.privateChatSetting<2&&(h>0&&h<110&&t?.drawString(4,h,s,S.A.DARKRED),e++),6===a&&0===this.splitPrivateChat&&this.privateChatSetting<2&&(h>0&&h<110&&(t?.drawString(4,h,"To "+this.messageSender[i]+":",S.A.BLACK),t?.drawString(t.stringWidth("To "+this.messageSender[i])+12,h,s,S.A.DARKRED)),e++),8===a&&(0===this.tradeChatSetting||1===this.tradeChatSetting&&this.isFriend(this.messageSender[i]))&&(h>0&&h<110&&t?.drawString(4,h,this.messageSender[i]+" "+this.messageText[i],S.A.DUEL_MESSAGE),e++)}m.A.resetBounds(),this.chatScrollHeight=14*e+7,this.chatScrollHeight<78&&(this.chatScrollHeight=78),this.drawScrollbar(463,0,this.chatScrollHeight-this.chatScrollOffset-77,this.chatScrollHeight,77),t?.drawString(4,90,M.A.formatName(this.username)+":",S.A.BLACK),t?.drawString(t.stringWidth(this.username+": ")+6,90,this.chatTyped+"*",S.A.BLUE),m.A.drawHorizontalLine(0,77,S.A.BLACK,479)}else this.drawInterface(c.A.instances[this.stickyChatInterfaceId],0,0,0);this.menuVisible&&2===this.menuArea&&this.drawMenu(),this.areaChatback?.draw(22,375),this.areaViewport?.bind(),this.areaViewportOffsets&&(u.A.lineOffset=this.areaViewportOffsets)};drawMinimap=()=>{if(this.areaMapback?.bind(),!this.localPlayer)return;const t=this.orbitCameraYaw+this.minimapAnticheatAngle&2047;let e=48+(this.localPlayer.x/32|0),i=464-(this.localPlayer.z/32|0);this.imageMinimap?.drawRotatedMasked(21,9,146,151,this.minimapMaskLineOffsets,this.minimapMaskLineLengths,e,i,t,this.minimapZoom+256),this.imageCompass?.drawRotatedMasked(0,0,33,33,this.compassMaskLineOffsets,this.compassMaskLineLengths,25,25,this.orbitCameraYaw,256);for(let t=0;t<this.activeMapFunctionCount;t++)e=4*this.activeMapFunctionX[t]+2-(this.localPlayer.x/32|0),i=4*this.activeMapFunctionZ[t]+2-(this.localPlayer.z/32|0),this.drawOnMinimap(i,this.activeMapFunctions[t],e);for(let t=0;t<x.A.SIZE;t++)for(let s=0;s<x.A.SIZE;s++)this.levelObjStacks[this.currentLevel][t][s]&&(e=4*t+2-(this.localPlayer.x/32|0),i=4*s+2-(this.localPlayer.z/32|0),this.drawOnMinimap(i,this.imageMapdot0,e));for(let t=0;t<this.npcCount;t++){const s=this.npcs[this.npcIds[t]];s&&s.isVisible()&&s.type&&s.type.minimap&&(e=(s.x/32|0)-(this.localPlayer.x/32|0),i=(s.z/32|0)-(this.localPlayer.z/32|0),this.drawOnMinimap(i,this.imageMapdot1,e))}for(let t=0;t<this.playerCount;t++){const s=this.players[this.playerIds[t]];if(s&&s.isVisible()&&s.name){e=(s.x/32|0)-(this.localPlayer.x/32|0),i=(s.z/32|0)-(this.localPlayer.z/32|0);let t=!1;const a=M.A.toBase37(s.name);for(let e=0;e<this.friendCount;e++)if(a===this.friendName37[e]&&0!==this.friendWorld[e]){t=!0;break}t?this.drawOnMinimap(i,this.imageMapdot3,e):this.drawOnMinimap(i,this.imageMapdot2,e)}}0!==this.flagSceneTileX&&(e=4*this.flagSceneTileX+2-(this.localPlayer.x/32|0),i=4*this.flagSceneTileZ+2-(this.localPlayer.z/32|0),this.drawOnMinimap(i,this.imageMapflag,e)),m.A.fillRect(93,82,3,3,S.A.WHITE),this.areaViewport?.bind()};drawOnMinimap=(t,e,i)=>{if(!e)return;const s=this.orbitCameraYaw+this.minimapAnticheatAngle&2047,a=i*i+t*t;if(a>6400)return;let h=u.A.sin[s],n=u.A.cos[s];h=256*h/(this.minimapZoom+256)|0,n=256*n/(this.minimapZoom+256)|0;const r=t*h+i*n>>16,o=t*n-i*h>>16;a>2500&&this.imageMapback?e.drawMasked(r+94-(e.cropW/2|0),83-o-(e.cropH/2|0),this.imageMapback):e.draw(r+94-(e.cropW/2|0),83-o-(e.cropH/2|0))};createMinimap=t=>{if(!this.imageMinimap)return;const e=this.imageMinimap.pixels,i=e.length;for(let t=0;t<i;t++)e[t]=0;for(let i=1;i<x.A.SIZE-1;i++){let s=512*(x.A.SIZE-1-i)*4+24628;for(let a=1;a<x.A.SIZE-1;a++)!this.levelTileFlags||24&this.levelTileFlags[t][a][i]||this.scene?.drawMinimapTile(t,a,i,e,s,512),t<3&&this.levelTileFlags&&8&this.levelTileFlags[t+1][a][i]&&this.scene?.drawMinimapTile(t+1,a,i,e,s,512),s+=4}const s=(238+(20*Math.random()|0)-10<<16)+(238+(20*Math.random()|0)-10<<8)+(20*Math.random()|0)+238-10,h=238+(20*Math.random()|0)-10<<16;this.imageMinimap.bind();for(let e=1;e<x.A.SIZE-1;e++)for(let i=1;i<x.A.SIZE-1;i++)!this.levelTileFlags||24&this.levelTileFlags[t][i][e]||this.drawMinimapLoc(i,e,t,s,h),t<3&&this.levelTileFlags&&8&this.levelTileFlags[t+1][i][e]&&this.drawMinimapLoc(i,e,t+1,s,h);this.areaViewport?.bind(),this.activeMapFunctionCount=0;for(let t=0;t<x.A.SIZE;t++)for(let e=0;e<x.A.SIZE;e++){let i=this.scene?.getGroundDecorationBitset(this.currentLevel,t,e)??0;if(0===i)continue;i=i>>14&32767;const s=a.A.get(i).mapfunction;if(s<0)continue;let h=t,n=e;if(22!==s&&29!==s&&34!==s&&36!==s&&46!==s&&47!==s&&48!==s){const i=x.A.SIZE,s=x.A.SIZE,a=this.levelCollisionMap[this.currentLevel];if(a){const r=a.flags;for(let a=0;a<10;a++){const a=4*Math.random()|0;0===a&&h>0&&h>t-3&&(r[x.A.index(h-1,n)]&F.A.BLOCK_WEST)===F.A.OPEN&&h--,1===a&&h<i-1&&h<t+3&&(r[x.A.index(h+1,n)]&F.A.BLOCK_EAST)===F.A.OPEN&&h++,2===a&&n>0&&n>e-3&&(r[x.A.index(h,n-1)]&F.A.BLOCK_SOUTH)===F.A.OPEN&&n--,3===a&&n<s-1&&n<e+3&&(r[x.A.index(h,n+1)]&F.A.BLOCK_NORTH)===F.A.OPEN&&n++}}}this.activeMapFunctions[this.activeMapFunctionCount]=this.imageMapfunction[s],this.activeMapFunctionX[this.activeMapFunctionCount]=h,this.activeMapFunctionZ[this.activeMapFunctionCount]=n,this.activeMapFunctionCount++}};drawMinimapLoc=(t,e,i,s,h)=>{if(!this.scene||!this.imageMinimap)return;let n=this.scene.getWallBitset(i,t,e);if(0!==n){const r=this.scene.getInfo(i,t,e,n),o=r>>6&3,l=31&r;let c=s;n>0&&(c=h);const d=this.imageMinimap.pixels,m=4*t+512*(103-e)*4+24624,u=n>>14&32767,p=a.A.get(u);if(-1===p.mapscene)l!==N.A.WALL_STRAIGHT.id&&l!==N.A.WALL_L.id||(o===R.A.WEST?(d[m]=c,d[m+512]=c,d[m+1024]=c,d[m+1536]=c):o===R.A.NORTH?(d[m]=c,d[m+1]=c,d[m+2]=c,d[m+3]=c):o===R.A.EAST?(d[m+3]=c,d[m+3+512]=c,d[m+3+1024]=c,d[m+3+1536]=c):o===R.A.SOUTH&&(d[m+1536]=c,d[m+1536+1]=c,d[m+1536+2]=c,d[m+1536+3]=c)),l===N.A.WALL_SQUARE_CORNER.id&&(o===R.A.WEST?d[m]=c:o===R.A.NORTH?d[m+3]=c:o===R.A.EAST?d[m+3+1536]=c:o===R.A.SOUTH&&(d[m+1536]=c)),l===N.A.WALL_L.id&&(o===R.A.SOUTH?(d[m]=c,d[m+512]=c,d[m+1024]=c,d[m+1536]=c):o===R.A.WEST?(d[m]=c,d[m+1]=c,d[m+2]=c,d[m+3]=c):o===R.A.NORTH?(d[m+3]=c,d[m+3+512]=c,d[m+3+1024]=c,d[m+3+1536]=c):o===R.A.EAST&&(d[m+1536]=c,d[m+1536+1]=c,d[m+1536+2]=c,d[m+1536+3]=c));else{const i=this.imageMapscene[p.mapscene];if(i){const s=(4*p.width-i.width)/2|0,a=(4*p.length-i.height)/2|0;i.draw(4*t+48+s,4*(x.A.SIZE-e-p.length)+a+48)}}}if(n=this.scene.getLocBitset(i,t,e),0!==n){const s=this.scene.getInfo(i,t,e,n),h=s>>6&3,r=31&s,o=n>>14&32767,l=a.A.get(o);if(-1!==l.mapscene){const i=this.imageMapscene[l.mapscene];if(i){const s=(4*l.width-i.width)/2|0,a=(4*l.length-i.height)/2|0;i.draw(4*t+48+s,4*(x.A.SIZE-e-l.length)+a+48)}}else if(r===N.A.WALL_DIAGONAL.id){let i=15658734;n>0&&(i=15597568);const s=this.imageMinimap.pixels,a=4*t+512*(x.A.SIZE-1-e)*4+24624;h===R.A.WEST||h===R.A.EAST?(s[a+1536]=i,s[a+1024+1]=i,s[a+512+2]=i,s[a+3]=i):(s[a]=i,s[a+512+1]=i,s[a+1024+2]=i,s[a+1536+3]=i)}}if(n=this.scene.getGroundDecorationBitset(i,t,e),0!==n){const i=a.A.get(n>>14&32767);if(-1!==i.mapscene){const s=this.imageMapscene[i.mapscene];if(s){const a=(4*i.width-s.width)/2|0,h=(4*i.length-s.height)/2|0;s.draw(4*t+48+a,4*(x.A.SIZE-e-i.length)+h+48)}}}};drawTooltip=()=>{if(this.menuSize<2&&0===this.objSelected&&0===this.spellSelected)return;let t;t=1===this.objSelected&&this.menuSize<2?"Use "+this.objSelectedName+" with...":1===this.spellSelected&&this.menuSize<2?this.spellCaption+"...":this.menuOption[this.menuSize-1],this.menuSize>2&&(t=t+"@whi@ / "+(this.menuSize-2)+" more options"),this.fontBold12?.drawStringTooltip(4,15,t,S.A.WHITE,!0,this.loopCycle/1e3|0)};drawMenu=()=>{const t=this.menuX,e=this.menuY,i=this.menuWidth,s=this.menuHeight,a=S.A.OPTIONS_MENU;m.A.fillRect(t,e,i,s,a),m.A.fillRect(t+1,e+1,i-2,16,S.A.BLACK),m.A.drawRect(t+1,e+18,i-2,s-19,S.A.BLACK),this.fontBold12?.drawString(t+3,e+14,"Choose Option",a);let h=this.mouseX,n=this.mouseY;0===this.menuArea&&(h-=8,n-=11),1===this.menuArea&&(h-=562,n-=231),2===this.menuArea&&(h-=22,n-=375);for(let s=0;s<this.menuSize;s++){const a=e+15*(this.menuSize-1-s)+31;let r=S.A.WHITE;h>t&&h<t+i&&n>a-13&&n<a+3&&(r=S.A.YELLOW),this.fontBold12?.drawStringTaggable(t+3,a,this.menuOption[s],r,!0)}};handleMouseInput=async()=>{if(0!==this.objDragArea)return;let t=this.mouseClickButton;if(1===this.spellSelected&&this.mouseClickX>=520&&this.mouseClickY>=165&&this.mouseClickX<=788&&this.mouseClickY<=230&&(t=0),this.menuVisible){if(1!==t){let t=this.mouseX,e=this.mouseY;0===this.menuArea?(t-=8,e-=11):1===this.menuArea?(t-=562,e-=231):2===this.menuArea&&(t-=22,e-=375),(t<this.menuX-10||t>this.menuX+this.menuWidth+10||e<this.menuY-10||e>this.menuY+this.menuHeight+10)&&(this.menuVisible=!1,1===this.menuArea&&(this.redrawSidebar=!0),2===this.menuArea&&(this.redrawChatback=!0))}if(1===t){const t=this.menuX,e=this.menuY,i=this.menuWidth;let s=this.mouseClickX,a=this.mouseClickY;0===this.menuArea?(s-=8,a-=11):1===this.menuArea?(s-=562,a-=231):2===this.menuArea&&(s-=22,a-=375);let h=-1;for(let n=0;n<this.menuSize;n++){const r=e+15*(this.menuSize-1-n)+31;s>t&&s<t+i&&a>r-13&&a<r+3&&(h=n)}-1!==h&&await this.useMenuOption(h),this.menuVisible=!1,1===this.menuArea?this.redrawSidebar=!0:2===this.menuArea&&(this.redrawChatback=!0)}}else{if(1===t&&this.menuSize>0){const t=this.menuAction[this.menuSize-1];if(602===t||596===t||22===t||892===t||415===t||405===t||38===t||422===t||478===t||347===t||188===t){const t=this.menuParamB[this.menuSize-1],e=this.menuParamC[this.menuSize-1];if(c.A.instances[e].draggable)return this.objGrabThreshold=!1,this.objDragCycles=0,this.objDragInterfaceId=e,this.objDragSlot=t,this.objDragArea=2,this.objGrabX=this.mouseClickX,this.objGrabY=this.mouseClickY,c.A.instances[e].layer===this.viewportInterfaceId&&(this.objDragArea=1),void(c.A.instances[e].layer===this.chatInterfaceId&&(this.objDragArea=3))}}if(1===t&&(1===this.mouseButtonsOption||this.isAddFriendOption(this.menuSize-1))&&this.menuSize>2&&(t=2),1===t&&this.menuSize>0&&await this.useMenuOption(this.menuSize-1),2!==t||this.menuSize<=0)return;this.showContextMenu()}};handleMinimapInput=()=>{if(1===this.mouseClickButton&&this.localPlayer){let t=this.mouseClickX-21-561,e=this.mouseClickY-9-5;if(t>=0&&e>=0&&t<146&&e<151){t-=73,e-=75;const i=this.orbitCameraYaw+this.minimapAnticheatAngle&2047;let s=u.A.sin[i],a=u.A.cos[i];s=s*(this.minimapZoom+256)>>8,a=a*(this.minimapZoom+256)>>8;const h=e*s+t*a>>11,n=e*a-t*s>>11,r=this.localPlayer.x+h>>7,o=this.localPlayer.z-n>>7;this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],r,o,1,0,0,0,0,0,!0)&&(this.out.p1(t),this.out.p1(e),this.out.p2(this.orbitCameraYaw),this.out.p1(57),this.out.p1(this.minimapAnticheatAngle),this.out.p1(this.minimapZoom),this.out.p1(89),this.out.p2(this.localPlayer.x),this.out.p2(this.localPlayer.z),this.out.p1(this.tryMoveNearest),this.out.p1(63))}}};isAddFriendOption=t=>{if(t<0)return!1;let e=this.menuAction[t];return e>=2e3&&(e-=2e3),406===e};useMenuOption=async t=>{if(t<0)return;this.chatbackInputOpen&&(this.chatbackInputOpen=!1,this.redrawChatback=!0);let e=this.menuAction[t];const i=this.menuParamA[t],s=this.menuParamB[t],n=this.menuParamC[t];if(e>=2e3&&(e-=2e3),903===e||363===e){let i=this.menuOption[t];const s=i.indexOf("@whi@");if(-1!==s){i=i.substring(s+5).trim();const t=M.A.formatName(M.A.fromBase37(M.A.toBase37(i)));let a=!1;for(let i=0;i<this.playerCount;i++){const s=this.players[this.playerIds[i]];if(s&&s.name&&s.name.toLowerCase()===t.toLowerCase()&&this.localPlayer){this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],s.pathTileX[0],s.pathTileZ[0],2,1,1,0,0,0,!1),903===e?this.out.p1isaac(v.A.OPPLAYER4):363===e&&this.out.p1isaac(v.A.OPPLAYER1),this.out.p2(this.playerIds[i]),a=!0;break}}a||this.addMessage(0,"Unable to find "+t,"")}}else if(450===e&&this.interactWithLoc(v.A.OPLOCU,s,n,i))this.out.p2(this.objInterface),this.out.p2(this.objSelectedSlot),this.out.p2(this.objSelectedInterface);else if(405===e||38===e||422===e||478===e||347===e)478===e?(3&s||$.K.oplogic5++,$.K.oplogic5>=90&&this.out.p1isaac(v.A.ANTICHEAT_OPLOGIC5),this.out.p1isaac(v.A.OPHELD4)):347===e?this.out.p1isaac(v.A.OPHELD5):422===e?this.out.p1isaac(v.A.OPHELD3):405===e?($.K.oplogic3+=i,$.K.oplogic3>=97&&(this.out.p1isaac(v.A.ANTICHEAT_OPLOGIC3),this.out.p3(14953816)),this.out.p1isaac(v.A.OPHELD1)):38===e&&this.out.p1isaac(v.A.OPHELD2),this.out.p2(i),this.out.p2(s),this.out.p2(n),this.selectedCycle=0,this.selectedInterface=n,this.selectedItem=s,this.selectedArea=2,c.A.instances[n].layer===this.viewportInterfaceId&&(this.selectedArea=1),c.A.instances[n].layer===this.chatInterfaceId&&(this.selectedArea=3);else if(728===e||542===e||6===e||963===e||245===e){const t=this.npcs[i];t&&this.localPlayer&&(this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],t.pathTileX[0],t.pathTileZ[0],2,1,1,0,0,0,!1),this.crossX=this.mouseClickX,this.crossY=this.mouseClickY,this.crossMode=2,this.crossCycle=0,542===e?this.out.p1isaac(v.A.OPNPC2):6===e?(3&i||$.K.oplogic2++,$.K.oplogic2>=124&&(this.out.p1isaac(v.A.ANTICHEAT_OPLOGIC2),this.out.p4(0)),this.out.p1isaac(v.A.OPNPC3)):963===e?this.out.p1isaac(v.A.OPNPC4):728===e?this.out.p1isaac(v.A.OPNPC1):245===e&&(3&i||$.K.oplogic4++,$.K.oplogic4>=85&&(this.out.p1isaac(v.A.ANTICHEAT_OPLOGIC4),this.out.p2(39596)),this.out.p1isaac(v.A.OPNPC5)),this.out.p2(i))}else if(217===e)this.localPlayer&&(this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],s,n,2,0,0,0,0,0,!1)||this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],s,n,2,1,1,0,0,0,!1),this.crossX=this.mouseClickX,this.crossY=this.mouseClickY,this.crossMode=2,this.crossCycle=0,this.out.p1isaac(v.A.OPOBJU),this.out.p2(s+this.sceneBaseTileX),this.out.p2(n+this.sceneBaseTileZ),this.out.p2(i),this.out.p2(this.objInterface),this.out.p2(this.objSelectedSlot),this.out.p2(this.objSelectedInterface));else if(1175===e){const t=i>>14&32767,e=a.A.get(t);let s;s=e.desc?e.desc:"It's a "+e.name+".",this.addMessage(0,s,"")}else if(285===e)this.interactWithLoc(v.A.OPLOC1,s,n,i);else if(881===e)this.out.p1isaac(v.A.OPHELDU),this.out.p2(i),this.out.p2(s),this.out.p2(n),this.out.p2(this.objInterface),this.out.p2(this.objSelectedSlot),this.out.p2(this.objSelectedInterface),this.selectedCycle=0,this.selectedInterface=n,this.selectedItem=s,this.selectedArea=2,c.A.instances[n].layer===this.viewportInterfaceId&&(this.selectedArea=1),c.A.instances[n].layer===this.chatInterfaceId&&(this.selectedArea=3);else if(391===e)this.out.p1isaac(v.A.OPHELDT),this.out.p2(i),this.out.p2(s),this.out.p2(n),this.out.p2(this.activeSpellId),this.selectedCycle=0,this.selectedInterface=n,this.selectedItem=s,this.selectedArea=2,c.A.instances[n].layer===this.viewportInterfaceId&&(this.selectedArea=1),c.A.instances[n].layer===this.chatInterfaceId&&(this.selectedArea=3);else if(660===e)this.menuVisible?this.scene?.click(s-8,n-11):this.scene?.click(this.mouseClickX-8,this.mouseClickY-11);else{if(188===e)return this.objSelected=1,this.objSelectedSlot=s,this.objSelectedInterface=n,this.objInterface=i,this.objSelectedName=h.A.get(i).name,void(this.spellSelected=0);if(44===e)this.pressedContinueOption||(this.out.p1isaac(v.A.RESUME_PAUSEBUTTON),this.out.p2(n),this.pressedContinueOption=!0);else if(1773===e){const t=h.A.get(i);let e;e=n>=1e5?n+" x "+t.name:t.desc?t.desc:"It's a "+t.name+".",this.addMessage(0,e,"")}else if(900===e){const t=this.npcs[i];t&&this.localPlayer&&(this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],t.pathTileX[0],t.pathTileZ[0],2,1,1,0,0,0,!1),this.crossX=this.mouseClickX,this.crossY=this.mouseClickY,this.crossMode=2,this.crossCycle=0,this.out.p1isaac(v.A.OPNPCU),this.out.p2(i),this.out.p2(this.objInterface),this.out.p2(this.objSelectedSlot),this.out.p2(this.objSelectedInterface))}else if(1373===e||1544===e||151===e||1101===e){const t=this.players[i];t&&this.localPlayer&&(this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],t.pathTileX[0],t.pathTileZ[0],2,1,1,0,0,0,!1),this.crossX=this.mouseClickX,this.crossY=this.mouseClickY,this.crossMode=2,this.crossCycle=0,1101===e?this.out.p1isaac(v.A.OPPLAYER1):151===e?($.K.oplogic8++,$.K.oplogic8>=90&&(this.out.p1isaac(v.A.ANTICHEAT_OPLOGIC8),this.out.p2(31114)),this.out.p1isaac(v.A.OPPLAYER2)):1373===e?this.out.p1isaac(v.A.OPPLAYER4):1544===e&&this.out.p1isaac(v.A.OPPLAYER3),this.out.p2(i))}else if(265===e){const t=this.npcs[i];t&&this.localPlayer&&(this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],t.pathTileX[0],t.pathTileZ[0],2,1,1,0,0,0,!1),this.crossX=this.mouseClickX,this.crossY=this.mouseClickY,this.crossMode=2,this.crossCycle=0,this.out.p1isaac(v.A.OPNPCT),this.out.p2(i),this.out.p2(this.activeSpellId))}else if(679===e){const e=this.menuOption[t],i=e.indexOf("@whi@");if(-1!==i){const t=M.A.toBase37(e.substring(i+5).trim());let s=-1;for(let e=0;e<this.friendCount;e++)if(this.friendName37[e]===t){s=e;break}-1!==s&&this.friendWorld[s]>0&&(this.redrawChatback=!0,this.chatbackInputOpen=!1,this.showSocialInput=!0,this.socialInput="",this.socialAction=3,this.socialName37=this.friendName37[s],this.socialMessage="Enter message to send to "+this.friendName[s])}}else if(55===e)this.interactWithLoc(v.A.OPLOCT,s,n,i)&&this.out.p2(this.activeSpellId);else if(224===e||993===e||99===e||746===e||877===e)this.localPlayer&&(this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],s,n,2,0,0,0,0,0,!1)||this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],s,n,2,1,1,0,0,0,!1),this.crossX=this.mouseClickX,this.crossY=this.mouseClickY,this.crossMode=2,this.crossCycle=0,224===e?this.out.p1isaac(v.A.OPOBJ1):746===e?this.out.p1isaac(v.A.OPOBJ4):877===e?this.out.p1isaac(v.A.OPOBJ5):99===e?this.out.p1isaac(v.A.OPOBJ3):993===e&&this.out.p1isaac(v.A.OPOBJ2),this.out.p2(s+this.sceneBaseTileX),this.out.p2(n+this.sceneBaseTileZ),this.out.p2(i));else if(1607===e){const t=this.npcs[i];if(t&&t.type){let e;e=t.type.desc?t.type.desc:"It's a "+t.type.name+".",this.addMessage(0,e,"")}}else if(504===e)this.interactWithLoc(v.A.OPLOC2,s,n,i);else{if(930===e){const t=c.A.instances[n];this.spellSelected=1,this.activeSpellId=n,this.activeSpellFlags=t.actionTarget,this.objSelected=0;let e=t.actionVerb;e&&-1!==e.indexOf(" ")&&(e=e.substring(0,e.indexOf(" ")));let i=t.actionVerb;return i&&-1!==i.indexOf(" ")&&(i=i.substring(i.indexOf(" ")+1)),this.spellCaption=e+" "+t.action+" "+i,void(16===this.activeSpellFlags&&(this.redrawSidebar=!0,this.selectedTab=3,this.redrawSideicons=!0))}if(951===e){const t=c.A.instances[n];let e=!0;t.clientCode>0&&(e=this.handleInterfaceAction(t)),e&&(this.out.p1isaac(v.A.IF_BUTTON),this.out.p2(n))}else if(602===e||596===e||22===e||892===e||415===e)22===e?this.out.p1isaac(v.A.INV_BUTTON3):415===e?(3&n||$.K.oplogic7++,$.K.oplogic7>=55&&(this.out.p1isaac(v.A.ANTICHEAT_OPLOGIC7),this.out.p4(0)),this.out.p1isaac(v.A.INV_BUTTON5)):602===e?this.out.p1isaac(v.A.INV_BUTTON1):892===e?(3&s||$.K.oplogic9++,$.K.oplogic9>=130&&(this.out.p1isaac(v.A.ANTICHEAT_OPLOGIC9),this.out.p1(177)),this.out.p1isaac(v.A.INV_BUTTON4)):596===e&&this.out.p1isaac(v.A.INV_BUTTON2),this.out.p2(i),this.out.p2(s),this.out.p2(n),this.selectedCycle=0,this.selectedInterface=n,this.selectedItem=s,this.selectedArea=2,c.A.instances[n].layer===this.viewportInterfaceId&&(this.selectedArea=1),c.A.instances[n].layer===this.chatInterfaceId&&(this.selectedArea=3);else if(581===e)3&i||$.K.oplogic1++,$.K.oplogic1>=99&&(this.out.p1isaac(v.A.ANTICHEAT_OPLOGIC1),this.out.p4(0)),this.interactWithLoc(v.A.OPLOC4,s,n,i);else if(965===e)this.localPlayer&&(this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],s,n,2,0,0,0,0,0,!1)||this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],s,n,2,1,1,0,0,0,!1),this.crossX=this.mouseClickX,this.crossY=this.mouseClickY,this.crossMode=2,this.crossCycle=0,this.out.p1isaac(v.A.OPOBJT),this.out.p2(s+this.sceneBaseTileX),this.out.p2(n+this.sceneBaseTileZ),this.out.p2(i),this.out.p2(this.activeSpellId));else if(1501===e)$.K.oplogic6+=this.sceneBaseTileZ,$.K.oplogic6>=92&&(this.out.p1isaac(v.A.ANTICHEAT_OPLOGIC6),this.out.p4(0)),this.interactWithLoc(v.A.OPLOC5,s,n,i);else if(364===e)this.interactWithLoc(v.A.OPLOC3,s,n,i);else if(1102===e){const t=h.A.get(i);let e;e=t.desc?t.desc:"It's a "+t.name+".",this.addMessage(0,e,"")}else if(960===e){this.out.p1isaac(v.A.IF_BUTTON),this.out.p2(n);const t=c.A.instances[n];if(t.scripts&&t.scripts[0]&&5===t.scripts[0][0]){const e=t.scripts[0][1];t.scriptOperand&&this.varps[e]!==t.scriptOperand[0]&&(this.varps[e]=t.scriptOperand[0],await this.updateVarp(e),this.redrawSidebar=!0)}}else if(34===e){const e=this.menuOption[t],i=e.indexOf("@whi@");if(-1!==i){this.closeInterfaces(),this.reportAbuseInput=e.substring(i+5).trim(),this.reportAbuseMuteOption=!1;for(let t=0;t<c.A.instances.length;t++)if(c.A.instances[t]&&c.A.instances[t].clientCode===c.A.CC_REPORT_INPUT){this.reportAbuseInterfaceID=this.viewportInterfaceId=c.A.instances[t].layer;break}}}else if(947===e)this.closeInterfaces();else if(367===e){const t=this.players[i];t&&this.localPlayer&&(this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],t.pathTileX[0],t.pathTileZ[0],2,1,1,0,0,0,!1),this.crossX=this.mouseClickX,this.crossY=this.mouseClickY,this.crossMode=2,this.crossCycle=0,this.out.p1isaac(v.A.OPPLAYERU),this.out.p2(i),this.out.p2(this.objInterface),this.out.p2(this.objSelectedSlot),this.out.p2(this.objSelectedInterface))}else if(465===e){this.out.p1isaac(v.A.IF_BUTTON),this.out.p2(n);const t=c.A.instances[n];if(t.scripts&&t.scripts[0]&&5===t.scripts[0][0]){const e=t.scripts[0][1];this.varps[e]=1-this.varps[e],await this.updateVarp(e),this.redrawSidebar=!0}}else if(406===e||436===e||557===e||556===e){const i=this.menuOption[t],s=i.indexOf("@whi@");if(-1!==s){const t=M.A.toBase37(i.substring(s+5).trim());406===e?this.addFriend(t):436===e?this.addIgnore(t):557===e?this.removeFriend(t):556===e&&this.removeIgnore(t)}}else if(651===e){const t=this.players[i];t&&this.localPlayer&&(this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],t.pathTileX[0],t.pathTileZ[0],2,1,1,0,0,0,!1),this.crossX=this.mouseClickX,this.crossY=this.mouseClickY,this.crossMode=2,this.crossCycle=0,this.out.p1isaac(v.A.OPPLAYERT),this.out.p2(i),this.out.p2(this.activeSpellId))}}}this.objSelected=0,this.spellSelected=0};handleInterfaceAction=t=>{const e=t.clientCode;if(e===c.A.CC_ADD_FRIEND&&(this.redrawChatback=!0,this.chatbackInputOpen=!1,this.showSocialInput=!0,this.socialInput="",this.socialAction=1,this.socialMessage="Enter name of friend to add to list"),e===c.A.CC_DEL_FRIEND&&(this.redrawChatback=!0,this.chatbackInputOpen=!1,this.showSocialInput=!0,this.socialInput="",this.socialAction=2,this.socialMessage="Enter name of friend to delete from list"),e===c.A.CC_LOGOUT)return this.idleTimeout=250,!0;if(e===c.A.CC_ADD_IGNORE&&(this.redrawChatback=!0,this.chatbackInputOpen=!1,this.showSocialInput=!0,this.socialInput="",this.socialAction=4,this.socialMessage="Enter name of player to add to list"),e===c.A.CC_DEL_IGNORE&&(this.redrawChatback=!0,this.chatbackInputOpen=!1,this.showSocialInput=!0,this.socialInput="",this.socialAction=5,this.socialMessage="Enter name of player to delete from list"),e>=c.A.CC_CHANGE_HEAD_L&&e<=c.A.CC_CHANGE_FEET_R){const t=(e-300)/2|0,i=1&e;let s=this.designIdentikits[t];if(-1!==s)for(;;)if(0===i&&(s--,s<0&&(s=r.A.count-1)),1===i&&(s++,s>=r.A.count&&(s=0)),!r.A.instances[s].disable&&r.A.instances[s].type===t+(this.designGenderMale?0:7)){this.designIdentikits[t]=s,this.updateDesignModel=!0;break}}if(e>=c.A.CC_RECOLOUR_HAIR_L&&e<=c.A.CC_RECOLOUR_SKIN_R){const t=(e-314)/2|0,i=1&e;let s=this.designColors[t];0===i&&(s--,s<0&&(s=H.A.DESIGN_IDK_COLORS[t].length-1)),1===i&&(s++,s>=H.A.DESIGN_IDK_COLORS[t].length&&(s=0)),this.designColors[t]=s,this.updateDesignModel=!0}if(e!==c.A.CC_SWITCH_TO_MALE||this.designGenderMale||(this.designGenderMale=!0,this.validateCharacterDesign()),e===c.A.CC_SWITCH_TO_FEMALE&&this.designGenderMale&&(this.designGenderMale=!1,this.validateCharacterDesign()),e===c.A.CC_ACCEPT_DESIGN){this.out.p1isaac(v.A.IF_PLAYERDESIGN),this.out.p1(this.designGenderMale?0:1);for(let t=0;t<7;t++)this.out.p1(this.designIdentikits[t]);for(let t=0;t<5;t++)this.out.p1(this.designColors[t]);return!0}return e===c.A.CC_MOD_MUTE&&(this.reportAbuseMuteOption=!this.reportAbuseMuteOption),e>=c.A.CC_REPORT_RULE1&&e<=c.A.CC_REPORT_RULE12&&(this.closeInterfaces(),this.reportAbuseInput.length>0&&(this.out.p1isaac(v.A.BUG_REPORT),this.out.p8(M.A.toBase37(this.reportAbuseInput)),this.out.p1(e-601),this.out.p1(this.reportAbuseMuteOption?1:0))),!1};validateCharacterDesign=()=>{this.updateDesignModel=!0;for(let t=0;t<7;t++){this.designIdentikits[t]=-1;for(let e=0;e<r.A.count;e++)if(!r.A.instances[e].disable&&r.A.instances[e].type===t+(this.designGenderMale?0:7)){this.designIdentikits[t]=e;break}}};interactWithLoc=(t,e,i,s)=>{if(!this.localPlayer||!this.scene)return!1;const h=s>>14&32767,n=this.scene.getInfo(this.currentLevel,e,i,s);if(-1===n)return!1;const r=31&n,o=n>>6&3;if(r===N.A.CENTREPIECE_STRAIGHT.id||r===N.A.CENTREPIECE_DIAGONAL.id||r===N.A.GROUND_DECOR.id){const t=a.A.get(h);let s,n;o===R.A.WEST||o===R.A.EAST?(s=t.width,n=t.length):(s=t.length,n=t.width);let r=t.forceapproach;0!==o&&(r=(r<<o&15)+(r>>4-o)),this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],e,i,2,s,n,0,0,r,!1)}else this.tryMove(this.localPlayer.pathTileX[0],this.localPlayer.pathTileZ[0],e,i,2,0,0,o,r+1,0,!1);return this.crossX=this.mouseClickX,this.crossY=this.mouseClickY,this.crossMode=2,this.crossCycle=0,this.out.p1isaac(t),this.out.p2(e+this.sceneBaseTileX),this.out.p2(i+this.sceneBaseTileZ),this.out.p2(h),!0};handleTabInput=()=>{1===this.mouseClickButton&&(this.mouseClickX>=549&&this.mouseClickX<=583&&this.mouseClickY>=195&&this.mouseClickY<231&&-1!==this.tabInterfaceId[0]?(this.redrawSidebar=!0,this.selectedTab=0,this.redrawSideicons=!0):this.mouseClickX>=579&&this.mouseClickX<=609&&this.mouseClickY>=194&&this.mouseClickY<231&&-1!==this.tabInterfaceId[1]?(this.redrawSidebar=!0,this.selectedTab=1,this.redrawSideicons=!0):this.mouseClickX>=607&&this.mouseClickX<=637&&this.mouseClickY>=194&&this.mouseClickY<231&&-1!==this.tabInterfaceId[2]?(this.redrawSidebar=!0,this.selectedTab=2,this.redrawSideicons=!0):this.mouseClickX>=635&&this.mouseClickX<=679&&this.mouseClickY>=194&&this.mouseClickY<229&&-1!==this.tabInterfaceId[3]?(this.redrawSidebar=!0,this.selectedTab=3,this.redrawSideicons=!0):this.mouseClickX>=676&&this.mouseClickX<=706&&this.mouseClickY>=194&&this.mouseClickY<231&&-1!==this.tabInterfaceId[4]?(this.redrawSidebar=!0,this.selectedTab=4,this.redrawSideicons=!0):this.mouseClickX>=704&&this.mouseClickX<=734&&this.mouseClickY>=194&&this.mouseClickY<231&&-1!==this.tabInterfaceId[5]?(this.redrawSidebar=!0,this.selectedTab=5,this.redrawSideicons=!0):this.mouseClickX>=732&&this.mouseClickX<=766&&this.mouseClickY>=195&&this.mouseClickY<231&&-1!==this.tabInterfaceId[6]?(this.redrawSidebar=!0,this.selectedTab=6,this.redrawSideicons=!0):this.mouseClickX>=550&&this.mouseClickX<=584&&this.mouseClickY>=492&&this.mouseClickY<528&&-1!==this.tabInterfaceId[7]?(this.redrawSidebar=!0,this.selectedTab=7,this.redrawSideicons=!0):this.mouseClickX>=582&&this.mouseClickX<=612&&this.mouseClickY>=492&&this.mouseClickY<529&&-1!==this.tabInterfaceId[8]?(this.redrawSidebar=!0,this.selectedTab=8,this.redrawSideicons=!0):this.mouseClickX>=609&&this.mouseClickX<=639&&this.mouseClickY>=492&&this.mouseClickY<529&&-1!==this.tabInterfaceId[9]?(this.redrawSidebar=!0,this.selectedTab=9,this.redrawSideicons=!0):this.mouseClickX>=637&&this.mouseClickX<=681&&this.mouseClickY>=493&&this.mouseClickY<528&&-1!==this.tabInterfaceId[10]?(this.redrawSidebar=!0,this.selectedTab=10,this.redrawSideicons=!0):this.mouseClickX>=679&&this.mouseClickX<=709&&this.mouseClickY>=492&&this.mouseClickY<529&&-1!==this.tabInterfaceId[11]?(this.redrawSidebar=!0,this.selectedTab=11,this.redrawSideicons=!0):this.mouseClickX>=706&&this.mouseClickX<=736&&this.mouseClickY>=492&&this.mouseClickY<529&&-1!==this.tabInterfaceId[12]?(this.redrawSidebar=!0,this.selectedTab=12,this.redrawSideicons=!0):this.mouseClickX>=734&&this.mouseClickX<=768&&this.mouseClickY>=492&&this.mouseClickY<528&&-1!==this.tabInterfaceId[13]&&(this.redrawSidebar=!0,this.selectedTab=13,this.redrawSideicons=!0),$.K.cyclelogic1++,$.K.cyclelogic1>150&&($.K.cyclelogic1=0,this.out.p1isaac(v.A.ANTICHEAT_CYCLELOGIC1),this.out.p1(43)))};handleInputKey=async()=>{for(;;){let t;do{for(;;){if(t=this.pollKey(),-1===t)return;if(-1!==this.viewportInterfaceId&&this.viewportInterfaceId===this.reportAbuseInterfaceID){8===t&&this.reportAbuseInput.length>0&&(this.reportAbuseInput=this.reportAbuseInput.substring(0,this.reportAbuseInput.length-1));break}if(this.showSocialInput){if(t>=32&&t<=122&&this.socialInput.length<80&&(this.socialInput=this.socialInput+String.fromCharCode(t),this.redrawChatback=!0),8===t&&this.socialInput.length>0&&(this.socialInput=this.socialInput.substring(0,this.socialInput.length-1),this.redrawChatback=!0),13===t||10===t){let t;if(this.showSocialInput=!1,this.redrawChatback=!0,1===this.socialAction&&(t=M.A.toBase37(this.socialInput),this.addFriend(t)),2===this.socialAction&&this.friendCount>0&&(t=M.A.toBase37(this.socialInput),this.removeFriend(t)),3===this.socialAction&&this.socialInput.length>0&&this.socialName37){this.out.p1isaac(v.A.MESSAGE_PRIVATE),this.out.p1(0);const t=this.out.pos;this.out.p8(this.socialName37),E.A.pack(this.out,this.socialInput),this.out.psize1(this.out.pos-t),this.socialInput=M.A.toSentenceCase(this.socialInput),this.socialInput=O.A.filter(this.socialInput),this.addMessage(6,this.socialInput,M.A.formatName(M.A.fromBase37(this.socialName37))),2===this.privateChatSetting&&(this.privateChatSetting=1,this.redrawPrivacySettings=!0,this.out.p1isaac(v.A.CHAT_SETMODE),this.out.p1(this.publicChatSetting),this.out.p1(this.privateChatSetting),this.out.p1(this.tradeChatSetting))}4===this.socialAction&&this.ignoreCount<100&&(t=M.A.toBase37(this.socialInput),this.addIgnore(t)),5===this.socialAction&&this.ignoreCount>0&&(t=M.A.toBase37(this.socialInput),this.removeIgnore(t))}}else if(this.chatbackInputOpen){if(t>=48&&t<=57&&this.chatbackInput.length<10&&(this.chatbackInput=this.chatbackInput+String.fromCharCode(t),this.redrawChatback=!0),8===t&&this.chatbackInput.length>0&&(this.chatbackInput=this.chatbackInput.substring(0,this.chatbackInput.length-1),this.redrawChatback=!0),13===t||10===t){if(this.chatbackInput.length>0){let t=0;try{t=parseInt(this.chatbackInput,10)}catch(t){}this.out.p1isaac(v.A.RESUME_P_COUNTDIALOG),this.out.p4(t)}this.chatbackInputOpen=!1,this.redrawChatback=!0}}else if(-1===this.chatInterfaceId&&(t>=32&&t<=122&&this.chatTyped.length<80&&(this.chatTyped=this.chatTyped+String.fromCharCode(t),this.redrawChatback=!0),8===t&&this.chatTyped.length>0&&(this.chatTyped=this.chatTyped.substring(0,this.chatTyped.length-1),this.redrawChatback=!0),(13===t||10===t)&&this.chatTyped.length>0)){if("::clientdrop"===this.chatTyped)await this.tryReconnect();else if(this.rights&&"::noclip"===this.chatTyped)for(let t=0;t<x.A.LEVELS;t++)for(let e=1;e<x.A.SIZE-1;e++)for(let i=1;i<x.A.SIZE-1;i++){const s=this.levelCollisionMap[t];s&&(s.flags[x.A.index(e,i)]=0)}else if("::debug"===this.chatTyped)$.K.showDebug=!$.K.showDebug;else if(this.chatTyped.startsWith("::fps "))try{this.setTargetedFramerate(parseInt(this.chatTyped.substring(6),10))}catch(t){}if(this.chatTyped.startsWith("::"))this.out.p1isaac(v.A.CLIENT_CHEAT),this.out.p1(this.chatTyped.length-1),this.out.pjstr(this.chatTyped.substring(2));else{let t=0;this.chatTyped.startsWith("yellow:")?(t=0,this.chatTyped=this.chatTyped.substring(7)):this.chatTyped.startsWith("red:")?(t=1,this.chatTyped=this.chatTyped.substring(4)):this.chatTyped.startsWith("green:")?(t=2,this.chatTyped=this.chatTyped.substring(6)):this.chatTyped.startsWith("cyan:")?(t=3,this.chatTyped=this.chatTyped.substring(5)):this.chatTyped.startsWith("purple:")?(t=4,this.chatTyped=this.chatTyped.substring(7)):this.chatTyped.startsWith("white:")?(t=5,this.chatTyped=this.chatTyped.substring(6)):this.chatTyped.startsWith("flash1:")?(t=6,this.chatTyped=this.chatTyped.substring(7)):this.chatTyped.startsWith("flash2:")?(t=7,this.chatTyped=this.chatTyped.substring(7)):this.chatTyped.startsWith("flash3:")?(t=8,this.chatTyped=this.chatTyped.substring(7)):this.chatTyped.startsWith("glow1:")?(t=9,this.chatTyped=this.chatTyped.substring(6)):this.chatTyped.startsWith("glow2:")?(t=10,this.chatTyped=this.chatTyped.substring(6)):this.chatTyped.startsWith("glow3:")&&(t=11,this.chatTyped=this.chatTyped.substring(6));let e=0;this.chatTyped.startsWith("wave:")&&(e=1,this.chatTyped=this.chatTyped.substring(5)),this.chatTyped.startsWith("scroll:")&&(e=2,this.chatTyped=this.chatTyped.substring(7)),this.out.p1isaac(v.A.MESSAGE_PUBLIC),this.out.p1(0);const i=this.out.pos;this.out.p1(t),this.out.p1(e),E.A.pack(this.out,this.chatTyped),this.out.psize1(this.out.pos-i),this.chatTyped=M.A.toSentenceCase(this.chatTyped),this.chatTyped=O.A.filter(this.chatTyped),this.localPlayer&&this.localPlayer.name&&(this.localPlayer.chat=this.chatTyped,this.localPlayer.chatColor=t,this.localPlayer.chatStyle=e,this.localPlayer.chatTimer=150,this.addMessage(2,this.localPlayer.chat,this.localPlayer.name)),2===this.publicChatSetting&&(this.publicChatSetting=3,this.redrawPrivacySettings=!0,this.out.p1isaac(v.A.CHAT_SETMODE),this.out.p1(this.publicChatSetting),this.out.p1(this.privateChatSetting),this.out.p1(this.tradeChatSetting))}this.chatTyped="",this.redrawChatback=!0}}}while((t<97||t>122)&&(t<65||t>90)&&(t<48||t>57)&&32!==t);this.reportAbuseInput.length<12&&(this.reportAbuseInput=this.reportAbuseInput+String.fromCharCode(t))}};handleChatSettingsInput=()=>{if(1===this.mouseClickButton)if(this.mouseClickX>=8&&this.mouseClickX<=108&&this.mouseClickY>=490&&this.mouseClickY<=522)this.publicChatSetting=(this.publicChatSetting+1)%4,this.redrawPrivacySettings=!0,this.redrawChatback=!0,this.out.p1isaac(v.A.CHAT_SETMODE),this.out.p1(this.publicChatSetting),this.out.p1(this.privateChatSetting),this.out.p1(this.tradeChatSetting);else if(this.mouseClickX>=137&&this.mouseClickX<=237&&this.mouseClickY>=490&&this.mouseClickY<=522)this.privateChatSetting=(this.privateChatSetting+1)%3,this.redrawPrivacySettings=!0,this.redrawChatback=!0,this.out.p1isaac(v.A.CHAT_SETMODE),this.out.p1(this.publicChatSetting),this.out.p1(this.privateChatSetting),this.out.p1(this.tradeChatSetting);else if(this.mouseClickX>=275&&this.mouseClickX<=375&&this.mouseClickY>=490&&this.mouseClickY<=522)this.tradeChatSetting=(this.tradeChatSetting+1)%3,this.redrawPrivacySettings=!0,this.redrawChatback=!0,this.out.p1isaac(v.A.CHAT_SETMODE),this.out.p1(this.publicChatSetting),this.out.p1(this.privateChatSetting),this.out.p1(this.tradeChatSetting);else if(this.mouseClickX>=416&&this.mouseClickX<=516&&this.mouseClickY>=490&&this.mouseClickY<=522){this.closeInterfaces(),this.reportAbuseInput="",this.reportAbuseMuteOption=!1;for(let t=0;t<c.A.instances.length;t++)if(c.A.instances[t]&&600===c.A.instances[t].clientCode)return void(this.reportAbuseInterfaceID=this.viewportInterfaceId=c.A.instances[t].layer)}};handleScrollInput=(t,e,i,s,a,h,n,r)=>{if(this.scrollGrabbed?this.scrollInputPadding=32:this.scrollInputPadding=0,this.scrollGrabbed=!1,t>=h&&t<h+16&&e>=n&&e<n+16)r.scrollPosition-=4*this.dragCycles,a&&(this.redrawSidebar=!0);else if(t>=h&&t<h+16&&e>=n+s-16&&e<n+s)r.scrollPosition+=4*this.dragCycles,a&&(this.redrawSidebar=!0);else if(t>=h-this.scrollInputPadding&&t<h+this.scrollInputPadding+16&&e>=n+16&&e<n+s-16&&this.dragCycles>0){let t=(s-32)*s/i|0;t<8&&(t=8);const h=e-n-(t/2|0)-16,o=s-t-32;r.scrollPosition=(i-s)*h/o|0,a&&(this.redrawSidebar=!0),this.scrollGrabbed=!0}};prepareGameScreen=()=>{this.areaChatback||(this.unloadTitle(),this.drawArea=null,this.imageTitle2=null,this.imageTitle3=null,this.imageTitle4=null,this.imageTitle0=null,this.imageTitle1=null,this.imageTitle5=null,this.imageTitle6=null,this.imageTitle7=null,this.imageTitle8=null,this.areaChatback=new d.A(479,96),this.areaMapback=new d.A(168,160),m.A.clear(),this.imageMapback?.draw(0,0),this.areaSidebar=new d.A(190,261),this.areaViewport=new d.A(512,334),m.A.clear(),this.areaBackbase1=new d.A(501,61),this.areaBackbase2=new d.A(288,40),this.areaBackhmid1=new d.A(269,66),this.redrawTitleBackground=!0)};isFriend=t=>{if(!t)return!1;for(let e=0;e<this.friendCount;e++)if(t.toLowerCase()===this.friendName[e]?.toLowerCase())return!0;return!!this.localPlayer&&t.toLowerCase()===this.localPlayer.name?.toLowerCase()};addFriend=t=>{if(0n===t)return;if(this.friendCount>=100)return void this.addMessage(0,"Your friends list is full. Max of 100 hit","");const e=M.A.formatName(M.A.fromBase37(t));for(let i=0;i<this.friendCount;i++)if(this.friendName37[i]===t)return void this.addMessage(0,e+" is already on your friend list","");for(let i=0;i<this.ignoreCount;i++)if(this.ignoreName37[i]===t)return void this.addMessage(0,"Please remove "+e+" from your ignore list first","");this.localPlayer&&this.localPlayer.name&&e!==this.localPlayer.name&&(this.friendName[this.friendCount]=e,this.friendName37[this.friendCount]=t,this.friendWorld[this.friendCount]=0,this.friendCount++,this.redrawSidebar=!0,this.out.p1isaac(v.A.FRIENDLIST_ADD),this.out.p8(t))};removeFriend=t=>{if(0n!==t)for(let e=0;e<this.friendCount;e++)if(this.friendName37[e]===t){this.friendCount--,this.redrawSidebar=!0;for(let t=e;t<this.friendCount;t++)this.friendName[t]=this.friendName[t+1],this.friendWorld[t]=this.friendWorld[t+1],this.friendName37[t]=this.friendName37[t+1];return this.out.p1isaac(v.A.FRIENDLIST_DEL),void this.out.p8(t)}};addIgnore=t=>{if(0n===t)return;if(this.ignoreCount>=100)return void this.addMessage(0,"Your ignore list is full. Max of 100 hit","");const e=M.A.formatName(M.A.fromBase37(t));for(let i=0;i<this.ignoreCount;i++)if(this.ignoreName37[i]===t)return void this.addMessage(0,e+" is already on your ignore list","");for(let i=0;i<this.friendCount;i++)if(this.friendName37[i]===t)return void this.addMessage(0,"Please remove "+e+" from your friend list first","");this.ignoreName37[this.ignoreCount++]=t,this.redrawSidebar=!0,this.out.p1isaac(v.A.IGNORELIST_ADD),this.out.p8(t)};removeIgnore=t=>{if(0n!==t)for(let e=0;e<this.ignoreCount;e++)if(this.ignoreName37[e]===t){this.ignoreCount--,this.redrawSidebar=!0;for(let t=e;t<this.ignoreCount;t++)this.ignoreName37[t]=this.ignoreName37[t+1];return this.out.p1isaac(v.A.IGNORELIST_DEL),void this.out.p8(t)}};sortObjStacks=(t,e)=>{const i=this.levelObjStacks[this.currentLevel][t][e];if(!i)return void this.scene?.removeObjStack(this.currentLevel,t,e);let s=-99999999,a=null;for(let t=i.head();t;t=i.next()){const e=h.A.get(t.index);let i=e.cost;e.stackable&&(i*=t.count+1),i>s&&(s=i,a=t)}if(!a)return;i.addHead(a);let n=-1,r=-1,o=0,l=0;for(let t=i.head();t;t=i.next())t.index!==a.index&&-1===n&&(n=t.index,o=t.count),t.index!==a.index&&t.index!==n&&-1===r&&(r=t.index,l=t.count);let c=null;-1!==n&&(c=h.A.get(n).getInterfaceModel(o));let d=null;-1!==r&&(d=h.A.get(r).getInterfaceModel(l));const m=t+(e<<7)+1610612736|0,u=h.A.get(a.index);this.scene?.addObjStack(t,e,this.getHeightmapY(this.currentLevel,128*t+64,128*e+64),this.currentLevel,m,u.getInterfaceModel(a.count),d,c)};addLoc=(t,e,i,s,h,n,r)=>{if(e<1||i<1||e>102||i>102)return;if($.K.lowMemory&&t!==this.currentLevel)return;if(!this.scene)return;let o=0;if(r===D.A.WALL&&(o=this.scene.getWallBitset(t,e,i)),r===D.A.WALL_DECOR&&(o=this.scene.getWallDecorationBitset(t,i,e)),r===D.A.GROUND&&(o=this.scene.getLocBitset(t,e,i)),r===D.A.GROUND_DECOR&&(o=this.scene.getGroundDecorationBitset(t,e,i)),0!==o){const s=this.scene.getInfo(t,e,i,o),h=o>>14&32767,n=31&s,l=s>>6;if(r===D.A.WALL){this.scene?.removeWall(t,e,i,1);const s=a.A.get(h);s.blockwalk&&this.levelCollisionMap[t]?.removeWall(e,i,n,l,s.blockrange)}if(r===D.A.WALL_DECOR&&this.scene?.removeWallDecoration(t,e,i),r===D.A.GROUND){this.scene.removeLoc(t,e,i);const s=a.A.get(h);if(e+s.width>x.A.SIZE-1||i+s.width>x.A.SIZE-1||e+s.length>x.A.SIZE-1||i+s.length>x.A.SIZE-1)return;s.blockwalk&&this.levelCollisionMap[t]?.removeLoc(e,i,s.width,s.length,l,s.blockrange)}if(r===D.A.GROUND_DECOR){this.scene?.removeGroundDecoration(t,e,i);const s=a.A.get(h);s.blockwalk&&s.active&&this.levelCollisionMap[t]?.removeFloor(e,i)}}if(s>=0){let a=t;this.levelTileFlags&&t<3&&!(2&~this.levelTileFlags[1][e][i])&&(a=t+1),this.levelHeightmap&&_.A.addLoc(t,e,i,this.scene,this.levelHeightmap,this.locList,this.levelCollisionMap[t],s,n,h,a)}};closeInterfaces=()=>{this.out.p1isaac(v.A.CLOSE_MODAL),-1!==this.sidebarInterfaceId&&(this.sidebarInterfaceId=-1,this.redrawSidebar=!0,this.pressedContinueOption=!1,this.redrawSideicons=!0),-1!==this.chatInterfaceId&&(this.chatInterfaceId=-1,this.redrawChatback=!0,this.pressedContinueOption=!1),this.viewportInterfaceId=-1};tryReconnect=async()=>{this.idleTimeout>0?await this.logout():(this.areaViewport?.bind(),this.fontPlain12?.drawStringCenter(257,144,"Connection lost",S.A.BLACK),this.fontPlain12?.drawStringCenter(256,143,"Connection lost",S.A.WHITE),this.fontPlain12?.drawStringCenter(257,159,"Please wait - attempting to reestablish",S.A.BLACK),this.fontPlain12?.drawStringCenter(256,158,"Please wait - attempting to reestablish",S.A.WHITE),this.areaViewport?.draw(8,11),this.flagSceneTileX=0,this.stream?.close(),this.ingame=!1,await this.login(this.username,this.password,!0),this.ingame||await this.logout())};logout=async()=>{this.stream&&this.stream.close(),this.stream=null,this.ingame=!1,this.titleScreenState=0,this.username="",this.password="",B.A.setDisabled(),this.clearCaches(),this.scene?.reset();for(let t=0;t<x.A.LEVELS;t++)this.levelCollisionMap[t]?.reset();(0,G.qI)(),this.currentMidi=null,this.nextMusicDelay=0,$.K.lowMemory||await this.setMidi("scape_main",12345678,4e4)};read=async()=>{if(!this.stream)return!1;try{let t=this.stream.available;if(0===t)return!1;if(-1===this.packetType&&(await this.stream.readBytes(this.in.data,0,1),this.packetType=255&this.in.data[0],this.randomIn&&(this.packetType=this.packetType-this.randomIn.nextInt&255),this.packetSize=T.A.SERVERPROT_SIZES[this.packetType],t--),-1===this.packetSize){if(t<=0)return!1;await this.stream.readBytes(this.in.data,0,1),this.packetSize=255&this.in.data[0],t--}if(-2===this.packetSize){if(t<=1)return!1;await this.stream.readBytes(this.in.data,0,2),this.in.pos=0,this.packetSize=this.in.g2,t-=2}if(t<this.packetSize)return!1;if(this.in.pos=0,await this.stream.readBytes(this.in.data,0,this.packetSize),this.idleNetCycles=0,this.lastPacketType2=this.lastPacketType1,this.lastPacketType1=this.lastPacketType0,this.lastPacketType0=this.packetType,this.packetType===b.A.VARP_SMALL){const t=this.in.g2,e=this.in.g1b;return this.varCache[t]=e,this.varps[t]!==e&&(this.varps[t]=e,await this.updateVarp(t),this.redrawSidebar=!0,-1!==this.stickyChatInterfaceId&&(this.redrawChatback=!0)),this.packetType=-1,!0}if(this.packetType===b.A.UPDATE_FRIENDLIST){const t=this.in.g8,e=this.in.g1;let i=M.A.formatName(M.A.fromBase37(t));for(let s=0;s<this.friendCount;s++)if(t===this.friendName37[s]){this.friendWorld[s]!==e&&(this.friendWorld[s]=e,this.redrawSidebar=!0,e>0&&this.addMessage(5,i+" has logged in.",""),0===e&&this.addMessage(5,i+" has logged out.","")),i=null;break}i&&this.friendCount<100&&(this.friendName37[this.friendCount]=t,this.friendName[this.friendCount]=i,this.friendWorld[this.friendCount]=e,this.friendCount++,this.redrawSidebar=!0);let s=!1;for(;!s;){s=!0;for(let t=0;t<this.friendCount-1;t++)if(this.friendWorld[t]!==$.K.nodeId&&this.friendWorld[t+1]===$.K.nodeId||0===this.friendWorld[t]&&0!==this.friendWorld[t+1]){const e=this.friendWorld[t];this.friendWorld[t]=this.friendWorld[t+1],this.friendWorld[t+1]=e;const i=this.friendName[t];this.friendName[t]=this.friendName[t+1],this.friendName[t+1]=i;const a=this.friendName37[t];this.friendName37[t]=this.friendName37[t+1],this.friendName37[t+1]=a,this.redrawSidebar=!0,s=!1}}return this.packetType=-1,!0}if(this.packetType===b.A.UPDATE_REBOOT_TIMER)return this.systemUpdateTimer=30*this.in.g2,this.packetType=-1,!0;if(this.packetType===b.A.DATA_LAND_DONE){const t=this.in.g1,e=this.in.g1;let i=-1;if(this.sceneMapIndex)for(let s=0;s<this.sceneMapIndex.length;s++)this.sceneMapIndex[s]===(t<<8)+e&&(i=s);if(-1!==i){const s=this.sceneMapLandData;if(s){const a=s[i];-1!==i&&a&&(this.db?.cachesave(`m${t}_${e}`,a),this.sceneState=1)}}return this.packetType=-1,!0}if(this.packetType===b.A.NPC_INFO)return this.readNpcInfo(this.in,this.packetSize),this.packetType=-1,!0;if(this.packetType===b.A.REBUILD_NORMAL){const t=this.in.g2,e=this.in.g2;if(this.sceneCenterZoneX===t&&this.sceneCenterZoneZ===e&&0!==this.sceneState)return this.packetType=-1,!0;this.sceneCenterZoneX=t,this.sceneCenterZoneZ=e,this.sceneBaseTileX=8*(this.sceneCenterZoneX-6),this.sceneBaseTileZ=8*(this.sceneCenterZoneZ-6),this.sceneState=1,this.areaViewport?.bind(),this.fontPlain12?.drawStringCenter(257,151,"Loading - please wait.",S.A.BLACK),this.fontPlain12?.drawStringCenter(256,150,"Loading - please wait.",S.A.WHITE),this.areaViewport?.draw(8,11);const i=(this.packetSize-2)/10|0;this.sceneMapLandData=new V.FO(i,null),this.sceneMapLocData=new V.FO(i,null),this.sceneMapIndex=new Int32Array(i),this.out.p1isaac(v.A.REBUILD_GETMAPS),this.out.p1(0);let s=0;for(let t=0;t<i;t++){const e=this.in.g1,i=this.in.g1,a=this.in.g4,h=this.in.g4;let n;this.sceneMapIndex[t]=(e<<8)+i,0!==a&&(n=await(this.db?.cacheload(`m${e}_${i}`)),n&&y.A.crc32(n)!==a&&(n=void 0),n?this.sceneMapLandData[t]=n:(this.sceneState=0,this.out.p1(0),this.out.p1(e),this.out.p1(i),s+=3)),0!==h&&(n=await(this.db?.cacheload(`l${e}_${i}`)),n&&y.A.crc32(n)!==h&&(n=void 0),n?this.sceneMapLocData[t]=n:(this.sceneState=0,this.out.p1(1),this.out.p1(e),this.out.p1(i),s+=3))}this.out.psize1(s),this.areaViewport?.bind(),0===this.sceneState&&(this.fontPlain12?.drawStringCenter(257,166,"Map area updated since last visit, so load will take longer this time only",S.A.BLACK),this.fontPlain12?.drawStringCenter(256,165,"Map area updated since last visit, so load will take longer this time only",S.A.WHITE)),this.areaViewport?.draw(8,11);const a=this.sceneBaseTileX-this.mapLastBaseX,h=this.sceneBaseTileZ-this.mapLastBaseZ;this.mapLastBaseX=this.sceneBaseTileX,this.mapLastBaseZ=this.sceneBaseTileZ;for(let t=0;t<8192;t++){const e=this.npcs[t];if(e){for(let t=0;t<10;t++)e.pathTileX[t]-=a,e.pathTileZ[t]-=h;e.x-=128*a,e.z-=128*h}}for(let t=0;t<this.MAX_PLAYER_COUNT;t++){const e=this.players[t];if(e){for(let t=0;t<10;t++)e.pathTileX[t]-=a,e.pathTileZ[t]-=h;e.x-=128*a,e.z-=128*h}}let n=0,r=x.A.SIZE,o=1;a<0&&(n=x.A.SIZE-1,r=-1,o=-1);let l=0,c=x.A.SIZE,d=1;h<0&&(l=x.A.SIZE-1,c=-1,d=-1);for(let t=n;t!==r;t+=o)for(let e=l;e!==c;e+=d){const i=t+a,s=e+h;for(let a=0;a<x.A.LEVELS;a++)i>=0&&s>=0&&i<x.A.SIZE&&s<x.A.SIZE?this.levelObjStacks[a][t][e]=this.levelObjStacks[a][i][s]:this.levelObjStacks[a][t][e]=null}for(let t=this.spawnedLocations.head();t;t=this.spawnedLocations.next())t.x-=a,t.z-=h,(t.x<0||t.z<0||t.x>=x.A.SIZE||t.z>=x.A.SIZE)&&t.unlink();return 0!==this.flagSceneTileX&&(this.flagSceneTileX-=a,this.flagSceneTileZ-=h),this.cutscene=!1,this.packetType=-1,!0}if(this.packetType===b.A.IF_SETPLAYERHEAD)return c.A.instances[this.in.g2].model=this.localPlayer?.getHeadModel()||null,this.packetType=-1,!0;if(this.packetType===b.A.HINT_ARROW)return this.hintType=this.in.g1,1===this.hintType&&(this.hintNpc=this.in.g2),this.hintType>=2&&this.hintType<=6&&(2===this.hintType&&(this.hintOffsetX=64,this.hintOffsetZ=64),3===this.hintType&&(this.hintOffsetX=0,this.hintOffsetZ=64),4===this.hintType&&(this.hintOffsetX=128,this.hintOffsetZ=64),5===this.hintType&&(this.hintOffsetX=64,this.hintOffsetZ=0),6===this.hintType&&(this.hintOffsetX=64,this.hintOffsetZ=128),this.hintType=2,this.hintTileX=this.in.g2,this.hintTileZ=this.in.g2,this.hintHeight=this.in.g1),10===this.hintType&&(this.hintPlayer=this.in.g2),this.packetType=-1,!0;if(this.packetType===b.A.MIDI_SONG){const t=this.in.gjstr,e=this.in.g4,i=this.in.g4;return t!==this.currentMidi&&this.midiActive&&!$.K.lowMemory&&await this.setMidi(t,e,i),this.currentMidi=t,this.midiCrc=e,this.midiSize=i,this.nextMusicDelay=0,this.packetType=-1,!0}if(this.packetType===b.A.LOGOUT)return await this.logout(),this.packetType=-1,!1;if(this.packetType===b.A.DATA_LOC_DONE){const t=this.in.g1,e=this.in.g1;let i=-1;if(this.sceneMapIndex)for(let s=0;s<this.sceneMapIndex.length;s++)this.sceneMapIndex[s]===(t<<8)+e&&(i=s);if(-1!==i){const s=this.sceneMapLocData;if(s){const a=s[i];-1!==i&&a&&(this.db?.cachesave(`l${t}_${e}`,a),this.sceneState=1)}}return this.packetType=-1,!0}if(this.packetType===b.A.UNSET_MAP_FLAG)return this.flagSceneTileX=0,this.packetType=-1,!0;if(this.packetType===b.A.UPDATE_UID192)return this.localPid=this.in.g2,this.packetType=-1,!0;if(this.packetType===b.A.OBJ_COUNT||this.packetType===b.A.LOC_MERGE||this.packetType===b.A.OBJ_REVEAL||this.packetType===b.A.MAP_ANIM||this.packetType===b.A.MAP_PROJANIM||this.packetType===b.A.OBJ_DEL||this.packetType===b.A.OBJ_ADD||this.packetType===b.A.LOC_ANIM||this.packetType===b.A.LOC_DEL||this.packetType===b.A.LOC_ADD_CHANGE)return this.readZonePacket(this.in,this.packetType),this.packetType=-1,!0;if(this.packetType===b.A.IF_OPENMAINSIDEMODAL){const t=this.in.g2,e=this.in.g2;return-1!==this.chatInterfaceId&&(this.chatInterfaceId=-1,this.redrawChatback=!0),this.chatbackInputOpen&&(this.chatbackInputOpen=!1,this.redrawChatback=!0),this.viewportInterfaceId=t,this.sidebarInterfaceId=e,this.redrawSidebar=!0,this.redrawSideicons=!0,this.pressedContinueOption=!1,this.packetType=-1,!0}if(this.packetType===b.A.VARP_LARGE){const t=this.in.g2,e=this.in.g4;return this.varCache[t]=e,this.varps[t]!==e&&(this.varps[t]=e,await this.updateVarp(t),this.redrawSidebar=!0,-1!==this.stickyChatInterfaceId&&(this.redrawChatback=!0)),this.packetType=-1,!0}if(this.packetType===b.A.IF_SETANIM){const t=this.in.g2;return c.A.instances[t].anim=this.in.g2,this.packetType=-1,!0}if(this.packetType===b.A.IF_OPENSIDEOVERLAY){let t=this.in.g2;const e=this.in.g1;return 65535===t&&(t=-1),this.tabInterfaceId[e]=t,this.redrawSidebar=!0,this.redrawSideicons=!0,this.packetType=-1,!0}if(this.packetType===b.A.DATA_LOC){const t=this.in.g1,e=this.in.g1,i=this.in.g2,s=this.in.g2;let a=-1;if(this.sceneMapIndex)for(let i=0;i<this.sceneMapIndex.length;i++)this.sceneMapIndex[i]===(t<<8)+e&&(a=i);if(-1!==a&&this.sceneMapLocData){this.sceneMapLocData[a]&&this.sceneMapLocData[a]?.length===s||(this.sceneMapLocData[a]=new Int8Array(s));const t=this.sceneMapLocData[a];t&&this.in.gdata(this.packetSize-6,i,t)}return this.packetType=-1,!0}if(this.packetType===b.A.FINISH_TRACKING){const t=B.A.stop();return t&&(this.out.p1isaac(v.A.EVENT_TRACKING),this.out.p2(t.pos),this.out.pdata(t.data,t.pos,0),t.release()),this.packetType=-1,!0}if(this.packetType===b.A.UPDATE_INV_FULL){this.redrawSidebar=!0;const t=this.in.g2,e=c.A.instances[t],i=this.in.g1;if(e.invSlotObjId&&e.invSlotObjCount){for(let t=0;t<i;t++){e.invSlotObjId[t]=this.in.g2;let i=this.in.g1;255===i&&(i=this.in.g4),e.invSlotObjCount[t]=i}for(let t=i;t<e.invSlotObjId.length;t++)e.invSlotObjId[t]=0,e.invSlotObjCount[t]=0}else for(let t=0;t<i;t++)this.in.g2,255===this.in.g1&&this.in.g4;return this.packetType=-1,!0}if(this.packetType===b.A.ENABLE_TRACKING)return B.A.setEnabled(),this.packetType=-1,!0;if(this.packetType===b.A.P_COUNTDIALOG)return this.showSocialInput=!1,this.chatbackInputOpen=!0,this.chatbackInput="",this.redrawChatback=!0,this.packetType=-1,!0;if(this.packetType===b.A.UPDATE_INV_STOP_TRANSMIT){const t=c.A.instances[this.in.g2];if(t.invSlotObjId)for(let e=0;e<t.invSlotObjId.length;e++)t.invSlotObjId[e]=-1,t.invSlotObjId[e]=0;return this.packetType=-1,!0}if(this.packetType===b.A.LAST_LOGIN_INFO){if(this.lastAddress=this.in.g4,this.daysSinceLastLogin=this.in.g2,this.daysSinceRecoveriesChanged=this.in.g1,this.unreadMessages=this.in.g2,0!==this.lastAddress&&-1===this.viewportInterfaceId){this.closeInterfaces();let t=650;201!==this.daysSinceRecoveriesChanged&&(t=655),this.reportAbuseInput="",this.reportAbuseMuteOption=!1;for(let e=0;e<c.A.instances.length;e++)if(c.A.instances[e]&&c.A.instances[e].clientCode===t){this.viewportInterfaceId=c.A.instances[e].layer;break}}return this.packetType=-1,!0}if(this.packetType===b.A.TUTORIAL_FLASHSIDE)return this.flashingTab=this.in.g1,this.flashingTab===this.selectedTab&&(3===this.flashingTab?this.selectedTab=1:this.selectedTab=3,this.redrawSidebar=!0),this.packetType=-1,!0;if(this.packetType===b.A.MIDI_JINGLE){if(this.midiActive&&!$.K.lowMemory){const t=this.in.g2,e=this.in.g4,i=this.packetSize-6,s=L.A.read(e,Int8Array.from(this.in.data),i,this.in.pos);(0,G.cs)(s,this.midiVolume),this.nextMusicDelay=t}return this.packetType=-1,!0}if(this.packetType===b.A.SET_MULTIWAY)return this.inMultizone=this.in.g1,this.packetType=-1,!0;if(this.packetType===b.A.SYNTH_SOUND){const t=this.in.g2,e=this.in.g1,i=this.in.g2;return this.waveEnabled&&!$.K.lowMemory&&this.waveCount<50&&(this.waveIds[this.waveCount]=t,this.waveLoops[this.waveCount]=e,this.waveDelay[this.waveCount]=i+k.A.delays[t],this.waveCount++),this.packetType=-1,!0}if(this.packetType===b.A.IF_SETNPCHEAD){const t=this.in.g2,e=this.in.g2,i=n.A.get(e);return c.A.instances[t].model=i.getHeadModel(),this.packetType=-1,!0}if(this.packetType===b.A.UPDATE_ZONE_PARTIAL_FOLLOWS)return this.baseX=this.in.g1,this.baseZ=this.in.g1,this.packetType=-1,!0;if(this.packetType===b.A.IF_SETRECOL){const t=this.in.g2,e=this.in.g2,i=this.in.g2,s=c.A.instances[t].model;return s?.recolor(e,i),this.packetType=-1,!0}if(this.packetType===b.A.CHAT_FILTER_SETTINGS)return this.publicChatSetting=this.in.g1,this.privateChatSetting=this.in.g1,this.tradeChatSetting=this.in.g1,this.redrawPrivacySettings=!0,this.redrawChatback=!0,this.packetType=-1,!0;if(this.packetType===b.A.IF_OPENSIDEMODAL){const t=this.in.g2;return this.resetInterfaceAnimation(t),-1!==this.chatInterfaceId&&(this.chatInterfaceId=-1,this.redrawChatback=!0),this.chatbackInputOpen&&(this.chatbackInputOpen=!1,this.redrawChatback=!0),this.sidebarInterfaceId=t,this.redrawSidebar=!0,this.redrawSideicons=!0,this.viewportInterfaceId=-1,this.pressedContinueOption=!1,this.packetType=-1,!0}if(this.packetType===b.A.IF_OPENCHATMODAL){const t=this.in.g2;return this.resetInterfaceAnimation(t),-1!==this.sidebarInterfaceId&&(this.sidebarInterfaceId=-1,this.redrawSidebar=!0,this.redrawSideicons=!0),this.chatInterfaceId=t,this.redrawChatback=!0,this.viewportInterfaceId=-1,this.pressedContinueOption=!1,this.packetType=-1,!0}if(this.packetType===b.A.IF_SETPOSITION){const t=this.in.g2,e=this.in.g2b,i=this.in.g2b,s=c.A.instances[t];return s.x=e,s.y=i,this.packetType=-1,!0}if(this.packetType===b.A.CAM_LOOKAT)return this.cutscene=!0,this.cutsceneSrcLocalTileX=this.in.g1,this.cutsceneSrcLocalTileZ=this.in.g1,this.cutsceneSrcHeight=this.in.g2,this.cutsceneMoveSpeed=this.in.g1,this.cutsceneMoveAcceleration=this.in.g1,this.cutsceneMoveAcceleration>=100&&(this.cameraX=128*this.cutsceneSrcLocalTileX+64,this.cameraZ=128*this.cutsceneSrcLocalTileZ+64,this.cameraY=this.getHeightmapY(this.currentLevel,this.cutsceneSrcLocalTileX,this.cutsceneSrcLocalTileZ)-this.cutsceneSrcHeight),this.packetType=-1,!0;if(this.packetType===b.A.UPDATE_ZONE_FULL_FOLLOWS){this.baseX=this.in.g1,this.baseZ=this.in.g1;for(let t=this.baseX;t<this.baseX+8;t++)for(let e=this.baseZ;e<this.baseZ+8;e++)this.levelObjStacks[this.currentLevel][t][e]&&(this.levelObjStacks[this.currentLevel][t][e]=null,this.sortObjStacks(t,e));for(let t=this.spawnedLocations.head();t;t=this.spawnedLocations.next())t.x>=this.baseX&&t.x<this.baseX+8&&t.z>=this.baseZ&&t.z<this.baseZ+8&&t.plane===this.currentLevel&&(this.addLoc(t.plane,t.x,t.z,t.lastLocIndex,t.lastAngle,t.lastShape,t.layer),t.unlink());return this.packetType=-1,!0}if(this.packetType===b.A.DATA_LAND){const t=this.in.g1,e=this.in.g1,i=this.in.g2,s=this.in.g2;let a=-1;if(this.sceneMapIndex)for(let i=0;i<this.sceneMapIndex.length;i++)this.sceneMapIndex[i]===(t<<8)+e&&(a=i);if(-1!==a&&this.sceneMapLandData){this.sceneMapLandData[a]&&this.sceneMapLandData[a]?.length===s||(this.sceneMapLandData[a]=new Int8Array(s));const t=this.sceneMapLandData[a];t&&this.in.gdata(this.packetSize-6,i,t)}return this.packetType=-1,!0}if(this.packetType===b.A.MESSAGE_PRIVATE){const t=this.in.g8,e=this.in.g4,i=this.in.g1;let s=!1;for(let t=0;t<100;t++)if(this.messageIds[t]===e){s=!0;break}if(i<=1)for(let e=0;e<this.ignoreCount;e++)if(this.ignoreName37[e]===t){s=!0;break}if(!s&&0===this.overrideChat)try{this.messageIds[this.privateMessageCount]=e,this.privateMessageCount=(this.privateMessageCount+1)%100;const s=E.A.unpack(this.in,this.packetSize-13),a=O.A.filter(s);i>1?this.addMessage(7,a,M.A.formatName(M.A.fromBase37(t))):this.addMessage(3,a,M.A.formatName(M.A.fromBase37(t)))}catch(t){}return this.packetType=-1,!0}if(this.packetType===b.A.RESET_CLIENT_VARCACHE){for(let t=0;t<this.varps.length;t++)this.varps[t]!==this.varCache[t]&&(this.varps[t]=this.varCache[t],await this.updateVarp(t),this.redrawSidebar=!0);return this.packetType=-1,!0}if(this.packetType===b.A.IF_SETMODEL){const t=this.in.g2,e=this.in.g2;return c.A.instances[t].model=A.A.model(e),this.packetType=-1,!0}if(this.packetType===b.A.TUTORIAL_OPENCHAT)return this.stickyChatInterfaceId=this.in.g2b,this.redrawChatback=!0,this.packetType=-1,!0;if(this.packetType===b.A.UPDATE_RUNENERGY)return 12===this.selectedTab&&(this.redrawSidebar=!0),this.energy=this.in.g1,this.packetType=-1,!0;if(this.packetType===b.A.CAM_MOVETO){if(this.cutscene=!0,this.cutsceneDstLocalTileX=this.in.g1,this.cutsceneDstLocalTileZ=this.in.g1,this.cutsceneDstHeight=this.in.g2,this.cutsceneRotateSpeed=this.in.g1,this.cutsceneRotateAcceleration=this.in.g1,this.cutsceneRotateAcceleration>=100){const t=128*this.cutsceneDstLocalTileX+64,e=128*this.cutsceneDstLocalTileZ+64,i=this.getHeightmapY(this.currentLevel,this.cutsceneDstLocalTileX,this.cutsceneDstLocalTileZ)-this.cutsceneDstHeight,s=t-this.cameraX,a=i-this.cameraY,h=e-this.cameraZ,n=0|Math.sqrt(s*s+h*h);this.cameraPitch=325.949*Math.atan2(a,n)&2047,this.cameraYaw=-325.949*Math.atan2(s,h)&2047,this.cameraPitch<128&&(this.cameraPitch=128),this.cameraPitch>383&&(this.cameraPitch=383)}return this.packetType=-1,!0}if(this.packetType===b.A.IF_SHOWSIDE)return this.selectedTab=this.in.g1,this.redrawSidebar=!0,this.redrawSideicons=!0,this.packetType=-1,!0;if(this.packetType===b.A.MESSAGE_GAME){const t=this.in.gjstr;let e;if(t.endsWith(":tradereq:")){const i=t.substring(0,t.indexOf(":"));e=M.A.toBase37(i);let s=!1;for(let t=0;t<this.ignoreCount;t++)if(this.ignoreName37[t]===e){s=!0;break}s||0!==this.overrideChat||this.addMessage(4,"wishes to trade with you.",i)}else if(t.endsWith(":duelreq:")){const i=t.substring(0,t.indexOf(":"));e=M.A.toBase37(i);let s=!1;for(let t=0;t<this.ignoreCount;t++)if(this.ignoreName37[t]===e){s=!0;break}s||0!==this.overrideChat||this.addMessage(8,"wishes to duel with you.",i)}else this.addMessage(0,t,"");return this.packetType=-1,!0}if(this.packetType===b.A.IF_SETOBJECT){const t=this.in.g2,e=this.in.g2,i=this.in.g2,s=h.A.get(e);return c.A.instances[t].model=s.getInterfaceModel(50),c.A.instances[t].xan=s.xan2d,c.A.instances[t].yan=s.yan2d,c.A.instances[t].zoom=100*s.zoom2d/i|0,this.packetType=-1,!0}if(this.packetType===b.A.IF_OPENMAINMODAL){const t=this.in.g2;return this.resetInterfaceAnimation(t),-1!==this.sidebarInterfaceId&&(this.sidebarInterfaceId=-1,this.redrawSidebar=!0,this.redrawSideicons=!0),-1!==this.chatInterfaceId&&(this.chatInterfaceId=-1,this.redrawChatback=!0),this.chatbackInputOpen&&(this.chatbackInputOpen=!1,this.redrawChatback=!0),this.viewportInterfaceId=t,this.pressedContinueOption=!1,this.packetType=-1,!0}if(this.packetType===b.A.IF_SETCOLOUR){const t=this.in.g2,e=this.in.g2,i=e>>10&31,s=e>>5&31,a=31&e;return c.A.instances[t].colour=(i<<19)+(s<<11)+(a<<3),this.packetType=-1,!0}if(this.packetType===b.A.RESET_ANIMS){for(let t=0;t<this.players.length;t++){const e=this.players[t];e&&(e.primarySeqId=-1)}for(let t=0;t<this.npcs.length;t++){const e=this.npcs[t];e&&(e.primarySeqId=-1)}return this.packetType=-1,!0}if(this.packetType===b.A.IF_SETHIDE){const t=this.in.g2;return c.A.instances[t].hide=1===this.in.g1,this.packetType=-1,!0}if(this.packetType===b.A.UPDATE_IGNORELIST){this.ignoreCount=this.packetSize/8|0;for(let t=0;t<this.ignoreCount;t++)this.ignoreName37[t]=this.in.g8;return this.packetType=-1,!0}if(this.packetType===b.A.CAM_RESET){this.cutscene=!1;for(let t=0;t<5;t++)this.cameraModifierEnabled[t]=!1;return this.packetType=-1,!0}if(this.packetType===b.A.IF_CLOSE)return-1!==this.sidebarInterfaceId&&(this.sidebarInterfaceId=-1,this.redrawSidebar=!0,this.redrawSideicons=!0),-1!==this.chatInterfaceId&&(this.chatInterfaceId=-1,this.redrawChatback=!0),this.chatbackInputOpen&&(this.chatbackInputOpen=!1,this.redrawChatback=!0),this.viewportInterfaceId=-1,this.pressedContinueOption=!1,this.packetType=-1,!0;if(this.packetType===b.A.IF_SETTEXT){const t=this.in.g2;return c.A.instances[t].text=this.in.gjstr,c.A.instances[t].layer===this.tabInterfaceId[this.selectedTab]&&(this.redrawSidebar=!0),this.packetType=-1,!0}if(this.packetType===b.A.UPDATE_STAT){this.redrawSidebar=!0;const t=this.in.g1,e=this.in.g4,i=this.in.g1;this.skillExperience[t]=e,this.skillLevel[t]=i,this.skillBaseLevel[t]=1;for(let i=0;i<98;i++)e>=this.levelExperience[i]&&(this.skillBaseLevel[t]=i+2);return this.packetType=-1,!0}if(this.packetType===b.A.UPDATE_ZONE_PARTIAL_ENCLOSED){for(this.baseX=this.in.g1,this.baseZ=this.in.g1;this.in.pos<this.packetSize;){const t=this.in.g1;this.readZonePacket(this.in,t)}return this.packetType=-1,!0}if(this.packetType===b.A.UPDATE_RUNWEIGHT)return 12===this.selectedTab&&(this.redrawSidebar=!0),this.weightCarried=this.in.g2b,this.packetType=-1,!0;if(this.packetType===b.A.CAM_SHAKE){const t=this.in.g1,e=this.in.g1,i=this.in.g1,s=this.in.g1;return this.cameraModifierEnabled[t]=!0,this.cameraModifierJitter[t]=e,this.cameraModifierWobbleScale[t]=i,this.cameraModifierWobbleSpeed[t]=s,this.cameraModifierCycle[t]=0,this.packetType=-1,!0}if(this.packetType===b.A.UPDATE_INV_PARTIAL){this.redrawSidebar=!0;const t=this.in.g2,e=c.A.instances[t];for(;this.in.pos<this.packetSize;){const t=this.in.g1,i=this.in.g2;let s=this.in.g1;255===s&&(s=this.in.g4),e.invSlotObjId&&e.invSlotObjCount&&t>=0&&t<e.invSlotObjId.length&&(e.invSlotObjId[t]=i,e.invSlotObjCount[t]=s)}return this.packetType=-1,!0}if(this.packetType===b.A.PLAYER_INFO)return this.lastTickFlag=!this.lastTickFlag,this.readPlayerInfo(this.in,this.packetSize),1===this.sceneState&&(this.sceneState=2,_.A.levelBuilt=this.currentLevel,this.buildScene()),$.K.lowMemory&&2===this.sceneState&&_.A.levelBuilt!==this.currentLevel&&(this.areaViewport?.bind(),this.fontPlain12?.drawStringCenter(257,151,"Loading - please wait.",S.A.BLACK),this.fontPlain12?.drawStringCenter(256,150,"Loading - please wait.",S.A.WHITE),this.areaViewport?.draw(8,11),_.A.levelBuilt=this.currentLevel,this.buildScene()),this.currentLevel!==this.minimapLevel&&2===this.sceneState&&(this.minimapLevel=this.currentLevel,this.createMinimap(this.currentLevel)),this.packetType=-1,!0;await this.logout()}catch(t){console.log(t),await this.tryReconnect()}return!0};buildScene=()=>{try{this.minimapLevel=-1,this.temporaryLocs.clear(),this.locList.clear(),this.spotanims.clear(),this.projectiles.clear(),u.A.clearTexels(),this.clearCaches(),this.scene?.reset();for(let t=0;t<x.A.LEVELS;t++)this.levelCollisionMap[t]?.reset();const t=new _.A(x.A.SIZE,x.A.SIZE,this.levelHeightmap,this.levelTileFlags);_.A.lowMemory=$.K.lowMemory;const e=this.sceneMapLandData?.length??0;if(this.sceneMapIndex)for(let t=0;t<e;t++){const e=this.sceneMapIndex[t]>>8,i=255&this.sceneMapIndex[t];if(33===e&&i>=71&&i<=73){_.A.lowMemory=!1;break}}if($.K.lowMemory?this.scene?.setMinLevel(this.currentLevel):this.scene?.setMinLevel(0),this.sceneMapIndex&&this.sceneMapLandData){this.out.p1isaac(v.A.NO_TIMEOUT);for(let i=0;i<e;i++){const e=64*(this.sceneMapIndex[i]>>8)-this.sceneBaseTileX,s=64*(255&this.sceneMapIndex[i])-this.sceneBaseTileZ,a=this.sceneMapLandData[i];if(a){const i=new y.A(new Uint8Array(a)).g4,h=L.A.read(i,a,a.length-4,4);t.readLandscape(8*(this.sceneCenterZoneX-6),8*(this.sceneCenterZoneZ-6),e,s,h)}else this.sceneCenterZoneZ<800&&t.clearLandscape(s,e,64,64)}}if(this.sceneMapIndex&&this.sceneMapLocData){this.out.p1isaac(v.A.NO_TIMEOUT);for(let i=0;i<e;i++){const e=this.sceneMapLocData[i];if(e){const s=new y.A(new Uint8Array(e)).g4,a=L.A.read(s,e,e.length-4,4),h=64*(this.sceneMapIndex[i]>>8)-this.sceneBaseTileX,n=64*(255&this.sceneMapIndex[i])-this.sceneBaseTileZ;t.readLocs(this.scene,this.locList,this.levelCollisionMap,a,h,n)}}}this.out.p1isaac(v.A.NO_TIMEOUT),t.build(this.scene,this.levelCollisionMap),this.areaViewport?.bind(),this.out.p1isaac(v.A.NO_TIMEOUT);for(let t=this.locList.head();t;t=this.locList.next())2===(this.levelTileFlags&&2&this.levelTileFlags[1][t.heightmapNE][t.heightmapNW])&&(t.heightmapSW--,t.heightmapSW<0&&t.unlink());for(let t=0;t<x.A.SIZE;t++)for(let e=0;e<x.A.SIZE;e++)this.sortObjStacks(t,e);for(let t=this.spawnedLocations.head();t;t=this.spawnedLocations.next())this.addLoc(t.plane,t.x,t.z,t.locIndex,t.angle,t.shape,t.layer)}catch(t){}a.A.modelCacheStatic?.clear(),u.A.initPool(20)};resetInterfaceAnimation=t=>{const e=c.A.instances[t];if(e.childId)for(let t=0;t<e.childId.length&&-1!==e.childId[t];t++){const i=c.A.instances[e.childId[t]];1===i.type&&this.resetInterfaceAnimation(i.id),i.seqFrame=0,i.seqCycle=0}};initializeLevelExperience=()=>{let t=0;for(let e=0;e<99;e++){const i=e+1;t+=i+300*Math.pow(2,i/7)|0,this.levelExperience[e]=t/4|0}};addMessage=(t,e,i)=>{0===t&&-1!==this.stickyChatInterfaceId&&(this.modalMessage=e,this.mouseClickButton=0),-1===this.chatInterfaceId&&(this.redrawChatback=!0);for(let t=99;t>0;t--)this.messageType[t]=this.messageType[t-1],this.messageSender[t]=this.messageSender[t-1],this.messageText[t]=this.messageText[t-1];$.K.showDebug&&0===t&&(e="["+(this.loopCycle/30|0)+"]: "+e),this.messageType[0]=t,this.messageSender[0]=i,this.messageText[0]=e};updateVarp=async t=>{const e=l.A.instances[t].clientcode;if(0!==e){const i=this.varps[t];if(1===e&&(1===i&&u.A.setBrightness(.9),2===i&&u.A.setBrightness(.8),3===i&&u.A.setBrightness(.7),4===i&&u.A.setBrightness(.6),h.A.iconCache?.clear(),this.redrawTitleBackground=!0),3===e){const t=this.midiActive;0===i&&(this.midiVolume=256,(0,G.u4)(256),this.midiActive=!0),1===i&&(this.midiVolume=192,(0,G.u4)(192),this.midiActive=!0),2===i&&(this.midiVolume=128,(0,G.u4)(128),this.midiActive=!0),3===i&&(this.midiVolume=64,(0,G.u4)(64),this.midiActive=!0),4===i&&(this.midiActive=!1),this.midiActive!==t&&(this.midiActive&&this.currentMidi?await this.setMidi(this.currentMidi,this.midiCrc,this.midiSize):(0,G.qI)(),this.nextMusicDelay=0)}4===e&&(0===i&&(this.waveVolume=256,(0,G.iw)(256),this.waveEnabled=!0),1===i&&(this.waveVolume=192,(0,G.iw)(192),this.waveEnabled=!0),2===i&&(this.waveVolume=128,(0,G.iw)(128),this.waveEnabled=!0),3===i&&(this.waveVolume=64,(0,G.iw)(64),this.waveEnabled=!0),4===i&&(this.waveEnabled=!1)),5===e&&(this.mouseButtonsOption=i),6===e&&(this.chatEffects=i),8===e&&(this.splitPrivateChat=i,this.redrawChatback=!0)}};handleChatMouseInput=(t,e)=>{let i=0;for(let t=0;t<100;t++){if(!this.messageText[t])continue;const s=this.messageType[t],a=this.chatScrollOffset+70+4-14*i;if(a<-20)break;0===s&&i++,1!==s&&2!==s||!(1===s||0===this.publicChatSetting||1===this.publicChatSetting&&this.isFriend(this.messageSender[t]))||(e>a-14&&e<=a&&this.localPlayer&&this.messageSender[t]!==this.localPlayer.name&&(this.rights&&(this.menuOption[this.menuSize]="Report abuse @whi@"+this.messageSender[t],this.menuAction[this.menuSize]=34,this.menuSize++),this.menuOption[this.menuSize]="Add ignore @whi@"+this.messageSender[t],this.menuAction[this.menuSize]=436,this.menuSize++,this.menuOption[this.menuSize]="Add friend @whi@"+this.messageSender[t],this.menuAction[this.menuSize]=406,this.menuSize++),i++),3!==s&&7!==s||0!==this.splitPrivateChat||!(7===s||0===this.privateChatSetting||1===this.privateChatSetting&&this.isFriend(this.messageSender[t]))||(e>a-14&&e<=a&&(this.rights&&(this.menuOption[this.menuSize]="Report abuse @whi@"+this.messageSender[t],this.menuAction[this.menuSize]=34,this.menuSize++),this.menuOption[this.menuSize]="Add ignore @whi@"+this.messageSender[t],this.menuAction[this.menuSize]=436,this.menuSize++,this.menuOption[this.menuSize]="Add friend @whi@"+this.messageSender[t],this.menuAction[this.menuSize]=406,this.menuSize++),i++),4===s&&(0===this.tradeChatSetting||1===this.tradeChatSetting&&this.isFriend(this.messageSender[t]))&&(e>a-14&&e<=a&&(this.menuOption[this.menuSize]="Accept trade @whi@"+this.messageSender[t],this.menuAction[this.menuSize]=903,this.menuSize++),i++),(5===s||6===s)&&0===this.splitPrivateChat&&this.privateChatSetting<2&&i++,8===s&&(0===this.tradeChatSetting||1===this.tradeChatSetting&&this.isFriend(this.messageSender[t]))&&(e>a-14&&e<=a&&(this.menuOption[this.menuSize]="Accept duel @whi@"+this.messageSender[t],this.menuAction[this.menuSize]=363,this.menuSize++),i++)}};handlePrivateChatInput=t=>{if(0===this.splitPrivateChat)return;let e=0;0!==this.systemUpdateTimer&&(e=1);for(let i=0;i<100;i++)if(null!==this.messageText[i]){const s=this.messageType[i];if((3===s||7===s)&&(7===s||0===this.privateChatSetting||1===this.privateChatSetting&&this.isFriend(this.messageSender[i]))){const s=329-13*e;if(this.mouseX>8&&this.mouseX<520&&t-11>s-10&&t-11<=s+3&&(this.rights&&(this.menuOption[this.menuSize]="Report abuse @whi@"+this.messageSender[i],this.menuAction[this.menuSize]=2034,this.menuSize++),this.menuOption[this.menuSize]="Add ignore @whi@"+this.messageSender[i],this.menuAction[this.menuSize]=2436,this.menuSize++,this.menuOption[this.menuSize]="Add friend @whi@"+this.messageSender[i],this.menuAction[this.menuSize]=2406,this.menuSize++),e++,e>=5)return}if((5===s||6===s)&&this.privateChatSetting<2&&(e++,e>=5))return}};handleInterfaceInput=(t,e,i,s,a,n)=>{if(0!==t.type||!t.childId||t.hide||e<s||i<a||e>s+t.width||i>a+t.height||!t.childX||!t.childY)return;const r=t.childId.length;for(let o=0;o<r;o++){let r=t.childX[o]+s,l=t.childY[o]+a-n;const d=c.A.instances[t.childId[o]];if(r+=d.x,l+=d.y,(d.overLayer>=0||0!==d.overColour)&&e>=r&&i>=l&&e<r+d.width&&i<l+d.height&&(d.overLayer>=0?this.lastHoveredInterfaceId=d.overLayer:this.lastHoveredInterfaceId=d.id),0===d.type)this.handleInterfaceInput(d,e,i,r,l,d.scrollPosition),d.scroll>d.height&&this.handleScrollInput(e,i,d.scroll,d.height,!0,r+d.width,l,d);else if(2===d.type){let t=0;for(let s=0;s<d.height;s++)for(let a=0;a<d.width;a++){let n=r+a*(d.marginX+32),o=l+s*(d.marginY+32);if(t<20&&d.invSlotOffsetX&&d.invSlotOffsetY&&(n+=d.invSlotOffsetX[t],o+=d.invSlotOffsetY[t]),e<n||i<o||e>=n+32||i>=o+32){t++;continue}if(this.hoveredSlot=t,this.hoveredSlotParentId=d.id,!d.invSlotObjId||d.invSlotObjId[t]<=0){t++;continue}const c=h.A.get(d.invSlotObjId[t]-1);if(1===this.objSelected&&d.interactable)d.id===this.objSelectedInterface&&t===this.objSelectedSlot||(this.menuOption[this.menuSize]="Use "+this.objSelectedName+" with @lre@"+c.name,this.menuAction[this.menuSize]=881,this.menuParamA[this.menuSize]=c.id,this.menuParamB[this.menuSize]=t,this.menuParamC[this.menuSize]=d.id,this.menuSize++);else if(1===this.spellSelected&&d.interactable)16&~this.activeSpellFlags||(this.menuOption[this.menuSize]=this.spellCaption+" @lre@"+c.name,this.menuAction[this.menuSize]=391,this.menuParamA[this.menuSize]=c.id,this.menuParamB[this.menuSize]=t,this.menuParamC[this.menuSize]=d.id,this.menuSize++);else{if(d.interactable)for(let e=4;e>=3;e--)c.iop&&c.iop[e]?(this.menuOption[this.menuSize]=c.iop[e]+" @lre@"+c.name,3===e?this.menuAction[this.menuSize]=478:4===e&&(this.menuAction[this.menuSize]=347),this.menuParamA[this.menuSize]=c.id,this.menuParamB[this.menuSize]=t,this.menuParamC[this.menuSize]=d.id,this.menuSize++):4===e&&(this.menuOption[this.menuSize]="Drop @lre@"+c.name,this.menuAction[this.menuSize]=347,this.menuParamA[this.menuSize]=c.id,this.menuParamB[this.menuSize]=t,this.menuParamC[this.menuSize]=d.id,this.menuSize++);if(d.usable&&(this.menuOption[this.menuSize]="Use @lre@"+c.name,this.menuAction[this.menuSize]=188,this.menuParamA[this.menuSize]=c.id,this.menuParamB[this.menuSize]=t,this.menuParamC[this.menuSize]=d.id,this.menuSize++),d.interactable&&c.iop)for(let e=2;e>=0;e--)c.iop[e]&&(this.menuOption[this.menuSize]=c.iop[e]+" @lre@"+c.name,0===e?this.menuAction[this.menuSize]=405:1===e?this.menuAction[this.menuSize]=38:2===e&&(this.menuAction[this.menuSize]=422),this.menuParamA[this.menuSize]=c.id,this.menuParamB[this.menuSize]=t,this.menuParamC[this.menuSize]=d.id,this.menuSize++);if(d.iops)for(let e=4;e>=0;e--)d.iops[e]&&(this.menuOption[this.menuSize]=d.iops[e]+" @lre@"+c.name,0===e?this.menuAction[this.menuSize]=602:1===e?this.menuAction[this.menuSize]=596:2===e?this.menuAction[this.menuSize]=22:3===e?this.menuAction[this.menuSize]=892:4===e&&(this.menuAction[this.menuSize]=415),this.menuParamA[this.menuSize]=c.id,this.menuParamB[this.menuSize]=t,this.menuParamC[this.menuSize]=d.id,this.menuSize++);this.menuOption[this.menuSize]="Examine @lre@"+c.name,$.K.showDebug&&(this.menuOption[this.menuSize]+="@whi@ ("+c.id+")"),this.menuAction[this.menuSize]=1773,this.menuParamA[this.menuSize]=c.id,d.invSlotObjCount&&(this.menuParamC[this.menuSize]=d.invSlotObjCount[t]),this.menuSize++}t++}}else if(e>=r&&i>=l&&e<r+d.width&&i<l+d.height)if(d.buttonType===c.A.BUTTON_OK){let t=!1;0!==d.clientCode&&(t=this.handleSocialMenuOption(d)),!t&&d.option&&(this.menuOption[this.menuSize]=d.option,this.menuAction[this.menuSize]=951,this.menuParamC[this.menuSize]=d.id,this.menuSize++)}else if(d.buttonType===c.A.BUTTON_TARGET&&0===this.spellSelected){let t=d.actionVerb;t&&-1!==t.indexOf(" ")&&(t=t.substring(0,t.indexOf(" "))),this.menuOption[this.menuSize]=t+" @gre@"+d.action,this.menuAction[this.menuSize]=930,this.menuParamC[this.menuSize]=d.id,this.menuSize++}else d.buttonType===c.A.BUTTON_CLOSE?(this.menuOption[this.menuSize]="Close",this.menuAction[this.menuSize]=947,this.menuParamC[this.menuSize]=d.id,this.menuSize++):d.buttonType===c.A.BUTTON_TOGGLE&&d.option?(this.menuOption[this.menuSize]=d.option,this.menuAction[this.menuSize]=465,this.menuParamC[this.menuSize]=d.id,this.menuSize++):d.buttonType===c.A.BUTTON_SELECT&&d.option?(this.menuOption[this.menuSize]=d.option,this.menuAction[this.menuSize]=960,this.menuParamC[this.menuSize]=d.id,this.menuSize++):d.buttonType===c.A.BUTTON_CONTINUE&&!this.pressedContinueOption&&d.option&&(this.menuOption[this.menuSize]=d.option,this.menuAction[this.menuSize]=44,this.menuParamC[this.menuSize]=d.id,this.menuSize++)}};handleSocialMenuOption=t=>{let e=t.clientCode;return e>=c.A.CC_FRIENDS_START&&e<=c.A.CC_FRIENDS_UPDATE_END?(e>=c.A.CC_FRIENDS_UPDATE_START?e-=c.A.CC_FRIENDS_UPDATE_START:e--,this.menuOption[this.menuSize]="Remove @whi@"+this.friendName[e],this.menuAction[this.menuSize]=557,this.menuSize++,this.menuOption[this.menuSize]="Message @whi@"+this.friendName[e],this.menuAction[this.menuSize]=679,this.menuSize++,!0):e>=c.A.CC_IGNORES_START&&e<=c.A.CC_IGNORES_END&&(this.menuOption[this.menuSize]="Remove @whi@"+t.text,this.menuAction[this.menuSize]=556,this.menuSize++,!0)};handleViewportOptions=()=>{0===this.objSelected&&0===this.spellSelected&&(this.menuOption[this.menuSize]="Walk here",this.menuAction[this.menuSize]=660,this.menuParamB[this.menuSize]=this.mouseX,this.menuParamC[this.menuSize]=this.mouseY,this.menuSize++);let t=-1;for(let e=0;e<A.A.pickedCount;e++){const i=A.A.pickedBitsets[e],s=127&i,n=i>>7&127,r=i>>29&3,o=i>>14&32767;if(i!==t){if(t=i,2===r&&this.scene&&this.scene.getInfo(this.currentLevel,s,n,i)>=0){const t=a.A.get(o);if(1===this.objSelected)this.menuOption[this.menuSize]="Use "+this.objSelectedName+" with @cya@"+t.name,this.menuAction[this.menuSize]=450,this.menuParamA[this.menuSize]=i,this.menuParamB[this.menuSize]=s,this.menuParamC[this.menuSize]=n,this.menuSize++;else if(1!==this.spellSelected){if(t.op)for(let e=4;e>=0;e--)t.op[e]&&(this.menuOption[this.menuSize]=t.op[e]+" @cya@"+t.name,0===e&&(this.menuAction[this.menuSize]=285),1===e&&(this.menuAction[this.menuSize]=504),2===e&&(this.menuAction[this.menuSize]=364),3===e&&(this.menuAction[this.menuSize]=581),4===e&&(this.menuAction[this.menuSize]=1501),this.menuParamA[this.menuSize]=i,this.menuParamB[this.menuSize]=s,this.menuParamC[this.menuSize]=n,this.menuSize++);this.menuOption[this.menuSize]="Examine @cya@"+t.name,$.K.showDebug&&(this.menuOption[this.menuSize]+="@whi@ ("+t.id+")"),this.menuAction[this.menuSize]=1175,this.menuParamA[this.menuSize]=i,this.menuParamB[this.menuSize]=s,this.menuParamC[this.menuSize]=n,this.menuSize++}else 4&~this.activeSpellFlags||(this.menuOption[this.menuSize]=this.spellCaption+" @cya@"+t.name,this.menuAction[this.menuSize]=55,this.menuParamA[this.menuSize]=i,this.menuParamB[this.menuSize]=s,this.menuParamC[this.menuSize]=n,this.menuSize++)}if(1===r){const t=this.npcs[o];if(t&&t.type&&1===t.type.size&&64==(127&t.x)&&64==(127&t.z))for(let e=0;e<this.npcCount;e++){const i=this.npcs[this.npcIds[e]];i&&i!==t&&i.type&&1===i.type.size&&i.x===t.x&&i.z===t.z&&this.addNpcOptions(i.type,this.npcIds[e],s,n)}t&&t.type&&this.addNpcOptions(t.type,o,s,n)}if(0===r){const t=this.players[o];if(t&&64==(127&t.x)&&64==(127&t.z)){for(let e=0;e<this.npcCount;e++){const i=this.npcs[this.npcIds[e]];i&&i.type&&1===i.type.size&&i.x===t.x&&i.z===t.z&&this.addNpcOptions(i.type,this.npcIds[e],s,n)}for(let e=0;e<this.playerCount;e++){const i=this.players[this.playerIds[e]];i&&i!==t&&i.x===t.x&&i.z===t.z&&this.addPlayerOptions(i,this.playerIds[e],s,n)}}t&&this.addPlayerOptions(t,o,s,n)}if(3===r){const t=this.levelObjStacks[this.currentLevel][s][n];if(!t)continue;for(let e=t.tail();e;e=t.prev()){const t=h.A.get(e.index);if(1===this.objSelected)this.menuOption[this.menuSize]="Use "+this.objSelectedName+" with @lre@"+t.name,this.menuAction[this.menuSize]=217,this.menuParamA[this.menuSize]=e.index,this.menuParamB[this.menuSize]=s,this.menuParamC[this.menuSize]=n,this.menuSize++;else if(1!==this.spellSelected){for(let i=4;i>=0;i--)t.op&&t.op[i]?(this.menuOption[this.menuSize]=t.op[i]+" @lre@"+t.name,0===i&&(this.menuAction[this.menuSize]=224),1===i&&(this.menuAction[this.menuSize]=993),2===i&&(this.menuAction[this.menuSize]=99),3===i&&(this.menuAction[this.menuSize]=746),4===i&&(this.menuAction[this.menuSize]=877),this.menuParamA[this.menuSize]=e.index,this.menuParamB[this.menuSize]=s,this.menuParamC[this.menuSize]=n,this.menuSize++):2===i&&(this.menuOption[this.menuSize]="Take @lre@"+t.name,this.menuAction[this.menuSize]=99,this.menuParamA[this.menuSize]=e.index,this.menuParamB[this.menuSize]=s,this.menuParamC[this.menuSize]=n,this.menuSize++);this.menuOption[this.menuSize]="Examine @lre@"+t.name,$.K.showDebug&&(this.menuOption[this.menuSize]+="@whi@ ("+e.index+")"),this.menuAction[this.menuSize]=1102,this.menuParamA[this.menuSize]=e.index,this.menuParamB[this.menuSize]=s,this.menuParamC[this.menuSize]=n,this.menuSize++}else 1&~this.activeSpellFlags||(this.menuOption[this.menuSize]=this.spellCaption+" @lre@"+t.name,this.menuAction[this.menuSize]=965,this.menuParamA[this.menuSize]=e.index,this.menuParamB[this.menuSize]=s,this.menuParamC[this.menuSize]=n,this.menuSize++)}}}}};addNpcOptions=(t,e,i,s)=>{if(this.menuSize>=400)return;let a=t.name;if(0!==t.vislevel&&this.localPlayer&&(a=a+this.getCombatLevelColorTag(this.localPlayer.combatLevel,t.vislevel)+" (level-"+t.vislevel+")"),1===this.objSelected)this.menuOption[this.menuSize]="Use "+this.objSelectedName+" with @yel@"+a,this.menuAction[this.menuSize]=900,this.menuParamA[this.menuSize]=e,this.menuParamB[this.menuSize]=i,this.menuParamC[this.menuSize]=s,this.menuSize++;else if(1!==this.spellSelected){let h;if(t.op)for(h=4;h>=0;h--)t.op[h]&&"attack"!==t.op[h]?.toLowerCase()&&(this.menuOption[this.menuSize]=t.op[h]+" @yel@"+a,0===h?this.menuAction[this.menuSize]=728:1===h?this.menuAction[this.menuSize]=542:2===h?this.menuAction[this.menuSize]=6:3===h?this.menuAction[this.menuSize]=963:4===h&&(this.menuAction[this.menuSize]=245),this.menuParamA[this.menuSize]=e,this.menuParamB[this.menuSize]=i,this.menuParamC[this.menuSize]=s,this.menuSize++);if(t.op)for(h=4;h>=0;h--)if(t.op[h]&&"attack"===t.op[h]?.toLowerCase()){let n=0;this.localPlayer&&t.vislevel>this.localPlayer.combatLevel&&(n=2e3),this.menuOption[this.menuSize]=t.op[h]+" @yel@"+a,0===h?this.menuAction[this.menuSize]=n+728:1===h?this.menuAction[this.menuSize]=n+542:2===h?this.menuAction[this.menuSize]=n+6:3===h?this.menuAction[this.menuSize]=n+963:4===h&&(this.menuAction[this.menuSize]=n+245),this.menuParamA[this.menuSize]=e,this.menuParamB[this.menuSize]=i,this.menuParamC[this.menuSize]=s,this.menuSize++}this.menuOption[this.menuSize]="Examine @yel@"+a,$.K.showDebug&&(this.menuOption[this.menuSize]+="@whi@ ("+t.id+")"),this.menuAction[this.menuSize]=1607,this.menuParamA[this.menuSize]=e,this.menuParamB[this.menuSize]=i,this.menuParamC[this.menuSize]=s,this.menuSize++}else 2&~this.activeSpellFlags||(this.menuOption[this.menuSize]=this.spellCaption+" @yel@"+a,this.menuAction[this.menuSize]=265,this.menuParamA[this.menuSize]=e,this.menuParamB[this.menuSize]=i,this.menuParamC[this.menuSize]=s,this.menuSize++)};addPlayerOptions=(t,e,i,s)=>{if(t===this.localPlayer||this.menuSize>=400)return;let a=null;this.localPlayer&&(a=t.name+this.getCombatLevelColorTag(this.localPlayer.combatLevel,t.combatLevel)+" (level-"+t.combatLevel+")"),1===this.objSelected?(this.menuOption[this.menuSize]="Use "+this.objSelectedName+" with @whi@"+a,this.menuAction[this.menuSize]=367,this.menuParamA[this.menuSize]=e,this.menuParamB[this.menuSize]=i,this.menuParamC[this.menuSize]=s,this.menuSize++):1!==this.spellSelected?(this.menuOption[this.menuSize]="Follow @whi@"+a,this.menuAction[this.menuSize]=1544,this.menuParamA[this.menuSize]=e,this.menuParamB[this.menuSize]=i,this.menuParamC[this.menuSize]=s,this.menuSize++,0===this.overrideChat&&(this.menuOption[this.menuSize]="Trade with @whi@"+a,this.menuAction[this.menuSize]=1373,this.menuParamA[this.menuSize]=e,this.menuParamB[this.menuSize]=i,this.menuParamC[this.menuSize]=s,this.menuSize++),this.wildernessLevel>0&&(this.menuOption[this.menuSize]="Attack @whi@"+a,this.localPlayer&&this.localPlayer.combatLevel>=t.combatLevel?this.menuAction[this.menuSize]=151:this.menuAction[this.menuSize]=2151,this.menuParamA[this.menuSize]=e,this.menuParamB[this.menuSize]=i,this.menuParamC[this.menuSize]=s,this.menuSize++),1===this.worldLocationState&&(this.menuOption[this.menuSize]="Fight @whi@"+a,this.menuAction[this.menuSize]=151,this.menuParamA[this.menuSize]=e,this.menuParamB[this.menuSize]=i,this.menuParamC[this.menuSize]=s,this.menuSize++),2===this.worldLocationState&&(this.menuOption[this.menuSize]="Duel-with @whi@"+a,this.menuAction[this.menuSize]=1101,this.menuParamA[this.menuSize]=e,this.menuParamB[this.menuSize]=i,this.menuParamC[this.menuSize]=s,this.menuSize++)):8&~this.activeSpellFlags||(this.menuOption[this.menuSize]=this.spellCaption+" @whi@"+a,this.menuAction[this.menuSize]=651,this.menuParamA[this.menuSize]=e,this.menuParamB[this.menuSize]=i,this.menuParamC[this.menuSize]=s,this.menuSize++);for(let t=0;t<this.menuSize;t++)if(660===this.menuAction[t])return void(this.menuOption[t]="Walk here @whi@"+a)};getCombatLevelColorTag=(t,e)=>{const i=t-e;return i<-9?"@red@":i<-6?"@or3@":i<-3?"@or2@":i<0?"@or1@":i>9?"@gre@":i>6?"@gr3@":i>3?"@gr2@":i>0?"@gr1@":"@yel@"};handleInput=()=>{if(0===this.objDragArea){this.menuOption[0]="Cancel",this.menuAction[0]=1252,this.menuSize=1,this.handlePrivateChatInput(this.mouseY),this.lastHoveredInterfaceId=0,this.mouseX>8&&this.mouseY>11&&this.mouseX<520&&this.mouseY<345&&(-1===this.viewportInterfaceId?this.handleViewportOptions():this.handleInterfaceInput(c.A.instances[this.viewportInterfaceId],this.mouseX,this.mouseY,8,11,0)),this.lastHoveredInterfaceId!==this.viewportHoveredInterfaceIndex&&(this.viewportHoveredInterfaceIndex=this.lastHoveredInterfaceId),this.lastHoveredInterfaceId=0,this.mouseX>562&&this.mouseY>231&&this.mouseX<752&&this.mouseY<492&&(-1!==this.sidebarInterfaceId?this.handleInterfaceInput(c.A.instances[this.sidebarInterfaceId],this.mouseX,this.mouseY,562,231,0):-1!==this.tabInterfaceId[this.selectedTab]&&this.handleInterfaceInput(c.A.instances[this.tabInterfaceId[this.selectedTab]],this.mouseX,this.mouseY,562,231,0)),this.lastHoveredInterfaceId!==this.sidebarHoveredInterfaceIndex&&(this.redrawSidebar=!0,this.sidebarHoveredInterfaceIndex=this.lastHoveredInterfaceId),this.lastHoveredInterfaceId=0,this.mouseX>22&&this.mouseY>375&&this.mouseX<431&&this.mouseY<471&&(-1===this.chatInterfaceId?this.handleChatMouseInput(this.mouseX-22,this.mouseY-375):this.handleInterfaceInput(c.A.instances[this.chatInterfaceId],this.mouseX,this.mouseY,22,375,0)),-1!==this.chatInterfaceId&&this.lastHoveredInterfaceId!==this.chatHoveredInterfaceIndex&&(this.redrawChatback=!0,this.chatHoveredInterfaceIndex=this.lastHoveredInterfaceId);let t=!1;for(;!t;){t=!0;for(let e=0;e<this.menuSize-1;e++)if(this.menuAction[e]<1e3&&this.menuAction[e+1]>1e3){const i=this.menuOption[e];this.menuOption[e]=this.menuOption[e+1],this.menuOption[e+1]=i;const s=this.menuAction[e];this.menuAction[e]=this.menuAction[e+1],this.menuAction[e+1]=s;const a=this.menuParamB[e];this.menuParamB[e]=this.menuParamB[e+1],this.menuParamB[e+1]=a;const h=this.menuParamC[e];this.menuParamC[e]=this.menuParamC[e+1],this.menuParamC[e+1]=h;const n=this.menuParamA[e];this.menuParamA[e]=this.menuParamA[e+1],this.menuParamA[e+1]=n,t=!1}}}};showContextMenu=()=>{let t=0;if(this.fontBold12){let e;t=this.fontBold12.stringWidth("Choose Option");for(let i=0;i<this.menuSize;i++)e=this.fontBold12.stringWidth(this.menuOption[i]),e>t&&(t=e)}t+=8;const e=15*this.menuSize+21;let i,s;this.mouseClickX>8&&this.mouseClickY>11&&this.mouseClickX<520&&this.mouseClickY<345&&(i=this.mouseClickX-(t/2|0)-8,i+t>512?i=512-t:i<0&&(i=0),s=this.mouseClickY-11,s+e>334?s=334-e:s<0&&(s=0),this.menuVisible=!0,this.menuArea=0,this.menuX=i,this.menuY=s,this.menuWidth=t,this.menuHeight=15*this.menuSize+22),this.mouseClickX>562&&this.mouseClickY>231&&this.mouseClickX<752&&this.mouseClickY<492&&(i=this.mouseClickX-(t/2|0)-562,i<0?i=0:i+t>190&&(i=190-t),s=this.mouseClickY-231,s<0?s=0:s+e>261&&(s=261-e),this.menuVisible=!0,this.menuArea=1,this.menuX=i,this.menuY=s,this.menuWidth=t,this.menuHeight=15*this.menuSize+22),this.mouseClickX>22&&this.mouseClickY>375&&this.mouseClickX<501&&this.mouseClickY<471&&(i=this.mouseClickX-(t/2|0)-22,i<0?i=0:i+t>479&&(i=479-t),s=this.mouseClickY-375,s<0?s=0:s+e>96&&(s=96-e),this.menuVisible=!0,this.menuArea=2,this.menuX=i,this.menuY=s,this.menuWidth=t,this.menuHeight=15*this.menuSize+22)};tryMove=(t,e,i,s,a,h,n,r,o,l,c)=>{const d=this.levelCollisionMap[this.currentLevel];if(!d)return!1;const m=x.A.SIZE,u=x.A.SIZE;for(let t=0;t<m;t++)for(let e=0;e<u;e++){const i=x.A.index(t,e);this.bfsDirection[i]=0,this.bfsCost[i]=99999999}let p=t,f=e;const g=x.A.index(t,e);this.bfsDirection[g]=99,this.bfsCost[g]=0;let A=0,S=0;this.bfsStepX[A]=t,this.bfsStepZ[A++]=e;let y=!1,C=this.bfsStepX.length;const T=d.flags;for(;S!==A;){if(p=this.bfsStepX[S],f=this.bfsStepZ[S],S=(S+1)%C,p===i&&f===s){y=!0;break}if(o!==N.A.WALL_STRAIGHT.id){if((o<N.A.WALLDECOR_STRAIGHT_OFFSET.id||o===N.A.CENTREPIECE_STRAIGHT.id)&&d.reachedWall(p,f,i,s,o-1,r)){y=!0;break}if(o<N.A.CENTREPIECE_STRAIGHT.id&&d.reachedWallDecoration(p,f,i,s,o-1,r)){y=!0;break}}if(0!==h&&0!==n&&d.reachedLoc(p,f,i,s,h,n,l)){y=!0;break}const t=this.bfsCost[x.A.index(p,f)]+1;let e=x.A.index(p-1,f);p>0&&0===this.bfsDirection[e]&&(T[e]&F.A.BLOCK_WEST)===F.A.OPEN&&(this.bfsStepX[A]=p-1,this.bfsStepZ[A]=f,A=(A+1)%C,this.bfsDirection[e]=2,this.bfsCost[e]=t),e=x.A.index(p+1,f),p<m-1&&0===this.bfsDirection[e]&&(T[e]&F.A.BLOCK_EAST)===F.A.OPEN&&(this.bfsStepX[A]=p+1,this.bfsStepZ[A]=f,A=(A+1)%C,this.bfsDirection[e]=8,this.bfsCost[e]=t),e=x.A.index(p,f-1),f>0&&0===this.bfsDirection[e]&&(T[e]&F.A.BLOCK_SOUTH)===F.A.OPEN&&(this.bfsStepX[A]=p,this.bfsStepZ[A]=f-1,A=(A+1)%C,this.bfsDirection[e]=1,this.bfsCost[e]=t),e=x.A.index(p,f+1),f<u-1&&0===this.bfsDirection[e]&&(T[e]&F.A.BLOCK_NORTH)===F.A.OPEN&&(this.bfsStepX[A]=p,this.bfsStepZ[A]=f+1,A=(A+1)%C,this.bfsDirection[e]=4,this.bfsCost[e]=t),e=x.A.index(p-1,f-1),p>0&&f>0&&0===this.bfsDirection[e]&&!(T[e]&F.A.BLOCK_SOUTH_WEST)&&(T[x.A.index(p-1,f)]&F.A.BLOCK_WEST)===F.A.OPEN&&(T[x.A.index(p,f-1)]&F.A.BLOCK_SOUTH)===F.A.OPEN&&(this.bfsStepX[A]=p-1,this.bfsStepZ[A]=f-1,A=(A+1)%C,this.bfsDirection[e]=3,this.bfsCost[e]=t),e=x.A.index(p+1,f-1),p<m-1&&f>0&&0===this.bfsDirection[e]&&!(T[e]&F.A.BLOCK_SOUTH_EAST)&&(T[x.A.index(p+1,f)]&F.A.BLOCK_EAST)===F.A.OPEN&&(T[x.A.index(p,f-1)]&F.A.BLOCK_SOUTH)===F.A.OPEN&&(this.bfsStepX[A]=p+1,this.bfsStepZ[A]=f-1,A=(A+1)%C,this.bfsDirection[e]=9,this.bfsCost[e]=t),e=x.A.index(p-1,f+1),p>0&&f<u-1&&0===this.bfsDirection[e]&&!(T[e]&F.A.BLOCK_NORTH_WEST)&&(T[x.A.index(p-1,f)]&F.A.BLOCK_WEST)===F.A.OPEN&&(T[x.A.index(p,f+1)]&F.A.BLOCK_NORTH)===F.A.OPEN&&(this.bfsStepX[A]=p-1,this.bfsStepZ[A]=f+1,A=(A+1)%C,this.bfsDirection[e]=6,this.bfsCost[e]=t),e=x.A.index(p+1,f+1),p<m-1&&f<u-1&&0===this.bfsDirection[e]&&!(T[e]&F.A.BLOCK_NORTH_EAST)&&(T[x.A.index(p+1,f)]&F.A.BLOCK_EAST)===F.A.OPEN&&(T[x.A.index(p,f+1)]&F.A.BLOCK_NORTH)===F.A.OPEN&&(this.bfsStepX[A]=p+1,this.bfsStepZ[A]=f+1,A=(A+1)%C,this.bfsDirection[e]=12,this.bfsCost[e]=t)}if(this.tryMoveNearest=0,!y){if(c){let t=100;for(let e=1;e<2;e++){for(let a=i-e;a<=i+e;a++)for(let i=s-e;i<=s+e;i++){const e=x.A.index(a,i);a>=0&&i>=0&&a<x.A.SIZE&&i<x.A.SIZE&&this.bfsCost[e]<t&&(t=this.bfsCost[e],p=a,f=i,this.tryMoveNearest=1,y=!0)}if(y)break}}if(!y)return!1}S=0,this.bfsStepX[S]=p,this.bfsStepZ[S++]=f;let I=this.bfsDirection[x.A.index(p,f)],w=I;for(;p!==t||f!==e;)w!==I&&(I=w,this.bfsStepX[S]=p,this.bfsStepZ[S++]=f),w&st.A.EAST?p++:w&st.A.WEST&&p--,w&st.A.NORTH?f++:w&st.A.SOUTH&&f--,w=this.bfsDirection[x.A.index(p,f)];if(S>0){C=Math.min(S,25),S--;const t=this.bfsStepX[S],e=this.bfsStepZ[S];if($.K.showDebug&&1===this.actionKey[6]&&1===this.actionKey[7]){for(let t=0;t<this.userTileMarkers.length;t++){const e=this.userTileMarkers[t];if(e&&e.x===z.A.clickTileX&&e.z===z.A.clickTileZ)return this.userTileMarkers[t]=null,!1}return this.userTileMarkers[this.userTileMarkerIndex]=new it.A(this.currentLevel,z.A.clickTileX,z.A.clickTileZ),this.userTileMarkerIndex=this.userTileMarkerIndex+1&this.userTileMarkers.length-1,!1}0===a?(this.out.p1isaac(v.A.MOVE_GAMECLICK),this.out.p1(C+C+3)):1===a?(this.out.p1isaac(v.A.MOVE_MINIMAPCLICK),this.out.p1(C+C+3+14)):2===a&&(this.out.p1isaac(v.A.MOVE_OPCLICK),this.out.p1(C+C+3)),1===this.actionKey[5]?this.out.p1(1):this.out.p1(0),this.out.p2(t+this.sceneBaseTileX),this.out.p2(e+this.sceneBaseTileZ),this.flagSceneTileX=this.bfsStepX[0],this.flagSceneTileZ=this.bfsStepZ[0];for(let i=1;i<C;i++)S--,this.out.p1(this.bfsStepX[S]-t),this.out.p1(this.bfsStepZ[S]-e);return!0}return 1!==a};readPlayerInfo=(t,e)=>{this.entityRemovalCount=0,this.entityUpdateCount=0,this.readLocalPlayer(t),this.readPlayers(t),this.readNewPlayers(t,e),this.readPlayerUpdates(t);for(let t=0;t<this.entityRemovalCount;t++){const e=this.entityRemovalIds[t],i=this.players[e];i&&i.cycle!==this.loopCycle&&(this.players[e]=null)}if(t.pos!==e)throw new Error(`eek! Error packet size mismatch in getplayer pos:${t.pos} psize:${e}`);for(let t=0;t<this.playerCount;t++)if(!this.players[this.playerIds[t]])throw new Error(`eek! ${this.username} null entry in pl list - pos:${t} size:${this.playerCount}`)};readLocalPlayer=t=>{if(t.bits(),0!==t.gBit(1)){const e=t.gBit(2);if(0===e)this.entityUpdateIds[this.entityUpdateCount++]=this.LOCAL_PLAYER_INDEX;else if(1===e){const e=t.gBit(3);this.localPlayer?.step(!1,e),1===t.gBit(1)&&(this.entityUpdateIds[this.entityUpdateCount++]=this.LOCAL_PLAYER_INDEX)}else if(2===e){const e=t.gBit(3);this.localPlayer?.step(!0,e);const i=t.gBit(3);this.localPlayer?.step(!0,i),1===t.gBit(1)&&(this.entityUpdateIds[this.entityUpdateCount++]=this.LOCAL_PLAYER_INDEX)}else if(3===e){this.currentLevel=t.gBit(2);const e=t.gBit(7),i=t.gBit(7),s=t.gBit(1);this.localPlayer?.move(1===s,e,i),1===t.gBit(1)&&(this.entityUpdateIds[this.entityUpdateCount++]=this.LOCAL_PLAYER_INDEX)}}};readPlayers=t=>{const e=t.gBit(8);if(e<this.playerCount)for(let t=e;t<this.playerCount;t++)this.entityRemovalIds[this.entityRemovalCount++]=this.playerIds[t];if(e>this.playerCount)throw new Error(`eek! ${this.username} Too many players`);this.playerCount=0;for(let i=0;i<e;i++){const e=this.playerIds[i],s=this.players[e];if(0===t.gBit(1))this.playerIds[this.playerCount++]=e,s&&(s.cycle=this.loopCycle);else{const i=t.gBit(2);if(0===i)this.playerIds[this.playerCount++]=e,s&&(s.cycle=this.loopCycle),this.entityUpdateIds[this.entityUpdateCount++]=e;else if(1===i){this.playerIds[this.playerCount++]=e,s&&(s.cycle=this.loopCycle);const i=t.gBit(3);s?.step(!1,i),1===t.gBit(1)&&(this.entityUpdateIds[this.entityUpdateCount++]=e)}else if(2===i){this.playerIds[this.playerCount++]=e,s&&(s.cycle=this.loopCycle);const i=t.gBit(3);s?.step(!0,i);const a=t.gBit(3);s?.step(!0,a),1===t.gBit(1)&&(this.entityUpdateIds[this.entityUpdateCount++]=e)}else 3===i&&(this.entityRemovalIds[this.entityRemovalCount++]=e)}}};readNewPlayers=(t,e)=>{let i;for(;t.bitPos+10<8*e&&(i=t.gBit(11),2047!==i);){if(!this.players[i]){this.players[i]=new H.A;const t=this.playerAppearanceBuffer[i];t&&this.players[i]?.read(t)}this.playerIds[this.playerCount++]=i;const e=this.players[i];e&&(e.cycle=this.loopCycle);let s=t.gBit(5);s>15&&(s-=32);let a=t.gBit(5);a>15&&(a-=32);const h=t.gBit(1);this.localPlayer&&e?.move(1===h,this.localPlayer.pathTileX[0]+s,this.localPlayer.pathTileZ[0]+a),1===t.gBit(1)&&(this.entityUpdateIds[this.entityUpdateCount++]=i)}t.bytes()};readPlayerUpdates=t=>{for(let e=0;e<this.entityUpdateCount;e++){const i=this.entityUpdateIds[e],s=this.players[i];if(!s)continue;let a=t.g1;128&~a||(a+=t.g1<<8),this.readPlayerUpdatesBlocks(s,i,a,t)}};readPlayerUpdatesBlocks=(t,e,i,a)=>{if(t.lastMask=i,t.lastMaskCycle=this.loopCycle,!(1&~i)){const i=a.g1,s=new Uint8Array(i),h=new y.A(s);a.gdata(i,0,s),this.playerAppearanceBuffer[e]=h,t.read(h)}if(!(2&~i)){let e=a.g2;65535===e&&(e=-1),e===t.primarySeqId&&(t.primarySeqLoop=0);const i=a.g1;(-1===e||-1===t.primarySeqId||s.A.instances[e].priority>s.A.instances[t.primarySeqId].priority||0===s.A.instances[t.primarySeqId].priority)&&(t.primarySeqId=e,t.primarySeqFrame=0,t.primarySeqCycle=0,t.primarySeqDelay=i,t.primarySeqLoop=0)}if(4&~i||(t.targetId=a.g2,65535===t.targetId&&(t.targetId=-1)),8&~i||(t.chat=a.gjstr,t.chatColor=0,t.chatStyle=0,t.chatTimer=150,t.name&&this.addMessage(2,t.chat,t.name)),16&~i||(t.damage=a.g1,t.damageType=a.g1,t.combatCycle=this.loopCycle+400,t.health=a.g1,t.totalHealth=a.g1),32&~i||(t.targetTileX=a.g2,t.targetTileZ=a.g2,t.lastFaceX=t.targetTileX,t.lastFaceZ=t.targetTileZ),!(64&~i)){const e=a.g2,i=a.g1,s=a.g1,h=a.pos;if(t.name){const h=M.A.toBase37(t.name);let n=!1;if(i<=1)for(let t=0;t<this.ignoreCount;t++)if(this.ignoreName37[t]===h){n=!0;break}if(!n&&0===this.overrideChat)try{const h=E.A.unpack(a,s),n=O.A.filter(h);t.chat=n,t.chatColor=e>>8,t.chatStyle=255&e,t.chatTimer=150,i>1?this.addMessage(1,n,t.name):this.addMessage(2,n,t.name)}catch(t){}}a.pos=h+s}if(!(256&~i)){t.spotanimId=a.g2;const e=a.g4;t.spotanimOffset=e>>16,t.spotanimLastCycle=this.loopCycle+(65535&e),t.spotanimFrame=0,t.spotanimCycle=0,t.spotanimLastCycle>this.loopCycle&&(t.spotanimFrame=-1),65535===t.spotanimId&&(t.spotanimId=-1)}512&~i||(t.forceMoveStartSceneTileX=a.g1,t.forceMoveStartSceneTileZ=a.g1,t.forceMoveEndSceneTileX=a.g1,t.forceMoveEndSceneTileZ=a.g1,t.forceMoveEndCycle=a.g2+this.loopCycle,t.forceMoveStartCycle=a.g2+this.loopCycle,t.forceMoveFaceDirection=a.g1,t.pathLength=0,t.pathTileX[0]=t.forceMoveEndSceneTileX,t.pathTileZ[0]=t.forceMoveEndSceneTileZ)};readNpcInfo=(t,e)=>{this.entityRemovalCount=0,this.entityUpdateCount=0,this.readNpcs(t),this.readNewNpcs(t,e),this.readNpcUpdates(t);for(let t=0;t<this.entityRemovalCount;t++){const e=this.entityRemovalIds[t],i=this.npcs[e];i&&i.cycle!==this.loopCycle&&(i.type=null,this.npcs[e]=null)}if(t.pos!==e)throw new Error(`eek! ${this.username} size mismatch in getnpcpos - pos:${t.pos} psize:${e}`);for(let t=0;t<this.npcCount;t++)if(!this.npcs[this.npcIds[t]])throw new Error(`eek! ${this.username} null entry in npc list - pos:${t} size:${this.npcCount}`)};readNpcs=t=>{t.bits();const e=t.gBit(8);if(e<this.npcCount)for(let t=e;t<this.npcCount;t++)this.entityRemovalIds[this.entityRemovalCount++]=this.npcIds[t];if(e>this.npcCount)throw new Error(`eek! ${this.username} Too many npc!`);this.npcCount=0;for(let i=0;i<e;i++){const e=this.npcIds[i],s=this.npcs[e];if(0===t.gBit(1))this.npcIds[this.npcCount++]=e,s&&(s.cycle=this.loopCycle);else{const i=t.gBit(2);if(0===i)this.npcIds[this.npcCount++]=e,s&&(s.cycle=this.loopCycle),this.entityUpdateIds[this.entityUpdateCount++]=e;else if(1===i){this.npcIds[this.npcCount++]=e,s&&(s.cycle=this.loopCycle);const i=t.gBit(3);s?.step(!1,i),1===t.gBit(1)&&(this.entityUpdateIds[this.entityUpdateCount++]=e)}else if(2===i){this.npcIds[this.npcCount++]=e,s&&(s.cycle=this.loopCycle);const i=t.gBit(3);s?.step(!0,i);const a=t.gBit(3);s?.step(!0,a),1===t.gBit(1)&&(this.entityUpdateIds[this.entityUpdateCount++]=e)}else 3===i&&(this.entityRemovalIds[this.entityRemovalCount++]=e)}}};readNewNpcs=(t,e)=>{for(;t.bitPos+21<8*e;){const e=t.gBit(13);if(8191===e)break;this.npcs[e]||(this.npcs[e]=new Z.A);const i=this.npcs[e];this.npcIds[this.npcCount++]=e,i?(i.cycle=this.loopCycle,i.type=n.A.get(t.gBit(11)),i.size=i.type.size,i.seqWalkId=i.type.walkanim,i.seqTurnAroundId=i.type.walkanim_b,i.seqTurnLeftId=i.type.walkanim_r,i.seqTurnRightId=i.type.walkanim_l,i.seqStandId=i.type.readyanim):t.gBit(11);let s=t.gBit(5);s>15&&(s-=32);let a=t.gBit(5);a>15&&(a-=32),this.localPlayer&&i?.move(!1,this.localPlayer.pathTileX[0]+s,this.localPlayer.pathTileZ[0]+a),1===t.gBit(1)&&(this.entityUpdateIds[this.entityUpdateCount++]=e)}t.bytes()};readNpcUpdates=t=>{for(let e=0;e<this.entityUpdateCount;e++){const i=this.entityUpdateIds[e],a=this.npcs[i];if(!a)continue;const h=t.g1;if(a.lastMask=h,a.lastMaskCycle=this.loopCycle,!(2&~h)){let e=t.g2;65535===e&&(e=-1),e===a.primarySeqId&&(a.primarySeqLoop=0);const i=t.g1;(-1===e||-1===a.primarySeqId||s.A.instances[e].priority>s.A.instances[a.primarySeqId].priority||0===s.A.instances[a.primarySeqId].priority)&&(a.primarySeqId=e,a.primarySeqFrame=0,a.primarySeqCycle=0,a.primarySeqDelay=i,a.primarySeqLoop=0)}if(4&~h||(a.targetId=t.g2,65535===a.targetId&&(a.targetId=-1)),8&~h||(a.chat=t.gjstr,a.chatTimer=100),16&~h||(a.damage=t.g1,a.damageType=t.g1,a.combatCycle=this.loopCycle+400,a.health=t.g1,a.totalHealth=t.g1),32&~h||(a.type=n.A.get(t.g2),a.seqWalkId=a.type.walkanim,a.seqTurnAroundId=a.type.walkanim_b,a.seqTurnLeftId=a.type.walkanim_r,a.seqTurnRightId=a.type.walkanim_l,a.seqStandId=a.type.readyanim),!(64&~h)){a.spotanimId=t.g2;const e=t.g4;a.spotanimOffset=e>>16,a.spotanimLastCycle=this.loopCycle+(65535&e),a.spotanimFrame=0,a.spotanimCycle=0,a.spotanimLastCycle>this.loopCycle&&(a.spotanimFrame=-1),65535===a.spotanimId&&(a.spotanimId=-1)}128&~h||(a.targetTileX=t.g2,a.targetTileZ=t.g2,a.lastFaceX=a.targetTileX,a.lastFaceZ=a.targetTileZ)}};updatePlayers=()=>{for(let t=-1;t<this.playerCount;t++){let e;e=-1===t?this.LOCAL_PLAYER_INDEX:this.playerIds[t];const i=this.players[e];i&&this.updateEntity(i)}if($.K.cyclelogic6++,$.K.cyclelogic6>1406){$.K.cyclelogic6=0,this.out.p1isaac(v.A.ANTICHEAT_CYCLELOGIC6),this.out.p1(0);const t=this.out.pos;this.out.p1(162),this.out.p1(22),2*Math.random()|0||this.out.p1(84),this.out.p2(31824),this.out.p2(13490),2*Math.random()|0||this.out.p1(123),2*Math.random()|0||this.out.p1(134),this.out.p1(100),this.out.p1(94),this.out.p2(35521),this.out.psize1(this.out.pos-t)}};updateEntity=t=>{(t.x<128||t.z<128||t.x>=13184||t.z>=13184)&&(t.primarySeqId=-1,t.spotanimId=-1,t.forceMoveEndCycle=0,t.forceMoveStartCycle=0,t.x=128*t.pathTileX[0]+64*t.size,t.z=128*t.pathTileZ[0]+64*t.size,t.pathLength=0),t===this.localPlayer&&(t.x<1536||t.z<1536||t.x>=11776||t.z>=11776)&&(t.primarySeqId=-1,t.spotanimId=-1,t.forceMoveEndCycle=0,t.forceMoveStartCycle=0,t.x=128*t.pathTileX[0]+64*t.size,t.z=128*t.pathTileZ[0]+64*t.size,t.pathLength=0),t.forceMoveEndCycle>this.loopCycle?this.updateForceMovement(t):t.forceMoveStartCycle>=this.loopCycle?this.startForceMovement(t):this.updateMovement(t),this.updateFacingDirection(t),this.updateSequences(t)};pushPlayers=()=>{if(this.localPlayer){this.localPlayer.x>>7===this.flagSceneTileX&&this.localPlayer.z>>7===this.flagSceneTileZ&&(this.flagSceneTileX=0);for(let t=-1;t<this.playerCount;t++){let e,i;if(-1===t?(e=this.localPlayer,i=this.LOCAL_PLAYER_INDEX<<14):(e=this.players[this.playerIds[t]],i=this.playerIds[t]<<14),!e||!e.isVisible())continue;e.lowMemory=($.K.lowMemory&&this.playerCount>50||this.playerCount>200)&&-1!==t&&e.secondarySeqId===e.seqStandId;const s=e.x>>7,a=e.z>>7;if(!(s<0||s>=x.A.SIZE||a<0||a>=x.A.SIZE))if(!e.locModel||this.loopCycle<e.locStartCycle||this.loopCycle>=e.locStopCycle){if(64==(127&e.x)&&64==(127&e.z)){if(this.tileLastOccupiedCycle[s][a]===this.sceneCycle)continue;this.tileLastOccupiedCycle[s][a]=this.sceneCycle}e.y=this.getHeightmapY(this.currentLevel,e.x,e.z),this.scene?.addTemporary(this.currentLevel,e.x,e.y,e.z,null,e,i,e.yaw,60,e.seqStretches)}else e.lowMemory=!1,e.y=this.getHeightmapY(this.currentLevel,e.x,e.z),this.scene?.addTemporary2(this.currentLevel,e.x,e.y,e.z,e.minTileX,e.minTileZ,e.maxTileX,e.maxTileZ,null,e,i,e.yaw)}}};updateNpcs=()=>{for(let t=0;t<this.npcCount;t++){const e=this.npcIds[t],i=this.npcs[e];i&&i.type&&this.updateEntity(i)}};pushNpcs=()=>{for(let t=0;t<this.npcCount;t++){const e=this.npcs[this.npcIds[t]],i=536870912+(this.npcIds[t]<<14)|0;if(!e||!e.isVisible())continue;const s=e.x>>7,a=e.z>>7;if(!(s<0||s>=x.A.SIZE||a<0||a>=x.A.SIZE)){if(1===e.size&&64==(127&e.x)&&64==(127&e.z)){if(this.tileLastOccupiedCycle[s][a]===this.sceneCycle)continue;this.tileLastOccupiedCycle[s][a]=this.sceneCycle}this.scene?.addTemporary(this.currentLevel,e.x,this.getHeightmapY(this.currentLevel,e.x,e.z),e.z,null,e,i,e.yaw,64*(e.size-1)+60,e.seqStretches)}}};pushProjectiles=()=>{for(let t=this.projectiles.head();t;t=this.projectiles.next())if(t.level!==this.currentLevel||this.loopCycle>t.lastCycle)t.unlink();else if(this.loopCycle>=t.startCycle){if(t.target>0){const e=this.npcs[t.target-1];e&&t.updateVelocity(e.x,this.getHeightmapY(t.level,e.x,e.z)-t.offsetY,e.z,this.loopCycle)}if(t.target<0){const e=-t.target-1;let i;i=e===this.localPid?this.localPlayer:this.players[e],i&&t.updateVelocity(i.x,this.getHeightmapY(t.level,i.x,i.z)-t.offsetY,i.z,this.loopCycle)}t.update(this.sceneDelta),this.scene?.addTemporary(this.currentLevel,0|t.x,0|t.y,0|t.z,null,t,-1,t.yaw,60,!1)}};pushSpotanims=()=>{for(let t=this.spotanims.head();t;t=this.spotanims.next())t.level!==this.currentLevel||t.seqComplete?t.unlink():this.loopCycle>=t.startCycle&&(t.update(this.sceneDelta),t.seqComplete?t.unlink():this.scene?.addTemporary(t.level,t.x,t.y,t.z,null,t,-1,0,60,!1))};pushLocs=()=>{for(let t=this.locList.head();t;t=this.locList.next()){let e=!1;if(t.seqCycle+=this.sceneDelta,-1===t.seqFrame&&(t.seqFrame=0,e=!0),t.seq.delay)for(;t.seqCycle>t.seq.delay[t.seqFrame];)if(t.seqCycle-=t.seq.delay[t.seqFrame]+1,t.seqFrame++,e=!0,t.seqFrame>=t.seq.frameCount&&(t.seqFrame-=t.seq.replayoff,t.seqFrame<0||t.seqFrame>=t.seq.frameCount)){t.unlink(),e=!1;break}if(e&&this.scene){const e=t.heightmapSW,i=t.heightmapNE,s=t.heightmapNW;let h=0;if(0===t.heightmapSE?h=this.scene.getWallBitset(e,i,s):1===t.heightmapSE?h=this.scene.getWallDecorationBitset(e,s,i):2===t.heightmapSE?h=this.scene.getLocBitset(e,i,s):3===t.heightmapSE&&(h=this.scene.getGroundDecorationBitset(e,i,s)),this.levelHeightmap&&0!==h&&(h>>14&32767)===t.index){const n=this.levelHeightmap[e][i][s],r=this.levelHeightmap[e][i+1][s],o=this.levelHeightmap[e][i+1][s+1],l=this.levelHeightmap[e][i][s+1],c=a.A.get(t.index);let d=-1;if(-1!==t.seqFrame&&t.seq.frames&&(d=t.seq.frames[t.seqFrame]),2===t.heightmapSE){const t=this.scene.getInfo(e,i,s,h);let a=31&t;const m=t>>6;a===N.A.CENTREPIECE_DIAGONAL.id&&(a=N.A.CENTREPIECE_STRAIGHT.id),this.scene?.setLocModel(e,i,s,c.getModel(a,m,n,r,o,l,d))}else if(1===t.heightmapSE)this.scene?.setWallDecorationModel(e,i,s,c.getModel(N.A.WALLDECOR_STRAIGHT_NOOFFSET.id,0,n,r,o,l,d));else if(0===t.heightmapSE){const t=this.scene.getInfo(e,i,s,h),a=31&t,m=t>>6;if(a===N.A.WALL_L.id){const t=m+1&3;this.scene?.setWallModels(i,s,e,c.getModel(N.A.WALL_L.id,m+4,n,r,o,l,d),c.getModel(N.A.WALL_L.id,t,n,r,o,l,d))}else this.scene?.setWallModel(e,i,s,c.getModel(a,m,n,r,o,l,d))}else if(3===t.heightmapSE){const t=this.scene.getInfo(e,i,s,h)>>6;this.scene?.setGroundDecorationModel(e,i,s,c.getModel(N.A.GROUND_DECOR.id,t,n,r,o,l,d))}}else t.unlink()}}};updateEntityChats=()=>{for(let t=-1;t<this.playerCount;t++){let e;e=-1===t?this.LOCAL_PLAYER_INDEX:this.playerIds[t];const i=this.players[e];i&&i.chatTimer>0&&(i.chatTimer--,0===i.chatTimer&&(i.chat=null))}for(let t=0;t<this.npcCount;t++){const e=this.npcIds[t],i=this.npcs[e];i&&i.chatTimer>0&&(i.chatTimer--,0===i.chatTimer&&(i.chat=null))}};updateTemporaryLocs=()=>{if(2===this.sceneState){for(let t=this.temporaryLocs.head();t;t=this.temporaryLocs.next())this.loopCycle>=t.lastCycle&&(this.addLoc(t.plane,t.x,t.z,t.locIndex,t.angle,t.shape,t.layer),t.unlink());$.K.cyclelogic5++,$.K.cyclelogic5>85&&($.K.cyclelogic5=0,this.out.p1isaac(v.A.ANTICHEAT_CYCLELOGIC5))}};updateForceMovement=t=>{const e=t.forceMoveEndCycle-this.loopCycle,i=128*t.forceMoveStartSceneTileX+64*t.size,s=128*t.forceMoveStartSceneTileZ+64*t.size;t.x+=(i-t.x)/e|0,t.z+=(s-t.z)/e|0,t.seqTrigger=0,0===t.forceMoveFaceDirection&&(t.dstYaw=1024),1===t.forceMoveFaceDirection&&(t.dstYaw=1536),2===t.forceMoveFaceDirection&&(t.dstYaw=0),3===t.forceMoveFaceDirection&&(t.dstYaw=512)};startForceMovement=t=>{if(t.forceMoveStartCycle===this.loopCycle||-1===t.primarySeqId||0!==t.primarySeqDelay||t.primarySeqCycle+1>s.A.instances[t.primarySeqId].delay[t.primarySeqFrame]){const e=t.forceMoveStartCycle-t.forceMoveEndCycle,i=this.loopCycle-t.forceMoveEndCycle,s=128*t.forceMoveStartSceneTileX+64*t.size,a=128*t.forceMoveStartSceneTileZ+64*t.size,h=128*t.forceMoveEndSceneTileX+64*t.size,n=128*t.forceMoveEndSceneTileZ+64*t.size;t.x=(s*(e-i)+h*i)/e|0,t.z=(a*(e-i)+n*i)/e|0}t.seqTrigger=0,0===t.forceMoveFaceDirection&&(t.dstYaw=1024),1===t.forceMoveFaceDirection&&(t.dstYaw=1536),2===t.forceMoveFaceDirection&&(t.dstYaw=0),3===t.forceMoveFaceDirection&&(t.dstYaw=512),t.yaw=t.dstYaw};updateFacingDirection=t=>{if(-1!==t.targetId&&t.targetId<32768){const e=this.npcs[t.targetId];if(e){const i=t.x-e.x,s=t.z-e.z;0===i&&0===s||(t.dstYaw=325.949*Math.atan2(i,s)&2047)}}if(t.targetId>=32768){let e=t.targetId-32768;e===this.localPid&&(e=this.LOCAL_PLAYER_INDEX);const i=this.players[e];if(i){const e=t.x-i.x,s=t.z-i.z;0===e&&0===s||(t.dstYaw=325.949*Math.atan2(e,s)&2047)}}if((0!==t.targetTileX||0!==t.targetTileZ)&&(0===t.pathLength||t.seqTrigger>0)){const e=t.x-64*(t.targetTileX-this.sceneBaseTileX-this.sceneBaseTileX),i=t.z-64*(t.targetTileZ-this.sceneBaseTileZ-this.sceneBaseTileZ);0===e&&0===i||(t.dstYaw=325.949*Math.atan2(e,i)&2047),t.targetTileX=0,t.targetTileZ=0}const e=t.dstYaw-t.yaw&2047;if(0!==e&&(e<32||e>2016?t.yaw=t.dstYaw:e>1024?t.yaw-=32:t.yaw+=32,t.yaw&=2047,t.secondarySeqId===t.seqStandId&&t.yaw!==t.dstYaw)){if(-1!==t.seqTurnId)return void(t.secondarySeqId=t.seqTurnId);t.secondarySeqId=t.seqWalkId}};updateSequences=t=>{let e;if(t.seqStretches=!1,-1!==t.secondarySeqId&&(e=s.A.instances[t.secondarySeqId],t.secondarySeqCycle++,e.delay&&t.secondarySeqFrame<e.frameCount&&t.secondarySeqCycle>e.delay[t.secondarySeqFrame]&&(t.secondarySeqCycle=0,t.secondarySeqFrame++),t.secondarySeqFrame>=e.frameCount&&(t.secondarySeqCycle=0,t.secondarySeqFrame=0)),-1!==t.primarySeqId&&0===t.primarySeqDelay){for(e=s.A.instances[t.primarySeqId],t.primarySeqCycle++;e.delay&&t.primarySeqFrame<e.frameCount&&t.primarySeqCycle>e.delay[t.primarySeqFrame];)t.primarySeqCycle-=e.delay[t.primarySeqFrame],t.primarySeqFrame++;t.primarySeqFrame>=e.frameCount&&(t.primarySeqFrame-=e.replayoff,t.primarySeqLoop++,t.primarySeqLoop>=e.replaycount&&(t.primarySeqId=-1),(t.primarySeqFrame<0||t.primarySeqFrame>=e.frameCount)&&(t.primarySeqId=-1)),t.seqStretches=e.stretches}if(t.primarySeqDelay>0&&t.primarySeqDelay--,-1!==t.spotanimId&&this.loopCycle>=t.spotanimLastCycle){for(t.spotanimFrame<0&&(t.spotanimFrame=0),e=o.A.instances[t.spotanimId].seq,t.spotanimCycle++;e&&e.delay&&t.spotanimFrame<e.frameCount&&t.spotanimCycle>e.delay[t.spotanimFrame];)t.spotanimCycle-=e.delay[t.spotanimFrame],t.spotanimFrame++;e&&t.spotanimFrame>=e.frameCount&&(t.spotanimFrame<0||t.spotanimFrame>=e.frameCount)&&(t.spotanimId=-1)}};updateMovement=t=>{if(t.secondarySeqId=t.seqStandId,0===t.pathLength)return void(t.seqTrigger=0);if(-1!==t.primarySeqId&&0===t.primarySeqDelay&&!s.A.instances[t.primarySeqId].walkmerge)return void t.seqTrigger++;const e=t.x,i=t.z,a=128*t.pathTileX[t.pathLength-1]+64*t.size,h=128*t.pathTileZ[t.pathLength-1]+64*t.size;if(a-e<=256&&a-e>=-256&&h-i<=256&&h-i>=-256){t.dstYaw=e<a?i<h?1280:i>h?1792:1536:e>a?i<h?768:i>h?256:512:i<h?1024:0;let s=t.dstYaw-t.yaw&2047;s>1024&&(s-=2048);let n=t.seqTurnAroundId;s>=-256&&s<=256?n=t.seqWalkId:s>=256&&s<768?n=t.seqTurnRightId:s>=-768&&s<=-256&&(n=t.seqTurnLeftId),-1===n&&(n=t.seqWalkId),t.secondarySeqId=n;let r=4;t.yaw!==t.dstYaw&&-1===t.targetId&&(r=2),t.pathLength>2&&(r=6),t.pathLength>3&&(r=8),t.seqTrigger>0&&t.pathLength>1&&(r=8,t.seqTrigger--),t.pathRunning[t.pathLength-1]&&(r<<=1),r>=8&&t.secondarySeqId===t.seqWalkId&&-1!==t.seqRunId&&(t.secondarySeqId=t.seqRunId),e<a?(t.x+=r,t.x>a&&(t.x=a)):e>a&&(t.x-=r,t.x<a&&(t.x=a)),i<h?(t.z+=r,t.z>h&&(t.z=h)):i>h&&(t.z-=r,t.z<h&&(t.z=h)),t.x===a&&t.z===h&&t.pathLength--}else t.x=a,t.z=h};getTopLevel=()=>{let t=3;if(this.cameraPitch<310&&this.localPlayer){let e=this.cameraX>>7,i=this.cameraZ>>7;const s=this.localPlayer.x>>7,a=this.localPlayer.z>>7;let h,n,r,o;if(this.levelTileFlags&&4&this.levelTileFlags[this.currentLevel][e][i]&&(t=this.currentLevel),h=s>e?s-e:e-s,n=a>i?a-i:i-a,h>n)for(r=65536*n/h|0,o=32768;e!==s;)e<s?e++:e>s&&e--,this.levelTileFlags&&4&this.levelTileFlags[this.currentLevel][e][i]&&(t=this.currentLevel),o+=r,o>=65536&&(o-=65536,i<a?i++:i>a&&i--,this.levelTileFlags&&4&this.levelTileFlags[this.currentLevel][e][i]&&(t=this.currentLevel));else for(r=65536*h/n|0,o=32768;i!==a;)i<a?i++:i>a&&i--,this.levelTileFlags&&4&this.levelTileFlags[this.currentLevel][e][i]&&(t=this.currentLevel),o+=r,o>=65536&&(o-=65536,e<s?e++:e>s&&e--,this.levelTileFlags&&4&this.levelTileFlags[this.currentLevel][e][i]&&(t=this.currentLevel))}return this.localPlayer&&this.levelTileFlags&&4&this.levelTileFlags[this.currentLevel][this.localPlayer.x>>7][this.localPlayer.z>>7]&&(t=this.currentLevel),t};getTopLevelCutscene=()=>this.levelTileFlags?this.getHeightmapY(this.currentLevel,this.cameraX,this.cameraZ)-this.cameraY>=800||!(4&this.levelTileFlags[this.currentLevel][this.cameraX>>7][this.cameraZ>>7])?3:this.currentLevel:0;getHeightmapY=(t,e,i)=>{if(!this.levelHeightmap)return 0;const s=Math.min(e>>7,x.A.SIZE-1),a=Math.min(i>>7,x.A.SIZE-1);let h=t;t<3&&this.levelTileFlags&&!(2&~this.levelTileFlags[1][s][a])&&(h=t+1);const n=127&e,r=127&i;return(this.levelHeightmap[h][s][a]*(128-n)+this.levelHeightmap[h][s+1][a]*n>>7)*(128-r)+(this.levelHeightmap[h][s][a+1]*(128-n)+this.levelHeightmap[h][s+1][a+1]*n>>7)*r>>7};orbitCamera=(t,e,i,s,a,h)=>{const n=2048-a&2047,r=2048-s&2047;let o,l,c,d=0,m=0,p=h;0!==n&&(o=u.A.sin[n],l=u.A.cos[n],c=m*l-h*o>>16,p=m*o+h*l>>16,m=c),0!==r&&(o=u.A.sin[r],l=u.A.cos[r],c=p*o+d*l>>16,p=p*l-d*o>>16,d=c),this.cameraX=t-d,this.cameraY=e-m,this.cameraZ=i-p,this.cameraPitch=a,this.cameraYaw=s};updateOrbitCamera=()=>{if(!this.localPlayer)return;const t=this.localPlayer.x+this.cameraAnticheatOffsetX,e=this.localPlayer.z+this.cameraAnticheatOffsetZ;(this.orbitCameraX-t<-500||this.orbitCameraX-t>500||this.orbitCameraZ-e<-500||this.orbitCameraZ-e>500)&&(this.orbitCameraX=t,this.orbitCameraZ=e),this.orbitCameraX!==t&&(this.orbitCameraX+=(t-this.orbitCameraX)/16|0),this.orbitCameraZ!==e&&(this.orbitCameraZ+=(e-this.orbitCameraZ)/16|0),1===this.actionKey[1]?this.orbitCameraYawVelocity+=(-this.orbitCameraYawVelocity-24)/2|0:1===this.actionKey[2]?this.orbitCameraYawVelocity+=(24-this.orbitCameraYawVelocity)/2|0:this.orbitCameraYawVelocity=this.orbitCameraYawVelocity/2|0,1===this.actionKey[3]?this.orbitCameraPitchVelocity+=(12-this.orbitCameraPitchVelocity)/2|0:1===this.actionKey[4]?this.orbitCameraPitchVelocity+=(-this.orbitCameraPitchVelocity-12)/2|0:this.orbitCameraPitchVelocity=this.orbitCameraPitchVelocity/2|0,this.orbitCameraYaw=this.orbitCameraYaw+this.orbitCameraYawVelocity/2&2047,this.orbitCameraPitch+=this.orbitCameraPitchVelocity/2|0,this.orbitCameraPitch<128&&(this.orbitCameraPitch=128),this.orbitCameraPitch>383&&(this.orbitCameraPitch=383);const i=this.orbitCameraX>>7,s=this.orbitCameraZ>>7,a=this.getHeightmapY(this.currentLevel,this.orbitCameraX,this.orbitCameraZ);let h=0;if(this.levelHeightmap&&i>3&&s>3&&i<100&&s<100)for(let t=i-4;t<=i+4;t++)for(let e=s-4;e<=s+4;e++){let i=this.currentLevel;i<3&&this.levelTileFlags&&!(2&~this.levelTileFlags[1][t][e])&&i++;const s=a-this.levelHeightmap[i][t][e];s>h&&(h=s)}let n=192*h;n>98048&&(n=98048),n<32768&&(n=32768),n>this.cameraPitchClamp?this.cameraPitchClamp+=(n-this.cameraPitchClamp)/24|0:n<this.cameraPitchClamp&&(this.cameraPitchClamp+=(n-this.cameraPitchClamp)/80|0)};applyCutscene=()=>{let t=128*this.cutsceneSrcLocalTileX+64,e=128*this.cutsceneSrcLocalTileZ+64,i=this.getHeightmapY(this.currentLevel,this.cutsceneSrcLocalTileX,this.cutsceneSrcLocalTileZ)-this.cutsceneSrcHeight;this.cameraX<t&&(this.cameraX+=this.cutsceneMoveSpeed+((t-this.cameraX)*this.cutsceneMoveAcceleration/1e3|0),this.cameraX>t&&(this.cameraX=t)),this.cameraX>t&&(this.cameraX-=this.cutsceneMoveSpeed+((this.cameraX-t)*this.cutsceneMoveAcceleration/1e3|0),this.cameraX<t&&(this.cameraX=t)),this.cameraY<i&&(this.cameraY+=this.cutsceneMoveSpeed+((i-this.cameraY)*this.cutsceneMoveAcceleration/1e3|0),this.cameraY>i&&(this.cameraY=i)),this.cameraY>i&&(this.cameraY-=this.cutsceneMoveSpeed+((this.cameraY-i)*this.cutsceneMoveAcceleration/1e3|0),this.cameraY<i&&(this.cameraY=i)),this.cameraZ<e&&(this.cameraZ+=this.cutsceneMoveSpeed+((e-this.cameraZ)*this.cutsceneMoveAcceleration/1e3|0),this.cameraZ>e&&(this.cameraZ=e)),this.cameraZ>e&&(this.cameraZ-=this.cutsceneMoveSpeed+((this.cameraZ-e)*this.cutsceneMoveAcceleration/1e3|0),this.cameraZ<e&&(this.cameraZ=e)),t=128*this.cutsceneDstLocalTileX+64,e=128*this.cutsceneDstLocalTileZ+64,i=this.getHeightmapY(this.currentLevel,this.cutsceneDstLocalTileX,this.cutsceneDstLocalTileZ)-this.cutsceneDstHeight;const s=t-this.cameraX,a=i-this.cameraY,h=e-this.cameraZ,n=0|Math.sqrt(s*s+h*h);let r=325.949*Math.atan2(a,n)&2047;const o=-325.949*Math.atan2(s,h)&2047;r<128&&(r=128),r>383&&(r=383),this.cameraPitch<r&&(this.cameraPitch+=this.cutsceneRotateSpeed+((r-this.cameraPitch)*this.cutsceneRotateAcceleration/1e3|0),this.cameraPitch>r&&(this.cameraPitch=r)),this.cameraPitch>r&&(this.cameraPitch-=this.cutsceneRotateSpeed+((this.cameraPitch-r)*this.cutsceneRotateAcceleration/1e3|0),this.cameraPitch<r&&(this.cameraPitch=r));let l=o-this.cameraYaw;l>1024&&(l-=2048),l<-1024&&(l+=2048),l>0&&(this.cameraYaw+=this.cutsceneRotateSpeed+(l*this.cutsceneRotateAcceleration/1e3|0),this.cameraYaw&=2047),l<0&&(this.cameraYaw-=this.cutsceneRotateSpeed+(-l*this.cutsceneRotateAcceleration/1e3|0),this.cameraYaw&=2047);let c=o-this.cameraYaw;c>1024&&(c-=2048),c<-1024&&(c+=2048),(c<0&&l>0||c>0&&l<0)&&(this.cameraYaw=o)};readZonePacket=(t,e)=>{const i=t.g1;let h=this.baseX+(i>>4&7),n=this.baseZ+(7&i);if(e===b.A.LOC_ADD_CHANGE||e===b.A.LOC_DEL){const i=t.g1,s=i>>2,a=3&i,r=N.A.of(s).layer;let o;if(o=e===b.A.LOC_DEL?-1:t.g2,h>=0&&n>=0&&h<x.A.SIZE&&n<x.A.SIZE){let t=null;for(let e=this.spawnedLocations.head();e;e=this.spawnedLocations.next())if(e.plane===this.currentLevel&&e.x===h&&e.z===n&&e.layer===r){t=e;break}if(!t&&this.scene){let e=0,i=-1,s=0,a=0;if(r===D.A.WALL?e=this.scene.getWallBitset(this.currentLevel,h,n):r===D.A.WALL_DECOR?e=this.scene.getWallDecorationBitset(this.currentLevel,n,h):r===D.A.GROUND?e=this.scene.getLocBitset(this.currentLevel,h,n):r===D.A.GROUND_DECOR&&(e=this.scene.getGroundDecorationBitset(this.currentLevel,h,n)),0!==e){const t=this.scene.getInfo(this.currentLevel,h,n,e);i=e>>14&32767,s=31&t,a=t>>6}t=new Y.A(this.currentLevel,r,h,n,0,R.A.WEST,N.A.WALL_STRAIGHT.id,i,a,s),this.spawnedLocations.addTail(t)}t&&(t.locIndex=o,t.shape=s,t.angle=a),this.addLoc(this.currentLevel,h,n,o,a,s,r)}}else if(e===b.A.LOC_ANIM){const e=t.g1>>2,i=N.A.of(e).layer,a=t.g2;if(h>=0&&n>=0&&h<x.A.SIZE&&n<x.A.SIZE&&this.scene){let t=0;if(i===D.A.WALL?t=this.scene.getWallBitset(this.currentLevel,h,n):i===D.A.WALL_DECOR?t=this.scene.getWallDecorationBitset(this.currentLevel,n,h):i===D.A.GROUND?t=this.scene.getLocBitset(this.currentLevel,h,n):i===D.A.GROUND_DECOR&&(t=this.scene.getGroundDecorationBitset(this.currentLevel,h,n)),0!==t){const e=new q.A(t>>14&32767,this.currentLevel,i,h,n,s.A.instances[a],!1);this.locList.addTail(e)}}}else if(e===b.A.OBJ_ADD){const e=t.g2,i=t.g2;if(h>=0&&n>=0&&h<x.A.SIZE&&n<x.A.SIZE){const t=new j.A(e,i);this.levelObjStacks[this.currentLevel][h][n]||(this.levelObjStacks[this.currentLevel][h][n]=new P.A),this.levelObjStacks[this.currentLevel][h][n]?.addTail(t),this.sortObjStacks(h,n)}}else if(e===b.A.OBJ_DEL){const e=t.g2;if(h>=0&&n>=0&&h<x.A.SIZE&&n<x.A.SIZE){const t=this.levelObjStacks[this.currentLevel][h][n];if(t){for(let i=t.head();i;i=t.next())if(i.index===(32767&e)){i.unlink();break}t.head()||(this.levelObjStacks[this.currentLevel][h][n]=null),this.sortObjStacks(h,n)}}}else if(e===b.A.MAP_PROJANIM){let e=h+t.g1b,i=n+t.g1b;const s=t.g2b,a=t.g2,r=t.g1,o=t.g1,l=t.g2,c=t.g2,d=t.g1,m=t.g1;if(h>=0&&n>=0&&h<x.A.SIZE&&n<x.A.SIZE&&e>=0&&i>=0&&e<x.A.SIZE&&i<x.A.SIZE){h=128*h+64,n=128*n+64,e=128*e+64,i=128*i+64;const t=new U.A(a,this.currentLevel,h,this.getHeightmapY(this.currentLevel,h,n)-r,n,l+this.loopCycle,c+this.loopCycle,d,m,s,o);t.updateVelocity(e,this.getHeightmapY(this.currentLevel,e,i)-o,i,l+this.loopCycle),this.projectiles.addTail(t)}}else if(e===b.A.MAP_ANIM){const e=t.g2,i=t.g1,s=t.g2;if(h>=0&&n>=0&&h<x.A.SIZE&&n<x.A.SIZE){h=128*h+64,n=128*n+64;const t=new W.A(e,this.currentLevel,h,n,this.getHeightmapY(this.currentLevel,h,n)-i,this.loopCycle,s);this.spotanims.addTail(t)}}else if(e===b.A.OBJ_REVEAL){const e=t.g2,i=t.g2,s=t.g2;if(h>=0&&n>=0&&h<x.A.SIZE&&n<x.A.SIZE&&s!==this.localPid){const t=new j.A(e,i);this.levelObjStacks[this.currentLevel][h][n]||(this.levelObjStacks[this.currentLevel][h][n]=new P.A),this.levelObjStacks[this.currentLevel][h][n]?.addTail(t),this.sortObjStacks(h,n)}}else if(e===b.A.LOC_MERGE){const e=t.g1,i=e>>2,s=3&e,r=N.A.of(i).layer,o=t.g2,l=t.g2,c=t.g2,d=t.g2;let m,u=t.g1b,p=t.g1b,f=t.g1b,g=t.g1b;if(m=d===this.localPid?this.localPlayer:this.players[d],m&&this.levelHeightmap){const t=new X.A(this.currentLevel,r,h,n,-1,s,i,l+this.loopCycle);this.temporaryLocs.addTail(t);const e=new X.A(this.currentLevel,r,h,n,o,s,i,c+this.loopCycle);this.temporaryLocs.addTail(e);const d=this.levelHeightmap[this.currentLevel][h][n],A=this.levelHeightmap[this.currentLevel][h+1][n],S=this.levelHeightmap[this.currentLevel][h+1][n+1],y=this.levelHeightmap[this.currentLevel][h][n+1],C=a.A.get(o);m.locStartCycle=l+this.loopCycle,m.locStopCycle=c+this.loopCycle,m.locModel=C.getModel(i,s,d,A,S,y,-1);let T,I=C.width,w=C.length;s!==R.A.NORTH&&s!==R.A.SOUTH||(I=C.length,w=C.width),m.locOffsetX=128*h+64*I,m.locOffsetZ=128*n+64*w,m.locOffsetY=this.getHeightmapY(this.currentLevel,m.locOffsetX,m.locOffsetZ),u>f&&(T=u,u=f,f=T),p>g&&(T=p,p=g,g=T),m.minTileX=h+u,m.maxTileX=h+f,m.minTileZ=n+p,m.maxTileZ=n+g}}else if(e===b.A.OBJ_COUNT){const e=t.g2,i=t.g2,s=t.g2;if(h>=0&&n>=0&&h<x.A.SIZE&&n<x.A.SIZE){const t=this.levelObjStacks[this.currentLevel][h][n];if(t){for(let a=t.head();a;a=t.next())if(a.index===(32767&e)&&a.count===i){a.count=s;break}this.sortObjStacks(h,n)}}}};updateTextures=t=>{if(!$.K.lowMemory){if(u.A.textureCycle[17]>=t){const t=u.A.textures[17];if(!t)return;const e=t.width*t.height-1,i=t.width*this.sceneDelta*2,s=t.pixels,a=this.textureBuffer;for(let t=0;t<=e;t++)a[t]=s[t-i&e];t.pixels=a,this.textureBuffer=s,u.A.pushTexture(17)}if(u.A.textureCycle[24]>=t){const t=u.A.textures[24];if(!t)return;const e=t.width*t.height-1,i=t.width*this.sceneDelta*2,s=t.pixels,a=this.textureBuffer;for(let t=0;t<=e;t++)a[t]=s[t-i&e];t.pixels=a,this.textureBuffer=s,u.A.pushTexture(24)}}};updateFlames=()=>{if(this.flameBuffer3&&this.flameBuffer2&&this.flameBuffer0&&this.flameLineOffset){for(let t=10;t<117;t++)(100*Math.random()|0)<50&&(this.flameBuffer3[t+32512]=255);for(let t=0;t<100;t++){const t=2+(124*Math.random()|0)+(128+(128*Math.random()|0)<<7);this.flameBuffer3[t]=192}for(let t=1;t<255;t++)for(let e=1;e<127;e++){const i=e+(t<<7);this.flameBuffer2[i]=(this.flameBuffer3[i-1]+this.flameBuffer3[i+1]+this.flameBuffer3[i-128]+this.flameBuffer3[i+128])/4|0}this.flameCycle0+=128,this.flameCycle0>this.flameBuffer0.length&&(this.flameCycle0-=this.flameBuffer0.length,this.updateFlameBuffer(this.imageRunes[12*Math.random()|0]));for(let t=1;t<255;t++)for(let e=1;e<127;e++){const i=e+(t<<7);let s=this.flameBuffer2[i+128]-(this.flameBuffer0[i+this.flameCycle0&this.flameBuffer0.length-1]/5|0);s<0&&(s=0),this.flameBuffer3[i]=s}for(let t=0;t<255;t++)this.flameLineOffset[t]=this.flameLineOffset[t+1];if(this.flameLineOffset[255]=16*Math.sin(this.loopCycle/14)+14*Math.sin(this.loopCycle/15)+12*Math.sin(this.loopCycle/16)|0,this.flameGradientCycle0>0&&(this.flameGradientCycle0-=4),this.flameGradientCycle1>0&&(this.flameGradientCycle1-=4),0===this.flameGradientCycle0&&0===this.flameGradientCycle1){const t=2e3*Math.random()|0;0===t?this.flameGradientCycle0=1024:1===t&&(this.flameGradientCycle1=1024)}}};mix=(t,e,i)=>{const s=256-e;return((16711935&t)*s+(16711935&i)*e&4278255360)+((65280&t)*s+(65280&i)*e&16711680)>>8};drawFlames=()=>{if(!(this.flameGradient&&this.flameGradient0&&this.flameGradient1&&this.flameGradient2&&this.flameLineOffset&&this.flameBuffer3))return;const t=256;if(this.flameGradientCycle0>0)for(let t=0;t<256;t++)this.flameGradientCycle0>768?this.flameGradient[t]=this.mix(this.flameGradient0[t],1024-this.flameGradientCycle0,this.flameGradient1[t]):this.flameGradientCycle0>256?this.flameGradient[t]=this.flameGradient1[t]:this.flameGradient[t]=this.mix(this.flameGradient1[t],256-this.flameGradientCycle0,this.flameGradient0[t]);else if(this.flameGradientCycle1>0)for(let t=0;t<256;t++)this.flameGradientCycle1>768?this.flameGradient[t]=this.mix(this.flameGradient0[t],1024-this.flameGradientCycle1,this.flameGradient2[t]):this.flameGradientCycle1>256?this.flameGradient[t]=this.flameGradient2[t]:this.flameGradient[t]=this.mix(this.flameGradient2[t],256-this.flameGradientCycle1,this.flameGradient0[t]);else for(let t=0;t<256;t++)this.flameGradient[t]=this.flameGradient0[t];for(let t=0;t<33920;t++)this.imageTitle0&&this.imageFlamesLeft&&(this.imageTitle0.pixels[t]=this.imageFlamesLeft.pixels[t]);let e=0,i=1152;for(let s=1;s<255;s++){let a=22+(this.flameLineOffset[s]*(t-s)/t|0);a<0&&(a=0),e+=a;for(let t=a;t<128;t++){let t=this.flameBuffer3[e++];if(0===t)i++;else{const e=t,s=256-t;if(t=this.flameGradient[t],this.imageTitle0){const a=this.imageTitle0.pixels[i];this.imageTitle0.pixels[i++]=((16711935&t)*e+(16711935&a)*s&4278255360)+((65280&t)*e+(65280&a)*s&16711680)>>8}}}i+=a}this.imageTitle0?.draw(0,0);for(let t=0;t<33920;t++)this.imageTitle1&&this.imageFlamesRight&&(this.imageTitle1.pixels[t]=this.imageFlamesRight.pixels[t]);e=0,i=1176;for(let s=1;s<255;s++){const a=this.flameLineOffset[s]*(t-s)/t|0,h=103-a;i+=a;for(let t=0;t<h;t++){let t=this.flameBuffer3[e++];if(0===t)i++;else{const e=t,s=256-t;if(t=this.flameGradient[t],this.imageTitle1){const a=this.imageTitle1.pixels[i];this.imageTitle1.pixels[i++]=((16711935&t)*e+(16711935&a)*s&4278255360)+((65280&t)*e+(65280&a)*s&16711680)>>8}}}e+=128-h,i+=128-h-a}this.imageTitle1?.draw(661,0)}}console.log(`RS2 user client - release #${$.K.clientversion}`),await(0,et.w)(),(new t).run().then((()=>{})),e()}catch(t){e(t)}}),1)},8412:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(9418),a=i(8665),h=i(8738),n=i(1312);class r extends s.A{type=null;draw(t){if(!this.type)return null;if(-1===this.spotanimId||-1===this.spotanimFrame)return this.getSequencedModel();const e=this.getSequencedModel();if(!e)return null;const i=h.A.instances[this.spotanimId],s=a.A.modelShareColored(i.getModel(),!0,!i.disposeAlpha,!1);s.translate(-this.spotanimOffset,0,0),s.createLabelReferences(),i.seq&&i.seq.frames&&s.applyTransform(i.seq.frames[this.spotanimFrame]),s.labelFaces=null,s.labelVertices=null,128===i.resizeh&&128===i.resizev||s.scale(i.resizeh,i.resizev,i.resizeh),s.calculateNormals(64+i.ambient,850+i.contrast,-30,-50,-30,!0);const n=[e,s],r=a.A.modelFromModelsBounds(n,2);return 1===this.type.size&&(r.pickable=!0),r}isVisible(){return null!==this.type}getSequencedModel(){if(!this.type)return null;if(this.primarySeqId>=0&&0===this.primarySeqDelay){const t=n.A.instances[this.primarySeqId].frames;if(t){const e=t[this.primarySeqFrame];let i=-1;if(this.secondarySeqId>=0&&this.secondarySeqId!==this.seqStandId){const t=n.A.instances[this.secondarySeqId].frames;t&&(i=t[this.secondarySeqFrame])}return this.type.getSequencedModel(e,i,n.A.instances[this.primarySeqId].walkmerge)}}let t=-1;if(this.secondarySeqId>=0){const e=n.A.instances[this.secondarySeqId].frames;e&&(t=e[this.secondarySeqFrame])}const e=this.type.getSequencedModel(t,-1,null);return e?(this.height=e.maxY,e):null}}},3606:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(1982);class a extends s.A{index;count;constructor(t,e){super(),this.index=t,this.count=e}}},254:(t,e,i)=>{i.d(e,{A:()=>n});var s=i(8738),a=i(7121),h=i(8665);class n extends a.A{spotanim;level;srcX;srcZ;srcY;offsetY;startCycle;lastCycle;peakPitch;arc;target;mobile=!1;x=0;z=0;y=0;velocityX=0;velocityZ=0;velocity=0;velocityY=0;accelerationY=0;yaw=0;pitch=0;seqFrame=0;seqCycle=0;constructor(t,e,i,a,h,n,r,o,l,c,d){super(),this.spotanim=s.A.instances[t],this.level=e,this.srcX=i,this.srcZ=h,this.srcY=a,this.startCycle=n,this.lastCycle=r,this.peakPitch=o,this.arc=l,this.target=c,this.offsetY=d}updateVelocity(t,e,i,s){if(!this.mobile){const e=t-this.srcX,s=i-this.srcZ,a=Math.sqrt(e*e+s*s);this.x=this.srcX+e*this.arc/a,this.z=this.srcZ+s*this.arc/a,this.y=this.srcY}const a=this.lastCycle+1-s;this.velocityX=(t-this.x)/a,this.velocityZ=(i-this.z)/a,this.velocity=Math.sqrt(this.velocityX*this.velocityX+this.velocityZ*this.velocityZ),this.mobile||(this.velocityY=-this.velocity*Math.tan(.02454369*this.peakPitch)),this.accelerationY=2*(e-this.y-this.velocityY*a)/(a*a)}update(t){if(this.mobile=!0,this.x+=this.velocityX*t,this.z+=this.velocityZ*t,this.y+=this.velocityY*t+.5*this.accelerationY*t*t,this.velocityY+=this.accelerationY*t,this.yaw=325.949*Math.atan2(this.velocityX,this.velocityZ)+1024&2047,this.pitch=325.949*Math.atan2(this.velocityY,this.velocity)&2047,this.spotanim.seq&&this.spotanim.seq.delay)for(this.seqCycle+=t;this.seqCycle>this.spotanim.seq.delay[this.seqFrame];)this.seqCycle-=this.spotanim.seq.delay[this.seqFrame]+1,this.seqFrame++,this.seqFrame>=this.spotanim.seq.frameCount&&(this.seqFrame=0)}draw(){const t=this.spotanim.getModel(),e=h.A.modelShareColored(t,!0,!this.spotanim.disposeAlpha,!1);return this.spotanim.seq&&this.spotanim.seq.frames&&(e.createLabelReferences(),e.applyTransform(this.spotanim.seq.frames[this.seqFrame]),e.labelFaces=null,e.labelVertices=null),128===this.spotanim.resizeh&&128===this.spotanim.resizev||e.scale(this.spotanim.resizeh,this.spotanim.resizev,this.spotanim.resizeh),e.rotateX(this.pitch),e.calculateNormals(64+this.spotanim.ambient,850+this.spotanim.contrast,-30,-50,-30,!0),e}}},7628:(t,e,i)=>{i.d(e,{A:()=>n});var s=i(7121),a=i(8738),h=i(8665);class n extends s.A{type;level;x;z;y;startCycle;seqComplete=!1;seqFrame=0;seqCycle=0;constructor(t,e,i,s,h,n,r){super(),this.type=a.A.instances[t],this.level=e,this.x=i,this.z=s,this.y=h,this.startCycle=n+r}update(t){if(this.type.seq&&this.type.seq.delay)for(this.seqCycle+=t;this.seqCycle>this.type.seq.delay[this.seqFrame];)this.seqCycle-=this.type.seq.delay[this.seqFrame]+1,this.seqFrame++,this.seqFrame>=this.type.seq.frameCount&&(this.seqFrame=0,this.seqComplete=!0)}draw(){const t=this.type.getModel(),e=h.A.modelShareColored(t,!0,!this.type.disposeAlpha,!1);return!this.seqComplete&&this.type.seq&&this.type.seq.frames&&(e.createLabelReferences(),e.applyTransform(this.type.seq.frames[this.seqFrame]),e.labelFaces=null,e.labelVertices=null),128===this.type.resizeh&&128===this.type.resizev||e.scale(this.type.resizeh,this.type.resizev,this.type.resizeh),0!==this.type.orientation&&(90===this.type.orientation?e.rotateY90():180===this.type.orientation?(e.rotateY90(),e.rotateY90()):270===this.type.orientation&&(e.rotateY90(),e.rotateY90(),e.rotateY90())),e.calculateNormals(64+this.type.ambient,850+this.type.contrast,-30,-50,-30,!0),e}}},5327:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(1982);class a extends s.A{plane;layer;x;z;locIndex;angle;shape;lastCycle;constructor(t,e,i,s,a,h,n,r){super(),this.plane=t,this.layer=e,this.x=i,this.z=s,this.locIndex=a,this.angle=h,this.shape=n,this.lastCycle=r}}},2630:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(1982);class a extends s.A{plane;layer;x;z;locIndex;angle;shape;lastLocIndex;lastAngle;lastShape;constructor(t,e,i,s,a,h,n,r,o,l){super(),this.plane=t,this.layer=e,this.x=i,this.z=s,this.locIndex=a,this.angle=h,this.shape=n,this.lastLocIndex=r,this.lastAngle=o,this.lastShape=l}}},3955:(t,e,i)=>{i.d(e,{A:()=>s});class s{static REBUILD_GETMAPS=150;static IDLE_TIMER=70;static NO_TIMEOUT=108;static EVENT_TRACKING=81;static EVENT_CAMERA_POSITION=189;static ANTICHEAT_OPLOGIC1=7;static ANTICHEAT_OPLOGIC2=88;static ANTICHEAT_OPLOGIC3=30;static ANTICHEAT_OPLOGIC4=176;static ANTICHEAT_OPLOGIC5=220;static ANTICHEAT_OPLOGIC6=66;static ANTICHEAT_OPLOGIC7=17;static ANTICHEAT_OPLOGIC8=2;static ANTICHEAT_OPLOGIC9=238;static ANTICHEAT_CYCLELOGIC1=233;static ANTICHEAT_CYCLELOGIC2=146;static ANTICHEAT_CYCLELOGIC3=215;static ANTICHEAT_CYCLELOGIC4=236;static ANTICHEAT_CYCLELOGIC5=85;static ANTICHEAT_CYCLELOGIC6=219;static OPOBJ1=140;static OPOBJ2=40;static OPOBJ3=200;static OPOBJ4=178;static OPOBJ5=247;static OPOBJT=138;static OPOBJU=239;static OPNPC1=194;static OPNPC2=8;static OPNPC3=27;static OPNPC4=113;static OPNPC5=100;static OPNPCT=134;static OPNPCU=202;static OPLOC1=245;static OPLOC2=172;static OPLOC3=96;static OPLOC4=97;static OPLOC5=116;static OPLOCT=9;static OPLOCU=75;static OPPLAYER1=164;static OPPLAYER2=53;static OPPLAYER3=185;static OPPLAYER4=206;static OPPLAYERT=177;static OPPLAYERU=248;static OPHELD1=195;static OPHELD2=71;static OPHELD3=133;static OPHELD4=157;static OPHELD5=211;static OPHELDT=48;static OPHELDU=130;static INV_BUTTON1=31;static INV_BUTTON2=59;static INV_BUTTON3=212;static INV_BUTTON4=38;static INV_BUTTON5=6;static IF_BUTTON=155;static RESUME_PAUSEBUTTON=235;static CLOSE_MODAL=231;static RESUME_P_COUNTDIALOG=237;static TUTORIAL_CLICKSIDE=175;static MOVE_OPCLICK=93;static BUG_REPORT=190;static MOVE_MINIMAPCLICK=165;static INV_BUTTOND=159;static IGNORELIST_DEL=171;static IGNORELIST_ADD=79;static IF_PLAYERDESIGN=52;static CHAT_SETMODE=244;static MESSAGE_PRIVATE=148;static FRIENDLIST_DEL=11;static FRIENDLIST_ADD=118;static CLIENT_CHEAT=4;static MESSAGE_PUBLIC=158;static MOVE_GAMECLICK=181}},3554:(t,e,i)=>{i.d(e,{A:()=>h});var s=i(6666),a=i(1982);class h{socket;wsin;wsout;closed=!1;ioerror=!1;static openSocket=async t=>await new Promise(((e,i)=>{const s=t.host.startsWith("https"),a=s?"wss":"ws",h=t.host.substring(t.host.indexOf("//")+2),n=s?t.port+2:t.port+1,r=new WebSocket(`${a}://${h}:${n}`,"binary");r.addEventListener("open",(()=>{console.log("connection open!"),e(r)})),r.addEventListener("error",(()=>{console.log("connection error!"),i(r)}))}));constructor(t){t.onclose=this.onclose,t.onerror=this.onerror,this.wsin=new o(t,5e3),this.wsout=new n(t,5e3),this.socket=t}get host(){return this.socket.url.split("/")[2]}get port(){return parseInt(this.socket.url.split(":")[2],10)}get available(){return this.closed?0:this.wsin.available}write(t,e){this.wsout.write(t,e)}async read(){return this.closed?0:this.wsin.fastByte()??await this.wsin.slowByte()}async readBytes(t,e,i){if(!this.closed)for(;i>0;){const s=this.wsin.fastBytes(t,e,i)??await this.wsin.slowBytes(t,e,i);if(s.length<=0)throw new Error("EOF");e+=s.length,i-=s.length}}close(){this.closed=!0,this.socket.close(),this.wsin.close(),this.wsout.close(),console.log("connection close!"),this.ioerror&&console.log("connection error!")}onclose=t=>{this.closed||this.close()};onerror=t=>{this.closed||(this.ioerror=!0,this.close())}}class n{socket;limit;closed=!1;ioerror=!1;constructor(t,e){this.socket=t,this.limit=e}write(t,e){if(!this.closed){if(this.ioerror)throw this.ioerror=!1,new Error("Error in writer thread");if(e>this.limit||t.length>this.limit)throw new Error("buffer overflow");try{this.socket.send(t.subarray(0,e))}catch(t){this.ioerror=!0}}}close(){this.closed=!0}}class r extends a.A{bytes;position;constructor(t){super(),this.bytes=t,this.position=0}get available(){return this.bytes.length-this.position}get read(){return this.bytes[this.position++]}get len(){return this.bytes.length}}class o{limit;queue=new s.A;event=null;callback=null;total=0;closed=!1;constructor(t,e){this.limit=e,t.binaryType="arraybuffer",t.onmessage=this.onmessage}get available(){return this.total}onmessage=t=>{if(this.closed)throw new Error("WebSocketReader is closed!");const e=new r(new Uint8Array(t.data));if(this.event?this.queue.addTail(e):this.event=e,this.total+=e.len,this.callback&&(this.callback(this.event),this.callback=null,this.total>this.limit))throw new Error("buffer overflow")};readFastByte(){return this.event&&this.event.available>0?this.event.read:null}async readSlowByte(t){for(this.event=this.queue.removeHead();this.total<t;)await new Promise((t=>this.callback=t));return this.event?this.event.read:this.readSlowByte(t)}fastBytes(t,e,i){if(this.closed)throw new Error("WebSocketReader is closed!");if(!(this.event&&this.event.available>=i))return null;for(;i>0;){const s=this.readFastByte();if(null===s)throw new Error("EOF - tried to read a fast byte when there was not enough immediate bytes.");t[e++]=s,this.total--,i--}return t}async slowBytes(t,e,i){if(this.closed)throw new Error("WebSocketReader is closed!");for(;i>0;)t[e++]=this.readFastByte()??await this.readSlowByte(i),this.total--,i--;return t}fastByte(){if(this.closed)throw new Error("WebSocketReader is closed!");const t=this.readFastByte();return null===t?null:(this.total--,t)}async slowByte(){if(this.closed)throw new Error("WebSocketReader is closed!");const t=await this.readSlowByte(1);return this.total--,t}close(){this.closed=!0,this.callback=null,this.total=0,this.event=null,this.queue.clear()}}},2634:(t,e,i)=>{i.d(e,{A:()=>s});class s{count=0;rsl=new Int32Array(256);mem=new Int32Array(256);a=0;b=0;c=0;constructor(t){for(let e=0;e<t.length;e++)this.rsl[e]=t[e];this.init()}get nextInt(){return 0==this.count--&&(this.isaac(),this.count=255),this.rsl[this.count]}init(){let t=2654435769,e=2654435769,i=2654435769,s=2654435769,a=2654435769,h=2654435769,n=2654435769,r=2654435769;for(let o=0;o<4;o++)t^=e<<11,s+=t,e+=i,e^=i>>>2,a+=e,i+=s,i^=s<<8,h+=i,s+=a,s^=a>>>16,n+=s,a+=h,a^=h<<10,r+=a,h+=n,h^=n>>>4,t+=h,n+=r,n^=r<<8,e+=n,r+=t,r^=t>>>9,i+=r,t+=e;for(let o=0;o<256;o+=8)t+=this.rsl[o],e+=this.rsl[o+1],i+=this.rsl[o+2],s+=this.rsl[o+3],a+=this.rsl[o+4],h+=this.rsl[o+5],n+=this.rsl[o+6],r+=this.rsl[o+7],t^=e<<11,s+=t,e+=i,e^=i>>>2,a+=e,i+=s,i^=s<<8,h+=i,s+=a,s^=a>>>16,n+=s,a+=h,a^=h<<10,r+=a,h+=n,h^=n>>>4,t+=h,n+=r,n^=r<<8,e+=n,r+=t,r^=t>>>9,i+=r,t+=e,this.mem[o]=t,this.mem[o+1]=e,this.mem[o+2]=i,this.mem[o+3]=s,this.mem[o+4]=a,this.mem[o+5]=h,this.mem[o+6]=n,this.mem[o+7]=r;for(let o=0;o<256;o+=8)t+=this.mem[o],e+=this.mem[o+1],i+=this.mem[o+2],s+=this.mem[o+3],a+=this.mem[o+4],h+=this.mem[o+5],n+=this.mem[o+6],r+=this.mem[o+7],t^=e<<11,s+=t,e+=i,e^=i>>>2,a+=e,i+=s,i^=s<<8,h+=i,s+=a,s^=a>>>16,n+=s,a+=h,a^=h<<10,r+=a,h+=n,h^=n>>>4,t+=h,n+=r,n^=r<<8,e+=n,r+=t,r^=t>>>9,i+=r,t+=e,this.mem[o]=t,this.mem[o+1]=e,this.mem[o+2]=i,this.mem[o+3]=s,this.mem[o+4]=a,this.mem[o+5]=h,this.mem[o+6]=n,this.mem[o+7]=r;this.isaac(),this.count=256}isaac(){this.c++,this.b+=this.c;for(let t=0;t<256;t++){const e=this.mem[t],i=3&t;let s;0===i?this.a^=this.a<<13:1===i?this.a^=this.a>>>6:2===i?this.a^=this.a<<2:3===i&&(this.a^=this.a>>>16),this.a+=this.mem[t+128&255],this.mem[t]=s=this.mem[e>>>2&255]+this.a+this.b,this.rsl[t]=this.b=this.mem[s>>>8>>>2&255]+e}}}},353:(t,e,i)=>{i.d(e,{A:()=>s});class s{static CLIENTPROT_SCRAMBLED=[95,218,67,50,253,222,194,60,101,128,8,251,92,111,24,33,223,66,232,59,227,113,153,105,126,98,167,102,177,238,62,190,147,23,150,151,156,144,193,155,81,0,198,22,137,210,179,16,168,170,32,181,248,141,58,87,208,106,180,191,221,241,40,176,196,154,65,145,230,78,30,161,188,41,14,129,18,199,47,247,225,34,51,10,159,75,12,56,61,31,39,91,46,242,134,5,122,123,209,228,104,195,21,3,11,44,107,172,6,186,110,215,205,103,27,185,124,77,252,117,86,115,127,207,52,79,43,97,219,116,169,7,118,162,108,36,20,233,88,135,80,19,42,237,57,152,71,9,250,17,4,119,234,130,26,200,189,163,254,245,197,171,220,235,140,244,184,94,211,231,99,246,121,212,112,204,63,148,83,178,1,255,131,13,183,142,236,45,55,35,243,136,37,85,100,160,38,224,146,174,82,48,109,132,125,90,143,138,240,173,165,164,192,175,29,74,28,114,213,73,64,206,76,139,96,2,229,15,93,25,239,202,49,70,214,201,72,203,68,89,69,157,216,217,249,120,226,84,149,187,54,53,158,166,182,133,0];static SERVERPROT_SIZES=[0,-2,4,6,-1,0,0,2,0,0,0,0,5,4,2,2,0,0,0,0,2,-2,2,14,0,6,3,0,4,0,0,0,3,0,0,0,0,0,0,0,0,-1,4,2,6,0,6,0,0,3,7,0,0,0,-1,0,0,0,0,4,0,0,0,0,0,0,0,0,1,15,0,0,0,0,6,0,2,0,0,0,2,0,0,0,1,0,0,4,0,0,0,0,0,0,0,0,0,0,-2,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,-2,0,0,2,0,0,0,2,9,0,0,0,0,0,4,0,0,0,3,7,9,0,0,0,0,0,0,0,0,0,-2,0,0,0,0,3,2,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,-2,2,0,0,0,0,0,6,0,0,0,2,0,2,0,0,0,-2,0,0,4,0,0,0,0,6,0,0,-2,-2,0,0,0,0,0,0,-2,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0]}},2215:(t,e,i)=>{i.d(e,{A:()=>s});class s{static IF_OPENCHATMODAL=14;static IF_OPENMAINSIDEMODAL=28;static IF_CLOSE=129;static IF_OPENSIDEOVERLAY=167;static IF_OPENMAINMODAL=168;static IF_OPENSIDEMODAL=195;static IF_SETCOLOUR=2;static IF_SETHIDE=26;static IF_SETOBJECT=46;static IF_SHOWSIDE=84;static IF_SETMODEL=87;static IF_SETRECOL=103;static IF_SETANIM=146;static IF_SETPLAYERHEAD=197;static IF_SETTEXT=201;static IF_SETNPCHEAD=204;static IF_SETPOSITION=209;static TUTORIAL_FLASHSIDE=126;static TUTORIAL_OPENCHAT=185;static UPDATE_INV_STOP_TRANSMIT=15;static UPDATE_INV_FULL=98;static UPDATE_INV_PARTIAL=213;static CAM_LOOKAT=3;static CAM_SHAKE=13;static CAM_MOVETO=74;static CAM_RESET=239;static NPC_INFO=1;static PLAYER_INFO=184;static FINISH_TRACKING=133;static ENABLE_TRACKING=226;static MESSAGE_GAME=4;static UPDATE_IGNORELIST=21;static CHAT_FILTER_SETTINGS=32;static MESSAGE_PRIVATE=41;static UPDATE_FRIENDLIST=152;static UNSET_MAP_FLAG=19;static UPDATE_RUNWEIGHT=22;static HINT_ARROW=25;static UPDATE_REBOOT_TIMER=43;static UPDATE_STAT=44;static UPDATE_RUNENERGY=68;static RESET_ANIMS=136;static UPDATE_UID192=139;static LAST_LOGIN_INFO=140;static LOGOUT=142;static P_COUNTDIALOG=243;static SET_MULTIWAY=254;static DATA_LOC_DONE=20;static DATA_LAND_DONE=80;static DATA_LAND=132;static DATA_LOC=220;static REBUILD_NORMAL=237;static VARP_SMALL=150;static VARP_LARGE=175;static RESET_CLIENT_VARCACHE=193;static SYNTH_SOUND=12;static MIDI_SONG=54;static MIDI_JINGLE=212;static UPDATE_ZONE_PARTIAL_FOLLOWS=7;static UPDATE_ZONE_FULL_FOLLOWS=135;static UPDATE_ZONE_PARTIAL_ENCLOSED=162;static LOC_MERGE=23;static LOC_ANIM=42;static OBJ_DEL=49;static OBJ_REVEAL=50;static LOC_ADD_CHANGE=59;static MAP_PROJANIM=69;static LOC_DEL=76;static OBJ_COUNT=151;static MAP_ANIM=191;static OBJ_ADD=223}},3937:(t,e,i)=>{i.d(e,{A:()=>r});class s{start=0;end=0;form=0;length=0;shapeDelta=null;shapePeak=null;threshold=0;position=0;delta=0;amplitude=0;ticks=0;read(t){this.form=t.g1,this.start=t.g4,this.end=t.g4,this.length=t.g1,this.shapeDelta=new Int32Array(this.length),this.shapePeak=new Int32Array(this.length);for(let e=0;e<this.length;e++)this.shapeDelta[e]=t.g2,this.shapePeak[e]=t.g2}reset(){this.threshold=0,this.position=0,this.delta=0,this.amplitude=0,this.ticks=0}evaluate(t){return this.ticks>=this.threshold&&this.shapePeak&&this.shapeDelta&&(this.amplitude=this.shapePeak[this.position++]<<15,this.position>=this.length&&(this.position=this.length-1),this.threshold=this.shapeDelta[this.position]/65536*t|0,this.threshold>this.ticks&&(this.delta=((this.shapePeak[this.position]<<15)-this.amplitude)/(this.threshold-this.ticks)|0)),this.amplitude+=this.delta,this.ticks++,this.amplitude-this.delta>>15}}class a{static buffer=null;static noise=null;static sin=null;static tmpPhases=new Int32Array(5);static tmpDelays=new Int32Array(5);static tmpVolumes=new Int32Array(5);static tmpSemitones=new Int32Array(5);static tmpStarts=new Int32Array(5);frequencyBase=null;amplitudeBase=null;frequencyModRate=null;frequencyModRange=null;amplitudeModRate=null;amplitudeModRange=null;release=null;attack=null;harmonicVolume=new Int32Array(5);harmonicSemitone=new Int32Array(5);harmonicDelay=new Int32Array(5);start=0;length=500;reverbVolume=100;reverbDelay=0;static init=()=>{this.noise=new Int32Array(32768);for(let t=0;t<32768;t++)Math.random()>.5?this.noise[t]=1:this.noise[t]=-1;this.sin=new Int32Array(32768);for(let t=0;t<32768;t++)this.sin[t]=16384*Math.sin(t/5215.1903)|0;this.buffer=new Int32Array(220500)};generate(t,e){for(let e=0;e<t;e++)a.buffer[e]=0;if(e<10)return a.buffer;const i=t/e|0;this.frequencyBase?.reset(),this.amplitudeBase?.reset();let s=0,h=0,n=0;this.frequencyModRate&&this.frequencyModRange&&(this.frequencyModRate.reset(),this.frequencyModRange.reset(),s=32.768*(this.frequencyModRate.end-this.frequencyModRate.start)/i|0,h=32.768*this.frequencyModRate.start/i|0);let r=0,o=0,l=0;this.amplitudeModRate&&this.amplitudeModRange&&(this.amplitudeModRate.reset(),this.amplitudeModRange.reset(),r=32.768*(this.amplitudeModRate.end-this.amplitudeModRate.start)/i|0,o=32.768*this.amplitudeModRate.start/i|0);for(let t=0;t<5;t++)this.frequencyBase&&0!==this.harmonicVolume[t]&&(a.tmpPhases[t]=0,a.tmpDelays[t]=this.harmonicDelay[t]*i,a.tmpVolumes[t]=(this.harmonicVolume[t]<<14)/100|0,a.tmpSemitones[t]=32.768*(this.frequencyBase.end-this.frequencyBase.start)*Math.pow(1.0057929410678534,this.harmonicSemitone[t])/i|0,a.tmpStarts[t]=32.768*this.frequencyBase.start/i|0);if(this.frequencyBase&&this.amplitudeBase)for(let e=0;e<t;e++){let i=this.frequencyBase.evaluate(t),c=this.amplitudeBase.evaluate(t);if(this.frequencyModRate&&this.frequencyModRange){const e=this.frequencyModRate.evaluate(t),a=this.frequencyModRange.evaluate(t);i+=this.generate2(a,n,this.frequencyModRate.form)>>1,n+=(e*s>>16)+h}if(this.amplitudeModRate&&this.amplitudeModRange){const e=this.amplitudeModRate.evaluate(t),i=this.amplitudeModRange.evaluate(t);c=c*(32768+(this.generate2(i,l,this.amplitudeModRate.form)>>1))>>15,l+=(e*r>>16)+o}for(let s=0;s<5;s++)if(0!==this.harmonicVolume[s]){const h=e+a.tmpDelays[s];h<t&&(a.buffer[h]+=this.generate2(c*a.tmpVolumes[s]>>15,a.tmpPhases[s],this.frequencyBase.form),a.tmpPhases[s]+=(i*a.tmpSemitones[s]>>16)+a.tmpStarts[s])}}if(this.release&&this.attack){this.release.reset(),this.attack.reset();let e=0,i=!0;for(let s=0;s<t;s++){const h=this.release.evaluate(t),n=this.attack.evaluate(t);let r;r=i?this.release.start+((this.release.end-this.release.start)*h>>8):this.release.start+((this.release.end-this.release.start)*n>>8),e+=256,e>=r&&(e=0,i=!i),i&&(a.buffer[s]=0)}}if(this.reverbDelay>0&&this.reverbVolume>0){const e=this.reverbDelay*i;for(let i=e;i<t;i++)a.buffer[i]+=a.buffer[i-e]*this.reverbVolume/100|0,a.buffer[i]|=0}for(let e=0;e<t;e++)a.buffer[e]<-32768&&(a.buffer[e]=-32768),a.buffer[e]>32767&&(a.buffer[e]=32767);return a.buffer}generate2(t,e,i){return 1===i?(32767&e)<16384?t:-t:2===i?a.sin[32767&e]*t>>14:3===i?((32767&e)*t>>14)-t:4===i?a.noise[e/2607&32767]*t:0}read(t){this.frequencyBase=new s,this.frequencyBase.read(t),this.amplitudeBase=new s,this.amplitudeBase.read(t),0!==t.g1&&(t.pos--,this.frequencyModRate=new s,this.frequencyModRate.read(t),this.frequencyModRange=new s,this.frequencyModRange.read(t)),0!==t.g1&&(t.pos--,this.amplitudeModRate=new s,this.amplitudeModRate.read(t),this.amplitudeModRange=new s,this.amplitudeModRange.read(t)),0!==t.g1&&(t.pos--,this.release=new s,this.release.read(t),this.attack=new s,this.attack.read(t));for(let e=0;e<10;e++){const i=t.gsmarts;if(0===i)break;this.harmonicVolume[e]=i,this.harmonicSemitone[e]=t.gsmart,this.harmonicDelay[e]=t.gsmarts}this.reverbDelay=t.gsmarts,this.reverbVolume=t.gsmarts,this.length=t.g2,this.start=t.g2}}var h=i(1069),n=i(3867);class r{static delays=new Int32Array(1e3);static waveBytes=null;static waveBuffer=null;static tracks=new n.FO(1e3,null);tones=new n.FO(10,null);loopBegin=0;loopEnd=0;static unpack=t=>{const e=new h.A(t.read("sounds.dat"));for(this.waveBytes=new Uint8Array(441e3),this.waveBuffer=new h.A(this.waveBytes),a.init();;){const t=e.g2;if(65535===t)break;const i=new r;i.read(e),this.tracks[t]=i,this.delays[t]=i.trim()}};static generate=(t,e)=>{if(!this.tracks[t])return null;const i=this.tracks[t];return i?.getWave(e)??null};read(t){for(let e=0;e<10;e++)0!==t.g1&&(t.pos--,this.tones[e]=new a,this.tones[e]?.read(t));this.loopBegin=t.g2,this.loopEnd=t.g2}trim(){let t=9999999;for(let e=0;e<10;e++)this.tones[e]&&(this.tones[e].start/20|0)<t&&(t=this.tones[e].start/20|0);if(this.loopBegin<this.loopEnd&&(this.loopBegin/20|0)<t&&(t=this.loopBegin/20|0),9999999===t||0===t)return 0;for(let e=0;e<10;e++)this.tones[e]&&(this.tones[e].start-=20*t);return this.loopBegin<this.loopEnd&&(this.loopBegin-=20*t,this.loopEnd-=20*t),t}getWave(t){const e=this.generate(t);return r.waveBuffer.pos=0,r.waveBuffer?.p4(1380533830),r.waveBuffer?.ip4(e+36),r.waveBuffer?.p4(1463899717),r.waveBuffer?.p4(1718449184),r.waveBuffer?.ip4(16),r.waveBuffer?.ip2(1),r.waveBuffer?.ip2(1),r.waveBuffer?.ip4(22050),r.waveBuffer?.ip4(22050),r.waveBuffer?.ip2(1),r.waveBuffer?.ip2(8),r.waveBuffer?.p4(1684108385),r.waveBuffer?.ip4(e),r.waveBuffer.pos+=e,r.waveBuffer}generate(t){let e=0;for(let t=0;t<10;t++)this.tones[t]&&this.tones[t].length+this.tones[t].start>e&&(e=this.tones[t].length+this.tones[t].start);if(0===e)return 0;let i=22050*e/1e3|0,s=22050*this.loopBegin/1e3|0,a=22050*this.loopEnd/1e3|0;(s<0||a<0||a>i||s>=a)&&(t=0);let h=i+(a-s)*(t-1);for(let t=44;t<h+44;t++)r.waveBytes&&(r.waveBytes[t]=-128);for(let t=0;t<10;t++)if(this.tones[t]){const e=22050*this.tones[t].length/1e3|0,i=22050*this.tones[t].start/1e3|0,s=this.tones[t].generate(e,this.tones[t].length);for(let t=0;t<e;t++)r.waveBytes&&(r.waveBytes[t+i+44]+=s[t]>>8<<24>>24)}if(t>1){s+=44,a+=44,i+=44,h+=44;const e=h-i;for(let t=i-1;t>=a;t--)r.waveBytes&&(r.waveBytes[t+e]=r.waveBytes[t]);for(let e=1;e<t;e++){const t=(a-s)*e;for(let e=s;e<a;e++)r.waveBytes&&(r.waveBytes[e+t]=r.waveBytes[e])}h-=44}return h}}},9234:(t,e,i)=>{i.d(e,{CZ:()=>o,Is:()=>a,U8:()=>r,fb:()=>s,mR:()=>h,n2:()=>n,yy:()=>l});const s=async t=>new Promise((e=>setTimeout(e,t))),a=async t=>new Int8Array(await(await fetch(t)).arrayBuffer()),h=async t=>(await fetch(t)).text();function n(t,e,i,s,a){for(;a--;)i[s++]=t[e++]}function r(t){let e=0n;for(let i=0;i<t.length;i++)e=(e<<8n)+BigInt(t[i]);return e}function o(t){const e=[];for(;t>0n;)e.unshift(Number(255n&t)),t>>=8n;return new Uint8Array(e)}function l(t,e,i){let s=1n;for(;e>0n;)e%2n===1n&&(s=s*t%i),t=t*t%i,e>>=1n;return s}},7953:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(1069);class a{static PERIOD=new Uint16Array(["d","o","t"].join("").split("").map((t=>t.charCodeAt(0))));static AMPERSAT=new Uint16Array(["(","a",")"].join("").split("").map((t=>t.charCodeAt(0))));static SLASH=new Uint16Array(["s","l","a","s","h"].join("").split("").map((t=>t.charCodeAt(0))));static whitelist=["cook","cook's","cooks","seeks","sheet"];static tlds=[];static tldTypes=[];static bads=[];static badCombinations=[];static domains=[];static fragments=[];static unpack=t=>{const e=new s.A(t.read("fragmentsenc.txt")),i=new s.A(t.read("badenc.txt")),a=new s.A(t.read("domainenc.txt")),h=new s.A(t.read("tldlist.txt"));this.read(i,a,e,h)};static filter=t=>{const e=[...t];this.format(e);const i=e.join("").trim(),s=i.toLowerCase(),a=[...s];this.filterTlds(a),this.filterBadWords(a),this.filterDomains(a),this.filterFragments(a);for(let t=0;t<this.whitelist.length;t++){let e=-1;for(;-1!==(e=s.indexOf(this.whitelist[t],e+1));){const i=[...this.whitelist[t]];for(let t=0;t<i.length;t++)a[t+e]=i[t]}}return this.replaceUppercases(a,[...i]),this.formatUppercases(a),a.join("").trim()};static read=(t,e,i,s)=>{this.readBadWords(t),this.readDomains(e),this.readFragments(i),this.readTld(s)};static readTld=t=>{const e=t.g4;for(let i=0;i<e;i++)this.tldTypes[i]=t.g1,this.tlds[i]=new Uint16Array(t.g1).map((()=>t.g1))};static readBadWords=t=>{const e=t.g4;for(let i=0;i<e;i++){this.bads[i]=new Uint16Array(t.g1).map((()=>t.g1));const e=new Array(t.g1).fill([]).map((()=>[t.g1b,t.g1b]));e.length>0&&(this.badCombinations[i]=e)}};static readDomains=t=>{const e=t.g4;for(let i=0;i<e;i++)this.domains[i]=new Uint16Array(t.g1).map((()=>t.g1))};static readFragments=t=>{const e=t.g4;for(let i=0;i<e;i++)this.fragments[i]=t.g2};static filterTlds=t=>{const e=[...t],i=[...t];this.filterBadCombinations(null,e,this.PERIOD),this.filterBadCombinations(null,i,this.SLASH);for(let s=0;s<this.tlds.length;s++)this.filterTld(i,this.tldTypes[s],t,this.tlds[s],e)};static filterBadWords=t=>{for(let e=0;e<2;e++)for(let e=this.bads.length-1;e>=0;e--)this.filterBadCombinations(this.badCombinations[e],t,this.bads[e])};static filterDomains=t=>{const e=[...t],i=[...t];this.filterBadCombinations(null,e,this.AMPERSAT),this.filterBadCombinations(null,i,this.PERIOD);for(let s=this.domains.length-1;s>=0;s--)this.filterDomain(i,e,this.domains[s],t)};static filterFragments=t=>{for(let e=0;e<t.length;){const i=this.indexOfNumber(t,e);if(-1===i)return;let s=!1;for(let a=e;a>=0&&a<i&&!s;a++)this.isSymbol(t[a])||this.isNotLowercaseAlpha(t[a])||(s=!0);let a=0;s&&(a=0),0===a&&(a=1,e=i);let h=0;for(let s=i;s<t.length&&s<e;s++)h=10*h+t[s].charCodeAt(0)-48;h<=255&&e-i<=8?a++:a=0,4===a&&(this.maskChars(i,e,t),a=0),e=this.indexOfNonNumber(e,t)}};static isBadFragment=t=>{if(this.isNumericalChars(t))return!0;const e=this.getInteger(t),i=this.fragments,s=i.length;if(e===i[0]||e===i[s-1])return!0;let a=0,h=s-1;for(;a<=h;){const t=(a+h)/2|0;if(e===i[t])return!0;e<i[t]?h=t-1:a=t+1}return!1};static getInteger=t=>{if(t.length>6)return 0;let e=0;for(let i=0;i<t.length;i++){const s=t[t.length-i-1];if(this.isLowercaseAlpha(s))e=38*e+s.charCodeAt(0)+1-"a".charCodeAt(0);else if("'"===s)e=38*e+27;else if(this.isNumerical(s))e=38*e+s.charCodeAt(0)+28-"0".charCodeAt(0);else if("\0"!==s)return 0}return e};static indexOfNumber=(t,e)=>{for(let i=e;i<t.length&&i>=0;i++)if(this.isNumerical(t[i]))return i;return-1};static indexOfNonNumber=(t,e)=>{for(let i=t;i<e.length&&i>=0;i++)if(!this.isNumerical(e[i]))return i;return e.length};static getEmulatedDomainCharLen=(t,e,i)=>e===i||"o"===e&&"0"===i?1:"o"===e&&"("===i&&")"===t?2:"c"!==e||"("!==i&&"<"!==i&&"["!==i?"e"===e&&"€"===i||"s"===e&&"$"===i||"l"===e&&"i"===i?1:0:1;static filterDomain=(t,e,i,s)=>{const a=i.length,h=s.length;for(let n=0;n<=h-a;n++){const{matched:a,currentIndex:h}=this.findMatchingDomain(n,i,s);if(!a)continue;const r=this.prefixSymbolStatus(n,s,3,e,["@"]),o=this.suffixSymbolStatus(h-1,s,3,t,[".",","]);(r>2||o>2)&&this.maskChars(n,h,s)}};static findMatchingDomain=(t,e,i)=>{const s=e.length;let a=t,h=0;for(;a<i.length&&h<s;){const n=i[a],r=a+1<i.length?i[a+1]:"\0",o=this.getEmulatedDomainCharLen(r,String.fromCharCode(e[h]),n);if(o>0)a+=o,h++;else{if(0===h)break;const i=this.getEmulatedDomainCharLen(r,String.fromCharCode(e[h-1]),n);if(i>0)a+=i,1===h&&t++;else{if(h>=s||!this.isSymbol(n))break;a++}}}return{matched:h>=s,currentIndex:a}};static filterBadCombinations=(t,e,i)=>{if(!(i.length>e.length))for(let s=0;s<=e.length-i.length;s++){let a=s;const{currentIndex:h,badIndex:n,hasSymbol:r,hasNumber:o,hasDigit:l}=this.processBadCharacters(e,i,a);a=h;let c=e[a],d=a+1<e.length?e[a+1]:"\0";if(!(n>=i.length)||o&&l)continue;let m,u=!0;if(r){let t=!1,i=!1;if((s-1<0||this.isSymbol(e[s-1])&&"'"!==e[s-1])&&(t=!0),(a>=e.length||this.isSymbol(e[a])&&"'"!==e[a])&&(i=!0),!t||!i){let i=!1;for(m=s-2,t&&(m=s);!i&&m<a;){if(m>=0&&(!this.isSymbol(e[m])||"'"===e[m])){const t=[];let s;for(s=0;s<3&&m+s<e.length&&(!this.isSymbol(e[m+s])||"'"===e[m+s]);s++)t[s]=e[m+s];let a=!0;0===s&&(a=!1),s<3&&m-1>=0&&(!this.isSymbol(e[m-1])||"'"===e[m-1])&&(a=!1),a&&!this.isBadFragment(t)&&(i=!0)}m++}i||(u=!1)}}else{c=" ",s-1>=0&&(c=e[s-1]),d=" ",a<e.length&&(d=e[a]);const i=this.getIndex(c),h=this.getIndex(d);t&&this.comboMatches(i,t,h)&&(u=!1)}if(!u)continue;let p=0,f=0;for(let t=s;t<a;t++)this.isNumerical(e[t])?p++:this.isAlpha(e[t])&&f++;p<=f&&this.maskChars(s,a,e)}};static processBadCharacters=(t,e,i)=>{let s=i,a=0,h=0,n=!1,r=!1,o=!1;for(;s<t.length&&(!r||!o)&&!(s>=t.length||r&&o);){const l=t[s],c=s+1<t.length?t[s+1]:"\0";let d;if(a<e.length&&(d=this.getEmulatedBadCharLen(c,String.fromCharCode(e[a]),l))>0)1===d&&this.isNumerical(l)&&(r=!0),2===d&&(this.isNumerical(l)||this.isNumerical(c))&&(r=!0),s+=d,a++;else{if(0===a)break;let t;if((t=this.getEmulatedBadCharLen(c,String.fromCharCode(e[a-1]),l))>0)s+=t;else{if(a>=e.length||!this.isNotLowercaseAlpha(l))break;if(this.isSymbol(l)&&"'"!==l&&(n=!0),this.isNumerical(l)&&(o=!0),s++,h++,(100*h/(s-i)|0)>90)break}}}return{currentIndex:s,badIndex:a,hasSymbol:n,hasNumber:r,hasDigit:o}};static getEmulatedBadCharLen=(t,e,i)=>{if(e===i)return 1;if(e>="a"&&e<="m"){if("a"===e)return"4"!==i&&"@"!==i&&"^"!==i?"/"===i&&"\\"===t?2:0:1;if("b"===e)return"6"!==i&&"8"!==i?"1"===i&&"3"===t?2:0:1;if("c"===e)return"("!==i&&"<"!==i&&"{"!==i&&"["!==i?0:1;if("d"===e)return"["===i&&")"===t?2:0;if("e"===e)return"3"!==i&&"€"!==i?0:1;if("f"===e)return"p"===i&&"h"===t?2:"£"===i?1:0;if("g"===e)return"9"!==i&&"6"!==i?0:1;if("h"===e)return"#"===i?1:0;if("i"===e)return"y"!==i&&"l"!==i&&"j"!==i&&"1"!==i&&"!"!==i&&":"!==i&&";"!==i&&"|"!==i?0:1;if("j"===e)return 0;if("k"===e)return 0;if("l"===e)return"1"!==i&&"|"!==i&&"i"!==i?0:1;if("m"===e)return 0}if(e>="n"&&e<="z"){if("n"===e)return 0;if("o"===e)return"0"!==i&&"*"!==i?"("===i&&")"===t||"["===i&&"]"===t||"{"===i&&"}"===t||"<"===i&&">"===t?2:0:1;if("p"===e)return 0;if("q"===e)return 0;if("r"===e)return 0;if("s"===e)return"5"!==i&&"z"!==i&&"$"!==i&&"2"!==i?0:1;if("t"===e)return"7"!==i&&"+"!==i?0:1;if("u"===e)return"v"===i?1:"\\"===i&&"/"===t||"\\"===i&&"|"===t||"|"===i&&"/"===t?2:0;if("v"===e)return"\\"===i&&"/"===t||"\\"===i&&"|"===t||"|"===i&&"/"===t?2:0;if("w"===e)return"v"===i&&"v"===t?2:0;if("x"===e)return")"===i&&"("===t||"}"===i&&"{"===t||"]"===i&&"["===t||">"===i&&"<"===t?2:0;if("y"===e)return 0;if("z"===e)return 0}return e>="0"&&e<="9"?"0"===e?"o"===i||"O"===i?1:"("===i&&")"===t||"{"===i&&"}"===t||"["===i&&"]"===t?2:0:"1"===e&&"l"===i?1:0:","===e?"."===i?1:0:"."===e?","===i?1:0:"!"===e&&"i"===i?1:0};static comboMatches=(t,e,i)=>{let s=0,a=e.length-1;for(;s<=a;){const h=(s+a)/2|0;if(e[h][0]===t&&e[h][1]===i)return!0;t<e[h][0]||t===e[h][0]&&i<e[h][1]?a=h-1:s=h+1}return!1};static getIndex=t=>this.isLowercaseAlpha(t)?t.charCodeAt(0)+1-"a".charCodeAt(0):"'"===t?28:this.isNumerical(t)?t.charCodeAt(0)+29-"0".charCodeAt(0):27;static filterTld=(t,e,i,s,a)=>{if(!(s.length>i.length))for(let h=0;h<=i.length-s.length;h++){const{currentIndex:n,tldIndex:r}=this.processTlds(i,s,h);if(r<s.length)continue;let o=!1;const l=this.prefixSymbolStatus(h,i,3,a,[",","."]),c=this.suffixSymbolStatus(n-1,i,5,t,["\\","/"]);if(1===e&&l>0&&c>0&&(o=!0),2===e&&(l>2&&c>0||l>0&&c>2)&&(o=!0),3===e&&l>0&&c>2&&(o=!0),!o)continue;let d,m=h,u=n-1,p=!1;if(l>2){if(4===l)for(p=!1,d=h-1;d>=0;d--)if(p){if("*"!==a[d])break;m=d}else"*"===a[d]&&(m=d,p=!0);for(p=!1,d=m-1;d>=0;d--)if(p){if(this.isSymbol(i[d]))break;m=d}else this.isSymbol(i[d])||(p=!0,m=d)}if(c>2){if(4===c)for(p=!1,d=u+1;d<i.length;d++)if(p){if("*"!==t[d])break;u=d}else"*"===t[d]&&(u=d,p=!0);for(p=!1,d=u+1;d<i.length;d++)if(p){if(this.isSymbol(i[d]))break;u=d}else this.isSymbol(i[d])||(p=!0,u=d)}this.maskChars(m,u+1,i)}};static processTlds=(t,e,i)=>{let s=0;for(;i<t.length&&s<e.length;){const a=t[i],h=i+1<t.length?t[i+1]:"\0";let n;if((n=this.getEmulatedDomainCharLen(h,String.fromCharCode(e[s]),a))>0)i+=n,s++;else{if(0===s)break;let t;if((t=this.getEmulatedDomainCharLen(h,String.fromCharCode(e[s-1]),a))>0)i+=t;else{if(!this.isSymbol(a))break;i++}}}return{currentIndex:i,tldIndex:s}};static isSymbol=t=>!this.isAlpha(t)&&!this.isNumerical(t);static isNotLowercaseAlpha=t=>!this.isLowercaseAlpha(t)||"v"===t||"x"===t||"j"===t||"q"===t||"z"===t;static isAlpha=t=>this.isLowercaseAlpha(t)||this.isUppercaseAlpha(t);static isNumerical=t=>t>="0"&&t<="9";static isLowercaseAlpha=t=>t>="a"&&t<="z";static isUppercaseAlpha=t=>t>="A"&&t<="Z";static isNumericalChars=t=>{for(let e=0;e<t.length;e++)if(!this.isNumerical(t[e])&&"\0"!==t[e])return!1;return!0};static maskChars=(t,e,i)=>{for(let s=t;s<e;s++)i[s]="*"};static maskedCountBackwards=(t,e)=>{let i=0;for(let s=e-1;s>=0&&this.isSymbol(t[s]);s--)"*"===t[s]&&i++;return i};static maskedCountForwards=(t,e)=>{let i=0;for(let s=e+1;s<t.length&&this.isSymbol(t[s]);s++)"*"===t[s]&&i++;return i};static maskedCharsStatus=(t,e,i,s,a)=>(a?this.maskedCountBackwards(e,i):this.maskedCountForwards(e,i))>=s?4:this.isSymbol(a?t[i-1]:t[i+1])?1:0;static prefixSymbolStatus=(t,e,i,s,a)=>{if(0===t)return 2;for(let i=t-1;i>=0&&this.isSymbol(e[i]);i--)if(a.includes(e[i]))return 3;return this.maskedCharsStatus(e,s,t,i,!0)};static suffixSymbolStatus=(t,e,i,s,a)=>{if(t+1===e.length)return 2;for(let i=t+1;i<e.length&&this.isSymbol(e[i]);i++)if(a.includes(e[i]))return 3;return this.maskedCharsStatus(e,s,t,i,!1)};static format=t=>{let e=0;for(let i=0;i<t.length;i++)this.isCharacterAllowed(t[i])?t[e]=t[i]:t[e]=" ",0!==e&&" "===t[e]&&" "===t[e-1]||e++;for(let i=e;i<t.length;i++)t[i]=" "};static isCharacterAllowed=t=>t>=" "&&t<=""||" "===t||"\n"===t||"\t"===t||"£"===t||"€"===t;static replaceUppercases=(t,e)=>{for(let i=0;i<e.length;i++)"*"!==t[i]&&this.isUppercaseAlpha(e[i])&&(t[i]=e[i])};static formatUppercases=t=>{let e=!0;for(let i=0;i<t.length;i++){const s=t[i];this.isAlpha(s)?e?this.isLowercaseAlpha(s)&&(e=!1):this.isUppercaseAlpha(s)&&(t[i]=String.fromCharCode(s.charCodeAt(0)+"a".charCodeAt(0)-65)):e=!0}}}},2646:(t,e,i)=>{i.d(e,{A:()=>s});class s{static TABLE=[" ","e","t","a","o","i","h","n","s","r","d","l","u","m","w","c","y","f","g","p","b","v","k","x","j","q","z","0","1","2","3","4","5","6","7","8","9"," ","!","?",".",",",":",";","(",")","-","&","*","\\","'","@","#","+","=","£","$","%",'"',"[","]"];static charBuffer=[];static unpack=(t,e)=>{let i,s=0,a=-1;for(let h=0;h<e&&s<100;h++){const e=t.g1;i=e>>4&15,-1!==a?(this.charBuffer[s++]=this.TABLE[(a<<4)+i-195],a=-1):i<13?this.charBuffer[s++]=this.TABLE[i]:a=i,i=15&e,-1!==a?(this.charBuffer[s++]=this.TABLE[(a<<4)+i-195],a=-1):i<13?this.charBuffer[s++]=this.TABLE[i]:a=i}let h=!0;for(let t=0;t<s;t++){const e=this.charBuffer[t];h&&e>="a"&&e<="z"&&(this.charBuffer[t]=e.toUpperCase(),h=!1),"."!==e&&"!"!==e||(h=!0)}return this.charBuffer.slice(0,s).join("")};static pack=(t,e)=>{e.length>80&&(e=e.substring(0,80)),e=e.toLowerCase();let i=-1;for(let s=0;s<e.length;s++){const a=e.charAt(s);let h=0;for(let t=0;t<this.TABLE.length;t++)if(a===this.TABLE[t]){h=t;break}h>12&&(h+=195),-1===i?h<13?i=h:t.p1(h):h<13?(t.p1((i<<4)+h),i=-1):(t.p1((i<<4)+(h>>4)),i=15&h)}-1!==i&&t.p1(i<<4)}}},123:(t,e,i)=>{let s;async function a(t,e){h(e);try{const e=await window.audioContext.decodeAudioData(Uint8Array.from(t).buffer);let i=window.audioContext.createBufferSource();i.buffer=e,i.connect(s),i.start()}catch(t){console.log(t)}}function h(t){s||(s=window.audioContext.createGain(),s.connect(window.audioContext.destination)),s.gain.value=t/256}function n(t,e){window._tinyMidiPlay&&window._tinyMidiPlay(t,e/256)}function r(t){window._tinyMidiVolume&&window._tinyMidiVolume(t/256)}function o(){window._tinyMidiStop&&window._tinyMidiStop()}i.d(e,{MG:()=>a,cs:()=>n,iw:()=>h,qI:()=>o,u4:()=>r})}},n={};function r(t){var e=n[t];if(void 0!==e)return e.exports;var i=n[t]={exports:{}};return h[t](i,i.exports,r),i.exports}r.m=h,t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},r.a=(a,h,n)=>{var r;n&&((r=[]).d=-1);var o,l,c,d=new Set,m=a.exports,u=new Promise(((t,e)=>{c=e,l=t}));u[e]=m,u[t]=t=>(r&&t(r),d.forEach(t),u.catch((t=>{}))),a.exports=u,h((a=>{var h;o=(a=>a.map((a=>{if(null!==a&&"object"==typeof a){if(a[t])return a;if(a.then){var h=[];h.d=0,a.then((t=>{n[e]=t,s(h)}),(t=>{n[i]=t,s(h)}));var n={};return n[t]=t=>t(h),n}}var r={};return r[t]=t=>{},r[e]=a,r})))(a);var n=()=>o.map((t=>{if(t[i])throw t[i];return t[e]})),l=new Promise((e=>{(h=()=>e(n)).r=0;var i=t=>t!==r&&!d.has(t)&&(d.add(t),t&&!t.d&&(h.r++,t.push(h)));o.map((e=>e[t](i)))}));return h.r?l:n()}),(t=>(t?c(u[i]=t):l(m),s(r)))),r&&r.d<0&&(r.d=0)},a=[],r.O=(t,e,i,s)=>{if(!e){var h=1/0;for(c=0;c<a.length;c++){for(var[e,i,s]=a[c],n=!0,o=0;o<e.length;o++)(!1&s||h>=s)&&Object.keys(r.O).every((t=>r.O[t](e[o])))?e.splice(o--,1):(n=!1,s<h&&(h=s));if(n){a.splice(c--,1);var l=i();void 0!==l&&(t=l)}}return t}s=s||0;for(var c=a.length;c>0&&a[c-1][2]>s;c--)a[c]=a[c-1];a[c]=[e,i,s]},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.p="/",(()=>{r.b=document.baseURI||self.location.href;var t={818:0};r.O.j=e=>0===t[e];var e=(e,i)=>{var s,a,[h,n,o]=i,l=0;if(h.some((e=>0!==t[e]))){for(s in n)r.o(n,s)&&(r.m[s]=n[s]);if(o)var c=o(r)}for(e&&e(i);l<h.length;l++)a=h[l],r.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return r.O(c)},i=self.webpackChunk_2004scape_client=self.webpackChunk_2004scape_client||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var o=r.O(void 0,[489],(()=>r(7906)));o=r.O(o)})();