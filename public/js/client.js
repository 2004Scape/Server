!function(t,i){'object'==typeof exports&&'object'==typeof module?module.exports=i():'function'==typeof define&&define.amd?define("Game",[],i):'object'==typeof exports?exports.Game=i():t.Game=i()}(self,(()=>(()=>{"use strict";var t={227:(t,i,s)=>{t.exports=s.p+"9f86b5397894e28b5ae2.wasm"}},i={};function s(h){var e=i[h];if(void 0!==e)return e.exports;var n=i[h]={exports:{}};return t[h](n,n.exports,s),n.exports}s.m=t,s.d=(t,i)=>{for(var h in i)s.o(i,h)&&!s.o(t,h)&&Object.defineProperty(t,h,{enumerable:!0,get:i[h]})},s.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),s.p="/",s.b=document.baseURI||self.location.href;var h={};return(()=>{s.d(h,{"default":()=>si});class t{id;tt=null;constructor(t){this.id=t}it(t){for(;;){const i=t.st;if(0===i)break;this.decode(i,t)}return this}}const i=async t=>new Promise((i=>setTimeout(i,t))),e=async t=>new Int8Array(await(await fetch(t)).arrayBuffer());function n(t,i,s,h,e){for(;e--;)s[h++]=t[i++]}class r{key;next;ht;constructor(){this.key=0n,this.next=this,this.ht=this}et(){this.ht&&this.next&&(this.ht.next=this.next,this.next.ht=this.ht,this.next=null,this.ht=null)}}class o{nt;cursor=null;constructor(){const t=new r;t.next=t,t.ht=t,this.nt=t}rt(t){t.ht&&t.et(),t.ht=this.nt.ht,t.next=this.nt,t.ht&&(t.ht.next=t),t.next.ht=t}ot(t){t.ht&&t.et(),t.ht=this.nt,t.next=this.nt.next,t.ht.next=t,t.next&&(t.next.ht=t)}lt(){const t=this.nt.next;return t===this.nt?null:(t?.et(),t)}head(){const t=this.nt.next;return t===this.nt?(this.cursor=null,null):(this.cursor=t?.next||null,t)}ct(){const t=this.nt.ht;return t===this.nt?(this.cursor=null,null):(this.cursor=t?.ht||null,t)}next(){const t=this.cursor;return t===this.nt?(this.cursor=null,null):(this.cursor=t?.next||null,t)}ht(){const t=this.cursor;return t===this.nt?(this.cursor=null,null):(this.cursor=t?.ht||null,t)}clear(){for(;;){const t=this.nt.next;if(t===this.nt)return;t?.et()}}}class l extends r{ft;ut;constructor(){super(),this.ft=this,this.ut=this}dt(){this.ut&&this.ft&&(this.ut.ft=this.ft,this.ft.ut=this.ut,this.ft=null,this.ut=null)}}class a extends l{static wt=3988292384;static yt=new Int32Array(256);static At=new Uint32Array(33);static It=new o;static Et=new o;static gt=new o;static _t=0;static Ct=0;static Tt=0;static{for(let t=0;t<32;t++)a.At[t]=(1<<t)-1;a.At[32]=4294967295;for(let t=0;t<256;t++){let i=t;for(let t=0;t<8;t++)1&~i?i>>>=1:i=i>>>1^a.wt;a.yt[t]=i}}static Ot=t=>{let i=4294967295;for(let s=0;s<t.length;s++)i=i>>>8^a.yt[255&(i^t[s])];return~i};view;data;bt=0;Lt=0;random=null;constructor(t){if(!t)throw new Error('Input src packet array was null!');super(),t instanceof Int8Array?this.data=new Uint8Array(t):this.data=t,this.view=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength)}get length(){return this.view.byteLength}get available(){return this.length-this.bt}static vt=t=>{let i=null;return 0===t&&a._t>0?(a._t--,i=a.It.lt()):1===t&&a.Ct>0?(a.Ct--,i=a.Et.lt()):2===t&&a.Tt>0&&(a.Tt--,i=a.gt.lt()),i?(i.bt=0,i):new a(0===t?new Uint8Array(100):1===t?new Uint8Array(5e3):new Uint8Array(3e4))};release(){this.bt=0,100===this.view.byteLength&&a._t<1e3?(a.It.rt(this),a._t++):5e3===this.view.byteLength&&a.Ct<250?(a.Et.rt(this),a.Ct++):3e4===this.view.byteLength&&a.Tt<50&&(a.gt.rt(this),a.Tt++)}get st(){return this.view.getUint8(this.bt++)}get St(){return this.view.getInt8(this.bt++)}get Rt(){const t=this.view.getUint16(this.bt);return this.bt+=2,t}get Mt(){const t=this.view.getInt16(this.bt);return this.bt+=2,t}get kt(){const t=this.view.getUint8(this.bt++)<<16|this.view.getUint16(this.bt);return this.bt+=2,t}get xt(){const t=this.view.getInt32(this.bt);return this.bt+=4,t}get Dt(){const t=this.view.getBigInt64(this.bt);return this.bt+=8,t}get Nt(){return this.view.getUint8(this.bt)<128?this.st-64:this.Rt-49152}get Pt(){return this.view.getUint8(this.bt)<128?this.st:this.Rt-32768}get Ft(){const t=this.view,i=t.byteLength;let s,h='';for(;10!==(s=t.getUint8(this.bt++))&&this.bt<i;)h+=String.fromCharCode(s);return h}Ut(t,i,s){s.set(this.data.subarray(this.bt,this.bt+t),i),this.bt+=t}Bt(t){this.view.setUint8(this.bt++,t+(this.random?.Gt??0)&255)}p1(t){this.view.setUint8(this.bt++,t)}p2(t){this.view.setUint16(this.bt,t),this.bt+=2}Ht(t){this.view.setUint16(this.bt,t,!0),this.bt+=2}p3(t){this.view.setUint8(this.bt++,t>>16),this.view.setUint16(this.bt,t),this.bt+=2}p4(t){this.view.setInt32(this.bt,t),this.bt+=4}Wt(t){this.view.setInt32(this.bt,t,!0),this.bt+=4}Yt(t){this.view.setBigInt64(this.bt,t),this.bt+=8}Vt(t){const i=this.view,s=t.length;for(let h=0;h<s;h++)i.setUint8(this.bt++,t.charCodeAt(h));i.setUint8(this.bt++,10)}Kt(t,i,s){this.data.set(t.subarray(s,s+i),this.bt),this.bt+=i-s}Xt(t){this.view.setUint8(this.bt-t-1,t)}zt(){this.Lt=this.bt<<3}jt(){this.bt=this.Lt+7>>>3}Zt(t){let i=this.Lt>>>3,s=8-(7&this.Lt),h=0;for(this.Lt+=t;t>s;s=8)h+=(this.view.getUint8(i++)&a.At[s])<<t-s,t-=s;return h+=t===s?this.view.getUint8(i)&a.At[s]:this.view.getUint8(i)>>>s-t&a.At[t],h}qt(t,i){const s=this.bt;this.bt=0;const h=new Uint8Array(s);this.Ut(s,0,h);const e=function(t){const i=[];for(;t>0n;)i.unshift(Number(0xffn&t)),t>>=8n;return 128&i[0]&&i.unshift(0),new Uint8Array(i)}(function(t,i,s){let h=1n;for(;i>0n;)i%2n===1n&&(h=h*t%s),t=t*t%s,i>>=1n;return h}(function(t){let i=0n;for(let s=0;s<t.length;s++)i=i<<8n|BigInt(t[s]);return i}(h),i,t));this.bt=0,this.p1(e.length),this.Kt(e,e.length,0)}}class c extends Array{constructor(t,i){super(t);for(let s=0;s<t;s++)this[s]=i}}class f extends Array{constructor(t,i,s){super(t);for(let h=0;h<t;h++){this[h]=new Array(i);for(let t=0;t<i;t++)this[h][t]=s}}}class u extends Array{constructor(t,i,s,h){super(t);for(let e=0;e<t;e++){this[e]=new Array(i);for(let t=0;t<i;t++){this[e][t]=new Array(s);for(let i=0;i<s;i++)this[e][t][i]=h}}}}class d extends Array{constructor(t,i,s,h,e){super(t);for(let n=0;n<t;n++){this[n]=new Array(i);for(let t=0;t<i;t++){this[n][t]=new Array(s);for(let i=0;i<s;i++){this[n][t][i]=new Array(h);for(let s=0;s<h;s++)this[n][t][i][s]=e}}}}}class w extends Array{constructor(t,i,s){super(t);for(let h=0;h<t;h++){this[h]=new Array(i);for(let t=0;t<i;t++)this[h][t]=new Uint8Array(s)}}}class y extends Array{constructor(t,i){super(t);for(let s=0;s<t;s++)this[s]=new Int32Array(i)}}class p extends Array{constructor(t,i,s){super(t);for(let h=0;h<t;h++){this[h]=new Array(i);for(let t=0;t<i;t++)this[h][t]=new Int32Array(s)}}}class A{static $t=[];static Jt=t=>{const i=new a(t.read('base_head.dat')),s=new a(t.read('base_type.dat')),h=new a(t.read('base_label.dat')),e=i.Rt;i.bt+=2;for(let t=0;t<e;t++){const t=i.Rt,e=i.st,n=new Uint8Array(e),r=new c(e,null);for(let t=0;t<e;t++){n[t]=s.st;const i=h.st,e=new Uint8Array(i);for(let t=0;t<i;t++)e[t]=h.st;r[t]=e}this.$t[t]=new A,this.$t[t].length=e,this.$t[t].types=n,this.$t[t].labels=r}};length=0;types=null;labels=null}class m{static $t=[];static Jt=t=>{const i=new a(t.read('frame_head.dat')),s=new a(t.read('frame_tran1.dat')),h=new a(t.read('frame_tran2.dat')),e=new a(t.read('frame_del.dat')),n=i.Rt;i.bt+=2;const r=new Int32Array(500),o=new Int32Array(500),l=new Int32Array(500),c=new Int32Array(500);for(let t=0;t<n;t++){const t=i.Rt,n=this.$t[t]=new m;n.delay=e.st;const a=i.Rt,f=A.$t[a];n.Qt=f;const u=i.st;let d=-1,w=0;for(let t=0;t<u;t++){if(!f.types)throw new Error('SeqBase not loaded!!!');const i=s.st;if(i>0){if(0!==f.types[t])for(let i=t-1;i>d;i--)if(0===f.types[i]){r[w]=i,o[w]=0,l[w]=0,c[w]=0,w++;break}r[w]=t;let s=0;3===f.types[r[w]]&&(s=128),o[w]=1&i?h.Nt:s,l[w]=2&i?h.Nt:s,c[w]=4&i?h.Nt:s,d=t,w++}}n.length=w,n.ti=new Int32Array(w),n.x=new Int32Array(w),n.y=new Int32Array(w),n.z=new Int32Array(w);for(let t=0;t<w;t++)n.ti[t]=r[t],n.x[t]=o[t],n.y[t]=l[t],n.z[t]=c[t]}};delay=0;Qt=null;length=0;ti=null;x=null;y=null;z=null}class I extends t{static count=0;static $t=[];static Jt=t=>{const i=new a(t.read('seq.dat'));this.count=i.Rt;for(let t=0;t<this.count;t++){const s=new I(t).it(i);0===s.ii&&(s.ii=1,s.frames=new Int16Array(1),s.frames[0]=-1,s.si=new Int16Array(1),s.si[0]=-1,s.delay=new Int16Array(1),s.delay[0]=-1),this.$t[t]=s}};ii=0;frames=null;si=null;delay=null;hi=-1;ei=null;ni=!1;priority=5;ri=-1;oi=-1;li=99;duration=0;decode(t,i){if(1===t){this.ii=i.st,this.frames=new Int16Array(this.ii),this.si=new Int16Array(this.ii),this.delay=new Int16Array(this.ii);for(let t=0;t<this.ii;t++)this.frames[t]=i.Rt,this.si[t]=i.Rt,65535===this.si[t]&&(this.si[t]=-1),this.delay[t]=i.Rt,0===this.delay[t]&&(this.delay[t]=m.$t[this.frames[t]].delay),0===this.delay[t]&&(this.delay[t]=1),this.duration+=this.delay[t]}else if(2===t)this.hi=i.Rt;else if(3===t){const t=i.st;this.ei=new Int32Array(t+1);for(let s=0;s<t;s++)this.ei[s]=i.st;this.ei[t]=9999999}else 4===t?this.ni=!0:5===t?this.priority=i.st:6===t?this.ri=i.Rt:7===t?this.oi=i.Rt:8===t?this.li=i.st:console.log('Error unrecognised seq config code: ',t)}}class E{head;constructor(){this.head=new l}push(t){t.ut&&t.dt(),t.ut=this.head.ut,t.ft=this.head,t.ut&&(t.ut.ft=t),t.ft.ut=t}pop(){const t=this.head.ft;return t===this.head?null:(t?.dt(),t)}}class g{ai;ci;constructor(t){this.ci=[],this.ai=t;for(let i=0;i<t;i++)this.ci[i]=new r}get(t){const i=this.ci[Number(t&BigInt(this.ai-1))];if(!i.next)return null;for(let s=i.next;s!==i;s=s.next)if(s&&s.key===t)return s;return null}put(t,i){i.ht&&i.et();const s=this.ci[Number(t&BigInt(this.ai-1))];i.ht=s.ht,i.next=s,i.ht&&(i.ht.next=i),i.next.ht=i,i.key=t}}class _{fi;ui;history;available;constructor(t){this.fi=t,this.available=t,this.ui=new g(1024),this.history=new E}get(t){const i=this.ui.get(t);return i&&this.history.push(i),i}put(t,i){if(0===this.available){const t=this.history.pop();t?.et(),t?.dt()}else this.available--;this.ui.put(t,i),this.history.push(i)}clear(){const t=this.history.pop();t?(t.et(),t.dt()):this.available=this.fi}}class C extends l{static di=new Int32Array;static wi=0;static yi=0;static top=0;static bottom=0;static left=0;static right=0;static pi=0;static Ai=0;static mi=0;static bind=(t,i,s)=>{this.di=t,this.wi=i,this.yi=s,this.Ii(0,0,i,s)};static Ei=()=>{this.left=0,this.top=0,this.right=this.wi,this.bottom=this.yi,this.pi=this.right-1,this.Ai=this.right/2|0};static Ii=(t,i,s,h)=>{t<0&&(t=0),i<0&&(i=0),s>this.wi&&(s=this.wi),h>this.yi&&(h=this.yi),this.top=i,this.bottom=h,this.left=t,this.right=s,this.pi=this.right-1,this.Ai=this.right/2|0,this.mi=this.bottom/2|0};static clear=()=>{const t=this.wi*this.yi;for(let i=0;i<t;i++)this.di[i]=0};static gi=(t,i,s,h,e)=>{this._i(t,i,e,s),this._i(t,i+h-1,e,s),this.Ci(t,i,e,h),this.Ci(t+s-1,i,e,h)};static _i=(t,i,s,h)=>{if(i<this.top||i>=this.bottom)return;t<this.left&&(h-=this.left-t,t=this.left),t+h>this.right&&(h=this.right-t);const e=t+i*this.wi;for(let t=0;t<h;t++)this.di[e+t]=s};static Ci=(t,i,s,h)=>{if(t<this.left||t>=this.right)return;i<this.top&&(h-=this.top-i,i=this.top),i+h>this.bottom&&(h=this.bottom-i);const e=t+i*this.wi;for(let t=0;t<h;t++)this.di[e+t*this.wi]=s};static Ti=(t,i,s,h,e)=>{const n=Math.abs(s-t),r=Math.abs(h-i),o=t<s?1:-1,l=i<h?1:-1;let a=n-r;for(;t>=this.left&&t<this.right&&i>=this.top&&i<this.bottom&&(this.di[t+i*this.wi]=e),t!==s||i!==h;){const s=2*a;s>-r&&(a-=r,t+=o),s<n&&(a+=n,i+=l)}};static fillRect=(t,i,s,h,e)=>{t<this.left&&(s-=this.left-t,t=this.left),i<this.top&&(h-=this.top-i,i=this.top),t+s>this.right&&(s=this.right-t),i+h>this.bottom&&(h=this.bottom-i);const n=this.wi-s;let r=t+i*this.wi;for(let t=-h;t<0;t++){for(let t=-s;t<0;t++)this.di[r++]=e;r+=n}};static Oi(t,i,s,h,e,n){t<this.left&&(s-=this.left-t,t=this.left),i<this.top&&(h-=this.top-i,i=this.top),t+s>this.right&&(s=this.right-t),i+h>this.bottom&&(h=this.bottom-i);const r=256-n,o=(e>>16&255)*n,l=(e>>8&255)*n,a=(255&e)*n,c=this.wi-s;let f=t+i*this.wi;for(let t=0;t<h;t++){for(let t=-s;t<0;t++){const t=(o+(this.di[f]>>16&255)*r>>8<<16)+(l+(this.di[f]>>8&255)*r>>8<<8)+(a+(255&this.di[f])*r>>8);this.di[f++]=t}f+=c}}static bi(t,i,s,h,e){const n=256-e,r=(h>>16&255)*e,o=(h>>8&255)*e,l=(255&h)*e;let a=i-s;a<0&&(a=0);let c=i+s;c>=this.yi&&(c=this.yi-1);for(let h=a;h<=c;h++){const e=h-i,a=0|Math.sqrt(s*s-e*e);let c=t-a;c<0&&(c=0);let f=t+a;f>=this.wi&&(f=this.wi-1);let u=c+h*this.wi;for(let t=c;t<=f;t++){const t=(r+(this.di[u]>>16&255)*n>>8<<16)+(o+(this.di[u]>>8&255)*n>>8<<8)+(l+(255&this.di[u])*n>>8);this.di[u++]=t}}}static Li=(t,i,s)=>{t<this.left||t>=this.right||i<this.top||i>=this.bottom||(this.di[t+i*this.wi]=s)}}class T extends l{di;width;height;vi;Si;Ri;Mi;palette;constructor(t,i,s){super(),this.di=new Int8Array(t*i),this.width=this.Ri=t,this.height=this.Mi=i,this.vi=this.Si=0,this.palette=s}static ki=(t,i,s=0)=>{const h=new a(t.read(i+'.dat')),e=new a(t.read('index.dat'));e.bt=h.Rt;const n=e.Rt,r=e.Rt,o=e.st,l=new Int32Array(o);for(let t=1;t<o;t++)l[t]=e.kt,0===l[t]&&(l[t]=1);for(let t=0;t<s;t++)e.bt+=2,h.bt+=e.Rt*e.Rt,e.bt+=1;if(h.bt>h.length||e.bt>e.length)throw new Error;const c=e.st,f=e.st,u=e.Rt,d=e.Rt,w=new T(u,d,l);w.vi=c,w.Si=f,w.Ri=n,w.Mi=r;const y=w.di,p=e.st;if(0===p){const t=w.width*w.height;for(let i=0;i<t;i++)y[i]=h.St}else if(1===p){const t=w.width,i=w.height;for(let s=0;s<t;s++)for(let e=0;e<i;e++)y[s+e*t]=h.St}return w};draw(t,i){t|=0,i|=0;let s=(t+=this.vi)+(i+=this.Si)*C.wi,h=0,e=this.height,n=this.width,r=C.wi-n,o=0;if(i<C.top){const t=C.top-i;e-=t,i=C.top,h+=t*n,s+=t*C.wi}if(i+e>C.bottom&&(e-=i+e-C.bottom),t<C.left){const i=C.left-t;n-=i,t=C.left,h+=i,s+=i,o+=i,r+=i}if(t+n>C.right){const i=t+n-C.right;n-=i,o+=i,r+=i}n>0&&e>0&&this.xi(n,e,this.di,h,o,C.di,s,r)}Di(){const t=this.di,i=this.width,s=this.height;for(let h=0;h<s;h++){const s=i/2|0;for(let e=0;e<s;e++){const s=e+h*i,n=i-e-1+h*i,r=t[s];t[s]=t[n],t[n]=r}}}Ni(){const t=this.di,i=this.width,s=this.height;for(let h=0;h<(s/2|0);h++)for(let e=0;e<i;e++){const n=e+h*i,r=e+(s-h-1)*i,o=t[n];t[n]=t[r],t[r]=o}}translate(t,i,s){for(let h=0;h<this.palette.length;h++){let e=this.palette[h]>>16&255;e+=t,e<0?e=0:e>255&&(e=255);let n=this.palette[h]>>8&255;n+=i,n<0?n=0:n>255&&(n=255);let r=255&this.palette[h];r+=s,r<0?r=0:r>255&&(r=255),this.palette[h]=(e<<16)+(n<<8)+r}}Pi(){this.Ri|=0,this.Mi|=0,this.Ri/=2,this.Mi/=2,this.Ri|=0,this.Mi|=0;const t=new Int8Array(this.Ri*this.Mi);let i=0;for(let s=0;s<this.height;s++)for(let h=0;h<this.width;h++)t[(h+this.vi>>1)+(s+this.Si>>1)*this.Ri]=this.di[i++];this.di=t,this.width=this.Ri,this.height=this.Mi,this.vi=0,this.Si=0}Fi(){if(this.width===this.Ri&&this.height===this.Mi)return;const t=new Int8Array(this.Ri*this.Mi);let i=0;for(let s=0;s<this.height;s++)for(let h=0;h<this.width;h++)t[h+this.vi+(s+this.Si)*this.Ri]=this.di[i++];this.di=t,this.width=this.Ri,this.height=this.Mi,this.vi=0,this.Si=0}xi(t,i,s,h,e,n,r,o){const l=-(t>>2);t=-(3&t);for(let a=-i;a<0;a++){for(let t=l;t<0;t++){let t=s[h++];0===t?r++:n[r++]=this.palette[255&t],t=s[h++],0===t?r++:n[r++]=this.palette[255&t],t=s[h++],0===t?r++:n[r++]=this.palette[255&t],t=s[h++],0===t?r++:n[r++]=this.palette[255&t]}for(let i=t;i<0;i++){const t=s[h++];0===t?r++:n[r++]=this.palette[255&t]}r+=o,h+=e}}clip(t,i,s,h){try{const e=this.width;this.height;let n=0,r=0;const o=this.Ri,l=this.Mi,a=(o<<16)/s|0,c=(l<<16)/h|0;t=t+(this.vi*s+o-1)/o|0,i=i+(this.Si*h+l-1)/l|0,this.vi*s%o!=0&&(n=(o-this.vi*s%o<<16)/s|0),this.Si*h%l!=0&&(r=(l-this.Si*h%l<<16)/h|0),s=s*(this.width-(n>>16))/o|0,h=h*(this.height-(r>>16))/l|0;let f,u=t+i*C.wi,d=C.wi-s;i<C.top&&(f=C.top-i,h-=f,i=0,u+=f*C.wi,r+=c*f),i+h>C.bottom&&(h-=i+h-C.bottom),t<C.left&&(f=C.left-t,s-=f,t=0,u+=f,n+=a*f,d+=f),t+s>C.right&&(f=t+s-C.right,s-=f,d+=f),this.Ui(C.di,this.di,this.palette,n,r,u,d,s,h,a,c,e)}catch(t){console.log('error in sprite clipping routine')}}Ui(t,i,s,h,e,n,r,o,l,a,c,f){try{const u=h;for(let d=-l;d<0;d++){const l=(e>>16)*f;for(let e=-o;e<0;e++){const e=i[(h>>16)+l];0==e?n++:t[n++]=s[255&e],h+=a}e+=c,h=u,n+=r}}catch(t){console.log('error in plot_scale')}}}class O extends C{static Bi=!1;static Gi=new Int32Array(512);static Hi=new Int32Array(2048);static sin=new Int32Array(2048);static cos=new Int32Array(2048);static palette=new Int32Array(65536);static Wi=new c(50,null);static Yi=0;static Vi=new Int32Array;static Ki=0;static Xi=0;static zi=!0;static ji=!1;static alpha=0;static Zi=null;static qi=new c(50,null);static $i=0;static Ji=0;static Qi=new Int32Array(50);static ts=new c(50,null);static ss=!1;static hs=new c(50,!1);static es=new Int32Array(50);static{for(let t=1;t<512;t++)this.Gi[t]=32768/t|0;for(let t=1;t<2048;t++)this.Hi[t]=65536/t|0;for(let t=0;t<2048;t++)this.sin[t]=65536*Math.sin(.0030679615757712823*t)|0,this.cos[t]=65536*Math.cos(.0030679615757712823*t)|0}static ns=()=>{this.Gi=null,this.Gi=null,this.sin=null,this.cos=null,this.Vi=null,this.Wi=null,this.hs=null,this.es=null,this.Zi=null,this.qi=null,this.Qi=null,this.palette=null,this.ts=null,console.log('Draw3D unloaded!')};static rs=()=>{this.Vi=new Int32Array(C.yi);for(let t=0;t<C.yi;t++)this.Vi[t]=C.wi*t;this.Ki=C.wi/2|0,this.Xi=C.yi/2|0};static os=(t,i)=>{this.Vi=new Int32Array(i);for(let s=0;s<i;s++)this.Vi[s]=t*s;this.Ki=t/2|0,this.Xi=i/2|0};static ls=()=>{this.Zi=null,this.qi.fill(null)};static cs=t=>{this.Yi=0;for(let i=0;i<50;i++)try{this.Wi[i]=T.ki(t,i.toString()),this.Bi&&128===this.Wi[i]?.Ri?this.Wi[i]?.Pi():this.Wi[i]?.Fi(),this.Yi++}catch(t){}};static fs=t=>{if(0!==this.es[t])return this.es[t];const i=this.ts[t];if(!i)return 0;let s=0,h=0,e=0;const n=i.length;for(let t=0;t<n;t++)s+=i[t]>>16&255,h+=i[t]>>8&255,e+=255&i[t];let r=(s/n<<16)+(h/n<<8)+(e/n|0);return r=this.us(r,1.4),0===r&&(r=1),this.es[t]=r,r};static ds=t=>{const i=t+.03*Math.random()-.015;let s=0;for(let t=0;t<512;t++){const h=(t/8|0)/64+.0078125,e=(7&t)/8+.0625;for(let t=0;t<128;t++){const n=t/128;let r=n,o=n,l=n;if(0!==e){let t;t=n<.5?n*(e+1):n+e-n*e;const i=2*n-t;let s=h+.3333333333333333;s>1&&s--;let a=h-.3333333333333333;a<0&&a++,r=6*s<1?i+6*(t-i)*s:2*s<1?t:3*s<2?i+(t-i)*(.6666666666666666-s)*6:i,o=6*h<1?i+6*(t-i)*h:2*h<1?t:3*h<2?i+(t-i)*(.6666666666666666-h)*6:i,l=6*a<1?i+6*(t-i)*a:2*a<1?t:3*a<2?i+(t-i)*(.6666666666666666-a)*6:i}const a=((256*r|0)<<16)+((256*o|0)<<8)+(256*l|0);this.palette[s++]=this.us(a,i)}}for(let t=0;t<50;t++){const s=this.Wi[t];if(!s)continue;const h=s.palette;this.ts[t]=new Int32Array(h.length);for(let s=0;s<h.length;s++){const e=this.ts[t];e&&(e[s]=this.us(h[s],i))}}for(let t=0;t<50;t++)this.ws(t)};static us=(t,i)=>{const s=(t>>16)/256,h=(t>>8&255)/256,e=(255&t)/256;return((256*Math.pow(s,i)|0)<<16)+((256*Math.pow(h,i)|0)<<8)+(256*Math.pow(e,i)|0)};static ys=t=>{this.Zi||(this.$i=t,this.Bi?this.Zi=new y(t,16384):this.Zi=new y(t,65536),this.qi.fill(null))};static ps=(t,i,s,h,e,n,r,o,l)=>{let a=0,c=0;e!==h&&(a=(i-t<<16)/(e-h)|0,c=(o-r<<15)/(e-h)|0);let f=0,u=0;n!==e&&(f=(s-i<<16)/(n-e)|0,u=(l-o<<15)/(n-e)|0);let d=0,w=0;if(n!==h&&(d=(t-s<<16)/(h-n)|0,w=(r-l<<15)/(h-n)|0),h<=e&&h<=n){if(h<C.bottom)if(e>C.bottom&&(e=C.bottom),n>C.bottom&&(n=C.bottom),e<n)if(s=t<<=16,l=r<<=15,h<0&&(s-=d*h,t-=a*h,l-=w*h,r-=c*h,h=0),i<<=16,o<<=15,e<0&&(i-=f*e,o-=u*e,e=0),h!==e&&d<a||h===e&&d>f)for(n-=e,e-=h,h=O.Vi[h];;){if(--e<0)for(;;){if(--n<0)return;this.As(s>>16,i>>16,l>>7,o>>7,C.di,h,0),s+=d,i+=f,l+=w,o+=u,h+=C.wi}this.As(s>>16,t>>16,l>>7,r>>7,C.di,h,0),s+=d,t+=a,l+=w,r+=c,h+=C.wi}else for(n-=e,e-=h,h=O.Vi[h];;){if(--e<0)for(;;){if(--n<0)return;this.As(i>>16,s>>16,o>>7,l>>7,C.di,h,0),s+=d,i+=f,l+=w,o+=u,h+=C.wi}this.As(t>>16,s>>16,r>>7,l>>7,C.di,h,0),s+=d,t+=a,l+=w,r+=c,h+=C.wi}else if(i=t<<=16,o=r<<=15,h<0&&(i-=d*h,t-=a*h,o-=w*h,r-=c*h,h=0),s<<=16,l<<=15,n<0&&(s-=f*n,l-=u*n,n=0),h!==n&&d<a||h===n&&f>a)for(e-=n,n-=h,h=O.Vi[h];;){if(--n<0)for(;;){if(--e<0)return;this.As(s>>16,t>>16,l>>7,r>>7,C.di,h,0),s+=f,t+=a,l+=u,r+=c,h+=C.wi}this.As(i>>16,t>>16,o>>7,r>>7,C.di,h,0),i+=d,t+=a,o+=w,r+=c,h+=C.wi}else for(e-=n,n-=h,h=O.Vi[h];;){if(--n<0)for(;;){if(--e<0)return;this.As(t>>16,s>>16,r>>7,l>>7,C.di,h,0),s+=f,t+=a,l+=u,r+=c,h+=C.wi}this.As(t>>16,i>>16,r>>7,o>>7,C.di,h,0),i+=d,t+=a,o+=w,r+=c,h+=C.wi}}else if(e<=n){if(e<C.bottom)if(n>C.bottom&&(n=C.bottom),h>C.bottom&&(h=C.bottom),n<h)if(t=i<<=16,r=o<<=15,e<0&&(t-=a*e,i-=f*e,r-=c*e,o-=u*e,e=0),s<<=16,l<<=15,n<0&&(s-=d*n,l-=w*n,n=0),e!==n&&a<f||e===n&&a>d)for(h-=n,n-=e,e=O.Vi[e];;){if(--n<0)for(;;){if(--h<0)return;this.As(t>>16,s>>16,r>>7,l>>7,C.di,e,0),t+=a,s+=d,r+=c,l+=w,e+=C.wi}this.As(t>>16,i>>16,r>>7,o>>7,C.di,e,0),t+=a,i+=f,r+=c,o+=u,e+=C.wi}else for(h-=n,n-=e,e=O.Vi[e];;){if(--n<0)for(;;){if(--h<0)return;this.As(s>>16,t>>16,l>>7,r>>7,C.di,e,0),t+=a,s+=d,r+=c,l+=w,e+=C.wi}this.As(i>>16,t>>16,o>>7,r>>7,C.di,e,0),t+=a,i+=f,r+=c,o+=u,e+=C.wi}else if(s=i<<=16,l=o<<=15,e<0&&(s-=a*e,i-=f*e,l-=c*e,o-=u*e,e=0),t<<=16,r<<=15,h<0&&(t-=d*h,r-=w*h,h=0),n-=h,h-=e,e=O.Vi[e],a<f)for(;;){if(--h<0)for(;;){if(--n<0)return;this.As(t>>16,i>>16,r>>7,o>>7,C.di,e,0),t+=d,i+=f,r+=w,o+=u,e+=C.wi}this.As(s>>16,i>>16,l>>7,o>>7,C.di,e,0),s+=a,i+=f,l+=c,o+=u,e+=C.wi}else for(;;){if(--h<0)for(;;){if(--n<0)return;this.As(i>>16,t>>16,o>>7,r>>7,C.di,e,0),t+=d,i+=f,r+=w,o+=u,e+=C.wi}this.As(i>>16,s>>16,o>>7,l>>7,C.di,e,0),s+=a,i+=f,l+=c,o+=u,e+=C.wi}}else if(n<C.bottom)if(h>C.bottom&&(h=C.bottom),e>C.bottom&&(e=C.bottom),h<e)if(i=s<<=16,o=l<<=15,n<0&&(i-=f*n,s-=d*n,o-=u*n,l-=w*n,n=0),t<<=16,r<<=15,h<0&&(t-=a*h,r-=c*h,h=0),e-=h,h-=n,n=O.Vi[n],f<d)for(;;){if(--h<0)for(;;){if(--e<0)return;this.As(i>>16,t>>16,o>>7,r>>7,C.di,n,0),i+=f,t+=a,o+=u,r+=c,n+=C.wi}this.As(i>>16,s>>16,o>>7,l>>7,C.di,n,0),i+=f,s+=d,o+=u,l+=w,n+=C.wi}else for(;;){if(--h<0)for(;;){if(--e<0)return;this.As(t>>16,i>>16,r>>7,o>>7,C.di,n,0),i+=f,t+=a,o+=u,r+=c,n+=C.wi}this.As(s>>16,i>>16,l>>7,o>>7,C.di,n,0),i+=f,s+=d,o+=u,l+=w,n+=C.wi}else if(t=s<<=16,r=l<<=15,n<0&&(t-=f*n,s-=d*n,r-=u*n,l-=w*n,n=0),i<<=16,o<<=15,e<0&&(i-=a*e,o-=c*e,e=0),h-=e,e-=n,n=O.Vi[n],f<d)for(;;){if(--e<0)for(;;){if(--h<0)return;this.As(i>>16,s>>16,o>>7,l>>7,C.di,n,0),i+=a,s+=d,o+=c,l+=w,n+=C.wi}this.As(t>>16,s>>16,r>>7,l>>7,C.di,n,0),t+=f,s+=d,r+=u,l+=w,n+=C.wi}else for(;;){if(--e<0)for(;;){if(--h<0)return;this.As(s>>16,i>>16,l>>7,o>>7,C.di,n,0),i+=a,s+=d,o+=c,l+=w,n+=C.wi}this.As(s>>16,t>>16,l>>7,r>>7,C.di,n,0),t+=f,s+=d,r+=u,l+=w,n+=C.wi}};static As=(t,i,s,h,e,n,r)=>{let o;if(O.zi){let l;if(O.ji){if(l=i-t>3?(h-s)/(i-t)|0:0,i>C.pi&&(i=C.pi),t<0&&(s-=t*l,t=0),t>=i)return;n+=t,r=i-t>>2,l<<=2}else{if(!(t<i))return;n+=t,l=(r=i-t>>2)>0?(h-s)*O.Gi[r]>>15:0}if(0===O.alpha)for(;;){if(--r<0){if((r=i-t&3)>0){o=O.palette[s>>8];do{e[n++]=o,r--}while(r>0);return}break}o=O.palette[s>>8],s+=l,e[n++]=o,e[n++]=o,e[n++]=o,e[n++]=o}else{const h=O.alpha,a=256-O.alpha;for(;;){if(--r<0){if((r=i-t&3)>0){o=O.palette[s>>8],o=((16711935&o)*a>>8&16711935)+((65280&o)*a>>8&65280);do{e[n++]=o+((16711935&e[n])*h>>8&16711935)+((65280&e[n])*h>>8&65280),r--}while(r>0)}break}o=O.palette[s>>8],s+=l,o=((16711935&o)*a>>8&16711935)+((65280&o)*a>>8&65280),e[n++]=o+((16711935&e[n])*h>>8&16711935)+((65280&e[n])*h>>8&65280),e[n++]=o+((16711935&e[n])*h>>8&16711935)+((65280&e[n])*h>>8&65280),e[n++]=o+((16711935&e[n])*h>>8&16711935)+((65280&e[n])*h>>8&65280),e[n++]=o+((16711935&e[n])*h>>8&16711935)+((65280&e[n])*h>>8&65280)}}}else if(t<i){const l=(h-s)/(i-t)|0;if(O.ji&&(i>C.pi&&(i=C.pi),t<0&&(s-=t*l,t=0),t>=i))return;if(n+=t,r=i-t,0===O.alpha)do{e[n++]=O.palette[s>>8],s+=l,r--}while(r>0);else{const t=O.alpha,i=256-O.alpha;do{o=O.palette[s>>8],s+=l,o=((16711935&o)*i>>8&16711935)+((65280&o)*i>>8&65280),e[n++]=o+((16711935&e[n])*t>>8&16711935)+((65280&e[n])*t>>8&65280),r--}while(r>0)}}};static Is=(t,i,s,h,e,n,r)=>{let o=0;e!==h&&(o=(i-t<<16)/(e-h)|0);let l=0;n!==e&&(l=(s-i<<16)/(n-e)|0);let a=0;if(n!==h&&(a=(t-s<<16)/(h-n)|0),h<=e&&h<=n){if(h<C.bottom)if(e>C.bottom&&(e=C.bottom),n>C.bottom&&(n=C.bottom),e<n)if(s=t<<=16,h<0&&(s-=a*h,t-=o*h,h=0),i<<=16,e<0&&(i-=l*e,e=0),h!==e&&a<o||h===e&&a>l)for(n-=e,e-=h,h=this.Vi[h];;){if(--e<0)for(;;){if(--n<0)return;this.Es(s>>16,i>>16,C.di,h,r),s+=a,i+=l,h+=C.wi}this.Es(s>>16,t>>16,C.di,h,r),s+=a,t+=o,h+=C.wi}else for(n-=e,e-=h,h=this.Vi[h];;){if(--e<0)for(;;){if(--n<0)return;this.Es(i>>16,s>>16,C.di,h,r),s+=a,i+=l,h+=C.wi}this.Es(t>>16,s>>16,C.di,h,r),s+=a,t+=o,h+=C.wi}else if(i=t<<=16,h<0&&(i-=a*h,t-=o*h,h=0),s<<=16,n<0&&(s-=l*n,n=0),h!==n&&a<o||h===n&&l>o)for(e-=n,n-=h,h=this.Vi[h];;){if(--n<0)for(;;){if(--e<0)return;this.Es(s>>16,t>>16,C.di,h,r),s+=l,t+=o,h+=C.wi}this.Es(i>>16,t>>16,C.di,h,r),i+=a,t+=o,h+=C.wi}else for(e-=n,n-=h,h=this.Vi[h];;){if(--n<0)for(;;){if(--e<0)return;this.Es(t>>16,s>>16,C.di,h,r),s+=l,t+=o,h+=C.wi}this.Es(t>>16,i>>16,C.di,h,r),i+=a,t+=o,h+=C.wi}}else if(e<=n){if(e<C.bottom)if(n>C.bottom&&(n=C.bottom),h>C.bottom&&(h=C.bottom),n<h)if(t=i<<=16,e<0&&(t-=o*e,i-=l*e,e=0),s<<=16,n<0&&(s-=a*n,n=0),e!==n&&o<l||e===n&&o>a)for(h-=n,n-=e,e=this.Vi[e];;){if(--n<0)for(;;){if(--h<0)return;this.Es(t>>16,s>>16,C.di,e,r),t+=o,s+=a,e+=C.wi}this.Es(t>>16,i>>16,C.di,e,r),t+=o,i+=l,e+=C.wi}else for(h-=n,n-=e,e=this.Vi[e];;){if(--n<0)for(;;){if(--h<0)return;this.Es(s>>16,t>>16,C.di,e,r),t+=o,s+=a,e+=C.wi}this.Es(i>>16,t>>16,C.di,e,r),t+=o,i+=l,e+=C.wi}else if(s=i<<=16,e<0&&(s-=o*e,i-=l*e,e=0),t<<=16,h<0&&(t-=a*h,h=0),o<l)for(n-=h,h-=e,e=this.Vi[e];;){if(--h<0)for(;;){if(--n<0)return;this.Es(t>>16,i>>16,C.di,e,r),t+=a,i+=l,e+=C.wi}this.Es(s>>16,i>>16,C.di,e,r),s+=o,i+=l,e+=C.wi}else for(n-=h,h-=e,e=this.Vi[e];;){if(--h<0)for(;;){if(--n<0)return;this.Es(i>>16,t>>16,C.di,e,r),t+=a,i+=l,e+=C.wi}this.Es(i>>16,s>>16,C.di,e,r),s+=o,i+=l,e+=C.wi}}else if(n<C.bottom)if(h>C.bottom&&(h=C.bottom),e>C.bottom&&(e=C.bottom),h<e)if(i=s<<=16,n<0&&(i-=l*n,s-=a*n,n=0),t<<=16,h<0&&(t-=o*h,h=0),l<a)for(e-=h,h-=n,n=this.Vi[n];;){if(--h<0)for(;;){if(--e<0)return;this.Es(i>>16,t>>16,C.di,n,r),i+=l,t+=o,n+=C.wi}this.Es(i>>16,s>>16,C.di,n,r),i+=l,s+=a,n+=C.wi}else for(e-=h,h-=n,n=this.Vi[n];;){if(--h<0)for(;;){if(--e<0)return;this.Es(t>>16,i>>16,C.di,n,r),i+=l,t+=o,n+=C.wi}this.Es(s>>16,i>>16,C.di,n,r),i+=l,s+=a,n+=C.wi}else if(t=s<<=16,n<0&&(t-=l*n,s-=a*n,n=0),i<<=16,e<0&&(i-=o*e,e=0),l<a)for(h-=e,e-=n,n=this.Vi[n];;){if(--e<0)for(;;){if(--h<0)return;this.Es(i>>16,s>>16,C.di,n,r),i+=o,s+=a,n+=C.wi}this.Es(t>>16,s>>16,C.di,n,r),t+=l,s+=a,n+=C.wi}else for(h-=e,e-=n,n=this.Vi[n];;){if(--e<0)for(;;){if(--h<0)return;this.Es(s>>16,i>>16,C.di,n,r),i+=o,s+=a,n+=C.wi}this.Es(s>>16,t>>16,C.di,n,r),t+=l,s+=a,n+=C.wi}};static gs=(t,i,s,h,e,n,r,o,l,a,c,f,u,d,w,y,p,A,m)=>{const I=this._s(m);this.ss=!this.hs[m];const E=a-u,g=c-w,_=f-p,T=d-a,O=y-c,b=A-f;let L=T*c-O*a<<14;const v=O*f-b*c<<8,S=b*a-T*f<<5;let R=E*c-g*a<<14;const M=g*f-_*c<<8,k=_*a-E*f<<5;let x=g*T-E*O<<14;const D=_*O-g*b<<8,N=E*b-_*T<<5;let P=0,F=0;e!==h&&(P=(i-t<<16)/(e-h)|0,F=(o-r<<16)/(e-h)|0);let U=0,B=0;n!==e&&(U=(s-i<<16)/(n-e)|0,B=(l-o<<16)/(n-e)|0);let G=0,H=0;if(n!==h&&(G=(t-s<<16)/(h-n)|0,H=(r-l<<16)/(h-n)|0),h<=e&&h<=n){if(h<C.bottom)if(e>C.bottom&&(e=C.bottom),n>C.bottom&&(n=C.bottom),e<n){s=t<<=16,l=r<<=16,h<0&&(s-=G*h,t-=P*h,l-=H*h,r-=F*h,h=0),i<<=16,o<<=16,e<0&&(i-=U*e,o-=B*e,e=0);const a=h-this.Xi;if(L+=S*a,R+=k*a,x+=N*a,L|=0,R|=0,x|=0,h!==e&&G<P||h===e&&G>U)for(n-=e,e-=h,h=this.Vi[h];;){if(--e<0)for(;;){if(--n<0)return;this.Cs(s>>16,i>>16,C.di,h,I,0,0,L,R,x,v,M,D,l>>8,o>>8),s+=G,i+=U,l+=H,o+=B,h+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}this.Cs(s>>16,t>>16,C.di,h,I,0,0,L,R,x,v,M,D,l>>8,r>>8),s+=G,t+=P,l+=H,r+=F,h+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}else for(n-=e,e-=h,h=this.Vi[h];;){if(--e<0)for(;;){if(--n<0)return;this.Cs(i>>16,s>>16,C.di,h,I,0,0,L,R,x,v,M,D,o>>8,l>>8),s+=G,i+=U,l+=H,o+=B,h+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}this.Cs(t>>16,s>>16,C.di,h,I,0,0,L,R,x,v,M,D,r>>8,l>>8),s+=G,t+=P,l+=H,r+=F,h+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}}else{i=t<<=16,o=r<<=16,h<0&&(i-=G*h,t-=P*h,o-=H*h,r-=F*h,h=0),s<<=16,l<<=16,n<0&&(s-=U*n,l-=B*n,n=0);const a=h-this.Xi;if(L+=S*a,R+=k*a,x+=N*a,L|=0,R|=0,x|=0,(h===n||G>=P)&&(h!==n||U<=P))for(e-=n,n-=h,h=this.Vi[h];;){if(--n<0)for(;;){if(--e<0)return;this.Cs(t>>16,s>>16,C.di,h,I,0,0,L,R,x,v,M,D,r>>8,l>>8),s+=U,t+=P,l+=B,r+=F,h+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}this.Cs(t>>16,i>>16,C.di,h,I,0,0,L,R,x,v,M,D,r>>8,o>>8),i+=G,t+=P,o+=H,r+=F,h+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}else for(e-=n,n-=h,h=this.Vi[h];;){if(--n<0)for(;;){if(--e<0)return;this.Cs(s>>16,t>>16,C.di,h,I,0,0,L,R,x,v,M,D,l>>8,r>>8),s+=U,t+=P,l+=B,r+=F,h+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}this.Cs(i>>16,t>>16,C.di,h,I,0,0,L,R,x,v,M,D,o>>8,r>>8),i+=G,t+=P,o+=H,r+=F,h+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}}}else if(e<=n){if(e<C.bottom)if(n>C.bottom&&(n=C.bottom),h>C.bottom&&(h=C.bottom),n<h){t=i<<=16,r=o<<=16,e<0&&(t-=P*e,i-=U*e,r-=F*e,o-=B*e,e=0),s<<=16,l<<=16,n<0&&(s-=G*n,l-=H*n,n=0);const a=e-this.Xi;if(L+=S*a,R+=k*a,x+=N*a,L|=0,R|=0,x|=0,e!==n&&P<U||e===n&&P>G)for(h-=n,n-=e,e=this.Vi[e];;){if(--n<0)for(;;){if(--h<0)return;this.Cs(t>>16,s>>16,C.di,e,I,0,0,L,R,x,v,M,D,r>>8,l>>8),t+=P,s+=G,r+=F,l+=H,e+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}this.Cs(t>>16,i>>16,C.di,e,I,0,0,L,R,x,v,M,D,r>>8,o>>8),t+=P,i+=U,r+=F,o+=B,e+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}else for(h-=n,n-=e,e=this.Vi[e];;){if(--n<0)for(;;){if(--h<0)return;this.Cs(s>>16,t>>16,C.di,e,I,0,0,L,R,x,v,M,D,l>>8,r>>8),t+=P,s+=G,r+=F,l+=H,e+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}this.Cs(i>>16,t>>16,C.di,e,I,0,0,L,R,x,v,M,D,o>>8,r>>8),t+=P,i+=U,r+=F,o+=B,e+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}}else{s=i<<=16,l=o<<=16,e<0&&(s-=P*e,i-=U*e,l-=F*e,o-=B*e,e=0),t<<=16,r<<=16,h<0&&(t-=G*h,r-=H*h,h=0);const a=e-this.Xi;if(L+=S*a,R+=k*a,x+=N*a,L|=0,R|=0,x|=0,n-=h,h-=e,e=this.Vi[e],P<U)for(;;){if(--h<0)for(;;){if(--n<0)return;this.Cs(t>>16,i>>16,C.di,e,I,0,0,L,R,x,v,M,D,r>>8,o>>8),t+=G,i+=U,r+=H,o+=B,e+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}this.Cs(s>>16,i>>16,C.di,e,I,0,0,L,R,x,v,M,D,l>>8,o>>8),s+=P,i+=U,l+=F,o+=B,e+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}else for(;;){if(--h<0)for(;;){if(--n<0)return;this.Cs(i>>16,t>>16,C.di,e,I,0,0,L,R,x,v,M,D,o>>8,r>>8),t+=G,i+=U,r+=H,o+=B,e+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}this.Cs(i>>16,s>>16,C.di,e,I,0,0,L,R,x,v,M,D,o>>8,l>>8),s+=P,i+=U,l+=F,o+=B,e+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}}}else if(n<C.bottom)if(h>C.bottom&&(h=C.bottom),e>C.bottom&&(e=C.bottom),h<e){i=s<<=16,o=l<<=16,n<0&&(i-=U*n,s-=G*n,o-=B*n,l-=H*n,n=0),t<<=16,r<<=16,h<0&&(t-=P*h,r-=F*h,h=0);const a=n-this.Xi;if(L+=S*a,R+=k*a,x+=N*a,L|=0,R|=0,x|=0,e-=h,h-=n,n=this.Vi[n],U<G)for(;;){if(--h<0)for(;;){if(--e<0)return;this.Cs(i>>16,t>>16,C.di,n,I,0,0,L,R,x,v,M,D,o>>8,r>>8),i+=U,t+=P,o+=B,r+=F,n+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}this.Cs(i>>16,s>>16,C.di,n,I,0,0,L,R,x,v,M,D,o>>8,l>>8),i+=U,s+=G,o+=B,l+=H,n+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}else for(;;){if(--h<0)for(;;){if(--e<0)return;this.Cs(t>>16,i>>16,C.di,n,I,0,0,L,R,x,v,M,D,r>>8,o>>8),i+=U,t+=P,o+=B,r+=F,n+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}this.Cs(s>>16,i>>16,C.di,n,I,0,0,L,R,x,v,M,D,l>>8,o>>8),i+=U,s+=G,o+=B,l+=H,n+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}}else{t=s<<=16,r=l<<=16,n<0&&(t-=U*n,s-=G*n,r-=B*n,l-=H*n,n=0),i<<=16,o<<=16,e<0&&(i-=P*e,o-=F*e,e=0);const a=n-this.Xi;if(L+=S*a,R+=k*a,x+=N*a,L|=0,R|=0,x|=0,h-=e,e-=n,n=this.Vi[n],U<G)for(;;){if(--e<0)for(;;){if(--h<0)return;this.Cs(i>>16,s>>16,C.di,n,I,0,0,L,R,x,v,M,D,o>>8,l>>8),i+=P,s+=G,o+=F,l+=H,n+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}this.Cs(t>>16,s>>16,C.di,n,I,0,0,L,R,x,v,M,D,r>>8,l>>8),t+=U,s+=G,r+=B,l+=H,n+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}else for(;;){if(--e<0)for(;;){if(--h<0)return;this.Cs(s>>16,i>>16,C.di,n,I,0,0,L,R,x,v,M,D,l>>8,o>>8),i+=P,s+=G,o+=F,l+=H,n+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}this.Cs(s>>16,t>>16,C.di,n,I,0,0,L,R,x,v,M,D,l>>8,r>>8),t+=U,s+=G,r+=B,l+=H,n+=C.wi,L+=S,R+=k,x+=N,L|=0,R|=0,x|=0}}};static Cs=(t,i,s,h,e,n,r,o,l,a,c,f,u,d,w)=>{if(t>=i)return;let y,p,A,m,I,E,g,_,T;if(this.ji){if(y=(w-d)/(i-t)|0,i>C.pi&&(i=C.pi),t<0&&(d-=t*y,t=0),t>=i)return;p=i-t>>3,y<<=12}else i-t>7?(p=i-t>>3,y=(w-d)*this.Gi[p]>>6):(p=0,y=0);if(d<<=9,h+=t,this.Bi&&e)if(A=0,m=0,E=t-this.Ki,o+=(c>>3)*E,l+=(f>>3)*E,a+=(u>>3)*E,o|=0,l|=0,I=(a|=0)>>12,0!==I&&(r=l/I|0,(n=o/I|0)<0?n=0:n>4032&&(n=4032)),o+=c,l+=f,a+=u,o|=0,l|=0,I=(a|=0)>>12,0!==I&&(A=o/I|0,m=l/I|0,A<7?A=7:A>4032&&(A=4032)),g=A-n>>3,_=m-r>>3,n+=d>>3&786432,T=d>>23,this.ss){for(;p-- >0;)s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n=A,r=m,o+=c,l+=f,I=(a+=u)>>12,0!==I&&(A=o/I|0,m=l/I|0,A<7?A=7:A>4032&&(A=4032)),g=A-n>>3,_=m-r>>3,n+=(d+=y)>>3&786432,T=d>>23;for(p=i-t&7;p-- >0;)s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_}else{for(;p-- >0;){let t;0!=(t=e[(4032&r)+(n>>6)]>>>T)&&(s[h]=t),h+=1,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h++,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h++,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h++,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h++,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h++,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h++,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h+=1,n=A,r=m,o+=c,l+=f,a+=u,o|=0,l|=0,I=(a|=0)>>12,0!==I&&(A=o/I|0,m=l/I|0,A<7?A=7:A>4032&&(A=4032)),g=A-n>>3,_=m-r>>3,n+=(d+=y)>>3&786432,T=d>>23}for(p=i-t&7;p-- >0;){let t;0!=(t=e[(4032&r)+(n>>6)]>>>T)&&(s[h]=t),h++,n+=g,r+=_}}else if(A=0,m=0,E=t-this.Ki,o+=(c>>3)*E,l+=(f>>3)*E,a+=(u>>3)*E,o|=0,l|=0,I=(a|=0)>>14,0!==I&&(r=l/I|0,(n=o/I|0)<0?n=0:n>16256&&(n=16256)),o+=c,l+=f,a+=u,o|=0,l|=0,I=(a|=0)>>14,0!==I&&(A=o/I|0,m=l/I|0,A<7?A=7:A>16256&&(A=16256)),g=A-n>>3,_=m-r>>3,n+=6291456&d,T=d>>23,this.ss&&e){for(;p-- >0;)s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n=A,r=m,o+=c,l+=f,a+=u,o|=0,l|=0,I=(a|=0)>>14,0!==I&&(A=o/I|0,m=l/I|0,A<7?A=7:A>16256&&(A=16256)),g=A-n>>3,_=m-r>>3,n+=6291456&(d+=y),T=d>>23;for(p=i-t&7;p-- >0;)s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_}else{for(;p-- >0&&e;){let t;0!=(t=e[(16256&r)+(n>>7)]>>>T)&&(s[h]=t),h+=1,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,n=A,r=m,o+=c,l+=f,a+=u,o|=0,l|=0,I=(a|=0)>>14,0!==I&&(A=o/I|0,m=l/I|0,A<7?A=7:A>16256&&(A=16256)),g=A-n>>3,_=m-r>>3,n+=6291456&(d+=y),T=d>>23}for(p=i-t&7;p-- >0&&e;){let t;0!=(t=e[(16256&r)+(n>>7)]>>>T)&&(s[h]=t),h++,n+=g,r+=_}}};static Es=(t,i,s,h,e)=>{if(this.ji&&(i>C.pi&&(i=C.pi),t<0&&(t=0)),t>=i)return;h+=t;let n=i-t>>2;if(0===this.alpha)for(;;){if(n--,n<0)for(n=i-t&3;;){if(n--,n<0)return;s[h++]=e}s[h++]=e,s[h++]=e,s[h++]=e,s[h++]=e}const r=this.alpha,o=256-this.alpha;for(e=((16711935&e)*o>>8&16711935)+((65280&e)*o>>8&65280);;){if(n--,n<0)for(n=i-t&3;;){if(n--,n<0)return;s[h++]=e+((16711935&s[h])*r>>8&16711935)+((65280&s[h])*r>>8&65280)}s[h++]=e+((16711935&s[h])*r>>8&16711935)+((65280&s[h])*r>>8&65280),s[h++]=e+((16711935&s[h])*r>>8&16711935)+((65280&s[h])*r>>8&65280),s[h++]=e+((16711935&s[h])*r>>8&16711935)+((65280&s[h])*r>>8&65280),s[h++]=e+((16711935&s[h])*r>>8&16711935)+((65280&s[h])*r>>8&65280)}};static ws=t=>{this.qi[t]&&this.Zi&&(this.Zi[this.$i++]=this.qi[t],this.qi[t]=null)};static _s=t=>{if(this.Qi[t]=this.Ji++,this.qi[t])return this.qi[t];let i;if(this.$i>0&&this.Zi)i=this.Zi[--this.$i],this.Zi[this.$i]=null;else{let t=0,s=-1;for(let i=0;i<this.Yi;i++)this.qi[i]&&(this.Qi[i]<t||-1===s)&&(t=this.Qi[i],s=i);i=this.qi[s],this.qi[s]=null}this.qi[t]=i;const s=this.Wi[t],h=this.ts[t];if(!i||!s||!h)return null;if(this.Bi){this.hs[t]=!1;for(let e=0;e<4096;e++){const n=i[e]=16316671&h[s.di[e]];0===n&&(this.hs[t]=!0),i[e+4096]=n-(n>>>3)&16316671,i[e+8192]=n-(n>>>2)&16316671,i[e+12288]=n-(n>>>2)-(n>>>3)&16316671}}else{if(64===s.width)for(let t=0;t<128;t++)for(let e=0;e<128;e++)i[e+(t<<7)]=h[s.di[(e>>1)+(t>>1<<6)]];else for(let t=0;t<16384;t++)i[t]=h[s.di[t]];this.hs[t]=!1;for(let s=0;s<16384;s++){i[s]&=16316671;const h=i[s];0===h&&(this.hs[t]=!0),i[s+16384]=h-(h>>>3)&16316671,i[s+32768]=h-(h>>>2)&16316671,i[s+49152]=h-(h>>>2)-(h>>>3)&16316671}}return i}}class b{Ts=0;Os=0;bs=0;Ls=-1;vs=-1;Ss=-1;Rs=-1;Ms=-1;ks=-1;xs=-1;Ds=-1;Ns=-1;Ps=0;Fs=-1;Us=-1;Bs=-1;data=null}class L{x=0;y=0;z=0;w=0}class v extends l{static metadata=null;static head=null;static Gs=null;static Hs=null;static Ws=null;static Ys=null;static Vs=null;static Ks=null;static Xs=null;static zs=null;static js=null;static Zs=null;static qs=null;static $s=null;static axis=null;static Js=new c(4096,!1);static Qs=new c(4096,!1);static th=new Int32Array(4096);static ih=new Int32Array(4096);static sh=new Int32Array(4096);static hh=new Int32Array(4096);static eh=new Int32Array(4096);static nh=new Int32Array(4096);static rh=new Int32Array(1500);static oh=new y(1500,512);static lh=new Int32Array(12);static ah=new y(12,2e3);static fh=new Int32Array(2e3);static uh=new Int32Array(2e3);static dh=new Int32Array(12);static wh=new Int32Array(10);static yh=new Int32Array(10);static ph=new Int32Array(10);static Ah=0;static mh=0;static Ih=0;static Eh=!1;static gh=0;static _h=0;static Ch=0;static Th=new Int32Array(1e3);static Oh=!1;static Jt(t){try{v.head=new a(t.read('ob_head.dat')),v.Gs=new a(t.read('ob_face1.dat')),v.Hs=new a(t.read('ob_face2.dat')),v.Ws=new a(t.read('ob_face3.dat')),v.Ys=new a(t.read('ob_face4.dat')),v.Vs=new a(t.read('ob_face5.dat')),v.Ks=new a(t.read('ob_point1.dat')),v.Xs=new a(t.read('ob_point2.dat')),v.zs=new a(t.read('ob_point3.dat')),v.js=new a(t.read('ob_point4.dat')),v.Zs=new a(t.read('ob_point5.dat')),v.qs=new a(t.read('ob_vertex1.dat')),v.$s=new a(t.read('ob_vertex2.dat')),v.axis=new a(t.read('ob_axis.dat')),v.head.bt=0,v.Ks.bt=0,v.Xs.bt=0,v.zs.bt=0,v.js.bt=0,v.qs.bt=0,v.$s.bt=0;const i=v.head.Rt;v.metadata=new c(i+100,null);let s=0,h=0,e=0,n=0,r=0,o=0,l=0;for(let t=0;t<i;t++){const t=v.head.Rt,i=new b;i.Ts=v.head.Rt,i.Os=v.head.Rt,i.bs=v.head.st,i.Ls=v.Ks.bt,i.vs=v.Xs.bt,i.Ss=v.zs.bt,i.Rs=v.js.bt,i.ks=v.qs.bt,i.xs=v.$s.bt;const a=v.head.st,c=v.head.st,f=v.head.st,u=v.head.st,d=v.head.st;for(let t=0;t<i.Ts;t++){const t=v.Ks.st;1&t&&v.Xs.Nt,2&t&&v.zs.Nt,4&t&&v.js.Nt}for(let t=0;t<i.Os;t++){1===v.$s.st&&(v.qs.Nt,v.qs.Nt),v.qs.Nt}i.Ds=e,e+=2*i.Os,1===a&&(i.Ns=n,n+=i.Os),255===c?(i.Ps=r,r+=i.Os):i.Ps=-c-1,1===f&&(i.Fs=o,o+=i.Os),1===u&&(i.Us=l,l+=i.Os),1===d&&(i.Ms=h,h+=i.Ts),i.Bs=s,s+=i.bs,v.metadata[t]=i}}catch(t){console.log('Error loading model index'),console.error(t)}}static bh(t,i){if(null===v.metadata&&(v.metadata=[]),null===t){const t=new b;return t.Ts=0,t.Os=0,t.bs=0,void(v.metadata[i]=t)}const s=new a(t);s.bt=s.length-18;const h=new b;h.data=t,h.Ts=s.Rt,h.Os=s.Rt,h.bs=s.st,v.metadata[i]=h;const e=s.st,n=s.st,r=s.st,o=s.st,l=s.st,c=s.Rt,f=s.Rt,u=s.Rt,d=s.Rt;let w=0;h.Ls=w,w+=h.Ts,h.xs=w,w+=h.Os,h.Ps=w,255===n?w+=h.Os:h.Ps=-n-1,h.Us=w,1===o?w+=h.Os:h.Us=-1,h.Ns=w,1===e?w+=h.Os:h.Ns=-1,h.Ms=w,1===l?w+=h.Ts:h.Ms=-1,h.Fs=w,1===r?w+=h.Os:h.Fs=-1,h.ks=w,w+=d,h.Ds=w,w+=2*h.Os,h.Bs=w,w+=6*h.bs,h.vs=w,w+=c,h.Ss=w,w+=f,h.Rs=w,w+=u}static ns(){v.metadata=null,v.head=null,v.Gs=null,v.Hs=null,v.Ws=null,v.Ys=null,v.Vs=null,v.Ks=null,v.Xs=null,v.zs=null,v.js=null,v.Zs=null,v.qs=null,v.$s=null,v.axis=null,v.Js=null,v.Qs=null,v.th=null,v.ih=null,v.sh=null,v.hh=null,v.eh=null,v.nh=null,v.rh=null,v.oh=null,v.lh=null,v.ah=null,v.fh=null,v.uh=null,v.dh=null}static Lh(t,i,s){return 2&~s?((i=i*(127&t)>>7)<2?i=2:i>126&&(i=126),(65408&t)+i):(i<0?i=0:i>127&&(i=127),127-i)}static Sh=(t,i,s)=>{const h=t.Ts,e=t.Os,n=t.bs;let r,o,l,a,f;if(i){r=new Int32Array(h);for(let i=0;i<h;i++)r[i]=t.Rh[i]}else r=t.Rh;let u=null,d=null;if(s){o=new Int32Array(e),l=new Int32Array(e),a=new Int32Array(e);for(let i=0;i<e;i++)t.Mh&&(o[i]=t.Mh[i]),t.kh&&(l[i]=t.kh[i]),t.xh&&(a[i]=t.xh[i]);if(f=new Int32Array(e),t.Dh)for(let i=0;i<e;i++)f[i]=t.Dh[i];else for(let t=0;t<e;t++)f[t]=0;u=new c(h,null);for(let i=0;i<h;i++){const s=u[i]=new L;if(t.Nh){const h=t.Nh[i];h&&(s.x=h.x,s.y=h.y,s.z=h.z,s.w=h.w)}}d=t.Ph}else o=t.Mh,l=t.kh,a=t.xh,f=t.Dh;return new v({Ts:h,Fh:t.Fh,Rh:r,Uh:t.Uh,Os:e,Bh:t.Bh,Gh:t.Gh,Hh:t.Hh,Mh:o,kh:l,xh:a,Dh:f,Wh:t.Wh,Yh:t.Yh,Vh:t.Vh,priority:t.priority,bs:n,Kh:t.Kh,Xh:t.Xh,zh:t.zh,jh:t.jh,Zh:t.Zh,qh:t.qh,$h:t.$h,Jh:t.Jh,Qh:t.Qh,te:t.te,ie:t.ie,se:t.se,Nh:u,Ph:d})};static he=(t,i,s,h)=>{const e=t.Ts,n=t.Os,r=t.bs;let o,l,a,c,f;if(h)o=t.Fh,l=t.Rh,a=t.Uh;else{o=new Int32Array(e),l=new Int32Array(e),a=new Int32Array(e);for(let i=0;i<e;i++)o[i]=t.Fh[i],l[i]=t.Rh[i],a[i]=t.Uh[i]}if(i)c=t.Vh;else{c=new Int32Array(n);for(let i=0;i<n;i++)t.Vh&&(c[i]=t.Vh[i])}if(s)f=t.Yh;else if(f=new Int32Array(n),t.Yh)for(let i=0;i<n;i++)f[i]=t.Yh[i];else for(let t=0;t<n;t++)f[t]=0;return new v({Ts:e,Fh:o,Rh:l,Uh:a,Os:n,Bh:t.Bh,Gh:t.Gh,Hh:t.Hh,Mh:null,kh:null,xh:null,Dh:t.Dh,Wh:t.Wh,Yh:f,Vh:c,priority:t.priority,bs:r,Kh:t.Kh,Xh:t.Xh,zh:t.zh,ee:t.ee,ne:t.ne})};static re=(t,i)=>{const s=t.Ts,h=t.Os,e=t.bs,n=new Int32Array(s),r=new Int32Array(s),o=new Int32Array(s);for(let i=0;i<s;i++)n[i]=t.Fh[i],r[i]=t.Rh[i],o[i]=t.Uh[i];let l;if(i)l=t.Yh;else if(l=new Int32Array(h),t.Yh)for(let i=0;i<h;i++)l[i]=t.Yh[i];else for(let t=0;t<h;t++)l[t]=0;return new v({Ts:s,Fh:n,Rh:r,Uh:o,Os:h,Bh:t.Bh,Gh:t.Gh,Hh:t.Hh,Mh:t.Mh,kh:t.kh,xh:t.xh,Dh:t.Dh,Wh:t.Wh,Yh:l,Vh:t.Vh,priority:t.priority,bs:e,Kh:t.Kh,Xh:t.Xh,zh:t.zh,oe:t.oe,le:t.le})};static ae=(t,i)=>{let s=!1,h=!1,e=!1,n=!1,r=0,o=0,l=0,a=-1;for(let c=0;c<i;c++){const i=t[c];i&&(r+=i.Ts,o+=i.Os,l+=i.bs,s||=null!==i.Dh,i.Wh?h=!0:(-1===a&&(a=i.priority),a!==i.priority&&(h=!0)),e||=null!==i.Yh,n||=null!==i.Vh)}const c=new Int32Array(r),f=new Int32Array(r),u=new Int32Array(r),d=new Int32Array(o),w=new Int32Array(o),y=new Int32Array(o),p=new Int32Array(o),A=new Int32Array(o),m=new Int32Array(o),I=new Int32Array(l),E=new Int32Array(l),g=new Int32Array(l);let _=null;s&&(_=new Int32Array(o));let C=null;h&&(C=new Int32Array(o));let T=null;e&&(T=new Int32Array(o));let O=null;n&&(O=new Int32Array(o)),r=0,o=0,l=0;for(let a=0;a<i;a++){const i=t[a];if(i){const t=r;for(let t=0;t<i.Ts;t++)c[r]=i.Fh[t],f[r]=i.Rh[t],u[r]=i.Uh[t],r++;for(let r=0;r<i.Os;r++)d[o]=i.Bh[r]+t,w[o]=i.Gh[r]+t,y[o]=i.Hh[r]+t,i.Mh&&(p[o]=i.Mh[r]),i.kh&&(A[o]=i.kh[r]),i.xh&&(m[o]=i.xh[r]),s&&(i.Dh?_&&(_[o]=i.Dh[r]):_&&(_[o]=0)),h&&(i.Wh?C&&(C[o]=i.Wh[r]):C&&(C[o]=i.priority)),e&&(i.Yh?T&&(T[o]=i.Yh[r]):T&&(T[o]=0)),n&&i.Vh&&O&&(O[o]=i.Vh[r]),o++;for(let s=0;s<i.bs;s++)I[l]=i.Kh[s]+t,E[l]=i.Xh[s]+t,g[l]=i.zh[s]+t,l++}}const b=new v({Ts:r,Fh:c,Rh:f,Uh:u,Os:o,Bh:d,Gh:w,Hh:y,Mh:p,kh:A,xh:m,Dh:_,Wh:C,Yh:T,Vh:O,priority:a,bs:l,Kh:I,Xh:E,zh:g});return b.ce(),b};static fe=(t,i)=>{let s=!1,h=!1,e=!1,n=!1,r=0,o=0,l=0,a=-1;for(let c=0;c<i;c++){const i=t[c];i&&(r+=i.Ts,o+=i.Os,l+=i.bs,s||=null!==i.Dh,i.Wh?h=!0:(-1===a&&(a=i.priority),a!==i.priority&&(h=!0)),e||=null!==i.Yh,n||=null!==i.ne)}const c=new Int32Array(r),f=new Int32Array(r),u=new Int32Array(r),d=new Int32Array(r),w=new Int32Array(o),y=new Int32Array(o),p=new Int32Array(o),A=new Int32Array(l),m=new Int32Array(l),I=new Int32Array(l);let E=null;s&&(E=new Int32Array(o));let g=null;h&&(g=new Int32Array(o));let _=null;e&&(_=new Int32Array(o));let C=null;n&&(C=new Int32Array(o));const T=new Int32Array(o);r=0,o=0,l=0;const O=(t,i,s,h,e,n,r)=>{let o=-1;const l=t.Fh[i],a=t.Rh[i],c=t.Uh[i];for(let t=0;t<r;t++)if(l===s[t]&&a===h[t]&&c===e[t]){o=t;break}return-1===o&&(s[r]=l,h[r]=a,e[r]=c,n&&t.ee&&(n[r]=t.ee[i]),o=r++),{vertex:o,Ts:r}};for(let a=0;a<i;a++){const i=t[a];if(i){for(let t=0;t<i.Os;t++){s&&(i.Dh?E&&(E[o]=i.Dh[t]):E&&(E[o]=0)),h&&(i.Wh?g&&(g[o]=i.Wh[t]):g&&(g[o]=i.priority)),e&&(i.Yh?_&&(_[o]=i.Yh[t]):_&&(_[o]=0)),n&&i.ne&&C&&(C[o]=i.ne[t]),i.Vh&&(T[o]=i.Vh[t]);const l=O(i,i.Bh[t],c,f,u,d,r);r=l.Ts;const a=O(i,i.Gh[t],c,f,u,d,r);r=a.Ts;const A=O(i,i.Hh[t],c,f,u,d,r);r=A.Ts,w[o]=l.vertex,y[o]=a.vertex,p[o]=A.vertex,o++}for(let t=0;t<i.bs;t++){const s=O(i,i.Kh[t],c,f,u,d,r);r=s.Ts;const h=O(i,i.Xh[t],c,f,u,d,r);r=h.Ts;const e=O(i,i.zh[t],c,f,u,d,r);r=e.Ts,A[l]=s.vertex,m[l]=h.vertex,I[l]=e.vertex,l++}}}return new v({Ts:r,Fh:c,Rh:f,Uh:u,Os:o,Bh:w,Gh:y,Hh:p,Mh:null,kh:null,xh:null,Dh:E,Wh:g,Yh:_,Vh:T,priority:a,bs:l,Kh:A,Xh:m,zh:I,ee:d,ne:C})};static model=t=>{if(!v.metadata)throw new Error('cant loading model metadata!!!!!');const i=v.metadata[t];if(!i)throw console.log(`Error model:${t} not found!`),new Error('cant loading model metadata!!!!!');if(!(v.head&&v.Gs&&v.Hs&&v.Ws&&v.Ys&&v.Vs&&v.Ks&&v.Xs&&v.zs&&v.js&&v.Zs&&v.qs&&v.$s&&v.axis))throw new Error('cant loading model!!!!!');const s=i.Ts,h=i.Os,e=i.bs,n=new Int32Array(s),r=new Int32Array(s),o=new Int32Array(s),l=new Int32Array(h),a=new Int32Array(h),c=new Int32Array(h),f=new Int32Array(e),u=new Int32Array(e),d=new Int32Array(e);let w=null;i.Ms>=0&&(w=new Int32Array(s));let y=null;i.Ns>=0&&(y=new Int32Array(h));let p=null,A=0;i.Ps>=0?p=new Int32Array(h):A=-i.Ps-1;let m=null;i.Fs>=0&&(m=new Int32Array(h));let I=null;i.Us>=0&&(I=new Int32Array(h));const E=new Int32Array(h);v.Ks.bt=i.Ls,v.Xs.bt=i.vs,v.zs.bt=i.Ss,v.js.bt=i.Rs,v.Zs.bt=i.Ms;let g,_,C,T=0,O=0,b=0;for(let t=0;t<s;t++){const i=v.Ks.st;g=0,1&i&&(g=v.Xs.Nt),_=0,2&i&&(_=v.zs.Nt),C=0,4&i&&(C=v.js.Nt),n[t]=T+g,r[t]=O+_,o[t]=b+C,T=n[t],O=r[t],b=o[t],w&&(w[t]=v.Zs.st)}v.Gs.bt=i.Ds,v.Hs.bt=i.Ns,v.Ws.bt=i.Ps,v.Ys.bt=i.Fs,v.Vs.bt=i.Us;for(let t=0;t<h;t++)E[t]=v.Gs.Rt,y&&(y[t]=v.Hs.st),p&&(p[t]=v.Ws.st),m&&(m[t]=v.Ys.st),I&&(I[t]=v.Vs.st);v.qs.bt=i.ks,v.$s.bt=i.xs,g=0,_=0,C=0;let L=0;for(let t=0;t<h;t++){const i=v.$s.st;if(1===i)g=v.qs.Nt+L,L=g,_=v.qs.Nt+L,L=_,C=v.qs.Nt+L,L=C;else if(2===i)_=C,C=v.qs.Nt+L,L=C;else if(3===i)g=C,C=v.qs.Nt+L,L=C;else if(4===i){const t=g;g=_,_=t,C=v.qs.Nt+L,L=C}l[t]=g,a[t]=_,c[t]=C}v.axis.bt=6*i.Bs;for(let t=0;t<e;t++)f[t]=v.axis.Rt,u[t]=v.axis.Rt,d[t]=v.axis.Rt;return new v({Ts:s,Fh:n,Rh:r,Uh:o,Os:h,Bh:l,Gh:a,Hh:c,Mh:null,kh:null,xh:null,Dh:y,Wh:p,Yh:m,Vh:E,priority:A,bs:e,Kh:f,Xh:u,zh:d,ee:w,ne:I})};static ue=(t,i)=>{if(!v.metadata||!v.metadata[i])throw new Error('No model metadata');const s=v.metadata[i];if(s.data=t,!s.data.length)throw new Error('No model data');const h=s.Ts,e=s.Os,n=s.bs,r=new Int32Array(h),o=new Int32Array(h),l=new Int32Array(h),c=new Int32Array(e),f=new Int32Array(e),u=new Int32Array(e),d=new Int32Array(n),w=new Int32Array(n),y=new Int32Array(n);let p=null;s.Ms>=0&&(p=new Int32Array(h));let A=null;s.Ns>=0&&(A=new Int32Array(e));let m=null,I=0;s.Ps>=0?m=new Int32Array(e):I=-s.Ps-1;let E=null;s.Fs>=0&&(E=new Int32Array(e));let g=null;s.Us>=0&&(g=new Int32Array(e));const _=new Int32Array(e),C=new a(s.data);C.bt=s.Ls;const T=new a(s.data);T.bt=s.vs;const O=new a(s.data);O.bt=s.Ss;const b=new a(s.data);b.bt=s.Rs;const L=new a(s.data);L.bt=s.Ms;let S,R,M,k=0,x=0,D=0;for(let t=0;t<h;t++){const i=C.st;S=0,1&i&&(S=T.Nt),R=0,2&i&&(R=O.Nt),M=0,4&i&&(M=b.Nt),r[t]=k+S,o[t]=x+R,l[t]=D+M,k=r[t],x=o[t],D=l[t],p&&(p[t]=L.st)}const N=new a(s.data);N.bt=s.Ds;const P=new a(s.data);P.bt=s.Ns;const F=new a(s.data);F.bt=s.Ps;const U=new a(s.data);U.bt=s.Fs;const B=new a(s.data);B.bt=s.Us;for(let t=0;t<e;t++)_[t]=N.Rt,A&&(A[t]=P.st),m&&(m[t]=F.st),E&&(E[t]=U.st),g&&(g[t]=B.st);const G=new a(s.data);G.bt=s.ks;const H=new a(s.data);H.bt=s.xs,S=0,R=0,M=0;let W=0;for(let t=0;t<e;t++){const i=H.st;if(1===i)S=G.Nt+W,W=S,R=G.Nt+W,W=R,M=G.Nt+W,W=M;else if(2===i)R=M,M=G.Nt+W,W=M;else if(3===i)S=M,M=G.Nt+W,W=M;else if(4===i){const t=S;S=R,R=t,M=G.Nt+W,W=M}c[t]=S,f[t]=R,u[t]=M}const Y=new a(s.data);Y.bt=s.Bs;for(let t=0;t<n;t++)d[t]=Y.Rt,w[t]=Y.Rt,y[t]=Y.Rt;return new v({Ts:h,Fh:r,Rh:o,Uh:l,Os:e,Bh:c,Gh:f,Hh:u,Mh:null,kh:null,xh:null,Dh:A,Wh:m,Yh:E,Vh:_,priority:I,bs:n,Kh:d,Xh:w,zh:y,ee:p,ne:g})};Ts;Fh;Rh;Uh;Os;Bh;Gh;Hh;Mh;kh;xh;Dh;Wh;Yh;Vh;priority;bs;Kh;Xh;zh;jh;Zh;qh;$h;Jh;Qh;te;ie;se;ee;ne;oe;le;Nh;Ph;de=0;we=!1;ye=-1;pe=-1;constructor(t){super(),this.Ts=t.Ts,this.Fh=t.Fh,this.Rh=t.Rh,this.Uh=t.Uh,this.Os=t.Os,this.Bh=t.Bh,this.Gh=t.Gh,this.Hh=t.Hh,this.Mh=t.Mh,this.kh=t.kh,this.xh=t.xh,this.Dh=t.Dh,this.Wh=t.Wh,this.Yh=t.Yh,this.Vh=t.Vh,this.priority=t.priority,this.bs=t.bs,this.Kh=t.Kh,this.Xh=t.Xh,this.zh=t.zh,this.jh=t.jh??0,this.Zh=t.Zh??0,this.qh=t.qh??0,this.$h=t.$h??0,this.Jh=t.Jh??0,this.Qh=t.Qh??0,this.te=t.te??0,this.ie=t.ie??0,this.se=t.se??0,this.ee=t.ee??null,this.ne=t.ne??null,this.oe=t.oe??null,this.le=t.le??null,this.Nh=t.Nh??null,this.Ph=t.Ph??null}ce(){this.te=0,this.Jh=0,this.Qh=0;for(let t=0;t<this.Ts;t++){const i=this.Fh[t],s=this.Rh[t],h=this.Uh[t];-s>this.te&&(this.te=-s),s>this.Qh&&(this.Qh=s);const e=i*i+h*h;e>this.Jh&&(this.Jh=e)}this.Jh=Math.sqrt(this.Jh)+.99|0,this.se=Math.sqrt(this.Jh*this.Jh+this.te*this.te)+.99|0,this.ie=this.se+(Math.sqrt(this.Jh*this.Jh+this.Qh*this.Qh)+.99|0)}Ae(){this.te=0,this.Qh=0;for(let t=0;t<this.Ts;t++){const i=this.Rh[t];-i>this.te&&(this.te=-i),i>this.Qh&&(this.Qh=i)}this.se=Math.sqrt(this.Jh*this.Jh+this.te*this.te)+.99|0,this.ie=this.se+(Math.sqrt(this.Jh*this.Jh+this.Qh*this.Qh)+.99|0)}me(){if(this.ee){const t=new Int32Array(256);let i=0;for(let s=0;s<this.Ts;s++){const h=this.ee[s];t[h]++,h>i&&(i=h)}this.oe=new c(i+1,null);for(let s=0;s<=i;s++)this.oe[s]=new Int32Array(t[s]),t[s]=0;let s=0;for(;s<this.Ts;){const i=this.ee[s],h=this.oe[i];h&&(h[t[i]++]=s++)}this.ee=null}if(this.ne){const t=new Int32Array(256);let i=0;for(let s=0;s<this.Os;s++){const h=this.ne[s];t[h]++,h>i&&(i=h)}this.le=new c(i+1,null);for(let s=0;s<=i;s++)this.le[s]=new Int32Array(t[s]),t[s]=0;let s=0;for(;s<this.Os;){const i=this.ne[s],h=this.le[i];h&&(h[t[i]++]=s++)}this.ne=null}}Ie(t,i,s){if(-1!==t)if(s&&-1!==i){const h=m.$t[t],e=m.$t[i],n=h.Qt;v.Ah=0,v.mh=0,v.Ih=0;let r=0,o=s[r++];for(let t=0;t<h.length;t++){if(!h.ti)continue;const i=h.ti[t];for(;i>o;)o=s[r++];n&&n.types&&h.x&&h.y&&h.z&&n.labels&&(i!==o||0===n.types[i])&&this.Ee(h.x[t],h.y[t],h.z[t],n.labels[i],n.types[i])}v.Ah=0,v.mh=0,v.Ih=0,r=0,o=s[r++];for(let t=0;t<e.length;t++){if(!e.ti)continue;const i=e.ti[t];for(;i>o;)o=s[r++];n&&n.types&&e.x&&e.y&&e.z&&n.labels&&(i===o||0===n.types[i])&&this.Ee(e.x[t],e.y[t],e.z[t],n.labels[i],n.types[i])}}else this.ge(t)}ge(t){if(!this.oe||-1===t||!m.$t[t])return;const i=m.$t[t],s=i.Qt;v.Ah=0,v.mh=0,v.Ih=0;for(let t=0;t<i.length;t++){if(!(i.ti&&i.x&&i.y&&i.z&&s&&s.labels&&s.types))continue;const h=i.ti[t];this.Ee(i.x[t],i.y[t],i.z[t],s.labels[h],s.types[h])}}_e(){for(let t=0;t<this.Ts;t++){const i=this.Fh[t];this.Fh[t]=this.Uh[t],this.Uh[t]=-i}}Ce(t){const i=O.sin[t],s=O.cos[t];for(let t=0;t<this.Ts;t++){const h=this.Rh[t]*s-this.Uh[t]*i>>16;this.Uh[t]=this.Rh[t]*i+this.Uh[t]*s>>16,this.Rh[t]=h}}translate(t,i,s){for(let h=0;h<this.Ts;h++)this.Fh[h]+=i,this.Rh[h]+=t,this.Uh[h]+=s}Te(t,i){if(this.Vh)for(let s=0;s<this.Os;s++)this.Vh[s]===t&&(this.Vh[s]=i)}Oe(){for(let t=0;t<this.Ts;t++)this.Uh[t]=-this.Uh[t];for(let t=0;t<this.Os;t++){const i=this.Bh[t];this.Bh[t]=this.Hh[t],this.Hh[t]=i}}scale(t,i,s){for(let h=0;h<this.Ts;h++)this.Fh[h]=this.Fh[h]*t/128|0,this.Rh[h]=this.Rh[h]*i/128|0,this.Uh[h]=this.Uh[h]*s/128|0}be(t,i,s,h,e,n){const r=i*(0|Math.sqrt(s*s+h*h+e*e))>>8;if(this.Mh&&this.kh&&this.xh||(this.Mh=new Int32Array(this.Os),this.kh=new Int32Array(this.Os),this.xh=new Int32Array(this.Os)),!this.Nh){this.Nh=new c(this.Ts,null);for(let t=0;t<this.Ts;t++)this.Nh[t]=new L}for(let i=0;i<this.Os;i++){const n=this.Bh[i],o=this.Gh[i],l=this.Hh[i],a=this.Fh[o]-this.Fh[n],c=this.Rh[o]-this.Rh[n],f=this.Uh[o]-this.Uh[n],u=this.Fh[l]-this.Fh[n],d=this.Rh[l]-this.Rh[n],w=this.Uh[l]-this.Uh[n];let y=c*w-d*f,p=f*u-w*a,A=a*d-u*c;for(;y>8192||p>8192||A>8192||y<-8192||p<-8192||A<-8192;)y>>=1,p>>=1,A>>=1;let m=0|Math.sqrt(y*y+p*p+A*A);if(m<=0&&(m=1),y=256*y/m|0,p=256*p/m|0,A=256*A/m|0,this.Dh&&1&this.Dh[i]){const n=t+((s*y+h*p+e*A)/(r+(r/2|0))|0);this.Vh&&(this.Mh[i]=v.Lh(this.Vh[i],n,this.Dh[i]))}else{let t=this.Nh[n];t&&(t.x+=y,t.y+=p,t.z+=A,t.w++),t=this.Nh[o],t&&(t.x+=y,t.y+=p,t.z+=A,t.w++),t=this.Nh[l],t&&(t.x+=y,t.y+=p,t.z+=A,t.w++)}}if(n)this.Le(t,r,s,h,e);else{this.Ph=new c(this.Ts,null);for(let t=0;t<this.Ts;t++){const i=this.Nh[t],s=new L;i&&(s.x=i.x,s.y=i.y,s.z=i.z,s.w=i.w),this.Ph[t]=s}}n?this.ce():this.ve()}Le(t,i,s,h,e){for(let n=0;n<this.Os;n++){const r=this.Bh[n],o=this.Gh[n],l=this.Hh[n];if(!this.Dh&&this.Vh&&this.Nh&&this.Mh&&this.kh&&this.xh){const a=this.Vh[n],c=this.Nh[r];c&&(this.Mh[n]=v.Lh(a,t+((s*c.x+h*c.y+e*c.z)/(i*c.w)|0),0));const f=this.Nh[o];f&&(this.kh[n]=v.Lh(a,t+((s*f.x+h*f.y+e*f.z)/(i*f.w)|0),0));const u=this.Nh[l];u&&(this.xh[n]=v.Lh(a,t+((s*u.x+h*u.y+e*u.z)/(i*u.w)|0),0))}else if(this.Dh&&!(1&this.Dh[n])&&this.Vh&&this.Nh&&this.Mh&&this.kh&&this.xh){const a=this.Vh[n],c=this.Dh[n],f=this.Nh[r];f&&(this.Mh[n]=v.Lh(a,t+((s*f.x+h*f.y+e*f.z)/(i*f.w)|0),c));const u=this.Nh[o];u&&(this.kh[n]=v.Lh(a,t+((s*u.x+h*u.y+e*u.z)/(i*u.w)|0),c));const d=this.Nh[l];d&&(this.xh[n]=v.Lh(a,t+((s*d.x+h*d.y+e*d.z)/(i*d.w)|0),c))}}if(this.Nh=null,this.Ph=null,this.ee=null,this.ne=null,this.Dh)for(let t=0;t<this.Os;t++)if(!(2&~this.Dh[t]))return;this.Vh=null}Se(t,i,s,h,e,n,r){const o=O.sin[t],l=O.cos[t],a=O.sin[i],c=O.cos[i],f=O.sin[s],u=O.cos[s],d=O.sin[h],w=O.cos[h],y=n*d+r*w>>16;for(let h=0;h<this.Ts;h++){let p,A=this.Fh[h],m=this.Rh[h],I=this.Uh[h];0!==s&&(p=m*f+A*u>>16,m=m*u-A*f>>16,A=p),0!==t&&(p=m*l-I*o>>16,I=m*o+I*l>>16,m=p),0!==i&&(p=I*a+A*c>>16,I=I*c-A*a>>16,A=p),A+=e,m+=n,I+=r,p=m*w-I*d>>16,I=m*d+I*w>>16,m=p,v.th&&v.ih&&v.sh&&(v.sh[h]=I-y,v.th[h]=O.Ki+((A<<9)/I|0),v.ih[h]=O.Xi+((m<<9)/I|0)),this.bs>0&&v.hh&&v.eh&&v.nh&&(v.hh[h]=A,v.eh[h]=m,v.nh[h]=I)}try{this.Re(!1,!1,0)}catch(t){}}draw(t,i,s,h,e,n,r,o,l){const a=o*e-n*h>>16,c=r*i+a*s>>16,f=this.Jh*s>>16,u=c+f;if(u<=50||c>=3500)return;const d=o*h+n*e>>16;let w=d-this.Jh<<9;if((w/u|0)>=C.Ai)return;let y=d+this.Jh<<9;if((y/u|0)<=-C.Ai)return;const p=r*s-a*i>>16,A=this.Jh*i>>16;let m=p+A<<9;if((m/u|0)<=-C.mi)return;let I=p-(A+(this.te*s>>16))<<9;if((I/u|0)>=C.mi)return;let E=c-(f+(this.te*i>>16))<=50,g=!1;if(l>0&&v.Eh){let t=c-f;t<=50&&(t=50),d>0?(w=w/u|0,y=y/t|0):(y=y/u|0,w=w/t|0),p>0?(I=I/u|0,m=m/t|0):(m=m/u|0,I=I/t|0);const i=v.gh-O.Ki,s=v._h-O.Xi;i>w&&i<y&&s>I&&s<m&&(this.we?v.Th[v.Ch++]=l:g=!0)}const _=O.Ki,T=O.Xi;let b=0,L=0;0!==t&&(b=O.sin[t],L=O.cos[t]);for(let l=0;l<this.Ts;l++){let a,f=this.Fh[l],u=this.Rh[l],d=this.Uh[l];0!==t&&(a=d*b+f*L>>16,d=d*L-f*b>>16,f=a),f+=n,u+=r,d+=o,a=d*h+f*e>>16,d=d*e-f*h>>16,f=a,a=u*s-d*i>>16,d=u*i+d*s>>16,u=a,v.sh&&(v.sh[l]=d-c),d>=50&&v.th&&v.ih?(v.th[l]=_+((f<<9)/d|0),v.ih[l]=T+((u<<9)/d|0)):v.th&&(v.th[l]=-5e3,E=!0),(E||this.bs>0)&&v.hh&&v.eh&&v.nh&&(v.hh[l]=f,v.eh[l]=u,v.nh[l]=d)}try{this.Re(E,g,l)}catch(t){}}Re(t,i,s,h=!1){v.Oh&&(this.ye=-1,this.pe=-1);for(let t=0;t<this.ie;t++)v.rh&&(v.rh[t]=0);for(let h=0;h<this.Os;h++)if((!this.Dh||-1!==this.Dh[h])&&v.th&&v.ih&&v.sh&&v.oh&&v.rh){const e=this.Bh[h],n=this.Gh[h],r=this.Hh[h],o=v.th[e],l=v.th[n],a=v.th[r],c=v.ih[e],f=v.ih[n],u=v.ih[r],d=v.sh[e],w=v.sh[n],y=v.sh[r];if(!t||-5e3!==o&&-5e3!==l&&-5e3!==a){i&&this.Me(v.gh,v._h,c,f,u,o,l,a)&&(v.Th[v.Ch++]=s,i=!1);if((o-l)*(u-f)-(c-f)*(a-l)<=0)continue;if(v.Qs&&(v.Qs[h]=!1),v.Js&&(v.Js[h]=o<0||l<0||a<0||o>C.pi||l>C.pi||a>C.pi),v.oh&&v.rh){const t=((d+w+y)/3|0)+this.se;v.oh[t][v.rh[t]++]=h,v.Oh&&this.Me(v.gh,v._h,c,f,u,o,l,a)&&this.pe<t&&(this.ye=h,this.pe=t)}}else if(v.Qs&&(v.Qs[h]=!0),v.oh&&v.rh){const t=((d+w+y)/3|0)+this.se;v.oh[t][v.rh[t]++]=h}}if(!this.Wh&&v.rh){for(let t=this.ie-1;t>=0;t--){const i=v.rh[t];if(!(i<=0)&&v.oh){const s=v.oh[t];for(let t=0;t<i;t++)this.ke(s[t],h)}}return}for(let t=0;t<12;t++)v.lh&&v.dh&&(v.lh[t]=0,v.dh[t]=0);if(v.rh)for(let t=this.ie-1;t>=0;t--){const i=v.rh[t];if(i>0&&v.oh){const s=v.oh[t];for(let h=0;h<i;h++)if(this.Wh&&v.lh&&v.ah){const i=s[h],e=this.Wh[i],n=v.lh[e]++;v.ah[e][n]=i,e<10&&v.dh?v.dh[e]+=t:10===e&&v.fh?v.fh[n]=t:v.uh&&(v.uh[n]=t)}}}let e=0;v.lh&&v.dh&&(v.lh[1]>0||v.lh[2]>0)&&(e=(v.dh[1]+v.dh[2])/(v.lh[1]+v.lh[2])|0);let n=0;v.lh&&v.dh&&(v.lh[3]>0||v.lh[4]>0)&&(n=(v.dh[3]+v.dh[4])/(v.lh[3]+v.lh[4])|0);let r=0;if(v.lh&&v.dh&&(v.lh[6]>0||v.lh[8]>0)&&(r=(v.dh[6]+v.dh[8])/(v.lh[6]+v.lh[8])|0),v.lh&&v.ah){let t,i=0,s=v.lh[10],o=v.ah[10],l=v.fh;i===s&&(i=0,s=v.lh[11],o=v.ah[11],l=v.uh),t=i<s&&l?l[i]:-1e3;for(let a=0;a<10;a++){for(;0===a&&t>e;)try{this.ke(o[i++],h),i===s&&o!==v.ah[11]&&(i=0,s=v.lh[11],o=v.ah[11],l=v.uh),t=i<s&&l?l[i]:-1e3}catch(t){}for(;3===a&&t>n;)try{this.ke(o[i++],h),i===s&&o!==v.ah[11]&&(i=0,s=v.lh[11],o=v.ah[11],l=v.uh),t=i<s&&l?l[i]:-1e3}catch(t){}for(;5===a&&t>r;)try{this.ke(o[i++],h),i===s&&o!==v.ah[11]&&(i=0,s=v.lh[11],o=v.ah[11],l=v.uh),t=i<s&&l?l[i]:-1e3}catch(t){}const c=v.lh[a],f=v.ah[a];for(let t=0;t<c;t++)this.ke(f[t],h)}for(;-1e3!==t;)try{this.ke(o[i++],h),i===s&&o!==v.ah[11]&&(i=0,o=v.ah[11],s=v.lh[11],l=v.uh),t=i<s&&l?l[i]:-1e3}catch(t){}}}ke(t,i=!1){if(v.Qs&&v.Qs[t])return void this.xe(t,i);const s=this.Bh[t],h=this.Gh[t],e=this.Hh[t];let n;if(v.Js&&(O.ji=v.Js[t]),this.Yh?O.alpha=this.Yh[t]:O.alpha=0,n=this.Dh?3&this.Dh[t]:0,i&&v.th&&v.ih&&this.Mh&&this.kh&&this.xh)O.Ti(v.th[s],v.ih[s],v.th[h],v.ih[h],O.palette[this.Mh[t]]),O.Ti(v.th[h],v.ih[h],v.th[e],v.ih[e],O.palette[this.kh[t]]),O.Ti(v.th[e],v.ih[e],v.th[s],v.ih[s],O.palette[this.xh[t]]);else if(0===n&&this.Mh&&this.kh&&this.xh&&v.th&&v.ih)O.ps(v.th[s],v.th[h],v.th[e],v.ih[s],v.ih[h],v.ih[e],this.Mh[t],this.kh[t],this.xh[t]);else if(1===n&&this.Mh&&v.th&&v.ih)O.Is(v.th[s],v.th[h],v.th[e],v.ih[s],v.ih[h],v.ih[e],O.palette[this.Mh[t]]);else if(2===n&&this.Dh&&this.Vh&&this.Mh&&this.kh&&this.xh&&v.th&&v.ih&&v.hh&&v.eh&&v.nh){const i=this.Dh[t]>>2,n=this.Kh[i],r=this.Xh[i],o=this.zh[i];O.gs(v.th[s],v.th[h],v.th[e],v.ih[s],v.ih[h],v.ih[e],this.Mh[t],this.kh[t],this.xh[t],v.hh[n],v.eh[n],v.nh[n],v.hh[r],v.hh[o],v.eh[r],v.eh[o],v.nh[r],v.nh[o],this.Vh[t])}else if(3===n&&this.Dh&&this.Vh&&this.Mh&&v.th&&v.ih&&v.hh&&v.eh&&v.nh){const i=this.Dh[t]>>2,n=this.Kh[i],r=this.Xh[i],o=this.zh[i];O.gs(v.th[s],v.th[h],v.th[e],v.ih[s],v.ih[h],v.ih[e],this.Mh[t],this.Mh[t],this.Mh[t],v.hh[n],v.eh[n],v.nh[n],v.hh[r],v.hh[o],v.eh[r],v.eh[o],v.nh[r],v.nh[o],this.Vh[t])}}xe(t,i=!1){let s=0;if(v.nh){const i=O.Ki,h=O.Xi,e=this.Bh[t],n=this.Gh[t],r=this.Hh[t],o=v.nh[e],l=v.nh[n],a=v.nh[r];if(o>=50&&v.th&&v.ih&&this.Mh)v.wh[s]=v.th[e],v.yh[s]=v.ih[e],v.ph[s++]=this.Mh[t];else if(v.hh&&v.eh&&this.Mh){const c=v.hh[e],f=v.eh[e],u=this.Mh[t];if(a>=50&&this.xh){const e=(50-o)*O.Hi[a-o];v.wh[s]=i+((c+((v.hh[r]-c)*e>>16)<<9)/50|0),v.yh[s]=h+((f+((v.eh[r]-f)*e>>16)<<9)/50|0),v.ph[s++]=u+((this.xh[t]-u)*e>>16)}if(l>=50&&this.kh){const e=(50-o)*O.Hi[l-o];v.wh[s]=i+((c+((v.hh[n]-c)*e>>16)<<9)/50|0),v.yh[s]=h+((f+((v.eh[n]-f)*e>>16)<<9)/50|0),v.ph[s++]=u+((this.kh[t]-u)*e>>16)}}if(l>=50&&v.th&&v.ih&&this.kh)v.wh[s]=v.th[n],v.yh[s]=v.ih[n],v.ph[s++]=this.kh[t];else if(v.hh&&v.eh&&this.kh){const c=v.hh[n],f=v.eh[n],u=this.kh[t];if(o>=50&&this.Mh){const n=(50-l)*O.Hi[o-l];v.wh[s]=i+((c+((v.hh[e]-c)*n>>16)<<9)/50|0),v.yh[s]=h+((f+((v.eh[e]-f)*n>>16)<<9)/50|0),v.ph[s++]=u+((this.Mh[t]-u)*n>>16)}if(a>=50&&this.xh){const e=(50-l)*O.Hi[a-l];v.wh[s]=i+((c+((v.hh[r]-c)*e>>16)<<9)/50|0),v.yh[s]=h+((f+((v.eh[r]-f)*e>>16)<<9)/50|0),v.ph[s++]=u+((this.xh[t]-u)*e>>16)}}if(a>=50&&v.th&&v.ih&&this.xh)v.wh[s]=v.th[r],v.yh[s]=v.ih[r],v.ph[s++]=this.xh[t];else if(v.hh&&v.eh&&this.xh){const c=v.hh[r],f=v.eh[r],u=this.xh[t];if(l>=50&&this.kh){const e=(50-a)*O.Hi[l-a];v.wh[s]=i+((c+((v.hh[n]-c)*e>>16)<<9)/50|0),v.yh[s]=h+((f+((v.eh[n]-f)*e>>16)<<9)/50|0),v.ph[s++]=u+((this.kh[t]-u)*e>>16)}if(o>=50&&this.Mh){const n=(50-a)*O.Hi[o-a];v.wh[s]=i+((c+((v.hh[e]-c)*n>>16)<<9)/50|0),v.yh[s]=h+((f+((v.eh[e]-f)*n>>16)<<9)/50|0),v.ph[s++]=u+((this.Mh[t]-u)*n>>16)}}}const h=v.wh[0],e=v.wh[1],n=v.wh[2],r=v.yh[0],o=v.yh[1],l=v.yh[2];if(!((h-e)*(l-o)-(r-o)*(n-e)<=0))if(O.ji=!1,3===s){let s;if((h<0||e<0||n<0||h>C.pi||e>C.pi||n>C.pi)&&(O.ji=!0),s=this.Dh?3&this.Dh[t]:0,i)O.Ti(h,e,r,o,v.ph[0]),O.Ti(e,n,o,l,v.ph[1]),O.Ti(n,h,l,r,v.ph[2]);else if(0===s)O.ps(h,e,n,r,o,l,v.ph[0],v.ph[1],v.ph[2]);else if(1===s&&this.Mh)O.Is(h,e,n,r,o,l,O.palette[this.Mh[t]]);else if(2===s&&this.Dh&&this.Vh&&v.hh&&v.eh&&v.nh){const i=this.Dh[t]>>2,s=this.Kh[i],a=this.Xh[i],c=this.zh[i];O.gs(h,e,n,r,o,l,v.ph[0],v.ph[1],v.ph[2],v.hh[s],v.eh[s],v.nh[s],v.hh[a],v.hh[c],v.eh[a],v.eh[c],v.nh[a],v.nh[c],this.Vh[t])}else if(3===s&&this.Dh&&this.Vh&&this.Mh&&v.hh&&v.eh&&v.nh){const i=this.Dh[t]>>2,s=this.Kh[i],a=this.Xh[i],c=this.zh[i];O.gs(h,e,n,r,o,l,this.Mh[t],this.Mh[t],this.Mh[t],v.hh[s],v.eh[s],v.nh[s],v.hh[a],v.hh[c],v.eh[a],v.eh[c],v.nh[a],v.nh[c],this.Vh[t])}}else if(4===s){let s;if((h<0||e<0||n<0||h>C.pi||e>C.pi||n>C.pi||v.wh[3]<0||v.wh[3]>C.pi)&&(O.ji=!0),s=this.Dh?3&this.Dh[t]:0,i)O.Ti(h,e,r,o,v.ph[0]),O.Ti(e,n,o,l,v.ph[1]),O.Ti(n,v.wh[3],l,v.yh[3],v.ph[2]),O.Ti(v.wh[3],h,v.yh[3],r,v.ph[3]);else if(0===s)O.ps(h,e,n,r,o,l,v.ph[0],v.ph[1],v.ph[2]),O.ps(h,n,v.wh[3],r,l,v.yh[3],v.ph[0],v.ph[2],v.ph[3]);else if(1===s){if(this.Mh){const i=O.palette[this.Mh[t]];O.Is(h,e,n,r,o,l,i),O.Is(h,n,v.wh[3],r,l,v.yh[3],i)}}else if(2===s&&this.Dh&&this.Vh&&v.hh&&v.eh&&v.nh){const i=this.Dh[t]>>2,s=this.Kh[i],a=this.Xh[i],c=this.zh[i];O.gs(h,e,n,r,o,l,v.ph[0],v.ph[1],v.ph[2],v.hh[s],v.eh[s],v.nh[s],v.hh[a],v.hh[c],v.eh[a],v.eh[c],v.nh[a],v.nh[c],this.Vh[t]),O.gs(h,n,v.wh[3],r,l,v.yh[3],v.ph[0],v.ph[2],v.ph[3],v.hh[s],v.eh[s],v.nh[s],v.hh[a],v.hh[c],v.eh[a],v.eh[c],v.nh[a],v.nh[c],this.Vh[t])}else if(3===s&&this.Dh&&this.Vh&&this.Mh&&v.hh&&v.eh&&v.nh){const i=this.Dh[t]>>2,s=this.Kh[i],a=this.Xh[i],c=this.zh[i];O.gs(h,e,n,r,o,l,this.Mh[t],this.Mh[t],this.Mh[t],v.hh[s],v.eh[s],v.nh[s],v.hh[a],v.hh[c],v.eh[a],v.eh[c],v.nh[a],v.nh[c],this.Vh[t]),O.gs(h,n,v.wh[3],r,l,v.yh[3],this.Mh[t],this.Mh[t],this.Mh[t],v.hh[s],v.eh[s],v.nh[s],v.hh[a],v.hh[c],v.eh[a],v.eh[c],v.nh[a],v.nh[c],this.Vh[t])}}}Ee(t,i,s,h,e){if(!h)return;const n=h.length;if(0===e){let e=0;v.Ah=0,v.mh=0,v.Ih=0;for(let t=0;t<n;t++){if(!this.oe)continue;const i=h[t];if(i<this.oe.length){const t=this.oe[i];if(t)for(let i=0;i<t.length;i++){const s=t[i];v.Ah+=this.Fh[s],v.mh+=this.Rh[s],v.Ih+=this.Uh[s],e++}}}e>0?(v.Ah=(v.Ah/e|0)+t,v.mh=(v.mh/e|0)+i,v.Ih=(v.Ih/e|0)+s):(v.Ah=t,v.mh=i,v.Ih=s)}else if(1===e)for(let e=0;e<n;e++){const n=h[e];if(!this.oe||n>=this.oe.length)continue;const r=this.oe[n];if(r)for(let h=0;h<r.length;h++){const e=r[h];this.Fh[e]+=t,this.Rh[e]+=i,this.Uh[e]+=s}}else if(2===e)for(let e=0;e<n;e++){const n=h[e];if(!this.oe||n>=this.oe.length)continue;const r=this.oe[n];if(r)for(let h=0;h<r.length;h++){const e=r[h];this.Fh[e]-=v.Ah,this.Rh[e]-=v.mh,this.Uh[e]-=v.Ih;const n=8*(255&t),o=8*(255&i),l=8*(255&s);let a,c;if(0!==l){a=O.sin[l],c=O.cos[l];const t=this.Rh[e]*a+this.Fh[e]*c>>16;this.Rh[e]=this.Rh[e]*c-this.Fh[e]*a>>16,this.Fh[e]=t}if(0!==n){a=O.sin[n],c=O.cos[n];const t=this.Rh[e]*c-this.Uh[e]*a>>16;this.Uh[e]=this.Rh[e]*a+this.Uh[e]*c>>16,this.Rh[e]=t}if(0!==o){a=O.sin[o],c=O.cos[o];const t=this.Uh[e]*a+this.Fh[e]*c>>16;this.Uh[e]=this.Uh[e]*c-this.Fh[e]*a>>16,this.Fh[e]=t}this.Fh[e]+=v.Ah,this.Rh[e]+=v.mh,this.Uh[e]+=v.Ih}}else if(3===e)for(let e=0;e<n;e++){const n=h[e];if(!this.oe||n>=this.oe.length)continue;const r=this.oe[n];if(r)for(let h=0;h<r.length;h++){const e=r[h];this.Fh[e]-=v.Ah,this.Rh[e]-=v.mh,this.Uh[e]-=v.Ih,this.Fh[e]=this.Fh[e]*t/128|0,this.Rh[e]=this.Rh[e]*i/128|0,this.Uh[e]=this.Uh[e]*s/128|0,this.Fh[e]+=v.Ah,this.Rh[e]+=v.mh,this.Uh[e]+=v.Ih}}else if(5===e&&this.le&&this.Yh)for(let i=0;i<n;i++){const s=h[i];if(s>=this.le.length)continue;const e=this.le[s];if(e)for(let i=0;i<e.length;i++){const s=e[i];this.Yh[s]+=8*t,this.Yh[s]<0&&(this.Yh[s]=0),this.Yh[s]>255&&(this.Yh[s]=255)}}}ve(){this.te=0,this.Jh=0,this.Qh=0,this.jh=999999,this.Zh=-999999,this.$h=-99999,this.qh=99999;for(let t=0;t<this.Ts;t++){const i=this.Fh[t],s=this.Rh[t],h=this.Uh[t];i<this.jh&&(this.jh=i),i>this.Zh&&(this.Zh=i),h<this.qh&&(this.qh=h),h>this.$h&&(this.$h=h),-s>this.te&&(this.te=-s),s>this.Qh&&(this.Qh=s);const e=i*i+h*h;e>this.Jh&&(this.Jh=e)}this.Jh=0|Math.sqrt(this.Jh),this.se=0|Math.sqrt(this.Jh*this.Jh+this.te*this.te),this.ie=this.se+(0|Math.sqrt(this.Jh*this.Jh+this.Qh*this.Qh))}Me(t,i,s,h,e,n,r,o){return!(i<s&&i<h&&i<e)&&(!(i>s&&i>h&&i>e)&&(!(t<n&&t<r&&t<o)&&(t<=n||t<=r||t<=o)))}De(t){if(!(v.th&&v.ih&&this.Mh&&this.kh&&this.xh))return;const i=this.Bh[t],s=this.Gh[t],h=this.Hh[t];O.Ti(v.th[i],v.ih[i],v.th[s],v.ih[s],O.palette[1e3]),O.Ti(v.th[s],v.ih[s],v.th[h],v.ih[h],O.palette[1e3]),O.Ti(v.th[h],v.ih[h],v.th[i],v.ih[i],O.palette[1e3])}}class S{static Ne=0;static Pe=1;static Fe=2;static Ue=3}class R{static Be=new R(0,S.Ne);static Ge=new R(1,S.Ne);static He=new R(2,S.Ne);static We=new R(3,S.Ne);static Ye=new R(4,S.Pe);static Ve=new R(5,S.Pe);static Ke=new R(6,S.Pe);static Xe=new R(7,S.Pe);static ze=new R(8,S.Pe);static je=new R(9,S.Fe);static Ze=new R(10,S.Fe);static qe=new R(11,S.Fe);static $e=new R(12,S.Fe);static Je=new R(13,S.Fe);static Qe=new R(14,S.Fe);static tn=new R(15,S.Fe);static sn=new R(16,S.Fe);static hn=new R(17,S.Fe);static en=new R(18,S.Fe);static nn=new R(19,S.Fe);static rn=new R(20,S.Fe);static ln=new R(21,S.Fe);static Ue=new R(22,S.Ue);static values(){return[this.Be,this.Ge,this.hn,this.tn,this.He,this.Qe,this.je,this.We,this.Ue,this.$e,this.qe,this.Ke,this.rn,this.Ze,this.Ve,this.Je,this.Xe,this.Ye,this.sn,this.ze,this.nn,this.ln,this.en]}static of(t){const i=this.values();for(let s=0;s<i.length;s++){const h=i[s];if(h.id===t)return h}throw Error('shape not found')}id;an;constructor(t,i){this.id=t,this.an=i}}class M{static cn=0;static fn=1;static un=2;static dn=3}class k extends t{static count=0;static cache=null;static wn=null;static yn=null;static pn=0;static An=new _(500);static mn=new _(30);static Jt=t=>{this.wn=new a(t.read('loc.dat'));const i=new a(t.read('loc.idx'));this.count=i.Rt,this.yn=new Int32Array(this.count);let s=2;for(let t=0;t<this.count;t++)this.yn[t]=s,s+=i.Rt;this.cache=new c(10,null);for(let t=0;t<10;t++)this.cache[t]=new k(-1)};static get=t=>{if(!this.cache||!this.yn||!this.wn)throw new Error('LocType not loaded!!!');for(let i=0;i<10;i++){const s=this.cache[i];if(s&&s.id===t)return s}this.pn=(this.pn+1)%10;const i=this.cache[this.pn];return this.wn.bt=this.yn[t],i.id=t,i.reset(),i.it(this.wn),i.In||(i.In=new Int32Array(1)),-1===i.En&&i.In&&(i.active=i.In.length>0&&i.In[0]===R.Ze.id,i.gn&&(i.active=!0)),i};static ns=()=>{this.An=null,this.mn=null,this.yn=null,this.cache=null,this.wn=null};_n=null;In=null;name=null;Cn=null;Tn=null;On=null;width=1;length=1;bn=!0;Ln=!0;active=!1;En=-1;vn=!1;Sn=!1;Rn=!1;Mn=-1;kn=!1;xn=16;Dn=0;Nn=0;gn=null;Pn=-1;Fn=-1;Un=!1;Bn=!0;Gn=128;Hn=128;Wn=128;Yn=0;Vn=0;Kn=0;Xn=0;zn=!1;decode(t,i){if(1===t){const t=i.st;this._n=new Int32Array(t),this.In=new Int32Array(t);for(let s=0;s<t;s++)this._n[s]=i.Rt,this.In[s]=i.st}else if(2===t)this.name=i.Ft;else if(3===t)this.Cn=i.Ft;else if(14===t)this.width=i.st;else if(15===t)this.length=i.st;else if(17===t)this.bn=!1;else if(18===t)this.Ln=!1;else if(19===t)this.En=i.st,1===this.En&&(this.active=!0);else if(21===t)this.vn=!0;else if(22===t)this.Sn=!0;else if(23===t)this.Rn=!0;else if(24===t)this.Mn=i.Rt,65535===this.Mn&&(this.Mn=-1);else if(25===t)this.kn=!0;else if(28===t)this.xn=i.st;else if(29===t)this.Dn=i.St;else if(39===t)this.Nn=i.St;else if(t>=30&&t<39)this.gn||(this.gn=new c(5,null)),this.gn[t-30]=i.Ft,'hidden'===this.gn[t-30]?.toLowerCase()&&(this.gn[t-30]=null);else if(40===t){const t=i.st;this.Tn=new Uint16Array(t),this.On=new Uint16Array(t);for(let s=0;s<t;s++)this.Tn[s]=i.Rt,this.On[s]=i.Rt}else 60===t?this.Pn=i.Rt:62===t?this.Un=!0:64===t?this.Bn=!1:65===t?this.Gn=i.Rt:66===t?this.Hn=i.Rt:67===t?this.Wn=i.Rt:68===t?this.Fn=i.Rt:69===t?this.Yn=i.st:70===t?this.Vn=i.Mt:71===t?this.Kn=i.Mt:72===t?this.Xn=i.Mt:73===t&&(this.zn=!0)}jn(t,i,s,h,e,n,r){if(!this.In)return null;let o=-1;for(let i=0;i<this.In.length;i++)if(this.In[i]===t){o=i;break}if(-1===o)return null;const l=BigInt(BigInt(this.id)<<6n)+BigInt(BigInt(o)<<3n)+BigInt(i)+BigInt(BigInt(r)+1n<<32n);let a=k.mn?.get(l);if(a){if((this.vn||this.Sn)&&(a=v.Sh(a,this.vn,this.Sn)),this.vn){const t=(s+h+e+n)/4|0;for(let i=0;i<a.Ts;i++){const r=a.Fh[i],o=s+((h-s)*(r+64)/128|0),l=o+((n+((e-n)*(r+64)/128|0)-o)*(a.Uh[i]+64)/128|0);a.Rh[i]+=l-t}a.Ae()}return a}if(!this._n)return null;if(o>=this._n.length)return null;let c=this._n[o];if(-1===c)return null;const f=this.Un!==i>3;f&&(c+=65536);let u=k.An?.get(BigInt(c));u||(u=v.model(65535&c),f&&u.Oe(),k.An?.put(BigInt(c),u));const d=128!==this.Gn||128!==this.Hn||128!==this.Wn,w=0!==this.Vn||0!==this.Kn||0!==this.Xn;let y=v.he(u,!this.Tn,!this.kn,i===M.cn&&-1===r&&!d&&!w);for(-1!==r&&(y.me(),y.ge(r),y.le=null,y.oe=null);i-- >0;)y._e();if(this.Tn&&this.On)for(let t=0;t<this.Tn.length;t++)y.Te(this.Tn[t],this.On[t]);if(d&&y.scale(this.Gn,this.Hn,this.Wn),w&&y.translate(this.Kn,this.Vn,this.Xn),y.be(64+(255&this.Dn),5*(255&this.Nn)+768,-50,-10,-50,!this.Sn),this.bn&&(y.de=y.te),k.mn?.put(l,y),(this.vn||this.Sn)&&(y=v.Sh(y,this.vn,this.Sn)),this.vn){const t=(s+h+e+n)/4|0;for(let i=0;i<y.Ts;i++){const r=y.Fh[i],o=s+((h-s)*(r+64)/128|0),l=o+((n+((e-n)*(r+64)/128|0)-o)*(y.Uh[i]+64)/128|0);y.Rh[i]+=l-t}y.Ae()}return y}reset(){this._n=null,this.In=null,this.name=null,this.Cn=null,this.Tn=null,this.On=null,this.width=1,this.length=1,this.bn=!0,this.Ln=!0,this.active=!1,this.En=-1,this.vn=!1,this.Sn=!1,this.Rn=!1,this.Mn=-1,this.xn=16,this.Dn=0,this.Nn=0,this.gn=null,this.kn=!1,this.Pn=-1,this.Fn=-1,this.Un=!1,this.Bn=!0,this.Gn=128,this.Hn=128,this.Wn=128,this.Yn=0,this.Vn=0,this.Kn=0,this.Xn=0,this.zn=!1}}const x=document.getElementById('canvas'),D=x.getContext('2d',{willReadFrequently:!0}),N=document.createElement('canvas'),P=document.createElement('img'),F=N.getContext('2d',{willReadFrequently:!0});class U extends l{di;width;height;vi;Si;Ri;Mi;constructor(t,i){super(),this.di=new Int32Array(t*i),this.width=this.Ri=t,this.height=this.Mi=i,this.vi=this.Si=0}static Zn=async(t,i)=>{const s=t.read(i+'.dat');if(!s)throw new Error(`${i} jpeg not found!`);const h=await(async t=>{255!==t[0]&&(t[0]=255),URL.revokeObjectURL(P.src),P.src=URL.createObjectURL(new Blob([t],{type:'image/jpeg'})),await new Promise((t=>P.onload=()=>t())),F.clearRect(0,0,N.width,N.height);const i=P.naturalWidth,s=P.naturalHeight;return N.width=i,N.height=s,F.drawImage(P,0,0),F.getImageData(0,0,i,s)})(s),e=new U(h.width,h.height),n=new Uint32Array(h.data.buffer),r=e.di;for(let t=0;t<r.length;t++){const i=n[t];r[t]=(i>>24&255)<<24|(255&i)<<16|(i>>8&255)<<8|i>>16&255}return e};static ki=(t,i,s=0)=>{const h=new a(t.read(i+'.dat')),e=new a(t.read('index.dat'));e.bt=h.Rt;const n=e.Rt,r=e.Rt,o=[],l=e.st-1;for(let t=0;t<l;t++)o[t+1]=e.kt,0===o[t+1]&&(o[t+1]=1);for(let t=0;t<s;t++)e.bt+=2,h.bt+=e.Rt*e.Rt,e.bt+=1;if(h.bt>h.length||e.bt>e.length)throw new Error;const c=e.st,f=e.st,u=e.Rt,d=e.Rt,w=new U(u,d);w.vi=c,w.Si=f,w.Ri=n,w.Mi=r;const y=e.st;if(0===y){const t=w.width*w.height;for(let i=0;i<t;i++)w.di[i]=o[h.st]}else if(1===y){const t=w.width;for(let i=0;i<t;i++){const s=w.height;for(let e=0;e<s;e++)w.di[i+e*t]=o[h.st]}}return w};bind(){C.bind(this.di,this.width,this.height)}draw(t,i){t|=0,i|=0;let s=(t+=this.vi)+(i+=this.Si)*C.wi,h=0,e=this.height,n=this.width,r=C.wi-n,o=0;if(i<C.top){const t=C.top-i;e-=t,i=C.top,h+=t*n,s+=t*C.wi}if(i+e>C.bottom&&(e-=i+e-C.bottom),t<C.left){const i=C.left-t;n-=i,t=C.left,h+=i,s+=i,o+=i,r+=i}if(t+n>C.right){const i=t+n-C.right;n-=i,o+=i,r+=i}n>0&&e>0&&this.qn(n,e,this.di,h,o,C.di,s,r)}$n(t,i,s){i|=0,s|=0;let h=(i+=this.vi)+(s+=this.Si)*C.wi,e=0,n=this.height,r=this.width,o=C.wi-r,l=0;if(s<C.top){const t=C.top-s;n-=t,s=C.top,e+=t*r,h+=t*C.wi}if(s+n>C.bottom&&(n-=s+n-C.bottom),i<C.left){const t=C.left-i;r-=t,i=C.left,e+=t,h+=t,l+=t,o+=t}if(i+r>C.right){const t=i+r-C.right;r-=t,l+=t,o+=t}r>0&&n>0&&this.Jn(r,n,this.di,e,l,C.di,h,o,t)}Qn(t,i){t|=0,i|=0;let s=(t+=this.vi)+(i+=this.Si)*C.wi,h=0,e=this.height,n=this.width,r=C.wi-n,o=0;if(i<C.top){const t=C.top-i;e-=t,i=C.top,h+=t*n,s+=t*C.wi}if(i+e>C.bottom&&(e-=i+e-C.bottom),t<C.left){const i=C.left-t;n-=i,t=C.left,h+=i,s+=i,o+=i,r+=i}if(t+n>C.right){const i=t+n-C.right;n-=i,o+=i,r+=i}n>0&&e>0&&this.tr(n,e,this.di,h,o,C.di,s,r)}Di(){const t=this.di,i=this.width,s=this.height;for(let h=0;h<s;h++){const s=i/2|0;for(let e=0;e<s;e++){const s=e+h*i,n=i-e-1+h*i,r=t[s];t[s]=t[n],t[n]=r}}}Ni(){const t=this.di,i=this.width,s=this.height;for(let h=0;h<(s/2|0);h++)for(let e=0;e<i;e++){const n=e+h*i,r=e+(s-h-1)*i,o=t[n];t[n]=t[r],t[r]=o}}translate(t,i,s){for(let h=0;h<this.di.length;h++){const e=this.di[h];if(0!==e){let n=e>>16&255;n+=t,n<1?n=1:n>255&&(n=255);let r=e>>8&255;r+=i,r<1?r=1:r>255&&(r=255);let o=255&e;o+=s,o<1?o=1:o>255&&(o=255),this.di[h]=(n<<16)+(r<<8)+o}}}Fi(t,i,s,h){t|=0,i|=0,s|=0,h|=0;try{const e=this.width;let n=0,r=0;const o=this.Ri,l=this.Mi,a=(o<<16)/s|0,c=(l<<16)/h|0;t+=(this.vi*s+o-1)/o|0,i+=(this.Si*h+l-1)/l|0,this.vi*s%o!=0&&(n=(o-this.vi*s%o<<16)/s|0),this.Si*h%l!=0&&(r=(l-this.Si*h%l<<16)/h|0),s=s*(this.width-(n>>16))/o|0,h=h*(this.height-(r>>16))/l|0;let f=t+i*C.wi,u=C.wi-s;if(i<C.top){const t=C.top-i;h-=t,i=0,f+=t*C.wi,r+=c*t}if(i+h>C.bottom&&(h-=i+h-C.bottom),t<C.left){const i=C.left-t;s-=i,t=0,f+=i,n+=a*i,u+=i}if(t+s>C.right){const i=t+s-C.right;s-=i,u+=i}this.scale(s,h,this.di,n,r,C.di,u,f,e,a,c)}catch(t){console.error('error in sprite clipping routine')}}ir(t,i,s,h,e,n,r,o,l,a){t|=0,i|=0,s|=0,h|=0;try{const c=-s/2|0,f=-h/2|0,u=65536*Math.sin(l/326.11)|0,d=65536*Math.cos(l/326.11)|0,w=u*a>>8,y=d*a>>8;let p=(r<<16)+f*w+c*y,A=f*y-c*w+(o<<16),m=t+i*C.wi;for(let t=0;t<h;t++){const i=e[t];let s=m+i,h=p+y*i,r=A-w*i;for(let i=-n[t];i<0;i++)C.di[s++]=this.di[(h>>16)+(r>>16)*this.width],h+=y,r-=w;p+=w,A+=y,m+=C.wi}}catch(t){}}sr(t,i,s){t|=0,i|=0;let h=(t+=this.vi)+(i+=this.Si)*C.wi,e=0,n=this.height,r=this.width,o=C.wi-r,l=0;if(i<C.top){const t=C.top-i;n-=t,i=C.top,e+=t*r,h+=t*C.wi}if(i+n>C.bottom&&(n-=i+n-C.bottom),t<C.left){const i=C.left-t;r-=i,t=C.left,e+=i,h+=i,l+=i,o+=i}if(t+r>C.right){const i=t+r-C.right;r-=i,l+=i,o+=i}r>0&&n>0&&this.hr(r,n,this.di,l,e,C.di,h,o,s.di)}scale(t,i,s,h,e,n,r,o,l,a,c){try{const f=h;for(let u=-i;u<0;u++){const i=(e>>16)*l;for(let e=-t;e<0;e++){const t=s[(h>>16)+i];0===t?o++:n[o++]=t,h+=a}e+=c,h=f,o+=r}}catch(t){console.error('error in plot_scale')}}tr(t,i,s,h,e,n,r,o){const l=-(t>>2);t=-(3&t);for(let a=-i;a<0;a++){for(let t=l;t<0;t++)n[r++]=s[h++],n[r++]=s[h++],n[r++]=s[h++],n[r++]=s[h++];for(let i=t;i<0;i++)n[r++]=s[h++];r+=o,h+=e}}Jn(t,i,s,h,e,n,r,o,l){const a=256-l;for(let c=-i;c<0;c++){for(let i=-t;i<0;i++){const t=s[h++];if(0===t)r++;else{const i=n[r];n[r++]=((16711935&t)*l+(16711935&i)*a&4278255360)+((65280&t)*l+(65280&i)*a&16711680)>>8}}r+=o,h+=e}}qn(t,i,s,h,e,n,r,o){const l=-(t>>2);t=-(3&t);for(let a=-i;a<0;a++){for(let t=l;t<0;t++){let t=s[h++];0===t?r++:n[r++]=t,t=s[h++],0===t?r++:n[r++]=t,t=s[h++],0===t?r++:n[r++]=t,t=s[h++],0===t?r++:n[r++]=t}for(let i=t;i<0;i++){const t=s[h++];0===t?r++:n[r++]=t}r+=o,h+=e}}hr(t,i,s,h,e,n,r,o,l){const a=-(t>>2);t=-(3&t);for(let c=-i;c<0;c++){for(let t=a;t<0;t++){let t=s[e++];0!==t&&0===l[r]?n[r++]=t:r++,t=s[e++],0!==t&&0===l[r]?n[r++]=t:r++,t=s[e++],0!==t&&0===l[r]?n[r++]=t:r++,t=s[e++],0!==t&&0===l[r]?n[r++]=t:r++}for(let i=t;i<0;i++){const t=s[e++];0!==t&&0===l[r]?n[r++]=t:r++}r+=o,e+=h}}}class B{static RED=16711680;static GREEN=65280;static BLUE=255;static er=16776960;static nr=65535;static rr=16711935;static lr=16777215;static ar=0;static cr=16748608;static ur=8388608;static dr=128;static wr=16756736;static yr=16740352;static pr=16723968;static Ar=12648192;static mr=8453888;static Ir=4259584;static Er=9179409;static gr=6116423;static _r=2301979;static Cr=5063219;static Tr=7759444;static Or=3353893;static br=8388736;static Lr=13350793;static vr=Int32Array.of(B.er,B.RED,B.GREEN,B.nr,B.rr,B.lr);static Sr=6798;static Rr=107;static Mr=10283;static kr=16;static Dr=4797;static Nr=7744;static Pr=5799;static Fr=4634;static Ur=33697;static Br=22433;static Gr=2983;static Hr=54193;static Wr=8741;static Yr=12;static Vr=64030;static Kr=43162;static Xr=7735;static zr=8404;static jr=1701;static Zr=38430;static qr=24094;static $r=10153;static Jr=56621;static Qr=4783;static io=1341;static so=16578;static ho=35003;static eo=25239;static no=9104;static ro=10275;static oo=7595;static lo=3610;static ao=7975;static co=8526;static fo=918;static uo=38802;static do=24466;static wo=10145;static yo=58654;static po=5027;static Ao=1457;static mo=16565;static Io=34991;static Eo=25486;static _o=4626;static Co=11146;static To=6439;static Oo=12;static bo=4758;static Lo=10270;static vo=4574;static So=4550;static Ro=4537;static Mo=5681;static ko=5673;static xo=5790;static Do=6806;static No=8076}class G extends t{static count=0;static cache=null;static wn=null;static yn=null;static pn=0;static Po=!0;static Fo=new _(50);static Uo=new _(200);static Jt=(t,i)=>{this.Po=i,this.wn=new a(t.read('obj.dat'));const s=new a(t.read('obj.idx'));this.count=s.Rt,this.yn=new Int32Array(this.count);let h=2;for(let t=0;t<this.count;t++)this.yn[t]=h,h+=s.Rt;this.cache=new c(10,null);for(let t=0;t<10;t++)this.cache[t]=new G(-1)};static get=t=>{if(!this.cache||!this.yn||!this.wn)throw new Error('ObjType not loaded!!!');for(let i=0;i<10;i++){const s=this.cache[i];if(s&&s.id===t)return s}this.pn=(this.pn+1)%10;const i=this.cache[this.pn];return this.wn.bt=this.yn[t],i.id=t,i.reset(),i.it(this.wn),-1!==i.Bo&&i.Go(),!this.Po&&i.members&&(i.name='Members Object',i.Cn="Login to a members' server to use this object.",i.gn=null,i.Ho=null),i};static ns=()=>{this.Fo=null,this.Uo=null,this.yn=null,this.cache=null,this.wn=null};static Wo=(t,i)=>{if(G.Uo){let s=G.Uo.get(BigInt(t));if(s&&s.Mi!==i&&-1!==s.Mi&&(s.et(),s=null),s)return s}let s=G.get(t);if(s.Yo||(i=-1),s.Yo&&s.Vo&&i>1){let t=-1;for(let h=0;h<10;h++)i>=s.Vo[h]&&0!==s.Vo[h]&&(t=s.Yo[h]);-1!==t&&(s=G.get(t))}const h=new U(32,32),e=O.Ki,n=O.Xi,r=O.Vi,o=C.di,l=C.wi,a=C.yi,c=C.left,f=C.right,u=C.top,d=C.bottom;O.zi=!1,C.bind(h.di,32,32),C.fillRect(0,0,32,32,B.ar),O.rs();const w=s.Ko(1),y=O.sin[s.Xo]*s.zo>>16,p=O.cos[s.Xo]*s.zo>>16;w.Se(0,s.jo,s.Zo,s.Xo,s.qo,y+(w.te/2|0)+s.$o,p+s.$o);for(let t=31;t>=0;t--)for(let i=31;i>=0;i--)0===h.di[t+32*i]&&(t>0&&h.di[t+32*i-1]>1||i>0&&h.di[t+32*(i-1)]>1||t<31&&h.di[t+32*i+1]>1||i<31&&h.di[t+32*(i+1)]>1)&&(h.di[t+32*i]=1);for(let t=31;t>=0;t--)for(let i=31;i>=0;i--)0===h.di[t+32*i]&&t>0&&i>0&&h.di[t+32*(i-1)-1]>0&&(h.di[t+32*i]=3153952);if(-1!==s.Bo){const t=this.Wo(s.Jo,10),i=t.Ri,h=t.Mi;t.Ri=32,t.Mi=32,t.Fi(5,5,22,22),t.Ri=i,t.Mi=h}return G.Uo?.put(BigInt(t),h),C.bind(o,l,a),C.Ii(c,u,f,d),O.Ki=e,O.Xi=n,O.Vi=r,O.zi=!0,s.Qo?h.Ri=33:h.Ri=32,h.Mi=i,h};model=0;name=null;Cn=null;Tn=null;On=null;zo=2e3;Xo=0;jo=0;Zo=0;qo=0;$o=0;tl=!1;il=-1;Qo=!1;sl=1;members=!1;gn=null;Ho=null;hl=-1;el=-1;nl=0;rl=-1;ol=-1;ll=0;al=-1;cl=-1;fl=-1;ul=-1;dl=-1;wl=-1;Yo=null;Vo=null;Jo=-1;Bo=-1;decode(t,i){if(1===t)this.model=i.Rt;else if(2===t)this.name=i.Ft;else if(3===t)this.Cn=i.Ft;else if(4===t)this.zo=i.Rt;else if(5===t)this.Xo=i.Rt;else if(6===t)this.jo=i.Rt;else if(7===t)this.qo=i.Mt,this.qo>32767&&(this.qo-=65536);else if(8===t)this.$o=i.Mt,this.$o>32767&&(this.$o-=65536);else if(9===t)this.tl=!0;else if(10===t)this.il=i.Rt;else if(11===t)this.Qo=!0;else if(12===t)this.sl=i.xt;else if(16===t)this.members=!0;else if(23===t)this.hl=i.Rt,this.nl=i.St;else if(24===t)this.el=i.Rt;else if(25===t)this.rl=i.Rt,this.ll=i.St;else if(26===t)this.ol=i.Rt;else if(t>=30&&t<35)this.gn||(this.gn=new c(5,null)),this.gn[t-30]=i.Ft,'hidden'===this.gn[t-30]?.toLowerCase()&&(this.gn[t-30]=null);else if(t>=35&&t<40)this.Ho||(this.Ho=new c(5,null)),this.Ho[t-35]=i.Ft;else if(40===t){const t=i.st;this.Tn=new Uint16Array(t),this.On=new Uint16Array(t);for(let s=0;s<t;s++)this.Tn[s]=i.Rt,this.On[s]=i.Rt}else 78===t?this.al=i.Rt:79===t?this.cl=i.Rt:90===t?this.fl=i.Rt:91===t?this.dl=i.Rt:92===t?this.ul=i.Rt:93===t?this.wl=i.Rt:95===t?this.Zo=i.Rt:97===t?this.Jo=i.Rt:98===t?this.Bo=i.Rt:t>=100&&t<110&&(this.Yo&&this.Vo||(this.Yo=new Uint16Array(10),this.Vo=new Uint16Array(10)),this.Yo[t-100]=i.Rt,this.Vo[t-100]=i.Rt)}yl(t){let i=this.hl;if(1===t&&(i=this.rl),-1===i)return null;let s=this.el,h=this.al;1===t&&(s=this.ol,h=this.cl);let e=v.model(i);if(-1!==s){const t=v.model(s);if(-1===h){const i=[e,t];e=v.fe(i,2)}else{const i=[e,t,v.model(h)];e=v.fe(i,3)}}if(0===t&&0!==this.nl&&e.translate(this.nl,0,0),1===t&&0!==this.ll&&e.translate(this.ll,0,0),this.Tn&&this.On)for(let t=0;t<this.Tn.length;t++)e.Te(this.Tn[t],this.On[t]);return e}pl(t){let i=this.fl;if(1===t&&(i=this.dl),-1===i)return null;let s=this.ul;1===t&&(s=this.wl);let h=v.model(i);if(-1!==s){const t=[h,v.model(s)];h=v.fe(t,2)}if(this.Tn&&this.On)for(let t=0;t<this.Tn.length;t++)h.Te(this.Tn[t],this.On[t]);return h}Ko(t){if(this.Yo&&this.Vo&&t>1){let i=-1;for(let s=0;s<10;s++)t>=this.Vo[s]&&0!==this.Vo[s]&&(i=this.Yo[s]);if(-1!==i)return G.get(i).Ko(1)}if(G.Fo){const t=G.Fo.get(BigInt(this.id));if(t)return t}const i=v.model(this.model);if(this.Tn&&this.On)for(let t=0;t<this.Tn.length;t++)i.Te(this.Tn[t],this.On[t]);return i.be(64,768,-50,-10,-50,!0),i.we=!0,G.Fo?.put(BigInt(this.id),i),i}Go(){const t=G.get(this.Bo);this.model=t.model,this.zo=t.zo,this.Xo=t.Xo,this.jo=t.jo,this.Zo=t.Zo,this.qo=t.qo,this.$o=t.$o,this.Tn=t.Tn,this.On=t.On;const i=G.get(this.Jo);this.name=i.name,this.members=i.members,this.sl=i.sl;let s='a';const h=(i.name||'').toLowerCase().charAt(0);'a'!==h&&'e'!==h&&'i'!==h&&'o'!==h&&'u'!==h||(s='an'),this.Cn=`Swap this note at any bank for ${s} ${i.name}.`,this.Qo=!0}reset(){this.model=0,this.name=null,this.Cn=null,this.Tn=null,this.On=null,this.zo=2e3,this.Xo=0,this.jo=0,this.Zo=0,this.qo=0,this.$o=0,this.tl=!1,this.il=-1,this.Qo=!1,this.sl=1,this.members=!1,this.gn=null,this.Ho=null,this.hl=-1,this.el=-1,this.nl=0,this.rl=-1,this.ol=-1,this.ll=0,this.al=-1,this.cl=-1,this.fl=-1,this.ul=-1,this.dl=-1,this.wl=-1,this.Yo=null,this.Vo=null,this.Jo=-1,this.Bo=-1}}class H extends t{static count=0;static cache=null;static wn=null;static yn=null;static pn=0;static Fo=new _(30);static Jt=t=>{this.wn=new a(t.read('npc.dat'));const i=new a(t.read('npc.idx'));this.count=i.Rt,this.yn=new Int32Array(this.count);let s=2;for(let t=0;t<this.count;t++)this.yn[t]=s,s+=i.Rt;this.cache=new c(20,null);for(let t=0;t<20;t++)this.cache[t]=new H(-1)};static get=t=>{if(!this.cache||!this.yn||!this.wn)throw new Error('NpcType not loaded!!!');for(let i=0;i<20;i++){const s=this.cache[i];if(s&&s.id===t)return s}this.pn=(this.pn+1)%20;const i=this.cache[this.pn]=new H(t);return this.wn.bt=this.yn[t],i.it(this.wn),i};static ns=()=>{this.Fo=null,this.yn=null,this.cache=null,this.wn=null};name=null;Cn=null;size=1;_n=null;Al=null;kn=!1;ml=-1;Il=-1;El=-1;gl=-1;_l=-1;Tn=null;On=null;gn=null;Gn=-1;Hn=-1;Wn=-1;Cl=!0;Tl=-1;Ol=128;bl=128;decode(t,i){if(1===t){const t=i.st;this._n=new Uint16Array(t);for(let s=0;s<t;s++)this._n[s]=i.Rt}else if(2===t)this.name=i.Ft;else if(3===t)this.Cn=i.Ft;else if(12===t)this.size=i.St;else if(13===t)this.ml=i.Rt;else if(14===t)this.Il=i.Rt;else if(16===t)this.kn=!0;else if(17===t)this.Il=i.Rt,this.El=i.Rt,this.gl=i.Rt,this._l=i.Rt;else if(t>=30&&t<40)this.gn||(this.gn=new c(5,null)),this.gn[t-30]=i.Ft,'hidden'===this.gn[t-30]?.toLowerCase()&&(this.gn[t-30]=null);else if(40===t){const t=i.st;this.Tn=new Uint16Array(t),this.On=new Uint16Array(t);for(let s=0;s<t;s++)this.Tn[s]=i.Rt,this.On[s]=i.Rt}else if(60===t){const t=i.st;this.Al=new Uint16Array(t);for(let s=0;s<t;s++)this.Al[s]=i.Rt}else 90===t?this.Gn=i.Rt:91===t?this.Hn=i.Rt:92===t?this.Wn=i.Rt:93===t?this.Cl=!1:95===t?this.Tl=i.Rt:97===t?this.Ol=i.Rt:98===t&&(this.bl=i.Rt)}Ll(t,i,s){let h=null,e=null;if(H.Fo&&(e=H.Fo.get(BigInt(this.id)),!e&&this._n)){const t=new c(this._n.length,null);for(let i=0;i<this._n.length;i++)t[i]=v.model(this._n[i]);if(e=1===t.length?t[0]:v.fe(t,t.length),this.Tn&&this.On)for(let t=0;t<this.Tn.length;t++)e?.Te(this.Tn[t],this.On[t]);e?.me(),e?.be(64,850,-30,-50,-30,!0),e&&H.Fo.put(BigInt(this.id),e)}return e?(h=v.re(e,!this.kn),-1!==t&&-1!==i?h.Ie(t,i,s):-1!==t&&h.ge(t),128===this.Ol&&128===this.bl||h.scale(this.Ol,this.bl,this.Ol),h.ce(),h.le=null,h.oe=null,1===this.size&&(h.we=!0),h):null}pl(){if(!this.Al)return null;const t=new c(this.Al.length,null);for(let i=0;i<this.Al.length;i++)t[i]=v.model(this.Al[i]);let i;if(i=1===t.length?t[0]:v.fe(t,t.length),this.Tn&&this.On)for(let t=0;t<this.Tn.length;t++)i?.Te(this.Tn[t],this.On[t]);return i}}class W extends t{static count=0;static $t=[];static Jt=t=>{const i=new a(t.read('idk.dat'));this.count=i.Rt;for(let t=0;t<this.count;t++)this.$t[t]=new W(t).it(i)};type=-1;_n=null;Al=new Int32Array(5).fill(-1);Tn=new Int32Array(6);On=new Int32Array(6);disable=!1;decode(t,i){if(1===t)this.type=i.st;else if(2===t){const t=i.st;this._n=new Int32Array(t);for(let s=0;s<t;s++)this._n[s]=i.Rt}else 3===t?this.disable=!0:t>=40&&t<50?this.Tn[t-40]=i.Rt:t>=50&&t<60?this.On[t-50]=i.Rt:t>=60&&t<70?this.Al[t-60]=i.Rt:console.log('Error unrecognised config code: ',t)}jn(){if(!this._n)return null;const t=new c(this._n.length,null);for(let i=0;i<this._n.length;i++)t[i]=v.model(this._n[i]);let i;i=1===t.length?t[0]:v.fe(t,t.length);for(let t=0;t<6&&0!==this.Tn[t];t++)i?.Te(this.Tn[t],this.On[t]);return i}pl(){let t=0;const i=new c(5,null);for(let s=0;s<5;s++)-1!==this.Al[s]&&(i[t++]=v.model(this.Al[s]));const s=v.fe(i,t);for(let t=0;t<6&&0!==this.Tn[t];t++)s.Te(this.Tn[t],this.On[t]);return s}}class Y extends t{static count=0;static $t=[];static Fo=new _(30);static Jt=t=>{const i=new a(t.read('spotanim.dat'));this.count=i.Rt;for(let t=0;t<this.count;t++)this.$t[t]=new Y(t).it(i)};model=0;Mn=-1;vl=null;kn=!1;Tn=new Uint16Array(6);On=new Uint16Array(6);Ol=128;bl=128;orientation=0;Dn=0;Nn=0;decode(t,i){1===t?this.model=i.Rt:2===t?(this.Mn=i.Rt,I.$t&&(this.vl=I.$t[this.Mn])):3===t?this.kn=!0:4===t?this.Ol=i.Rt:5===t?this.bl=i.Rt:6===t?this.orientation=i.Rt:7===t?this.Dn=i.st:8===t?this.Nn=i.st:t>=40&&t<50?this.Tn[t-40]=i.Rt:t>=50&&t<60?this.On[t-50]=i.Rt:console.log('Error unrecognised spotanim config code: ',t)}jn(){let t=Y.Fo?.get(BigInt(this.id));if(t)return t;t=v.model(this.model);for(let i=0;i<6;i++)0!==this.Tn[0]&&t.Te(this.Tn[i],this.On[i]);return Y.Fo?.put(BigInt(this.id),t),t}}class V extends t{static count=0;static $t=[];static Sl=[];static Rl=0;static Jt=t=>{const i=new a(t.read('varp.dat'));this.count=i.Rt;for(let t=0;t<this.count;t++)this.$t[t]=new V(t).it(i)};scope=0;type=0;Sl=!1;Ml=!0;kl=0;xl=0;Dl=!1;Nl=!1;decode(t,i){1===t?this.scope=i.st:2===t?this.type=i.st:3===t?(this.Sl=!0,V.Sl[V.Rl++]=this.id):4===t?this.Ml=!1:5===t?this.kl=i.Rt:6===t?this.Dl=!0:7===t?this.xl=i.xt:8===t?this.Nl=!0:10===t?this.tt=i.Ft:console.log('Error unrecognised config code: ',t)}}class K{static Pl=['_','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','0','1','2','3','4','5','6','7','8','9'];static Fl=t=>{t=t.trim();let i=0n;for(let s=0;s<t.length&&s<12;s++){const h=t.charCodeAt(s);i*=37n,h>=65&&h<=90?i+=BigInt(h+1-65):h>=97&&h<=122?i+=BigInt(h+1-97):h>=48&&h<=57&&(i+=BigInt(h+27-48))}return i};static Ul=t=>{if(t<0n||t>=6582952005840035281n)return'invalid_name';if(t%37n===0n)return'invalid_name';let i=0;const s=Array(12);for(;0n!==t;){const h=t;t/=37n,s[11-i++]=this.Pl[Number(h-37n*t)]}return s.slice(12-i).join('')};static Bl=t=>{const i=[...t.toLowerCase()];let s=!0;for(let t=0;t<i.length;t++){const h=i[t];s&&h>='a'&&h<='z'&&(i[t]=h.toUpperCase(),s=!1),'.'!==h&&'!'!==h||(s=!0)}return i.join('')};static Gl=t=>{let i='';for(let s=0;s<t.length;s++)i+='*';return i};static Hl=t=>(t>>24&255)+'.'+(t>>16&255)+'.'+(t>>8&255)+'.'+(255&t);static Wl=t=>{if(0===t.length)return t;const i=[...t];for(let t=0;t<i.length;t++)'_'===i[t]&&(i[t]=' ',t+1<i.length&&i[t+1]>='a'&&i[t+1]<='z'&&(i[t+1]=String.fromCharCode(i[t+1].charCodeAt(0)+'A'.charCodeAt(0)-97)));return i[0]>='a'&&i[0]<='z'&&(i[0]=String.fromCharCode(i[0].charCodeAt(0)+'A'.charCodeAt(0)-97)),i.join('')};static Yl=t=>{const i=t.toUpperCase();let s=0n;for(let t=0;t<i.length;t++)s=61n*s+BigInt(i.charCodeAt(t))-32n,s=s+(s>>56n)&0xffffffffffffffn;return s}}class X{static $t=[];static Vl=null;static Fo=null;static Kl=0;static Xl=1;static zl=2;static jl=3;static Zl=4;static ql=5;static $l=6;static Jl=7;static Ql=1;static ta=2;static ia=3;static sa=4;static ha=5;static ea=6;static na=1;static ra=100;static oa=101;static la=200;static aa=201;static ca=202;static fa=203;static ua=205;static da=300;static wa=301;static ya=302;static pa=303;static Aa=304;static ma=305;static Ia=306;static Ea=307;static ga=308;static _a=309;static Ca=310;static Ta=311;static Oa=312;static ba=313;static La=314;static va=315;static Sa=316;static Ra=317;static Ma=318;static ka=319;static xa=320;static Da=321;static Na=322;static Pa=323;static Fa=324;static Ua=325;static Ba=326;static Ga=327;static Ha=401;static Wa=500;static Ya=501;static Va=502;static Ka=503;static Xa=600;static za=601;static ja=602;static Za=603;static qa=604;static $a=605;static Ja=606;static Qa=607;static tc=608;static ic=609;static sc=610;static hc=611;static ec=612;static nc=613;static rc=650;static oc=651;static lc=652;static ac=653;static cc=654;static fc=655;static Jt=(t,i,s)=>{this.Vl=new _(5e4),this.Fo=new _(5e4);const h=new a(t.read('data'));let e=-1;for(h.bt+=2;h.bt<h.length;){let t=h.Rt;65535===t&&(e=h.Rt,t=h.Rt);const n=this.$t[t]=new X;n.id=t,n.an=e,n.type=h.st,n.uc=h.st,n.dc=h.Rt,n.width=h.Rt,n.height=h.Rt,n.wc=h.st,0===n.wc?n.wc=-1:n.wc=(n.wc-1<<8)+h.st;const r=h.st;if(r>0){n.yc=new Uint8Array(r),n.Ac=new Uint16Array(r);for(let t=0;t<r;t++)n.yc[t]=h.st,n.Ac[t]=h.Rt}const o=h.st;if(o>0){n.scripts=new c(o,null);for(let t=0;t<o;t++){const i=h.Rt,s=new Uint16Array(i);n.scripts[t]=s;for(let t=0;t<i;t++)s[t]=h.Rt}}if(n.type===X.Kl){n.scroll=h.Rt,n.hide=1===h.st;const t=h.st;n.mc=new Array(t),n.Ic=new Array(t),n.Ec=new Array(t);for(let i=0;i<t;i++)n.mc[i]=h.Rt,n.Ic[i]=h.Mt,n.Ec[i]=h.Mt}if(n.type===X.Xl&&(h.bt+=3),n.type===X.zl){n.gc=new Int32Array(n.width*n.height),n._c=new Int32Array(n.width*n.height),n.draggable=1===h.st,n.Cc=1===h.st,n.Tc=1===h.st,n.Oc=h.st,n.bc=h.st,n.Lc=new Int16Array(20),n.vc=new Int16Array(20),n.Sc=new c(20,null);for(let t=0;t<20;t++)if(1===h.st){n.Lc[t]=h.Mt,n.vc[t]=h.Mt;const s=h.Ft;if(s.length>0){const h=s.lastIndexOf(',');n.Sc[t]=this.Rc(i,s.substring(0,h),parseInt(s.substring(h+1),10))}}n.Mc=new c(5,null);for(let t=0;t<5;t++){const i=h.Ft;n.Mc[t]=i,0===i.length&&(n.Mc[t]=null)}}if(n.type===X.jl&&(n.fill=1===h.st),n.type===X.Zl||n.type===X.Xl){n.kc=1===h.st;const t=h.st;s&&(n.font=s[t]),n.xc=1===h.st}if(n.type===X.Zl&&(n.text=h.Ft,n.Dc=h.Ft),n.type!==X.Xl&&n.type!==X.jl&&n.type!==X.Zl||(n.Nc=h.xt),n.type!==X.jl&&n.type!==X.Zl||(n.Pc=h.xt,n.Fc=h.xt),n.type===X.ql){const t=h.Ft;if(t.length>0){const s=t.lastIndexOf(',');n.Uc=this.Rc(i,t.substring(0,s),parseInt(t.substring(s+1),10))}const s=h.Ft;if(s.length>0){const t=s.lastIndexOf(',');n.Bc=this.Rc(i,s.substring(0,t),parseInt(s.substring(t+1),10))}}if(n.type===X.$l){const t=h.st;0!==t&&(n.model=this.jn((t-1<<8)+h.st));const i=h.st;0!==i&&(n.Gc=this.jn((i-1<<8)+h.st)),n.Mn=h.st,0===n.Mn?n.Mn=-1:n.Mn=(n.Mn-1<<8)+h.st,n.Hc=h.st,0===n.Hc?n.Hc=-1:n.Hc=(n.Hc-1<<8)+h.st,n.zoom=h.Rt,n.Wc=h.Rt,n.Yc=h.Rt}if(n.type===X.Jl){n.gc=new Int32Array(n.width*n.height),n._c=new Int32Array(n.width*n.height),n.kc=1===h.st;const t=h.st;s&&(n.font=s[t]),n.xc=1===h.st,n.Nc=h.xt,n.Oc=h.Mt,n.bc=h.Mt,n.Cc=1===h.st,n.Mc=new c(5,null);for(let t=0;t<5;t++){const i=h.Ft;n.Mc[t]=i,0===i.length&&(n.Mc[t]=null)}}n.uc!==X.ta&&n.type!==X.zl||(n.Vc=h.Ft,n.action=h.Ft,n.Kc=h.Rt),n.uc!==X.Ql&&n.uc!==X.sa&&n.uc!==X.ha&&n.uc!==X.ea||(n.Xc=h.Ft,0===n.Xc.length&&(n.uc===X.Ql?n.Xc='Ok':n.uc===X.sa||n.uc===X.ha?n.Xc='Select':n.uc===X.ea&&(n.Xc='Continue')))}this.Vl=null,this.Fo=null};static Rc=(t,i,s)=>{const h=K.Yl(i)<<8n|BigInt(s);if(this.Vl){const t=this.Vl.get(h);if(t)return t}let e;try{e=U.ki(t,i,s),this.Vl?.put(h,e)}catch(t){return null}return e};static jn=t=>{if(this.Fo){const i=this.Fo.get(BigInt(t));if(i)return i}const i=v.model(t);return this.Fo?.put(BigInt(t),i),i};id=-1;an=-1;type=-1;uc=-1;dc=0;width=0;height=0;wc=-1;yc=null;Ac=null;scripts=null;scroll=0;hide=!1;draggable=!1;Cc=!1;Tc=!1;Oc=0;bc=0;Lc=null;vc=null;Sc=null;Mc=null;fill=!1;kc=!1;font=null;xc=!1;text=null;Dc=null;Nc=0;Pc=0;Fc=0;Uc=null;Bc=null;model=null;Gc=null;Mn=-1;Hc=-1;zoom=0;Wc=0;Yc=0;Vc=null;action=null;Kc=-1;Xc=null;mc=null;Ic=null;Ec=null;x=0;y=0;zc=0;gc=null;_c=null;jc=0;Zc=0;jn(t,i,s){let h=this.model;if(s&&(h=this.Gc),!h)return null;if(-1===t&&-1===i&&!h.Vh)return h;const e=v.he(h,!0,!0,!1);return-1===t&&-1===i||e.me(),-1!==t&&e.ge(t),-1!==i&&e.ge(i),e.be(64,768,-50,-10,-50,!0),e}qc(){if(this.an===this.id)return this.x;let t=X.$t[this.an];if(!t.mc||!t.Ic||!t.Ec)return this.x;let i=t.mc.indexOf(this.id);if(-1===i)return this.x;let s=t.Ic[i];for(;t.an!==t.id;){const h=X.$t[t.an];h.mc&&h.Ic&&h.Ec&&(i=h.mc.indexOf(t.id),-1!==i&&(s+=h.Ic[i])),t=h}return s}$c(){if(this.an===this.id)return this.y;let t=X.$t[this.an];if(!t.mc||!t.Ic||!t.Ec)return this.y;let i=t.mc.indexOf(this.id);if(-1===i)return this.y;let s=t.Ec[i];for(;t.an!==t.id;){const h=X.$t[t.an];h.mc&&h.Ic&&h.Ec&&(i=h.mc.indexOf(t.id),-1!==i&&(s+=h.Ec[i])),t=h}return s}outline(t){const i=this.qc(),s=this.$c();C.gi(i,s,this.width,this.height,t)}move(t,i){if(this.an===this.id)return;this.x=0,this.y=0;const s=X.$t[this.an];if(s.mc&&s.Ic&&s.Ec){const h=s.mc.indexOf(this.id);-1!==h&&(s.Ic[h]=t,s.Ec[h]=i)}}delete(){if(this.an===this.id)return;const t=X.$t[this.an];if(t.mc&&t.Ic&&t.Ec){const i=t.mc.indexOf(this.id);-1!==i&&(t.mc.splice(i,1),t.Ic.splice(i,1),t.Ec.splice(i,1))}}}class z{Jc;width;height;Qc;tf;di;constructor(t,i,s=D){this.Qc=s,this.Jc=this.Qc.getImageData(0,0,t,i),this.tf=new Uint32Array(this.Jc.data.buffer),this.di=new Int32Array(t*i),this.width=t,this.height=i,this.bind()}clear(){this.di.fill(0)}bind(){C.bind(this.di,this.width,this.height)}draw(t,i){this.#t(),this.Qc.putImageData(this.Jc,t,i)}#t(){const t=this.di.length,i=this.di,s=this.tf;for(let h=0;h<t;h++){const t=i[h];s[h]=t>>16&255|(t>>8&255)<<8|(255&t)<<16|4278190080}}}class j{seed;constructor(t){this.seed=(0x5deece66dn^t)&(1n<<48n)-1n}if(t){this.seed=(0x5deece66dn^t)&(1n<<48n)-1n}Gt(){return this.next(32)}next(t){return this.seed=0x5deece66dn*this.seed+0xbn&(1n<<48n)-1n,Number(this.seed)>>>48-t}}class Z extends l{static sf='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!"$%^&*()-_=+[{]};:\'@#~,<.>/?\\| ';static hf=[];static{const t=navigator.userAgent.includes('Capacitor');for(let i=0;i<256;i++){let s=Z.sf.indexOf(String.fromCharCode(i));t&&s>=63&&s--,-1===s&&(s=74),Z.hf[i]=s}}ef=[];nf=new Int32Array(94);rf=new Int32Array(94);lf=new Int32Array(94);af=new Int32Array(94);cf=new Int32Array(95);ff=new Int32Array(256);random=new j(BigInt(Date.now()));height=0;static ki=(t,i)=>{const s=new a(t.read(i+'.dat')),h=new a(t.read('index.dat'));h.bt=s.Rt+4;const e=h.st;e>0&&(h.bt+=3*(e-1));const n=new Z;for(let t=0;t<94;t++){n.lf[t]=h.st,n.af[t]=h.st;const i=n.nf[t]=h.Rt,e=n.rf[t]=h.Rt,r=h.st,o=i*e;if(n.ef[t]=new Int8Array(o),0===r)for(let h=0;h<i*e;h++)n.ef[t][h]=s.St;else if(1===r)for(let h=0;h<i;h++)for(let r=0;r<e;r++)n.ef[t][h+r*i]=s.St;e>n.height&&(n.height=e),n.lf[t]=1,n.cf[t]=i+2;{let s=0;for(let h=e/7|0;h<e;h++)s+=n.ef[t][h*i];s<=(e/7|0)&&(n.cf[t]--,n.lf[t]=0)}{let s=0;for(let h=e/7|0;h<e;h++)s+=n.ef[t][i+h*i-1];s<=(e/7|0)&&n.cf[t]--}}n.cf[94]=n.cf[8];for(let t=0;t<256;t++)n.ff[t]=n.cf[Z.hf[t]];return n};uf(t,i,s,h){if(!s)return;t|=0,i|=0;const e=s.length;i-=this.height;for(let n=0;n<e;n++){const e=Z.hf[s.charCodeAt(n)];94!==e&&this.df(this.ef[e],t+this.lf[e],i+this.af[e],this.nf[e],this.rf[e],h),t+=this.cf[e]}}wf(t,i,s,h,e){t|=0,i|=0;const n=s.length;i-=this.height;for(let r=0;r<n;r++)if('@'===s.charAt(r)&&r+4<n&&'@'===s.charAt(r+4))h=this.yf(s.substring(r+1,r+4)),r+=4;else{const n=Z.hf[s.charCodeAt(r)];94!==n&&(e&&this.df(this.ef[n],t+this.lf[n]+1,i+this.af[n]+1,this.nf[n],this.rf[n],B.ar),this.df(this.ef[n],t+this.lf[n],i+this.af[n],this.nf[n],this.rf[n],h)),t+=this.cf[n]}}pf(t){if(!t)return 0;const i=t.length;let s=0;for(let h=0;h<i;h++)'@'===t.charAt(h)&&h+4<i&&'@'===t.charAt(h+4)?h+=4:s+=this.ff[t.charCodeAt(h)];return s}Af(t,i,s,h,e){t|=0,i|=0,this.wf(t-this.pf(s)/2,i,s,h,e)}mf(t,i,s,h){s&&(t|=0,i|=0,this.uf(t-this.pf(s)/2,i,s,h))}If(t,i,s,h,e,n){t|=0,i|=0,this.random.if(BigInt(n));const r=192+(31&this.random.Gt()),o=i-this.height;for(let i=0;i<s.length;i++)if('@'===s.charAt(i)&&i+4<s.length&&'@'===s.charAt(i+4))h=this.yf(s.substring(i+1,i+4)),i+=4;else{const n=Z.hf[s.charCodeAt(i)];94!==n&&(e&&this.Ef(t+this.lf[n]+1,o+this.af[n]+1,this.nf[n],this.rf[n],B.ar,192,this.ef[n]),this.Ef(t+this.lf[n],o+this.af[n],this.nf[n],this.rf[n],h,r,this.ef[n])),t+=this.cf[n],3&this.random.Gt()||t++}}gf(t,i,s,h,e=!0){t|=0,i|=0,e&&this.uf(t-this.pf(s)+1,i+1,s,B.ar),this.uf(t-this.pf(s),i,s,h)}_f(t,i,s,h,e){if(!s)return;t|=0,i|=0,t-=this.pf(s)/2|0;const n=i-this.height;for(let i=0;i<s.length;i++){const r=Z.hf[s.charCodeAt(i)];94!=r&&this.df(this.ef[r],t+this.lf[r],n+this.af[r]+(5*Math.sin(i/2+e/5)|0),this.nf[r],this.rf[r],h),t+=this.cf[r]}}df(t,i,s,h,e,n){h|=0,e|=0;let r=(i|=0)+(s|=0)*C.wi,o=C.wi-h,l=0,a=0;if(s<C.top){const t=C.top-s;e-=t,s=C.top,a+=t*h,r+=t*C.wi}if(s+e>=C.bottom&&(e-=s+e+1-C.bottom),i<C.left){const t=C.left-i;h-=t,i=C.left,a+=t,r+=t,l+=t,o+=t}if(i+h>=C.right){const t=i+h+1-C.right;h-=t,l+=t,o+=t}h>0&&e>0&&this.Cf(h,e,t,a,l,C.di,r,o,n)}Ef(t,i,s,h,e,n,r){s|=0,h|=0;let o=(t|=0)+(i|=0)*C.wi,l=C.wi-s,a=0,c=0;if(i<C.top){const t=C.top-i;h-=t,i=C.top,c+=t*s,o+=t*C.wi}if(i+h>=C.bottom&&(h-=i+h+1-C.bottom),t<C.left){const i=C.left-t;s-=i,t=C.left,c+=i,o+=i,a+=i,l+=i}if(t+s>=C.right){const i=t+s+1-C.right;s-=i,a+=i,l+=i}s>0&&h>0&&this.Tf(s,h,C.di,o,l,r,c,a,e,n)}Cf(t,i,s,h,e,n,r,o,l){const a=-((t|=0)>>2);t=-(3&t);for(let c=-(i|=0);c<0;c++){for(let t=a;t<0;t++)0===s[h++]?r++:n[r++]=l,0===s[h++]?r++:n[r++]=l,0===s[h++]?r++:n[r++]=l,0===s[h++]?r++:n[r++]=l;for(let i=t;i<0;i++)0===s[h++]?r++:n[r++]=l;r+=o,h+=e}}Tf(t,i,s,h,e,n,r,o,l,a){t|=0;const c=((16711935&l)*a&4278255360)+((65280&l)*a&16711680)>>8,f=256-a;for(let l=-(i|=0);l<0;l++){for(let i=-t;i<0;i++)if(0===n[r++])h++;else{const t=s[h];s[h++]=(((16711935&t)*f&4278255360)+((65280&t)*f&16711680)>>8)+c}h+=e,r+=o}}yf(t){return'red'===t?B.RED:'gre'===t?B.GREEN:'blu'===t?B.BLUE:'yel'===t?B.er:'cya'===t?B.nr:'mag'===t?B.rr:'whi'===t?B.lr:'bla'===t?B.ar:'lre'===t?B.cr:'dre'===t?B.ur:'dbl'===t?B.dr:'or1'===t?B.wr:'or2'===t?B.yr:'or3'===t?B.pr:'gr1'===t?B.Ar:'gr2'===t?B.mr:'gr3'===t?B.Ir:B.ar}split(t,i){if(0===t.length)return[t];const s=[];for(;t.length>0;){if(this.pf(t)<=i&&-1===t.indexOf('|')){s.push(t);break}let h=t.length;for(let s=0;s<t.length;s++)if(' '===t[s]){if(this.pf(t.substring(0,s))>i)break;h=s}else if('|'===t[s]){h=s;break}s.push(t.substring(0,h)),t=t.substring(h+1)}return s}}class q{Of;bf;Lf;closed=!1;vf=!1;static Sf=async t=>await new Promise(((i,s)=>{const h=t.host.startsWith('https'),e=h?'wss':'ws',n=t.host.substring(t.host.indexOf('//')+2),r=h?t.port+2:t.port+1,o=new WebSocket(`${e}://${n}:${r}`,'binary');o.addEventListener('open',(()=>{console.log('connection open!'),i(o)})),o.addEventListener('error',(()=>{console.log('connection error!'),s(o)}))}));constructor(t){t.onclose=this.onclose,t.onerror=this.onerror,this.bf=new Q(t,5e3),this.Lf=new $(t,5e3),this.Of=t}get host(){return this.Of.url.split('/')[2]}get port(){return parseInt(this.Of.url.split(':')[2],10)}get available(){return this.closed?0:this.bf.available}write(t,i){this.Lf.write(t,i)}async read(){return this.closed?0:this.bf.Rf()??await this.bf.Mf()}async kf(t,i,s){if(!this.closed)for(;s>0;){const h=this.bf.xf(t,i,s)??await this.bf.Df(t,i,s);if(h.length<=0)throw new Error('EOF');i+=h.length,s-=h.length}}close(){this.closed=!0,this.Of.close(),this.bf.close(),this.Lf.close(),console.log('connection close!'),this.vf&&console.log('connection error!')}onclose=t=>{this.closed||this.close()};onerror=t=>{this.closed||(this.vf=!0,this.close())}}class ${Of;Nf;closed=!1;vf=!1;constructor(t,i){this.Of=t,this.Nf=i}write(t,i){if(!this.closed){if(this.vf)throw this.vf=!1,new Error('Error in writer thread');if(i>this.Nf||t.length>this.Nf)throw new Error('buffer overflow');try{this.Of.send(t.subarray(0,i))}catch(t){this.vf=!0}}}close(){this.closed=!0}}class J extends r{jt;position;constructor(t){super(),this.jt=t,this.position=0}get available(){return this.jt.length-this.position}get read(){return this.jt[this.position++]}get Pf(){return this.jt.length}}class Q{Nf;queue=new o;event=null;Ff=null;total=0;closed=!1;constructor(t,i){this.Nf=i,t.binaryType='arraybuffer',t.onmessage=this.onmessage}get available(){return this.total}onmessage=t=>{if(this.closed)throw new Error('WebSocketReader is closed!');const i=new J(new Uint8Array(t.data));if(this.event?this.queue.rt(i):this.event=i,this.total+=i.Pf,this.Ff&&(this.Ff(this.event),this.Ff=null,this.total>this.Nf))throw new Error('buffer overflow')};Uf(){return this.event&&this.event.available>0?this.event.read:null}async Bf(t){for(this.event=this.queue.lt();this.total<t;)await Promise.race([new Promise((t=>this.Ff=t)),i(2e3).then((()=>{if(this.closed)throw new Error('WebSocketReader closed while reading.')}))]);return this.event?this.event.read:this.Bf(t)}xf(t,i,s){if(this.closed)throw new Error('WebSocketReader is closed!');if(!(this.event&&this.event.available>=s))return null;for(;s>0;){const h=this.Uf();if(null===h)throw new Error('EOF - tried to read a fast byte when there was not enough immediate bytes.');t[i++]=h,this.total--,s--}return t}async Df(t,i,s){if(this.closed)throw new Error('WebSocketReader is closed!');for(;s>0;)t[i++]=this.Uf()??await this.Bf(s),this.total--,s--;return t}Rf(){if(this.closed)throw new Error('WebSocketReader is closed!');const t=this.Uf();return null===t?null:(this.total--,t)}async Mf(){if(this.closed)throw new Error('WebSocketReader is closed!');const t=await this.Bf(1);return this.total--,t}close(){this.closed=!0,this.Ff=null,this.total=0,this.event=null,this.queue.clear()}}class tt{static Gf=[95,218,67,50,253,222,194,60,101,128,8,251,92,111,24,33,223,66,232,59,227,113,153,105,126,98,167,102,177,238,62,190,147,23,150,151,156,144,193,155,81,0,198,22,137,210,179,16,168,170,32,181,248,141,58,87,208,106,180,191,221,241,40,176,196,154,65,145,230,78,30,161,188,41,14,129,18,199,47,247,225,34,51,10,159,75,12,56,61,31,39,91,46,242,134,5,122,123,209,228,104,195,21,3,11,44,107,172,6,186,110,215,205,103,27,185,124,77,252,117,86,115,127,207,52,79,43,97,219,116,169,7,118,162,108,36,20,233,88,135,80,19,42,237,57,152,71,9,250,17,4,119,234,130,26,200,189,163,254,245,197,171,220,235,140,244,184,94,211,231,99,246,121,212,112,204,63,148,83,178,1,255,131,13,183,142,236,45,55,35,243,136,37,85,100,160,38,224,146,174,82,48,109,132,125,90,143,138,240,173,165,164,192,175,29,74,28,114,213,73,64,206,76,139,96,2,229,15,93,25,239,202,49,70,214,201,72,203,68,89,69,157,216,217,249,120,226,84,149,187,54,53,158,166,182,133,0];static Hf=[0,-2,4,6,-1,0,0,2,0,0,0,0,5,4,2,2,0,0,0,0,2,-2,2,14,0,6,3,0,4,0,0,0,3,0,0,0,0,0,0,0,0,-1,4,2,6,0,6,0,0,3,7,0,0,0,-1,0,0,0,0,4,0,0,0,0,0,0,0,0,1,15,0,0,0,0,6,0,2,0,0,0,2,0,0,0,1,0,0,4,0,0,0,0,0,0,0,0,0,0,-2,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,-2,0,0,2,0,0,0,2,9,0,0,0,0,0,4,0,0,0,3,7,9,0,0,0,0,0,0,0,0,0,-2,0,0,0,0,3,2,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,-2,2,0,0,0,0,0,6,0,0,0,2,0,2,0,0,0,-2,0,0,4,0,0,0,0,6,0,0,-2,-2,0,0,0,0,0,0,-2,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0]}class it{count=0;Wf=new Int32Array(256);Yf=new Int32Array(256);a=0;b=0;c=0;constructor(t){for(let i=0;i<t.length;i++)this.Wf[i]=t[i];this.init()}get Gt(){return 0==this.count--&&(this.Vf(),this.count=255),this.Wf[this.count]}init(){let t=2654435769,i=2654435769,s=2654435769,h=2654435769,e=2654435769,n=2654435769,r=2654435769,o=2654435769;for(let l=0;l<4;l++)t^=i<<11,h+=t,i+=s,i^=s>>>2,e+=i,s+=h,s^=h<<8,n+=s,h+=e,h^=e>>>16,r+=h,e+=n,e^=n<<10,o+=e,n+=r,n^=r>>>4,t+=n,r+=o,r^=o<<8,i+=r,o+=t,o^=t>>>9,s+=o,t+=i;for(let l=0;l<256;l+=8)t+=this.Wf[l],i+=this.Wf[l+1],s+=this.Wf[l+2],h+=this.Wf[l+3],e+=this.Wf[l+4],n+=this.Wf[l+5],r+=this.Wf[l+6],o+=this.Wf[l+7],t^=i<<11,h+=t,i+=s,i^=s>>>2,e+=i,s+=h,s^=h<<8,n+=s,h+=e,h^=e>>>16,r+=h,e+=n,e^=n<<10,o+=e,n+=r,n^=r>>>4,t+=n,r+=o,r^=o<<8,i+=r,o+=t,o^=t>>>9,s+=o,t+=i,this.Yf[l]=t,this.Yf[l+1]=i,this.Yf[l+2]=s,this.Yf[l+3]=h,this.Yf[l+4]=e,this.Yf[l+5]=n,this.Yf[l+6]=r,this.Yf[l+7]=o;for(let l=0;l<256;l+=8)t+=this.Yf[l],i+=this.Yf[l+1],s+=this.Yf[l+2],h+=this.Yf[l+3],e+=this.Yf[l+4],n+=this.Yf[l+5],r+=this.Yf[l+6],o+=this.Yf[l+7],t^=i<<11,h+=t,i+=s,i^=s>>>2,e+=i,s+=h,s^=h<<8,n+=s,h+=e,h^=e>>>16,r+=h,e+=n,e^=n<<10,o+=e,n+=r,n^=r>>>4,t+=n,r+=o,r^=o<<8,i+=r,o+=t,o^=t>>>9,s+=o,t+=i,this.Yf[l]=t,this.Yf[l+1]=i,this.Yf[l+2]=s,this.Yf[l+3]=h,this.Yf[l+4]=e,this.Yf[l+5]=n,this.Yf[l+6]=r,this.Yf[l+7]=o;this.Vf(),this.count=256}Vf(){this.c++,this.b+=this.c;for(let t=0;t<256;t++){const i=this.Yf[t],s=3&t;let h;0===s?this.a^=this.a<<13:1===s?this.a^=this.a>>>6:2===s?this.a^=this.a<<2:3===s&&(this.a^=this.a>>>16),this.a+=this.Yf[t+128&255],this.Yf[t]=h=this.Yf[i>>>2&255]+this.a+this.b,this.Wf[t]=this.b=this.Yf[h>>>8>>>2&255]+i}}}class st{db;constructor(t){t.onerror=this.onerror,t.onclose=this.onclose,this.db=t}static openDatabase=async()=>await new Promise(((t,i)=>{const s=indexedDB.open('lostcity',1);s.onsuccess=i=>{const s=i.target;console.log('database success!'),t(s.result)},s.onupgradeneeded=t=>{t.target.result.createObjectStore('cache')},s.onerror=t=>{const s=t.target;console.error('database error!: ',s.error),i(s.result)}}));Kf=async t=>await new Promise((i=>{const s=this.db.transaction('cache','readonly').objectStore('cache').get(t);s.onsuccess=()=>{i(s.result)},s.onerror=t=>{i(void 0)}}));Xf=async(t,i)=>await new Promise(((s,h)=>{const e=this.db.transaction('cache','readwrite').objectStore('cache').put(i,t);e.onsuccess=()=>{s()},e.onerror=t=>{h()}}));onclose=t=>{console.log('database close!')};onerror=t=>{console.log('database error!')};zf=t=>{const i=t.trim();let s=0;for(let t=0;t<i.length&&t<12;t++){const h=i.charAt(t);s*=37,h>='A'&&h<='Z'?s+=h.charCodeAt(0)+1-65:h>='a'&&h<='z'?s+=h.charCodeAt(0)+1-97:h>='0'&&h<='9'&&(s+=h.charCodeAt(0)+27-48)}return s}}class ht{static jf=14;static Zf=28;static qf=129;static $f=167;static Jf=168;static Qf=195;static tu=2;static iu=26;static su=46;static hu=84;static eu=87;static nu=103;static ru=146;static ou=197;static lu=201;static au=204;static cu=209;static fu=126;static uu=185;static du=15;static wu=98;static yu=213;static pu=74;static Au=13;static mu=3;static Iu=239;static Eu=1;static gu=184;static _u=133;static Cu=226;static Tu=4;static Ou=21;static bu=32;static Lu=41;static vu=152;static Su=19;static Ru=22;static Mu=25;static ku=43;static xu=44;static Du=68;static Nu=136;static Pu=139;static Fu=140;static Uu=142;static Bu=243;static Gu=254;static Hu=20;static Wu=80;static Yu=132;static Vu=220;static Ku=237;static Xu=150;static zu=175;static ju=193;static Zu=12;static qu=54;static $u=212;static Ju=7;static Qu=135;static td=162;static sd=23;static hd=42;static ed=49;static nd=50;static rd=59;static od=69;static ld=76;static ad=151;static fd=191;static ud=223}class et{static dd=150;static wd=108;static yd=70;static pd=81;static Ad=189;static md=7;static Id=88;static Ed=30;static gd=176;static _d=220;static Cd=66;static Td=17;static Od=2;static bd=238;static Ld=233;static vd=146;static Sd=215;static Rd=236;static Md=85;static kd=219;static xd=140;static Dd=40;static Nd=200;static Pd=178;static Fd=247;static Ud=138;static Bd=239;static Gd=194;static Hd=8;static Wd=27;static Yd=113;static Vd=100;static Kd=134;static Xd=202;static zd=245;static jd=172;static Zd=96;static qd=97;static $d=116;static Jd=9;static Qd=75;static tw=164;static iw=53;static sw=185;static hw=206;static ew=177;static nw=248;static rw=195;static ow=71;static lw=133;static aw=157;static cw=211;static fw=48;static uw=130;static dw=31;static ww=59;static yw=212;static pw=38;static Aw=6;static mw=155;static Iw=235;static Ew=231;static gw=237;static _w=175;static Cw=93;static Tw=190;static Ow=165;static bw=159;static Lw=171;static Sw=79;static Rw=52;static Mw=244;static Lu=148;static kw=11;static xw=118;static Dw=4;static Nw=158;static Pw=181}class nt{static Fw=new Uint16Array(['d','o','t'].join('').split('').map((t=>t.charCodeAt(0))));static Uw=new Uint16Array(['(','a',')'].join('').split('').map((t=>t.charCodeAt(0))));static Bw=new Uint16Array(['s','l','a','s','h'].join('').split('').map((t=>t.charCodeAt(0))));static Gw=['cook',"cook's",'cooks','seeks','sheet'];static Hw=[];static Ww=[];static Yw=[];static Vw=[];static Kw=[];static Xw=[];static Jt=t=>{const i=new a(t.read('fragmentsenc.txt')),s=new a(t.read('badenc.txt')),h=new a(t.read('domainenc.txt')),e=new a(t.read('tldlist.txt'));this.read(s,h,i,e)};static filter=t=>{const i=[...t];this.format(i);const s=i.join('').trim(),h=s.toLowerCase(),e=[...h];this.zw(e),this.jw(e),this.Zw(e),this.qw(e);for(let t=0;t<this.Gw.length;t++){let i=-1;for(;-1!==(i=h.indexOf(this.Gw[t],i+1));){const s=[...this.Gw[t]];for(let t=0;t<s.length;t++)e[t+i]=s[t]}}return this.$w(e,[...s]),this.Jw(e),e.join('').trim()};static read=(t,i,s,h)=>{this.Qw(t),this.ty(i),this.iy(s),this.sy(h)};static sy=t=>{const i=t.xt;for(let s=0;s<i;s++)this.Ww[s]=t.st,this.Hw[s]=new Uint16Array(t.st).map((()=>t.st))};static Qw=t=>{const i=t.xt;for(let s=0;s<i;s++){this.Yw[s]=new Uint16Array(t.st).map((()=>t.st));const i=new Array(t.st).fill([]).map((()=>[t.St,t.St]));i.length>0&&(this.Vw[s]=i)}};static ty=t=>{const i=t.xt;for(let s=0;s<i;s++)this.Kw[s]=new Uint16Array(t.st).map((()=>t.st))};static iy=t=>{const i=t.xt;for(let s=0;s<i;s++)this.Xw[s]=t.Rt};static zw=t=>{const i=[...t],s=[...t];this.hy(null,i,this.Fw),this.hy(null,s,this.Bw);for(let h=0;h<this.Hw.length;h++)this.ey(s,this.Ww[h],t,this.Hw[h],i)};static jw=t=>{for(let i=0;i<2;i++)for(let i=this.Yw.length-1;i>=0;i--)this.hy(this.Vw[i],t,this.Yw[i])};static Zw=t=>{const i=[...t],s=[...t];this.hy(null,i,this.Uw),this.hy(null,s,this.Fw);for(let h=this.Kw.length-1;h>=0;h--)this.ny(s,i,this.Kw[h],t)};static qw=t=>{for(let i=0;i<t.length;){const s=this.oy(t,i);if(-1===s)return;let h=!1;for(let e=i;e>=0&&e<s&&!h;e++)this.ly(t[e])||this.uy(t[e])||(h=!0);let e=0;h&&(e=0),0===e&&(e=1,i=s);let n=0;for(let h=s;h<t.length&&h<i;h++)n=10*n+t[h].charCodeAt(0)-48;n<=255&&i-s<=8?e++:e=0,4===e&&(this.wy(s,i,t),e=0),i=this.yy(i,t)}};static py=t=>{if(this.Ay(t))return!0;const i=this.my(t),s=this.Xw,h=s.length;if(i===s[0]||i===s[h-1])return!0;let e=0,n=h-1;for(;e<=n;){const t=(e+n)/2|0;if(i===s[t])return!0;i<s[t]?n=t-1:e=t+1}return!1};static my=t=>{if(t.length>6)return 0;let i=0;for(let s=0;s<t.length;s++){const h=t[t.length-s-1];if(this.Iy(h))i=38*i+h.charCodeAt(0)+1-'a'.charCodeAt(0);else if("'"===h)i=38*i+27;else if(this.Ey(h))i=38*i+h.charCodeAt(0)+28-'0'.charCodeAt(0);else if('\0'!==h)return 0}return i};static oy=(t,i)=>{for(let s=i;s<t.length&&s>=0;s++)if(this.Ey(t[s]))return s;return-1};static yy=(t,i)=>{for(let s=t;s<i.length&&s>=0;s++)if(!this.Ey(i[s]))return s;return i.length};static gy=(t,i,s)=>i===s||'o'===i&&'0'===s?1:'o'===i&&'('===s&&')'===t?2:'c'!==i||'('!==s&&'<'!==s&&'['!==s?'e'===i&&''===s||'s'===i&&'$'===s||'l'===i&&'i'===s?1:0:1;static ny=(t,i,s,h)=>{const e=s.length,n=h.length;for(let r=0;r<=n-e;r++){const{_y:e,Cy:n}=this.Ty(r,s,h);if(!e)continue;const o=this.Oy(r,h,3,i,['@']),l=this.by(n-1,h,3,t,['.',',']);(o>2||l>2)&&this.wy(r,n,h)}};static Ty=(t,i,s)=>{const h=i.length;let e=t,n=0;for(;e<s.length&&n<h;){const r=s[e],o=e+1<s.length?s[e+1]:'\0',l=this.gy(o,String.fromCharCode(i[n]),r);if(l>0)e+=l,n++;else{if(0===n)break;const s=this.gy(o,String.fromCharCode(i[n-1]),r);if(s>0)e+=s,1===n&&t++;else{if(n>=h||!this.ly(r))break;e++}}}return{_y:n>=h,Cy:e}};static hy=(t,i,s)=>{if(!(s.length>i.length))for(let h=0;h<=i.length-s.length;h++){let e=h;const{Cy:n,Ly:r,vy:o,Sy:l,Ry:a}=this.My(i,s,e);e=n;let c=i[e],f=e+1<i.length?i[e+1]:'\0';if(!(r>=s.length)||l&&a)continue;let u,d=!0;if(o){let t=!1,s=!1;if((h-1<0||this.ly(i[h-1])&&"'"!==i[h-1])&&(t=!0),(e>=i.length||this.ly(i[e])&&"'"!==i[e])&&(s=!0),!t||!s){let s=!1;for(u=h-2,t&&(u=h);!s&&u<e;){if(u>=0&&(!this.ly(i[u])||"'"===i[u])){const t=[];let h;for(h=0;h<3&&u+h<i.length&&(!this.ly(i[u+h])||"'"===i[u+h]);h++)t[h]=i[u+h];let e=!0;0===h&&(e=!1),h<3&&u-1>=0&&(!this.ly(i[u-1])||"'"===i[u-1])&&(e=!1),e&&!this.py(t)&&(s=!0)}u++}s||(d=!1)}}else{c=' ',h-1>=0&&(c=i[h-1]),f=' ',e<i.length&&(f=i[e]);const s=this.ky(c),n=this.ky(f);t&&this.xy(s,t,n)&&(d=!1)}if(!d)continue;let w=0,y=0;for(let t=h;t<e;t++)this.Ey(i[t])?w++:this.Dy(i[t])&&y++;w<=y&&this.wy(h,e,i)}};static My=(t,i,s)=>{let h=s,e=0,n=0,r=!1,o=!1,l=!1;for(;h<t.length&&(!o||!l)&&!(h>=t.length||o&&l);){const a=t[h],c=h+1<t.length?t[h+1]:'\0';let f;if(e<i.length&&(f=this.Ny(c,String.fromCharCode(i[e]),a))>0)1===f&&this.Ey(a)&&(o=!0),2===f&&(this.Ey(a)||this.Ey(c))&&(o=!0),h+=f,e++;else{if(0===e)break;let t;if((t=this.Ny(c,String.fromCharCode(i[e-1]),a))>0)h+=t;else{if(e>=i.length||!this.uy(a))break;if(this.ly(a)&&"'"!==a&&(r=!0),this.Ey(a)&&(l=!0),h++,n++,(100*n/(h-s)|0)>90)break}}}return{Cy:h,Ly:e,vy:r,Sy:o,Ry:l}};static Ny=(t,i,s)=>{if(i===s)return 1;if(i>='a'&&i<='m'){if('a'===i)return'4'!==s&&'@'!==s&&'^'!==s?'/'===s&&'\\'===t?2:0:1;if('b'===i)return'6'!==s&&'8'!==s?'1'===s&&'3'===t?2:0:1;if('c'===i)return'('!==s&&'<'!==s&&'{'!==s&&'['!==s?0:1;if('d'===i)return'['===s&&')'===t?2:0;if('e'===i)return'3'!==s&&''!==s?0:1;if('f'===i)return'p'===s&&'h'===t?2:''===s?1:0;if('g'===i)return'9'!==s&&'6'!==s?0:1;if('h'===i)return'#'===s?1:0;if('i'===i)return'y'!==s&&'l'!==s&&'j'!==s&&'1'!==s&&'!'!==s&&':'!==s&&';'!==s&&'|'!==s?0:1;if('j'===i)return 0;if('k'===i)return 0;if('l'===i)return'1'!==s&&'|'!==s&&'i'!==s?0:1;if('m'===i)return 0}if(i>='n'&&i<='z'){if('n'===i)return 0;if('o'===i)return'0'!==s&&'*'!==s?'('===s&&')'===t||'['===s&&']'===t||'{'===s&&'}'===t||'<'===s&&'>'===t?2:0:1;if('p'===i)return 0;if('q'===i)return 0;if('r'===i)return 0;if('s'===i)return'5'!==s&&'z'!==s&&'$'!==s&&'2'!==s?0:1;if('t'===i)return'7'!==s&&'+'!==s?0:1;if('u'===i)return'v'===s?1:'\\'===s&&'/'===t||'\\'===s&&'|'===t||'|'===s&&'/'===t?2:0;if('v'===i)return'\\'===s&&'/'===t||'\\'===s&&'|'===t||'|'===s&&'/'===t?2:0;if('w'===i)return'v'===s&&'v'===t?2:0;if('x'===i)return')'===s&&'('===t||'}'===s&&'{'===t||']'===s&&'['===t||'>'===s&&'<'===t?2:0;if('y'===i)return 0;if('z'===i)return 0}return i>='0'&&i<='9'?'0'===i?'o'===s||'O'===s?1:'('===s&&')'===t||'{'===s&&'}'===t||'['===s&&']'===t?2:0:'1'===i&&'l'===s?1:0:','===i?'.'===s?1:0:'.'===i?','===s?1:0:'!'===i&&'i'===s?1:0};static xy=(t,i,s)=>{let h=0,e=i.length-1;for(;h<=e;){const n=(h+e)/2|0;if(i[n][0]===t&&i[n][1]===s)return!0;t<i[n][0]||t===i[n][0]&&s<i[n][1]?e=n-1:h=n+1}return!1};static ky=t=>this.Iy(t)?t.charCodeAt(0)+1-'a'.charCodeAt(0):"'"===t?28:this.Ey(t)?t.charCodeAt(0)+29-'0'.charCodeAt(0):27;static ey=(t,i,s,h,e)=>{if(!(h.length>s.length))for(let n=0;n<=s.length-h.length;n++){const{Cy:r,Py:o}=this.Fy(s,h,n);if(o<h.length)continue;let l=!1;const a=this.Oy(n,s,3,e,[',','.']),c=this.by(r-1,s,5,t,['\\','/']);if(1===i&&a>0&&c>0&&(l=!0),2===i&&(a>2&&c>0||a>0&&c>2)&&(l=!0),3===i&&a>0&&c>2&&(l=!0),!l)continue;let f,u=n,d=r-1,w=!1;if(a>2){if(4===a)for(w=!1,f=n-1;f>=0;f--)if(w){if('*'!==e[f])break;u=f}else'*'===e[f]&&(u=f,w=!0);for(w=!1,f=u-1;f>=0;f--)if(w){if(this.ly(s[f]))break;u=f}else this.ly(s[f])||(w=!0,u=f)}if(c>2){if(4===c)for(w=!1,f=d+1;f<s.length;f++)if(w){if('*'!==t[f])break;d=f}else'*'===t[f]&&(d=f,w=!0);for(w=!1,f=d+1;f<s.length;f++)if(w){if(this.ly(s[f]))break;d=f}else this.ly(s[f])||(w=!0,d=f)}this.wy(u,d+1,s)}};static Fy=(t,i,s)=>{let h=0;for(;s<t.length&&h<i.length;){const e=t[s],n=s+1<t.length?t[s+1]:'\0';let r;if((r=this.gy(n,String.fromCharCode(i[h]),e))>0)s+=r,h++;else{if(0===h)break;let t;if((t=this.gy(n,String.fromCharCode(i[h-1]),e))>0)s+=t;else{if(!this.ly(e))break;s++}}}return{Cy:s,Py:h}};static ly=t=>!this.Dy(t)&&!this.Ey(t);static uy=t=>!this.Iy(t)||('v'===t||'x'===t||'j'===t||'q'===t||'z'===t);static Dy=t=>this.Iy(t)||this.Uy(t);static Ey=t=>t>='0'&&t<='9';static Iy=t=>t>='a'&&t<='z';static Uy=t=>t>='A'&&t<='Z';static Ay=t=>{for(let i=0;i<t.length;i++)if(!this.Ey(t[i])&&'\0'!==t[i])return!1;return!0};static wy=(t,i,s)=>{for(let h=t;h<i;h++)s[h]='*'};static By=(t,i)=>{let s=0;for(let h=i-1;h>=0&&this.ly(t[h]);h--)'*'===t[h]&&s++;return s};static Gy=(t,i)=>{let s=0;for(let h=i+1;h<t.length&&this.ly(t[h]);h++)'*'===t[h]&&s++;return s};static Hy=(t,i,s,h,e)=>(e?this.By(i,s):this.Gy(i,s))>=h?4:this.ly(e?t[s-1]:t[s+1])?1:0;static Oy=(t,i,s,h,e)=>{if(0===t)return 2;for(let s=t-1;s>=0&&this.ly(i[s]);s--)if(e.includes(i[s]))return 3;return this.Hy(i,h,t,s,!0)};static by=(t,i,s,h,e)=>{if(t+1===i.length)return 2;for(let s=t+1;s<i.length&&this.ly(i[s]);s++)if(e.includes(i[s]))return 3;return this.Hy(i,h,t,s,!1)};static format=t=>{let i=0;for(let s=0;s<t.length;s++)this.Wy(t[s])?t[i]=t[s]:t[i]=' ',0!==i&&' '===t[i]&&' '===t[i-1]||i++;for(let s=i;s<t.length;s++)t[s]=' '};static Wy=t=>t>=' '&&t<=''||' '===t||'\n'===t||'\t'===t||''===t||''===t;static $w=(t,i)=>{for(let s=0;s<i.length;s++)'*'!==t[s]&&this.Uy(i[s])&&(t[s]=i[s])};static Jw=t=>{let i=!0;for(let s=0;s<t.length;s++){const h=t[s];this.Dy(h)?i?this.Iy(h)&&(i=!1):this.Uy(h)&&(t[s]=String.fromCharCode(h.charCodeAt(0)+'a'.charCodeAt(0)-65)):i=!0}}}class rt{static Yy=[' ','e','t','a','o','i','h','n','s','r','d','l','u','m','w','c','y','f','g','p','b','v','k','x','j','q','z','0','1','2','3','4','5','6','7','8','9',' ','!','?','.',',',':',';','(',')','-','&','*','\\','\'','@','#','+','=','','$','%','"','[',']'];static Vy=[];static Jt=(t,i)=>{let s,h=0,e=-1;for(let n=0;n<i&&h<100;n++){const i=t.st;s=i>>4&15,-1!==e?(this.Vy[h++]=this.Yy[(e<<4)+s-195],e=-1):s<13?this.Vy[h++]=this.Yy[s]:e=s,s=15&i,-1!==e?(this.Vy[h++]=this.Yy[(e<<4)+s-195],e=-1):s<13?this.Vy[h++]=this.Yy[s]:e=s}let n=!0;for(let t=0;t<h;t++){const i=this.Vy[t];n&&i>='a'&&i<='z'&&(this.Vy[t]=i.toUpperCase(),n=!1),'.'!==i&&'!'!==i||(n=!0)}return this.Vy.slice(0,h).join('')};static Ky=(t,i)=>{i.length>80&&(i=i.substring(0,80)),i=i.toLowerCase();let s=-1;for(let h=0;h<i.length;h++){const e=i.charAt(h);let n=0;for(let t=0;t<this.Yy.length;t++)if(e===this.Yy[t]){n=t;break}n>12&&(n+=195),-1===s?n<13?s=n:t.p1(n):n<13?(t.p1((s<<4)+n),s=-1):(t.p1((s<<4)+(n>>4)),s=15&n)}-1!==s&&t.p1(s<<4)}}class ot{start=0;end=0;form=0;length=0;Xy=null;zy=null;threshold=0;position=0;delta=0;amplitude=0;jy=0;read(t){this.form=t.st,this.start=t.xt,this.end=t.xt,this.length=t.st,this.Xy=new Int32Array(this.length),this.zy=new Int32Array(this.length);for(let i=0;i<this.length;i++)this.Xy[i]=t.Rt,this.zy[i]=t.Rt}reset(){this.threshold=0,this.position=0,this.delta=0,this.amplitude=0,this.jy=0}evaluate(t){return this.jy>=this.threshold&&this.zy&&this.Xy&&(this.amplitude=this.zy[this.position++]<<15,this.position>=this.length&&(this.position=this.length-1),this.threshold=this.Xy[this.position]/65536*t|0,this.threshold>this.jy&&(this.delta=((this.zy[this.position]<<15)-this.amplitude)/(this.threshold-this.jy)|0)),this.amplitude+=this.delta,this.jy++,this.amplitude-this.delta>>15}}class lt{static buffer=null;static Zy=null;static sin=null;static qy=new Int32Array(5);static $y=new Int32Array(5);static Jy=new Int32Array(5);static Qy=new Int32Array(5);static tp=new Int32Array(5);ip=null;sp=null;hp=null;ep=null;np=null;rp=null;release=null;attack=null;op=new Int32Array(5);lp=new Int32Array(5);ap=new Int32Array(5);start=0;length=500;cp=100;fp=0;static init=()=>{this.Zy=new Int32Array(32768);for(let t=0;t<32768;t++)Math.random()>.5?this.Zy[t]=1:this.Zy[t]=-1;this.sin=new Int32Array(32768);for(let t=0;t<32768;t++)this.sin[t]=16384*Math.sin(t/5215.1903)|0;this.buffer=new Int32Array(220500)};up(t,i){for(let i=0;i<t;i++)lt.buffer[i]=0;if(i<10)return lt.buffer;const s=t/i|0;this.ip?.reset(),this.sp?.reset();let h=0,e=0,n=0;this.hp&&this.ep&&(this.hp.reset(),this.ep.reset(),h=32.768*(this.hp.end-this.hp.start)/s|0,e=32.768*this.hp.start/s|0);let r=0,o=0,l=0;this.np&&this.rp&&(this.np.reset(),this.rp.reset(),r=32.768*(this.np.end-this.np.start)/s|0,o=32.768*this.np.start/s|0);for(let t=0;t<5;t++)this.ip&&0!==this.op[t]&&(lt.qy[t]=0,lt.$y[t]=this.ap[t]*s,lt.Jy[t]=(this.op[t]<<14)/100|0,lt.Qy[t]=32.768*(this.ip.end-this.ip.start)*Math.pow(1.0057929410678534,this.lp[t])/s|0,lt.tp[t]=32.768*this.ip.start/s|0);if(this.ip&&this.sp)for(let i=0;i<t;i++){let s=this.ip.evaluate(t),a=this.sp.evaluate(t);if(this.hp&&this.ep){const i=this.hp.evaluate(t),r=this.ep.evaluate(t);s+=this.dp(r,n,this.hp.form)>>1,n+=(i*h>>16)+e}if(this.np&&this.rp){const i=this.np.evaluate(t),s=this.rp.evaluate(t);a=a*(32768+(this.dp(s,l,this.np.form)>>1))>>15,l+=(i*r>>16)+o}for(let h=0;h<5;h++)if(0!==this.op[h]){const e=i+lt.$y[h];e<t&&(lt.buffer[e]+=this.dp(a*lt.Jy[h]>>15,lt.qy[h],this.ip.form),lt.qy[h]+=(s*lt.Qy[h]>>16)+lt.tp[h])}}if(this.release&&this.attack){this.release.reset(),this.attack.reset();let i=0,s=!0;for(let h=0;h<t;h++){const e=this.release.evaluate(t),n=this.attack.evaluate(t);let r;r=s?this.release.start+((this.release.end-this.release.start)*e>>8):this.release.start+((this.release.end-this.release.start)*n>>8),i+=256,i>=r&&(i=0,s=!s),s&&(lt.buffer[h]=0)}}if(this.fp>0&&this.cp>0){const i=this.fp*s;for(let s=i;s<t;s++)lt.buffer[s]+=lt.buffer[s-i]*this.cp/100|0,lt.buffer[s]|=0}for(let i=0;i<t;i++)lt.buffer[i]<-32768&&(lt.buffer[i]=-32768),lt.buffer[i]>32767&&(lt.buffer[i]=32767);return lt.buffer}dp(t,i,s){return 1===s?(32767&i)<16384?t:-t:2===s?lt.sin[32767&i]*t>>14:3===s?((32767&i)*t>>14)-t:4===s?lt.Zy[i/2607&32767]*t:0}read(t){this.ip=new ot,this.ip.read(t),this.sp=new ot,this.sp.read(t),0!==t.st&&(t.bt--,this.hp=new ot,this.hp.read(t),this.ep=new ot,this.ep.read(t)),0!==t.st&&(t.bt--,this.np=new ot,this.np.read(t),this.rp=new ot,this.rp.read(t)),0!==t.st&&(t.bt--,this.release=new ot,this.release.read(t),this.attack=new ot,this.attack.read(t));for(let i=0;i<10;i++){const s=t.Pt;if(0===s)break;this.op[i]=s,this.lp[i]=t.Nt,this.ap[i]=t.Pt}this.fp=t.Pt,this.cp=t.Pt,this.length=t.Rt,this.start=t.Rt}}class at{static wp=new Int32Array(1e3);static yp=null;static pp=null;static Ap=new c(1e3,null);mp=new c(10,null);Ip=0;loopEnd=0;static Jt=t=>{const i=new a(t.read('sounds.dat'));for(this.yp=new Uint8Array(441e3),this.pp=new a(this.yp),lt.init();;){const t=i.Rt;if(65535===t)break;const s=new at;s.read(i),this.Ap[t]=s,this.wp[t]=s.trim()}};static up=(t,i)=>{if(!this.Ap[t])return null;const s=this.Ap[t];return s?.Ep(i)??null};read(t){for(let i=0;i<10;i++)0!==t.st&&(t.bt--,this.mp[i]=new lt,this.mp[i]?.read(t));this.Ip=t.Rt,this.loopEnd=t.Rt}trim(){let t=9999999;for(let i=0;i<10;i++)this.mp[i]&&(this.mp[i].start/20|0)<t&&(t=this.mp[i].start/20|0);if(this.Ip<this.loopEnd&&(this.Ip/20|0)<t&&(t=this.Ip/20|0),9999999===t||0===t)return 0;for(let i=0;i<10;i++)this.mp[i]&&(this.mp[i].start-=20*t);return this.Ip<this.loopEnd&&(this.Ip-=20*t,this.loopEnd-=20*t),t}Ep(t){const i=this.up(t);return at.pp.bt=0,at.pp?.p4(1380533830),at.pp?.Wt(i+36),at.pp?.p4(1463899717),at.pp?.p4(1718449184),at.pp?.Wt(16),at.pp?.Ht(1),at.pp?.Ht(1),at.pp?.Wt(22050),at.pp?.Wt(22050),at.pp?.Ht(1),at.pp?.Ht(8),at.pp?.p4(1684108385),at.pp?.Wt(i),at.pp.bt+=i,at.pp}up(t){let i=0;for(let t=0;t<10;t++)this.mp[t]&&this.mp[t].length+this.mp[t].start>i&&(i=this.mp[t].length+this.mp[t].start);if(0===i)return 0;let s=22050*i/1e3|0,h=22050*this.Ip/1e3|0,e=22050*this.loopEnd/1e3|0;(h<0||e<0||e>s||h>=e)&&(t=0);let n=s+(e-h)*(t-1);for(let t=44;t<n+44;t++)at.yp&&(at.yp[t]=-128);for(let t=0;t<10;t++)if(this.mp[t]){const i=22050*this.mp[t].length/1e3|0,s=22050*this.mp[t].start/1e3|0,h=this.mp[t].up(i,this.mp[t].length);for(let t=0;t<i;t++)at.yp&&(at.yp[t+s+44]+=h[t]>>8<<24>>24)}if(t>1){h+=44,e+=44,s+=44,n+=44;const i=n-s;for(let t=s-1;t>=e;t--)at.yp&&(at.yp[t+i]=at.yp[t]);for(let i=1;i<t;i++){const t=(e-h)*i;for(let i=h;i<e;i++)at.yp&&(at.yp[i+t]=at.yp[i])}n-=44}return n}}var ct;const ft=(ct="file:///Users/pazaz/Documents/2004Scape/Client2/src/js/vendor/tinymidipcm/tinymidipcm.mjs",function(t){var i,h,e=void 0!==(t=t||{})?t:{};e.ready=new Promise((function(t,s){i=t,h=s})),["_tsf_load_memory","_tsf_set_output","_tsf_channel_set_bank_preset","_tsf_set_max_voices","_tsf_channel_set_presetnumber","_tsf_reset","_tsf_close","_tml_load_memory","_midi_render","_malloc","_realloc","_free","_fflush","onRuntimeInitialized"].forEach((t=>{Object.getOwnPropertyDescriptor(e.ready,t)||Object.defineProperty(e.ready,t,{get:()=>X('You are getting '+t+' on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js'),set:()=>X('You are setting '+t+' on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js')})}));var n=Object.assign({},e),r=[],o='object'==typeof window,l='function'==typeof importScripts,a='object'==typeof process&&'object'==typeof process.versions&&'string'==typeof process.versions.node,c=!o&&!a&&!l;if(e.ENVIRONMENT)throw new Error('Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)');var f,u,d,w='';if(a){if('undefined'==typeof process||!process.release||'node'!==process.release.name)throw new Error('not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)');var y,p;w=l?require('path').gp(w)+'/':__dirname+'/';var A=()=>{p||(y=require('fs'),p=require('path'))};f=(t,i)=>(A(),t=p.normalize(t),y._p(t,i?void 0:'utf8')),d=t=>{var i=f(t,!0);return i.buffer||(i=new Uint8Array(i)),x(i.buffer),i},u=(t,i,s)=>{A(),t=p.normalize(t),y.Cp(t,(function(t,h){t?s(t):i(h.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,'/'),r=process.argv.slice(2),process.on('uncaughtException',(function(t){if(!(t instanceof ht))throw t})),process.on('unhandledRejection',(function(t){throw t})),e.inspect=function(){return'[Emscripten Module object]'}}else if(c){if('object'==typeof process&&'function'==typeof require||'object'==typeof window||'function'==typeof importScripts)throw new Error('not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)');'undefined'!=typeof read&&(f=function(t){return read(t)}),d=function(t){let i;return'function'==typeof readbuffer?new Uint8Array(readbuffer(t)):(i=read(t,'binary'),x('object'==typeof i),i)},u=function(t,i,s){setTimeout((()=>i(d(t))),0)},'undefined'!=typeof scriptArgs?r=scriptArgs:void 0!==arguments&&(r=arguments),'undefined'!=typeof print&&('undefined'==typeof console&&(console={}),console.log=print,console.warn=console.error='undefined'!=typeof printErr?printErr:print)}else{if(!o&&!l)throw new Error('environment detection error');if(l?w=self.location.href:'undefined'!=typeof document&&document.currentScript&&(w=document.currentScript.src),ct&&(w=ct),w=0!==w.indexOf('blob:')?w.substr(0,w.replace(/[?#].*/,"").lastIndexOf('/')+1):'','object'!=typeof window&&'function'!=typeof importScripts)throw new Error('not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)');f=t=>{var i=new XMLHttpRequest;return i.open('GET',t,!1),i.send(null),i.responseText},l&&(d=t=>{var i=new XMLHttpRequest;return i.open('GET',t,!1),i.responseType='arraybuffer',i.send(null),new Uint8Array(i.response)}),u=(t,i,s)=>{var h=new XMLHttpRequest;h.open('GET',t,!0),h.responseType='arraybuffer',h.onload=()=>{200==h.status||0==h.status&&h.response?i(h.response):s()},h.onerror=s,h.send(null)}}e.print||console.log.bind(console);var m,I,E=e.printErr||console.warn.bind(console);function g(t,i){Object.getOwnPropertyDescriptor(e,t)||Object.defineProperty(e,t,{configurable:!0,get:function(){X('Module.'+t+' has been replaced with plain '+i+' (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)')}})}function _(t){return'FS_createPath'===t||'FS_createDataFile'===t||'FS_createPreloadedFile'===t||'FS_unlink'===t||'addRunDependency'===t||'FS_createLazyFile'===t||'FS_createDevice'===t||'removeRunDependency'===t}Object.assign(e,n),n=null,m='fetchSettings',Object.getOwnPropertyDescriptor(e,m)&&X('`Module.'+m+'` was supplied but `'+m+'` not included in INCOMING_MODULE_JS_API'),e.arguments&&(r=e.arguments),g('arguments','arguments_'),e.thisProgram&&e.thisProgram,g('thisProgram','thisProgram'),e.quit&&e.quit,g('quit','quit_'),x(void 0===e.memoryInitializerPrefixURL,'Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead'),x(void 0===e.pthreadMainPrefixURL,'Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead'),x(void 0===e.cdInitializerPrefixURL,'Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead'),x(void 0===e.filePackagePrefixURL,'Module.filePackagePrefixURL option was removed, use Module.locateFile instead'),x(void 0===e.read,'Module.read option was removed (modify read_ in JS)'),x(void 0===e.readAsync,'Module.readAsync option was removed (modify readAsync in JS)'),x(void 0===e.readBinary,'Module.readBinary option was removed (modify readBinary in JS)'),x(void 0===e.setWindowTitle,'Module.setWindowTitle option was removed (modify setWindowTitle in JS)'),x(void 0===e.TOTAL_MEMORY,'Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY'),g('read','read_'),g('readAsync','readAsync'),g('readBinary','readBinary'),g('setWindowTitle','setWindowTitle'),x(!c,"shell environment detected but not enabled at build time.  Add 'shell' to `-sENVIRONMENT` to enable."),e.wasmBinary&&(I=e.wasmBinary),g('wasmBinary','wasmBinary');var C;e.noExitRuntime;g('noExitRuntime','noExitRuntime'),'object'!=typeof WebAssembly&&X('no native wasm support detected');var T,O,b,L,v,S,R,M,k=!1;function x(t,i){t||X('Assertion failed'+(i?': '+i:''))}function D(t){T=t,e.HEAP8=O=new Int8Array(t),e.HEAP16=L=new Int16Array(t),e.HEAP32=v=new Int32Array(t),e.HEAPU8=b=new Uint8Array(t),e.HEAPU16=new Uint16Array(t),e.HEAPU32=S=new Uint32Array(t),e.HEAPF32=R=new Float32Array(t),e.HEAPF64=M=new Float64Array(t)}'undefined'!=typeof TextDecoder&&new TextDecoder('utf8');var N=5242880;e.TOTAL_STACK&&x(N===e.TOTAL_STACK,'the stack size can no longer be determined at runtime');var P=e.INITIAL_MEMORY||16777216;function F(){if(!k){var t=ft(),i=S[t>>2],s=S[t+4>>2];34821223==i&&2310721022==s||X('Stack overflow! Stack cookie has been overwritten at 0x'+t.toString(16)+', expected hex dwords 0x89BACDFE and 0x2135467, but received 0x'+s.toString(16)+' 0x'+i.toString(16)),1668509029!==S[0]&&X('Runtime error: The application has corrupted its heap memory area (address zero)!')}}g('INITIAL_MEMORY','INITIAL_MEMORY'),x(P>=N,'INITIAL_MEMORY should be larger than TOTAL_STACK, was '+P+'! (TOTAL_STACK='+N+')'),x('undefined'!=typeof Int32Array&&'undefined'!=typeof Float64Array&&null!=Int32Array.prototype.subarray&&null!=Int32Array.prototype.set,'JS engine does not provide full typed array support'),x(!e.wasmMemory,'Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally'),x(16777216==P,'Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically'),function(){var t=new Int16Array(1),i=new Int8Array(t.buffer);if(t[0]=25459,115!==i[0]||99!==i[1])throw'Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)'}();var U=[],B=[],G=[],H=!1;x(Math.imul,'This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill'),x(Math.fround,'This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill'),x(Math.clz32,'This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill'),x(Math.trunc,'This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill');var W=0,Y=null,V=null,K={};function X(t){e.onAbort&&e.onAbort(t),E(t='Aborted('+t+')'),k=!0;var i=new WebAssembly.RuntimeError(t);throw h(i),i}var z={error:function(){X('Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with -sFORCE_FILESYSTEM')},init:function(){z.error()},Tp:function(){z.error()},Op:function(){z.error()},bp:function(){z.error()},open:function(){z.error()},Lp:function(){z.error()},vp:function(){z.error()},Sp:function(){z.error()},Rp:function(){z.error()},Mp:function(){z.error()}};e.FS_createDataFile=z.Tp,e.FS_createPreloadedFile=z.Op;var j,Z,q,$,J='data:application/octet-stream;base64,';function Q(t){return t.startsWith(J)}function tt(t){return t.startsWith('file://')}function it(t,i){return function(){var s=t,h=i;return i||(h=e.asm),x(H,'native function `'+s+'` called before runtime initialization'),h[t]||x(h[t],'exported native function `'+s+'` not found'),h[t].apply(null,arguments)}}function st(t){try{if(t==j&&I)return new Uint8Array(I);if(d)return d(t);throw"both async and sync fetching of the wasm failed"}catch(t){X(t)}}function ht(t){this.name='ExitStatus',this.message='Program terminated with exit('+t+')',this.status=t}function et(t){for(;t.length>0;)t.shift()(e)}function nt(t){nt.kp||(nt.kp={}),nt.kp[t]||(nt.kp[t]=1,a&&(t='warning: '+t),E(t))}function rt(t){try{return C.grow(t-T.byteLength+65535>>>16),D(C.buffer),1}catch(i){E('emscripten_realloc_buffer: Attempted to grow heap from '+T.byteLength+' bytes to '+t+' bytes, but got error: '+i)}}e.locateFile?Q(j='tinymidipcm.wasm')||(Z=j,j=e.locateFile?e.locateFile(Z,w):w+Z):j=new URL(s(227),s.b).toString();var ot,lt={"emscripten_memcpy_big":function(t,i,s){b.copyWithin(t,i,i+s)},"emscripten_resize_heap":function(t){var i=b.length;x((t>>>=0)>i);var s,h,e=2147483648;if(t>e)return E('Cannot enlarge memory, asked to go up to '+t+' bytes, but the limit is '+e+' bytes!'),!1;for(var n=1;n<=4;n*=2){var r=i*(1+.2/n);r=Math.min(r,t+100663296);var o=Math.min(e,(s=Math.max(t,r))+((h=65536)-s%h)%h);if(rt(o))return!0}return E('Failed to grow the heap from '+i+' bytes to '+o+' bytes, not enough memory!'),!1}},at=(function(){var t,i={'env':lt,'wasi_snapshot_preview1':lt};function s(t,i){var s,h=t.exports;e.asm=h,x(C=e.asm.memory,"memory not found in wasm exports"),D(C.buffer),x(e.asm.__indirect_function_table,"table not found in wasm exports"),s=e.asm.__wasm_call_ctors,B.unshift(s),function(t){if(W--,e.monitorRunDependencies&&e.monitorRunDependencies(W),t?(x(K[t]),delete K[t]):E('warning: run dependency removed without ID'),0==W&&(null!==Y&&(clearInterval(Y),Y=null),V)){var i=V;V=null,i()}}('wasm-instantiate')}t='wasm-instantiate',W++,e.monitorRunDependencies&&e.monitorRunDependencies(W),t?(x(!K[t]),K[t]=1,null===Y&&'undefined'!=typeof setInterval&&(Y=setInterval((function(){if(k)return clearInterval(Y),void(Y=null);var t=!1;for(var i in K)t||(t=!0,E('still waiting on run dependencies:')),E('dependency: '+i);t&&E('(end of list)')}),1e4))):E('warning: run dependency added without ID');var n=e;function r(t){x(e===n,'the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?'),n=null,s(t.instance)}function c(t){return function(){if(!I&&(o||l)){if('function'==typeof fetch&&!tt(j))return fetch(j,{credentials:'same-origin'}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+j+"'";return t.arrayBuffer()})).catch((function(){return st(j)}));if(u)return new Promise((function(t,i){u(j,(function(i){t(new Uint8Array(i))}),i)}))}return Promise.resolve().then((function(){return st(j)}))}().then((function(t){return WebAssembly.instantiate(t,i)})).then((function(t){return t})).then(t,(function(t){E('failed to asynchronously prepare wasm: '+t),tt(j)&&E('warning: Loading from a file URI ('+j+') is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing'),X(t)}))}if(e.instantiateWasm)try{return e.instantiateWasm(i,s)}catch(t){E('Module.instantiateWasm callback failed with error: '+t),h(t)}(I||'function'!=typeof WebAssembly.instantiateStreaming||Q(j)||tt(j)||a||'function'!=typeof fetch?c(r):fetch(j,{credentials:'same-origin'}).then((function(t){return WebAssembly.instantiateStreaming(t,i).then(r,(function(t){return E('wasm streaming compile failed: '+t),E('falling back to ArrayBuffer instantiation'),c(r)}))}))).catch(h)}(),e.___wasm_call_ctors=it("__wasm_call_ctors"),e._malloc=it("malloc"),e._free=it("free"),e._tsf_load_memory=it("tsf_load_memory"),e._tsf_close=it("tsf_close"),e._tsf_reset=it("tsf_reset"),e._tsf_set_output=it("tsf_set_output"),e._tsf_set_max_voices=it("tsf_set_max_voices"),e._realloc=it("realloc"),e._tsf_channel_set_presetnumber=it("tsf_channel_set_presetnumber"),e._tsf_channel_set_bank_preset=it("tsf_channel_set_bank_preset"),e._tml_load_memory=it("tml_load_memory"),e._midi_render=it("midi_render"),e.___errno_location=it("__errno_location"),e._fflush=it("fflush"),e._emscripten_stack_init=function(){return(at=e._emscripten_stack_init=e.asm.emscripten_stack_init).apply(null,arguments)}),ft=(e._emscripten_stack_get_free=function(){return(e._emscripten_stack_get_free=e.asm.emscripten_stack_get_free).apply(null,arguments)},e._emscripten_stack_get_base=function(){return(e._emscripten_stack_get_base=e.asm.emscripten_stack_get_base).apply(null,arguments)},e._emscripten_stack_get_end=function(){return(ft=e._emscripten_stack_get_end=e.asm.emscripten_stack_get_end).apply(null,arguments)});function ut(){var t;at(),x(!(3&(t=ft()))),S[t>>2]=34821223,S[t+4>>2]=2310721022,S[0]=1668509029}function dt(t){function s(){ot||(ot=!0,e.calledRun=!0,k||(x(!H),H=!0,F(),et(B),i(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),x(!e._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),function(){if(F(),e.postRun)for('function'==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;)t=e.postRun.shift(),G.unshift(t);var t;et(G)}()))}t=t||r,W>0||(ut(),function(){if(e.preRun)for('function'==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)t=e.preRun.shift(),U.unshift(t);var t;et(U)}(),W>0||(e.setStatus?(e.setStatus('Running...'),setTimeout((function(){setTimeout((function(){e.setStatus('')}),1),s()}),1)):s(),F()))}if(e.stackSave=it("stackSave"),e.stackRestore=it("stackRestore"),e.stackAlloc=it("stackAlloc"),e.setValue=function(t,i,s="i8"){switch(s.endsWith('*')&&(s='*'),s){case'i1':case'i8':O[0|t]=i;break;case'i16':L[t>>1]=i;break;case'i32':v[t>>2]=i;break;case'i64':$=[i>>>0,(q=i,+Math.abs(q)>=1?q>0?(0|Math.min(+Math.floor(q/4294967296),4294967295))>>>0:~~+Math.ceil((q-+(~~q>>>0))/4294967296)>>>0:0)],v[t>>2]=$[0],v[t+4>>2]=$[1];break;case'float':R[t>>2]=i;break;case'double':M[t>>3]=i;break;case'*':S[t>>2]=i;break;default:X('invalid type for setValue: '+s)}},e.getValue=function(t,i="i8"){switch(i.endsWith('*')&&(i='*'),i){case'i1':case'i8':return O[0|t];case'i16':return L[t>>1];case'i32':case'i64':return v[t>>2];case'float':return R[t>>2];case'double':return M[t>>3];case'*':return S[t>>2];default:X('invalid type for getValue: '+i)}return null},['run','UTF8ArrayToString','UTF8ToString','stringToUTF8Array','stringToUTF8','lengthBytesUTF8','addOnPreRun','addOnInit','addOnPreMain','addOnExit','addOnPostRun','addRunDependency','removeRunDependency','FS_createFolder','FS_createPath','FS_createDataFile','FS_createPreloadedFile','FS_createLazyFile','FS_createLink','FS_createDevice','FS_unlink','getLEB','getFunctionTables','alignFunctionTables','registerFunctions','prettyPrint','getCompilerSetting','print','printErr','callMain','abort','keepRuntimeAlive','wasmMemory','stackAlloc','stackSave','stackRestore','getTempRet0','setTempRet0','writeStackCookie','checkStackCookie','ptrToString','zeroMemory','stringToNewUTF8','exitJS','getHeapMax','emscripten_realloc_buffer','ENV','ERRNO_CODES','ERRNO_MESSAGES','setErrNo','inetPton4','inetNtop4','inetPton6','inetNtop6','readSockaddr','writeSockaddr','DNS','getHostByName','Protocols','Sockets','getRandomDevice','warnOnce','traverseStack','UNWIND_CACHE','convertPCtoSourceLocation','readAsmConstArgsArray','readAsmConstArgs','mainThreadEM_ASM','jstoi_q','jstoi_s','getExecutableName','listenOnce','autoResumeAudioContext','dynCallLegacy','getDynCaller','dynCall','handleException','runtimeKeepalivePush','runtimeKeepalivePop','callUserCallback','maybeExit','safeSetTimeout','asmjsMangle','asyncLoad','alignMemory','mmapAlloc','writeI53ToI64','writeI53ToI64Clamped','writeI53ToI64Signaling','writeI53ToU64Clamped','writeI53ToU64Signaling','readI53FromI64','readI53FromU64','convertI32PairToI53','convertI32PairToI53Checked','convertU32PairToI53','getCFunc','ccall','cwrap','uleb128Encode','sigToWasmTypes','generateFuncType','convertJsFunctionToWasm','freeTableIndexes','functionsInTableMap','getEmptyTableSlot','updateTableMap','addFunction','removeFunction','reallyNegative','unSign','strLen','reSign','formatString','PATH','PATH_FS','intArrayFromString','intArrayToString','AsciiToString','stringToAscii','UTF16Decoder','UTF16ToString','stringToUTF16','lengthBytesUTF16','UTF32ToString','stringToUTF32','lengthBytesUTF32','allocateUTF8','allocateUTF8OnStack','writeStringToMemory','writeArrayToMemory','writeAsciiToMemory','SYSCALLS','getSocketFromFD','getSocketAddress','JSEvents','registerKeyEventCallback','specialHTMLTargets','maybeCStringToJsString','findEventTarget','findCanvasEventTarget','getBoundingClientRect','fillMouseEventData','registerMouseEventCallback','registerWheelEventCallback','registerUiEventCallback','registerFocusEventCallback','fillDeviceOrientationEventData','registerDeviceOrientationEventCallback','fillDeviceMotionEventData','registerDeviceMotionEventCallback','screenOrientation','fillOrientationChangeEventData','registerOrientationChangeEventCallback','fillFullscreenChangeEventData','registerFullscreenChangeEventCallback','JSEvents_requestFullscreen','JSEvents_resizeCanvasForFullscreen','registerRestoreOldStyle','hideEverythingExceptGivenElement','restoreHiddenElements','setLetterbox','currentFullscreenStrategy','restoreOldWindowedStyle','softFullscreenResizeWebGLRenderTarget','doRequestFullscreen','fillPointerlockChangeEventData','registerPointerlockChangeEventCallback','registerPointerlockErrorEventCallback','requestPointerLock','fillVisibilityChangeEventData','registerVisibilityChangeEventCallback','registerTouchEventCallback','fillGamepadEventData','registerGamepadEventCallback','registerBeforeUnloadEventCallback','fillBatteryEventData','battery','registerBatteryEventCallback','setCanvasElementSize','getCanvasElementSize','demangle','demangleAll','jsStackTrace','stackTrace','ExitStatus','getEnvStrings','checkWasiClock','flush_NO_FILESYSTEM','dlopenMissingError','createDyncallWrapper','setImmediateWrapped','clearImmediateWrapped','polyfillSetImmediate','uncaughtExceptionCount','exceptionLast','exceptionCaught','ExceptionInfo','exception_addRef','exception_decRef','Browser','setMainLoop','wget','FS','MEMFS','TTY','PIPEFS','SOCKFS','_setNetworkCallback','tempFixedLengthArray','miniTempWebGLFloatBuffers','heapObjectForWebGLType','heapAccessShiftForWebGLHeap','GL','emscriptenWebGLGet','computeUnpackAlignedImageSize','emscriptenWebGLGetTexPixelData','emscriptenWebGLGetUniform','webglGetUniformLocation','webglPrepareUniformLocationsBeforeFirstUse','webglGetLeftBracePos','emscriptenWebGLGetVertexAttrib','writeGLArray','AL','SDL_unicode','SDL_ttfContext','SDL_audio','SDL','SDL_gfx','GLUT','EGL','GLFW_Window','GLFW','GLEW','IDBStore','runAndAbortIfError','ALLOC_NORMAL','ALLOC_STACK','allocate'].forEach((function(t){Object.getOwnPropertyDescriptor(e,t)||Object.defineProperty(e,t,{configurable:!0,get:function(){var i="'"+t+"' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the FAQ)";_(t)&&(i+='. Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you'),X(i)}})})),['ptrToString','zeroMemory','stringToNewUTF8','exitJS','setErrNo','inetPton4','inetNtop4','inetPton6','inetNtop6','readSockaddr','writeSockaddr','getHostByName','getRandomDevice','traverseStack','convertPCtoSourceLocation','readAsmConstArgs','mainThreadEM_ASM','jstoi_q','jstoi_s','getExecutableName','listenOnce','autoResumeAudioContext','dynCallLegacy','getDynCaller','dynCall','runtimeKeepalivePush','runtimeKeepalivePop','callUserCallback','maybeExit','safeSetTimeout','asmjsMangle','asyncLoad','alignMemory','mmapAlloc','writeI53ToI64','writeI53ToI64Clamped','writeI53ToI64Signaling','writeI53ToU64Clamped','writeI53ToU64Signaling','readI53FromI64','readI53FromU64','convertI32PairToI53','convertI32PairToI53Checked','convertU32PairToI53','getCFunc','ccall','cwrap','uleb128Encode','sigToWasmTypes','generateFuncType','convertJsFunctionToWasm','getEmptyTableSlot','updateTableMap','addFunction','removeFunction','reallyNegative','unSign','strLen','reSign','formatString','intArrayFromString','intArrayToString','AsciiToString','stringToAscii','UTF16ToString','stringToUTF16','lengthBytesUTF16','UTF32ToString','stringToUTF32','lengthBytesUTF32','allocateUTF8','allocateUTF8OnStack','writeStringToMemory','writeAsciiToMemory','getSocketFromFD','getSocketAddress','registerKeyEventCallback','maybeCStringToJsString','findEventTarget','findCanvasEventTarget','getBoundingClientRect','fillMouseEventData','registerMouseEventCallback','registerWheelEventCallback','registerUiEventCallback','registerFocusEventCallback','fillDeviceOrientationEventData','registerDeviceOrientationEventCallback','fillDeviceMotionEventData','registerDeviceMotionEventCallback','screenOrientation','fillOrientationChangeEventData','registerOrientationChangeEventCallback','fillFullscreenChangeEventData','registerFullscreenChangeEventCallback','JSEvents_requestFullscreen','JSEvents_resizeCanvasForFullscreen','registerRestoreOldStyle','hideEverythingExceptGivenElement','restoreHiddenElements','setLetterbox','softFullscreenResizeWebGLRenderTarget','doRequestFullscreen','fillPointerlockChangeEventData','registerPointerlockChangeEventCallback','registerPointerlockErrorEventCallback','requestPointerLock','fillVisibilityChangeEventData','registerVisibilityChangeEventCallback','registerTouchEventCallback','fillGamepadEventData','registerGamepadEventCallback','registerBeforeUnloadEventCallback','fillBatteryEventData','battery','registerBatteryEventCallback','setCanvasElementSize','getCanvasElementSize','getEnvStrings','checkWasiClock','flush_NO_FILESYSTEM','createDyncallWrapper','setImmediateWrapped','clearImmediateWrapped','polyfillSetImmediate','ExceptionInfo','exception_addRef','exception_decRef','setMainLoop','_setNetworkCallback','heapObjectForWebGLType','heapAccessShiftForWebGLHeap','emscriptenWebGLGet','computeUnpackAlignedImageSize','emscriptenWebGLGetTexPixelData','emscriptenWebGLGetUniform','webglGetUniformLocation','webglPrepareUniformLocationsBeforeFirstUse','webglGetLeftBracePos','emscriptenWebGLGetVertexAttrib','writeGLArray','SDL_unicode','SDL_ttfContext','SDL_audio','GLFW_Window','runAndAbortIfError','ALLOC_NORMAL','ALLOC_STACK','allocate'].forEach((function(t){'undefined'==typeof globalThis||Object.getOwnPropertyDescriptor(globalThis,t)||Object.defineProperty(globalThis,t,{configurable:!0,get:function(){var i='`'+t+'` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line';_(t)&&(i+='. Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you'),nt(i)}})})),V=function t(){ot||dt(),ot||(V=t)},e.preInit)for('function'==typeof e.preInit&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return dt(),t.ready});const ut=class{constructor(t={}){this.xp=void 0,this.Dp=0,this.Np=0,this.Pp=0,this.Fp=t.Fp||100,this.sampleRate=t.sampleRate||44100,this.Up=t.Up||2,this.gain=t.gain||0,t.bufferSize?this.bufferSize=t.bufferSize:this.Bp(1),this.Gp=t.Gp||(()=>{}),this.Hp=t.Hp||(()=>{}),this.Wp=void 0,this.test=0}async init(){if(!this.xp){if('undefined'!=typeof process){const{gp:t}=await import('path'),{Yp:i}=await import('module');globalThis.__dirname=t("file:///Users/pazaz/Documents/2004Scape/Client2/src/js/vendor/tinymidipcm/index.js"),globalThis.require=i("file:///Users/pazaz/Documents/2004Scape/Client2/src/js/vendor/tinymidipcm/index.js")}this.xp=await ft(),this.Vp=this.xp._malloc(this.bufferSize),this.Kp=this.xp._malloc(8)}}Bp(t){this.bufferSize=4*this.sampleRate*this.Up*t}Xp(){if(!this.xp)throw new Error(`${this.constructor.name} not initalized. call .init()`)}zp(t){this.Xp();const{_malloc:i,_free:s,_tsf_load_memory:h,_tsf_set_output:e,_tsf_channel_set_bank_preset:n,_tsf_set_max_voices:r,_tsf_channel_set_presetnumber:o}=this.xp;s(this.Dp),this.Dp=i(t.length),this.xp.HEAPU8.set(t,this.Dp),this.Np=h(this.Dp,t.length),e(this.Np,2===this.Up?0:2,this.sampleRate,this.gain)}jp(){this.Xp();const t=new Uint8Array(this.bufferSize);return t.set(this.xp.HEAPU8.subarray(this.Vp,this.Vp+this.bufferSize)),t}Zp(t){const{_malloc:i,_free:s,_tml_load_memory:h}=this.xp;return s(this.Pp),this.Pp=i(t.length),this.xp.HEAPU8.set(t,this.Pp),h(this.Pp,t.length)}qp(t){const{_midi_render:i}=this.xp;return i(this.Np,t,this.Up,this.sampleRate,this.Vp,this.bufferSize,this.Kp)}$p(t){if(this.Xp(),!this.Np)throw new Error('no soundfont buffer set. call .setSoundfont');window.clearTimeout(this.Wp);const{setValue:i,getValue:s}=this.xp;i(this.Kp,0,'double'),this.xp._tsf_reset(this.Np),this.xp._tsf_channel_set_bank_preset(this.Np,9,128,0),t[0]==='R'.charCodeAt(0)&&(t=t.slice(20));let h=this.Zp(t);const e=()=>{h=this.qp(h);const t=this.jp();this.Gp(t),h?this.Wp=setTimeout(e,this.Fp):this.Hp(s(this.Kp,'double'))};this.Wp=setTimeout(e,16)}};async function dt(t,i={}){const s={env:Object.assign(Object.create(globalThis),i.env||{},{abort(t,i,s,h){t=r(t>>>0),i=r(i>>>0),s>>>=0,h>>>=0,(()=>{throw Error(`${t} in ${i}:${s}:${h}`)})()}})},{exports:h}=await WebAssembly.instantiate(t,s),e=h.memory||i.env.memory,n=Object.setPrototypeOf({read:(t,i,s,n)=>(i=function(t,i,s,n,r){if(null==n)return 0;const o=n.length,l=h.__pin(h.__new(o<<s,i))>>>0;if(r)new r(e.buffer,l,o).set(n);else for(let i=0;i<o;i++)t(l+(i<<s>>>0),n[i]);return h.__unpin(l),l}(l,6,0,i,Int8Array)||function(){throw TypeError("value must not be null")}(),function(t,i,s){if(!s)return null;const h=function(t){try{return o.getUint32(t,!0)}catch{return o=new DataView(e.buffer),o.getUint32(t,!0)}}(s-4)>>>i,n=new Array(h);for(let e=0;e<h;++e)n[e]=t(s+(e<<i>>>0));return n}(a,0,h.read(t,i,s,n)>>>0))},h);function r(t){if(!t)return null;const i=t+new Uint32Array(e.buffer)[t-4>>>2]>>>1,s=new Uint16Array(e.buffer);let h=t>>>1,n="";for(;i-h>1024;)n+=String.fromCharCode(...s.subarray(h,h+=1024));return n+String.fromCharCode(...s.subarray(h,i))}let o=new DataView(e.buffer);function l(t,i){try{o.setUint8(t,i,!0)}catch{o=new DataView(e.buffer),o.setUint8(t,i,!0)}}function a(t){try{return o.getInt8(t,!0)}catch{return o=new DataView(e.buffer),o.getInt8(t,!0)}}return n}!function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(window.audioContext=new window.AudioContext);var t=function(i){if(window.audioContext){var s=window.audioContext.createBuffer(1,1,22050),h=window.audioContext.createBufferSource();h.buffer=s,h.connect(window.audioContext.destination),h.start?h.start(0):h.play?h.play(0):h.noteOn&&h.noteOn(0)}document.removeEventListener('touchstart',t),document.removeEventListener('touchend',t),document.removeEventListener('click',t)};document.addEventListener('touchstart',t),document.addEventListener('touchend',t),document.addEventListener('click',t)}(),(async()=>{const t=2,i=44100;let s=new Float32Array,h=window.audioContext.createGain();h.gain.setValueAtTime(.1,window.audioContext.currentTime),h.connect(window.audioContext.destination);let e=window.audioContext.currentTime,n=[];const r=new ut({Fp:30,Gp:t=>{let i=new Float32Array(t.buffer),h=new Float32Array(s.length+i.length);h.set(s,0),h.set(i,s.length),s=h},Hp:t=>{},bufferSize:102400});await r.init();const o=await fetch('./SCC1_Florestan.sf2'),l=new Uint8Array(await o.arrayBuffer());function a(){if(!window.audioContext||!s.length)return;let r=window.audioContext.createBufferSource();const o=s.length/t,l=window.audioContext.createBuffer(t,o,i);for(let i=0;i<t;i++){const h=l.getChannelData(i);let e=i;for(let i=0;i<o;i++)h[i]=s[e],e+=t}e<window.audioContext.currentTime&&(e=window.audioContext.currentTime),r.buffer=l,r.connect(h),r.start(e),n.push(r),e+=l.duration,s=new Float32Array}let c;function f(){if(c&&clearInterval(c),s=new Float32Array,n.length){let t=h.gain.value;h.gain.setValueAtTime(0,window.audioContext.currentTime),n.forEach((t=>{t.stop(window.audioContext.currentTime)})),n=[],h.gain.setValueAtTime(t,window.audioContext.currentTime)}}function u(t,i){-1!==t&&window._tinyMidiVolume(t),e=window.audioContext.currentTime,c=setInterval(a,250),r.$p(i)}r.zp(l),window._tinyMidiStop=async t=>{t?function(t){const i=window.audioContext.currentTime;h.gain.cancelScheduledValues(i),h.gain.setTargetAtTime(0,i,.5),setTimeout(t,2e3)}((()=>{f()})):f()},window._tinyMidiVolume=(t=1)=>{h.gain.setValueAtTime(t,window.audioContext.currentTime)},window._tinyMidiPlay=async(t,i,s)=>{t&&(await window._tinyMidiStop(s),s?setTimeout((()=>{u(i,t)}),2e3):u(i,t))}})();class wt{static Jp=null;static load=async t=>{this.Jp=await dt(new WebAssembly.Module(t),{env:void 0})};static read=(t,i,s,h)=>{if(!this.Jp)throw new Error('bz2 not found!!');return Int8Array.from(this.Jp.read(t,i,s,h))}}class yt{static enabled=!1;static Qp=null;static tA=null;static iA=0;static sA=0;static hA=0;static eA=0;static nA=0;static rA=()=>{this.Qp=a.vt(1),this.tA=null,this.iA=performance.now(),this.enabled=!0};static oA=()=>{this.enabled=!1,this.Qp=null};static flush=()=>{let t=null;return this.tA&&this.enabled&&(t=this.tA),this.tA=null,t};static stop=()=>{let t=null;return this.Qp&&this.Qp.bt>0&&this.enabled&&(t=this.Qp),this.oA(),t};static lA=(t,i,s)=>{if(!(this.enabled&&t>=0&&t<789&&i>=0&&i<532))return;this.sA++;const h=performance.now();let e=(h-this.iA)/10|0;e>250&&(e=250),this.iA=h,this.aA(5),1===s?this.Qp?.p1(1):this.Qp?.p1(2),this.Qp?.p1(e),this.Qp?.p3(t+(i<<10))};static cA=t=>{if(!this.enabled)return;this.sA++;const i=performance.now();let s=(i-this.iA)/10|0;s>250&&(s=250),this.iA=i,this.aA(2),1===t?this.Qp?.p1(3):this.Qp?.p1(4),this.Qp?.p1(s)};static fA=(t,i)=>{if(!(this.enabled&&t>=0&&t<789&&i>=0&&i<532))return;const s=performance.now();if(s-this.hA>=50){this.hA=s,this.sA++;let h=(s-this.iA)/10|0;h>250&&(h=250),this.iA=s,t-this.eA<8&&t-this.eA>=-8&&i-this.nA<8&&i-this.nA>=-8?(this.aA(3),this.Qp?.p1(5),this.Qp?.p1(h),this.Qp?.p1(t+(i-this.nA+8<<4)+8-this.eA)):t-this.eA<128&&t-this.eA>=-128&&i-this.nA<128&&i-this.nA>=-128?(this.aA(4),this.Qp?.p1(6),this.Qp?.p1(h),this.Qp?.p1(t+128-this.eA),this.Qp?.p1(i+128-this.nA)):(this.aA(5),this.Qp?.p1(7),this.Qp?.p1(h),this.Qp?.p3(t+(i<<10))),this.eA=t,this.nA=i}};static uA=t=>{if(!this.enabled)return;this.sA++;const i=performance.now();let s=(i-this.iA)/10|0;s>250&&(s=250),this.iA=i,1e3===t?t=11:1001===t?t=12:1002===t?t=14:1003===t?t=15:t>=1008&&(t-=992),this.aA(3),this.Qp?.p1(8),this.Qp?.p1(s),this.Qp?.p1(t)};static dA=t=>{if(!this.enabled)return;this.sA++;const i=performance.now();let s=(i-this.iA)/10|0;s>250&&(s=250),this.iA=i,1e3===t?t=11:1001===t?t=12:1002===t?t=14:1003===t?t=15:t>=1008&&(t-=992),this.aA(3),this.Qp?.p1(9),this.Qp?.p1(s),this.Qp?.p1(t)};static wA=()=>{if(!this.enabled)return;this.sA++;const t=performance.now();let i=(t-this.iA)/10|0;i>250&&(i=250),this.iA=t,this.aA(2),this.Qp?.p1(10),this.Qp?.p1(i)};static yA=()=>{if(!this.enabled)return;this.sA++;const t=performance.now();let i=(t-this.iA)/10|0;i>250&&(i=250),this.iA=t,this.aA(2),this.Qp?.p1(11),this.Qp?.p1(i)};static pA=()=>{if(!this.enabled)return;this.sA++;const t=performance.now();let i=(t-this.iA)/10|0;i>250&&(i=250),this.iA=t,this.aA(2),this.Qp?.p1(12),this.Qp?.p1(i)};static AA=()=>{if(!this.enabled)return;this.sA++;const t=performance.now();let i=(t-this.iA)/10|0;i>250&&(i=250),this.iA=t,this.aA(2),this.Qp?.p1(13),this.Qp?.p1(i)};static aA=t=>{if(this.Qp&&this.Qp.bt+t>=500){const t=this.Qp;this.Qp=a.vt(1),this.tA=t}}}class pt{level;y;x;z;model;mA;IA;EA;gA;_A;CA;TA;info;OA=0;Ji=0;constructor(t,i,s,h,e,n,r,o,l,a,c,f,u){this.level=t,this.y=i,this.x=s,this.z=h,this.model=e,this.mA=n,this.IA=r,this.EA=o,this.gA=l,this._A=a,this.CA=c,this.TA=f,this.info=u}}class At extends r{level;x;z;bA;LA;vA;SA=null;RA=null;MA=null;kA=null;xA=null;DA=null;NA=null;PA=0;FA=0;UA=0;visible=!1;update=!1;BA=!1;GA=0;HA=0;WA=0;YA=0;constructor(t,i,s){super(),this.bA=this.level=t,this.x=i,this.z=s,this.LA=new c(5,null),this.vA=new Int32Array(5)}}class mt{VA;KA;XA;zA;type;jh;Zh;qh;$h;Qh;te;mode=0;jA=0;ZA=0;qA=0;$A=0;JA=0;QA=0;constructor(t,i,s,h,e,n,r,o,l,a,c){this.VA=t,this.KA=i,this.XA=s,this.zA=h,this.type=e,this.jh=n,this.Zh=r,this.qh=o,this.$h=l,this.Qh=a,this.te=c}}class It{static OPEN=0;static tm=1;static im=2;static sm=4;static hm=8;static nm=It.tm<<4;static rm=It.im<<4;static om=It.sm<<4;static lm=It.hm<<4;static am=256;static fm=512;static um=1024;static dm=2048;static wm=4096;static ym=It.fm<<4;static pm=It.um<<4;static Am=It.dm<<4;static Im=It.wm<<4;static Em=It.am<<9;static gm=524288;static _m=2097152;static Cm=It._m|It.gm;static Tm=It.am|It.Cm;static Om=It.im|It.Tm;static bm=It.hm|It.Tm;static Lm=It.im|It.sm|It.bm;static vm=It.rm|It.Tm;static Sm=It.hm|It.nm|It.vm;static Rm=It.lm|It.Tm;static Mm=It.tm|It.im|It.Rm;static km=It.rm|It.om|It.Rm;static xm=16777215}class Et{static fn=1;static un=2;static dn=4;static cn=8}class gt{static Dm=4;static Nm=104;static index=(t,i)=>t*gt.Nm+i;offsetX;Pm;sizeX;sizeZ;flags;constructor(){this.offsetX=0,this.Pm=0,this.sizeX=gt.Nm,this.sizeZ=gt.Nm,this.flags=new Int32Array(this.sizeX*this.sizeZ),this.reset()}reset=()=>{for(let t=0;t<this.sizeX;t++)for(let i=0;i<this.sizeZ;i++){const s=gt.index(t,i);0===t||0===i||t===this.sizeX-1||i===this.sizeZ-1?this.flags[s]=It.xm:this.flags[s]=It.OPEN}};Fm=(t,i)=>{this.flags[gt.index(t-this.offsetX,i-this.Pm)]|=It._m};Um=(t,i)=>{this.flags[gt.index(t-this.offsetX,i-this.Pm)]&=~It._m};Bm=(t,i,s,h,e,n)=>{let r=It.am;n&&(r|=It.Em);const o=t-this.offsetX,l=i-this.Pm;if(e===M.fn||e===M.dn){const t=s;s=h,h=t}for(let t=o;t<o+s;t++)if(t>=0&&t<this.sizeX)for(let i=l;i<l+h;i++)i>=0&&i<this.sizeZ&&this.add(t,i,r)};Gm=(t,i,s,h,e,n)=>{let r=It.am;n&&(r|=It.Em);const o=t-this.offsetX,l=i-this.Pm;if(e===M.fn||e===M.dn){const t=s;s=h,h=t}for(let t=o;t<o+s;t++)if(t>=0&&t<this.sizeX)for(let i=l;i<l+h;i++)i>=0&&i<this.sizeZ&&this.remove(t,i,r)};Hm=(t,i,s,h,e)=>{const n=t-this.offsetX,r=i-this.Pm,o=e?It.Im:It.lm,l=e?It.wm:It.hm,a=e?It.um:It.im,c=e?It.pm:It.rm,f=e?It.fm:It.tm,u=e?It.ym:It.nm,d=e?It.dm:It.sm,w=e?It.Am:It.om;s===R.Be.id?h===M.cn?(this.add(n,r,o),this.add(n-1,r,l)):h===M.fn?(this.add(n,r,a),this.add(n,r+1,c)):h===M.un?(this.add(n,r,l),this.add(n+1,r,o)):h===M.dn&&(this.add(n,r,c),this.add(n,r-1,a)):s===R.Ge.id||s===R.We.id?h===M.cn?(this.add(n,r,f),this.add(n-1,r+1,u)):h===M.fn?(this.add(n,r,d),this.add(n+1,r+1,w)):h===M.un?(this.add(n,r,u),this.add(n+1,r-1,f)):h===M.dn&&(this.add(n,r,w),this.add(n-1,r-1,d)):s===R.He.id&&(h===M.cn?(this.add(n,r,a|o),this.add(n-1,r,l),this.add(n,r+1,c)):h===M.fn?(this.add(n,r,a|l),this.add(n,r+1,c),this.add(n+1,r,o)):h===M.un?(this.add(n,r,c|l),this.add(n+1,r,o),this.add(n,r-1,a)):h===M.dn&&(this.add(n,r,c|o),this.add(n,r-1,a),this.add(n-1,r,l))),e&&this.Hm(t,i,s,h,!1)};Wm=(t,i,s,h,e)=>{const n=t-this.offsetX,r=i-this.Pm,o=e?It.Im:It.lm,l=e?It.wm:It.hm,a=e?It.um:It.im,c=e?It.pm:It.rm,f=e?It.fm:It.tm,u=e?It.ym:It.nm,d=e?It.dm:It.sm,w=e?It.Am:It.om;s===R.Be.id?h===M.cn?(this.remove(n,r,o),this.remove(n-1,r,l)):h===M.fn?(this.remove(n,r,a),this.remove(n,r+1,c)):h===M.un?(this.remove(n,r,l),this.remove(n+1,r,o)):h===M.dn&&(this.remove(n,r,c),this.remove(n,r-1,a)):s===R.Ge.id||s===R.We.id?h===M.cn?(this.remove(n,r,f),this.remove(n-1,r+1,u)):h===M.fn?(this.remove(n,r,d),this.remove(n+1,r+1,w)):h===M.un?(this.remove(n,r,u),this.remove(n+1,r-1,f)):h===M.dn&&(this.remove(n,r,w),this.remove(n-1,r-1,d)):s===R.He.id&&(h===M.cn?(this.remove(n,r,a|o),this.remove(n-1,r,l),this.remove(n,r+1,c)):h===M.fn?(this.remove(n,r,a|l),this.remove(n,r+1,c),this.remove(n+1,r,o)):h===M.un?(this.remove(n,r,c|l),this.remove(n+1,r,o),this.remove(n,r-1,a)):h===M.dn&&(this.remove(n,r,c|o),this.remove(n,r-1,a),this.remove(n-1,r,l))),e&&this.Wm(t,i,s,h,!1)};Ym=(t,i,s,h,e,n)=>{if(t===s&&i===h)return!0;const r=t-this.offsetX,o=i-this.Pm,l=s-this.offsetX,a=h-this.Pm,c=gt.index(r,o);if(e===R.Be.id){if(n===M.cn){if(r===l-1&&o===a)return!0;if(r===l&&o===a+1&&(this.flags[c]&It.vm)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.Om)===It.OPEN)return!0}else if(n===M.fn){if(r===l&&o===a+1)return!0;if(r===l-1&&o===a&&(this.flags[c]&It.bm)===It.OPEN)return!0;if(r===l+1&&o===a&&(this.flags[c]&It.Rm)===It.OPEN)return!0}else if(n===M.un){if(r===l+1&&o===a)return!0;if(r===l&&o===a+1&&(this.flags[c]&It.vm)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.Om)===It.OPEN)return!0}else if(n===M.dn){if(r===l&&o===a-1)return!0;if(r===l-1&&o===a&&(this.flags[c]&It.bm)===It.OPEN)return!0;if(r===l+1&&o===a&&(this.flags[c]&It.Rm)===It.OPEN)return!0}}else if(e===R.He.id){if(n===M.cn){if(r===l-1&&o===a)return!0;if(r===l&&o===a+1)return!0;if(r===l+1&&o===a&&(this.flags[c]&It.Rm)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.Om)===It.OPEN)return!0}else if(n===M.fn){if(r===l-1&&o===a&&(this.flags[c]&It.bm)===It.OPEN)return!0;if(r===l&&o===a+1)return!0;if(r===l+1&&o===a)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.Om)===It.OPEN)return!0}else if(n===M.un){if(r===l-1&&o===a&&(this.flags[c]&It.bm)===It.OPEN)return!0;if(r===l&&o===a+1&&(this.flags[c]&It.vm)===It.OPEN)return!0;if(r===l+1&&o===a)return!0;if(r===l&&o===a-1)return!0}else if(n===M.dn){if(r===l-1&&o===a)return!0;if(r===l&&o===a+1&&(this.flags[c]&It.vm)===It.OPEN)return!0;if(r===l+1&&o===a&&(this.flags[c]&It.Rm)===It.OPEN)return!0;if(r===l&&o===a-1)return!0}}else if(e===R.je.id){if(r===l&&o===a+1&&(this.flags[c]&It.rm)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.im)===It.OPEN)return!0;if(r===l-1&&o===a&&(this.flags[c]&It.hm)===It.OPEN)return!0;if(r===l+1&&o===a&&(this.flags[c]&It.lm)===It.OPEN)return!0}return!1};Vm=(t,i,s,h,e,n)=>{if(t===s&&i===h)return!0;const r=t-this.offsetX,o=i-this.Pm,l=s-this.offsetX,a=h-this.Pm,c=gt.index(r,o);if(e===R.Ke.id||e===R.Xe.id){if(e===R.Xe.id&&(n=n+2&3),n===M.cn){if(r===l+1&&o===a&&(this.flags[c]&It.lm)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.im)===It.OPEN)return!0}else if(n===M.fn){if(r===l-1&&o===a&&(this.flags[c]&It.hm)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.im)===It.OPEN)return!0}else if(n===M.un){if(r===l-1&&o===a&&(this.flags[c]&It.hm)===It.OPEN)return!0;if(r===l&&o===a+1&&(this.flags[c]&It.rm)===It.OPEN)return!0}else if(n===M.dn){if(r===l+1&&o===a&&(this.flags[c]&It.lm)===It.OPEN)return!0;if(r===l&&o===a+1&&(this.flags[c]&It.rm)===It.OPEN)return!0}}else if(e===R.ze.id){if(r===l&&o===a+1&&(this.flags[c]&It.rm)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.im)===It.OPEN)return!0;if(r===l-1&&o===a&&(this.flags[c]&It.hm)===It.OPEN)return!0;if(r===l+1&&o===a&&(this.flags[c]&It.lm)===It.OPEN)return!0}return!1};Km=(t,i,s,h,e,n,r)=>{const o=s+e-1,l=h+n-1,a=gt.index(t-this.offsetX,i-this.Pm);return t>=s&&t<=o&&i>=h&&i<=l||(t===s-1&&i>=h&&i<=l&&(this.flags[a]&It.hm)===It.OPEN&&(r&Et.cn)===It.OPEN||(t===o+1&&i>=h&&i<=l&&(this.flags[a]&It.lm)===It.OPEN&&(r&Et.un)===It.OPEN||(i===h-1&&t>=s&&t<=o&&(this.flags[a]&It.im)===It.OPEN&&(r&Et.dn)===It.OPEN||i===l+1&&t>=s&&t<=o&&(this.flags[a]&It.rm)===It.OPEN&&(r&Et.fn)===It.OPEN)))};add=(t,i,s)=>{this.flags[gt.index(t,i)]|=s};remove=(t,i,s)=>{this.flags[gt.index(t,i)]&=It.xm-s}}class _t{y;x;z;model;TA;info;constructor(t,i,s,h,e,n){this.y=t,this.x=i,this.z=s,this.model=h,this.TA=e,this.info=n}}class Ct{y;x;z;Xm;zm;jm;Zm;TA;info;constructor(t,i,s,h,e,n,r,o,l){this.y=t,this.x=i,this.z=s,this.Xm=h,this.zm=e,this.jm=n,this.Zm=r,this.TA=o,this.info=l}}class Tt{y;x;z;type;angle;model;TA;info;constructor(t,i,s,h,e,n,r,o){this.y=t,this.x=i,this.z=s,this.type=h,this.angle=e,this.model=n,this.TA=r,this.info=o}}class Ot{y;x;z;qm;$m;Jm;TA;offset;constructor(t,i,s,h,e,n,r,o){this.y=t,this.x=i,this.z=s,this.qm=h,this.$m=e,this.Jm=n,this.TA=r,this.offset=o}}class bt{Qm;tI;iI;sI;hI;color;flat;constructor(t,i,s,h,e,n,r){this.Qm=t,this.tI=i,this.iI=s,this.sI=h,this.hI=e,this.color=n,this.flat=r}}class Lt{static eI=new Int32Array(6);static nI=new Int32Array(6);static rI=new Int32Array(6);static oI=new Int32Array(6);static lI=new Int32Array(6);static aI=[Int8Array.of(1,3,5,7),Int8Array.of(1,3,5,7),Int8Array.of(1,3,5,7),Int8Array.of(1,3,5,7,6),Int8Array.of(1,3,5,7,6),Int8Array.of(1,3,5,7,6),Int8Array.of(1,3,5,7,6),Int8Array.of(1,3,5,7,2,6),Int8Array.of(1,3,5,7,2,8),Int8Array.of(1,3,5,7,2,8),Int8Array.of(1,3,5,7,11,12),Int8Array.of(1,3,5,7,11,12),Int8Array.of(1,3,5,7,13,14)];static cI=[Int8Array.of(0,1,2,3,0,0,1,3),Int8Array.of(1,1,2,3,1,0,1,3),Int8Array.of(0,1,2,3,1,0,1,3),Int8Array.of(0,0,1,2,0,0,2,4,1,0,4,3),Int8Array.of(0,0,1,4,0,0,4,3,1,1,2,4),Int8Array.of(0,0,4,3,1,0,1,2,1,0,2,4),Int8Array.of(0,1,2,4,1,0,1,4,1,0,4,3),Int8Array.of(0,4,1,2,0,4,2,5,1,0,4,5,1,0,5,3),Int8Array.of(0,4,1,2,0,4,2,3,0,4,3,5,1,0,4,5),Int8Array.of(0,0,4,5,1,4,1,2,1,4,2,3,1,4,3,5),Int8Array.of(0,0,1,5,0,1,4,5,0,1,2,4,1,0,5,3,1,5,4,3,1,4,2,3),Int8Array.of(1,0,1,5,1,1,4,5,1,1,2,4,0,0,5,3,0,5,4,3,0,4,2,3),Int8Array.of(1,0,5,4,1,0,1,5,0,0,4,3,0,4,5,3,0,5,2,3,0,1,2,5)];static fI=128;static uI=this.fI/2|0;static dI=this.fI/4|0;static wI=3*this.fI/4|0;Fh;Rh;Uh;yI;pI;AI;mI;II;EI;gI;flat;shape;angle;_I;CI;constructor(t,i,s,h,e,n,r,o,l,a,c,f,u,d,w,y,p,A,m){this.flat=!(p!==h||p!==d||p!==o),this.shape=i,this.angle=n,this._I=u,this.CI=l;const I=Lt.aI[i],E=I.length;this.Fh=new Int32Array(E),this.Rh=new Int32Array(E),this.Uh=new Int32Array(E);const g=new Int32Array(E),_=new Int32Array(E),C=t*Lt.fI,T=A*Lt.fI;for(let t=0;t<E;t++){let i,l,c,u,A,E=I[t];!(1&E)&&E<=8&&(E=1+(E-n-n-1&7)),E>8&&E<=12&&(E=9+(E-n-9&3)),E>12&&E<=16&&(E=13+(E-n-13&3)),1===E?(i=C,l=T,c=p,u=r,A=a):2===E?(i=C+Lt.uI,l=T,c=p+h>>1,u=r+m>>1,A=a+s>>1):3===E?(i=C+Lt.fI,l=T,c=h,u=m,A=s):4===E?(i=C+Lt.fI,l=T+Lt.uI,c=h+d>>1,u=m+e>>1,A=s+w>>1):5===E?(i=C+Lt.fI,l=T+Lt.fI,c=d,u=e,A=w):6===E?(i=C+Lt.uI,l=T+Lt.fI,c=d+o>>1,u=e+y>>1,A=w+f>>1):7===E?(i=C,l=T+Lt.fI,c=o,u=y,A=f):8===E?(i=C,l=T+Lt.uI,c=o+p>>1,u=y+r>>1,A=f+a>>1):9===E?(i=C+Lt.uI,l=T+Lt.dI,c=p+h>>1,u=r+m>>1,A=a+s>>1):10===E?(i=C+Lt.wI,l=T+Lt.uI,c=h+d>>1,u=m+e>>1,A=s+w>>1):11===E?(i=C+Lt.uI,l=T+Lt.wI,c=d+o>>1,u=e+y>>1,A=w+f>>1):12===E?(i=C+Lt.dI,l=T+Lt.uI,c=o+p>>1,u=y+r>>1,A=f+a>>1):13===E?(i=C+Lt.dI,l=T+Lt.dI,c=p,u=r,A=a):14===E?(i=C+Lt.wI,l=T+Lt.dI,c=h,u=m,A=s):15===E?(i=C+Lt.wI,l=T+Lt.wI,c=d,u=e,A=w):(i=C+Lt.dI,l=T+Lt.wI,c=o,u=y,A=f),this.Fh[t]=i,this.Rh[t]=c,this.Uh[t]=l,g[t]=u,_[t]=A}const O=Lt.cI[i],b=O.length/4|0;this.mI=new Int32Array(b),this.II=new Int32Array(b),this.EI=new Int32Array(b),this.yI=new Int32Array(b),this.pI=new Int32Array(b),this.AI=new Int32Array(b),this.gI=-1!==c?new Int32Array(b):null;let L=0;for(let t=0;t<b;t++){const i=O[L];let s=O[L+1],h=O[L+2],e=O[L+3];L+=4,s<4&&(s=s-n&3),h<4&&(h=h-n&3),e<4&&(e=e-n&3),this.mI[t]=s,this.II[t]=h,this.EI[t]=e,0===i?(this.yI[t]=g[s],this.pI[t]=g[h],this.AI[t]=g[e],this.gI&&(this.gI[t]=-1)):(this.yI[t]=_[s],this.pI[t]=_[h],this.AI[t]=_[e],this.gI&&(this.gI[t]=c))}}}class vt{static TI=0;static OI=1;static bI=2;static LI=3;static vI=4;static SI=5;static uI=6;static dI=7;static wI=8;static RI=9;static MI=10;static kI=11}class St{static xI=new d(8,32,51,51,!1);static DI=new c(100,null);static NI=new Int32Array(gt.Dm);static FI=new f(gt.Dm,500,null);static UI=new c(500,null);static BI=new o;static Ji=0;static GI=0;static HI=0;static WI=0;static YI=0;static VI=0;static KI=0;static XI=0;static zI=0;static jI=0;static ZI=0;static qI=0;static $I=0;static JI=0;static QI=0;static tE=0;static iE=0;static sE=0;static hE=0;static eE=0;static nE=0;static rE=0;static oE=!1;static lE=null;static aE=Uint8Array.of(19,55,38,155,255,110,137,205,76);static cE=Uint8Array.of(160,192,80,96,0,144,80,48,160);static fE=Uint8Array.of(76,8,137,4,0,1,38,2,19);static uE=Int8Array.of(0,0,2,0,0,2,1,1,0);static dE=Int8Array.of(2,0,0,2,0,0,0,4,4);static wE=Int8Array.of(0,4,4,8,0,0,8,0,0);static yE=Int8Array.of(1,1,0,0,0,8,0,0,8);static pE=Int8Array.of(53,-53,-53,53);static AE=Int8Array.of(-53,-53,53,53);static mE=Int8Array.of(-45,45,45,-45);static IE=Int8Array.of(45,45,-45,-45);static EE=[new Int8Array(16),Int8Array.of(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Int8Array.of(1,0,0,0,1,1,0,0,1,1,1,0,1,1,1,1),Int8Array.of(1,1,0,0,1,1,0,0,1,0,0,0,1,0,0,0),Int8Array.of(0,0,1,1,0,0,1,1,0,0,0,1,0,0,0,1),Int8Array.of(0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1),Int8Array.of(1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1),Int8Array.of(1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0),Int8Array.of(0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0),Int8Array.of(1,1,1,1,1,1,1,1,0,1,1,1,0,0,1,1),Int8Array.of(1,1,1,1,1,1,0,0,1,0,0,0,1,0,0,0),Int8Array.of(0,0,0,0,0,0,1,1,0,1,1,1,0,1,1,1),Int8Array.of(0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1)];static gE=[Int8Array.of(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15),Int8Array.of(12,8,4,0,13,9,5,1,14,10,6,2,15,11,7,3),Int8Array.of(15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0),Int8Array.of(3,7,11,15,2,6,10,14,1,5,9,13,0,4,8,12)];static _E=Int32Array.of(41,39248,41,4643,41,41,41,41,41,41,41,41,41,41,41,43086,41,41,41,41,41,41,41,8602,41,28992,41,41,41,41,41,5056,41,41,41,41,41,41,41,41,41,41,41,41,41,41,3131,41,41,41);static CE=0;static gh=0;static _h=0;static TE=-1;static OE=-1;static Bi=!0;static init=(t,i,s,h,e)=>{this.GI=0,this.HI=0,this.WI=t,this.YI=i,this.VI=t/2|0,this.KI=i/2|0;const n=new d(9,32,53,53,!1);for(let t=128;t<=384;t+=32)for(let i=0;i<2048;i+=64){this.XI=O.sin[t],this.zI=O.cos[t],this.jI=O.sin[i],this.ZI=O.cos[i];const r=(t-128)/32|0,o=i/64|0;for(let t=-26;t<=26;t++)for(let i=-26;i<=26;i++){const l=128*t,a=128*i;let c=!1;for(let t=-s;t<=h;t+=128)if(this.bE(l,a,e[r]+t)){c=!0;break}n[r][o][t+25+1][i+25+1]=c}}for(let t=0;t<8;t++)for(let i=0;i<32;i++)for(let s=-25;s<25;s++)for(let h=-25;h<25;h++){let e=!1;t:for(let r=-1;r<=1;r++)for(let o=-1;o<=1;o++){if(n[t][i][s+r+25+1][h+o+25+1]){e=!0;break t}if(n[t][(i+1)%31][s+r+25+1][h+o+25+1]){e=!0;break t}if(n[t+1][i][s+r+25+1][h+o+25+1]){e=!0;break t}if(n[t+1][(i+1)%31][s+r+25+1][h+o+25+1]){e=!0;break t}}this.xI[t][i][s+25][h+25]=e}};static ns=()=>{this.DI=null,this.NI=null,this.FI=null,this.BI=null,this.xI=null,this.UI=null,this.lE=null,console.log('World3D unloaded!')};static LE=(t,i,s,h,e,n,r,o)=>{St.FI[t][St.NI[t]++]=new mt(s/128|0,n/128|0,e/128|0,o/128|0,i,s,n,e,o,h,r)};static bE=(t,i,s)=>{const h=i*this.jI+t*this.ZI>>16,e=i*this.ZI-t*this.jI>>16,n=s*this.XI+e*this.zI>>16,r=s*this.zI-e*this.XI>>16;if(n<50||n>3500)return!1;const o=this.VI+((h<<9)/n|0),l=this.KI+((r<<9)/n|0);return o>=this.GI&&o<=this.WI&&l>=this.HI&&l<=this.YI};vE;KA;zA;SE;RE;ME;kE;xE;DE;NE=0;PE=0;FE=0;constructor(t,i,s,h){this.vE=s,this.KA=h,this.zA=i,this.RE=new u(s,h,i,null),this.kE=new p(s,h+1,i+1),this.SE=t,this.ME=new c(5e3,null),this.xE=new Int32Array(1e4),this.DE=new Int32Array(1e4),this.reset()}reset=()=>{for(let t=0;t<this.vE;t++)for(let i=0;i<this.KA;i++)for(let s=0;s<this.zA;s++)this.RE[t][i][s]=null;for(let t=0;t<gt.Dm;t++){for(let i=0;i<St.NI[t];i++)St.FI[t][i]=null;St.NI[t]=0}for(let t=0;t<this.NE;t++)this.ME[t]=null;this.NE=0,St.DI.fill(null)};UE=t=>{this.PE=t;for(let i=0;i<this.KA;i++)for(let s=0;s<this.zA;s++)this.RE[t][i][s]=new At(t,i,s)};BE=(t,i)=>{const s=this.RE[0][t][i];for(let s=0;s<3;s++){this.RE[s][t][i]=this.RE[s+1][t][i];const h=this.RE[s][t][i];h&&h.level--}this.RE[0][t][i]||(this.RE[0][t][i]=new At(0,t,i));const h=this.RE[0][t][i];h&&(h.NA=s),this.RE[3][t][i]=null};GE=(t,i,s,h)=>{const e=this.RE[t][i][s];e&&(e.UA=h)};HE=(t,i,s,h,e,n,r,o,l,a,c,f,u,d,w,y,p,A,m,I)=>{if(h===vt.TI){for(let h=t;h>=0;h--)this.RE[h][i][s]||(this.RE[h][i][s]=new At(h,i,s));const h=this.RE[t][i][s];h&&(h.SA=new bt(c,f,u,d,-1,m,!1))}else if(h===vt.OI){for(let h=t;h>=0;h--)this.RE[h][i][s]||(this.RE[h][i][s]=new At(h,i,s));const h=this.RE[t][i][s];h&&(h.SA=new bt(w,y,p,A,n,I,r===o&&r===l&&r===a))}else{for(let h=t;h>=0;h--)this.RE[h][i][s]||(this.RE[h][i][s]=new At(h,i,s));const E=this.RE[t][i][s];E&&(E.RA=new Lt(i,h,y,o,u,e,c,a,I,w,n,A,m,l,p,d,r,s,f))}};WE=(t,i,s,h,e,n,r)=>{this.RE[i][s][h]||(this.RE[i][s][h]=new At(i,s,h));const o=this.RE[i][s][h];o&&(o.xA=new _t(e,128*s+64,128*h+64,t,n,r))};YE=(t,i,s)=>{const h=this.RE[t][i][s];h&&(h.xA=null)};VE=(t,i,s,h,e,n,r,o)=>{let l=0;const a=this.RE[h][t][i];if(a)for(let t=0;t<a.PA;t++){const i=a.LA[t];if(!i||!i.model)continue;const s=i.model.de;s>l&&(l=s)}else this.RE[h][t][i]=new At(h,t,i);const c=this.RE[h][t][i];c&&(c.DA=new Ot(s,128*t+64,128*i+64,n,r,o,e,l))};KE=(t,i,s)=>{const h=this.RE[t][i][s];h&&(h.DA=null)};Hm=(t,i,s,h,e,n,r,o,l,a)=>{if(!r&&!o)return;for(let h=t;h>=0;h--)this.RE[h][i][s]||(this.RE[h][i][s]=new At(h,i,s));const c=this.RE[t][i][s];c&&(c.MA=new Ct(h,128*i+64,128*s+64,e,n,r,o,l,a))};Wm=(t,i,s,h)=>{const e=this.RE[t][i][s];1===h&&e&&(e.MA=null)};XE=(t,i,s,h,e,n,r,o,l,a,c)=>{if(!o)return;for(let h=t;h>=0;h--)this.RE[h][i][s]||(this.RE[h][i][s]=new At(h,i,s));const f=this.RE[t][i][s];f&&(f.kA=new Tt(h,128*i+e+64,128*s+n+64,c,a,o,r,l))};zE=(t,i,s)=>{const h=this.RE[t][i][s];h&&(h.kA=null)};jE=(t,i,s,h)=>{const e=this.RE[t][i][s];if(!e)return;const n=e.kA;if(!n)return;const r=128*i+64,o=128*s+64;n.x=r+((n.x-r)*h/16|0),n.z=o+((n.z-o)*h/16|0)};ZE=(t,i,s,h)=>{if(!h)return;const e=this.RE[t][i][s];if(!e)return;const n=e.kA;n&&(n.model=h)};qE=(t,i,s,h)=>{if(!h)return;const e=this.RE[t][i][s];if(!e)return;const n=e.xA;n&&(n.model=h)};$E=(t,i,s,h)=>{if(!h)return;const e=this.RE[t][i][s];if(!e)return;const n=e.MA;n&&(n.jm=h)};JE=(t,i,s,h,e)=>{if(!h)return;const n=this.RE[s][t][i];if(!n)return;const r=n.MA;r&&(r.jm=h,r.Zm=e)};Bm=(t,i,s,h,e,n,r,o,l,a,c)=>{if(!e&&!n)return!0;const f=128*i+64*l,u=128*s+64*a;return this.QE(f,u,h,t,i,s,l,a,e,n,r,o,c,!1)};tg=(t,i,s,h,e,n,r,o,l,a)=>{if(!e&&!n)return!0;let c=i-l,f=h-l,u=i+l,d=h+l;return a&&(o>640&&o<1408&&(d+=128),o>1152&&o<1920&&(u+=128),(o>1664||o<384)&&(f-=128),o>128&&o<896&&(c-=128)),c=c/128|0,f=f/128|0,u=u/128|0,d=d/128|0,this.QE(i,h,s,t,c,f,u+1-c,d-f+1,e,n,r,0,o,!0)};ig=(t,i,s,h,e,n,r,o,l,a,c,f)=>!l&&!a||this.QE(i,h,s,t,e,n,r+1-e,o-n+1,l,a,c,0,f,!0);Gm=(t,i,s)=>{const h=this.RE[t][i][s];if(h)for(let t=0;t<h.PA;t++){const e=h.LA[t];if(e&&2==(e.TA>>29&3)&&e.EA===i&&e._A===s)return void this.sg(e)}};hg=(t,i,s,h)=>{if(!h)return;const e=this.RE[t][i][s];if(e)for(let t=0;t<e.PA;t++){const i=e.LA[t];if(i&&2==(i.TA>>29&3))return void(i.model=h)}};eg=()=>{for(let t=0;t<this.NE;t++){const i=this.ME[t];i&&this.sg(i),this.ME[t]=null}this.NE=0};ng=(t,i,s)=>{const h=this.RE[t][i][s];return h&&h.MA?h.MA.TA:0};rg=(t,i,s)=>{const h=this.RE[t][s][i];return h&&h.kA?h.kA.TA:0};og=(t,i,s)=>{const h=this.RE[t][i][s];if(!h)return 0;for(let t=0;t<h.PA;t++){const e=h.LA[t];if(e&&2==(e.TA>>29&3)&&e.EA===i&&e._A===s)return e.TA}return 0};lg=(t,i,s)=>{const h=this.RE[t][i][s];return h&&h.xA?h.xA.TA:0};ag=(t,i,s,h)=>{const e=this.RE[t][i][s];if(e){if(e.MA&&e.MA.TA===h)return 255&e.MA.info;if(e.kA&&e.kA.TA===h)return 255&e.kA.info;if(e.xA&&e.xA.TA===h)return 255&e.xA.info;for(let t=0;t<e.PA;t++){const i=e.LA[t];if(i&&i.TA===h)return 255&i.info}return-1}return-1};cg=(t,i,s,h,e)=>{const n=i*(0|Math.sqrt(s*s+h*h+e*e))>>8;for(let i=0;i<this.vE;i++)for(let r=0;r<this.KA;r++)for(let o=0;o<this.zA;o++){const l=this.RE[i][r][o];if(!l)continue;const a=l.MA;a&&a.jm&&a.jm.Nh&&(this.fg(i,r,o,1,1,a.jm),a.Zm&&a.Zm.Nh&&(this.fg(i,r,o,1,1,a.Zm),this.ug(a.jm,a.Zm,0,0,0,!1),a.Zm.Le(t,n,s,h,e)),a.jm.Le(t,n,s,h,e));for(let a=0;a<l.PA;a++){const c=l.LA[a];c&&c.model&&c.model.Nh&&(this.fg(i,r,o,c.gA+1-c.EA,c.CA-c._A+1,c.model),c.model.Le(t,n,s,h,e))}const c=l.xA;c&&c.model&&c.model.Nh&&(this.dg(i,r,o,c.model),c.model.Le(t,n,s,h,e))}};dg=(t,i,s,h)=>{if(i<this.KA){const e=this.RE[t][i+1][s];e&&e.xA&&e.xA.model&&e.xA.model.Nh&&this.ug(h,e.xA.model,128,0,0,!0)}if(s<this.KA){const e=this.RE[t][i][s+1];e&&e.xA&&e.xA.model&&e.xA.model.Nh&&this.ug(h,e.xA.model,0,0,128,!0)}if(i<this.KA&&s<this.zA){const e=this.RE[t][i+1][s+1];e&&e.xA&&e.xA.model&&e.xA.model.Nh&&this.ug(h,e.xA.model,128,0,128,!0)}if(i<this.KA&&s>0){const e=this.RE[t][i+1][s-1];e&&e.xA&&e.xA.model&&e.xA.model.Nh&&this.ug(h,e.xA.model,128,0,-128,!0)}};fg=(t,i,s,h,e,n)=>{let r=!0,o=i;const l=i+h,a=s-1,c=s+e;for(let f=t;f<=t+1;f++)if(f!==this.vE){for(let u=o;u<=l;u++)if(!(u<0||u>=this.KA))for(let o=a;o<=c;o++){if(o<0||o>=this.zA||r&&u<l&&o<c&&(o>=s||u===i))continue;const a=this.RE[f][u][o];if(!a)continue;const d=128*(u-i)+64*(1-h),w=128*(o-s)+64*(1-e),y=((this.SE[f][u][o]+this.SE[f][u+1][o]+this.SE[f][u][o+1]+this.SE[f][u+1][o+1])/4|0)-((this.SE[t][i][s]+this.SE[t][i+1][s]+this.SE[t][i][s+1]+this.SE[t][i+1][s+1])/4|0),p=a.MA;p&&p.jm&&p.jm.Nh&&this.ug(n,p.jm,d,y,w,r),p&&p.Zm&&p.Zm.Nh&&this.ug(n,p.Zm,d,y,w,r);for(let t=0;t<a.PA;t++){const o=a.LA[t];if(!o||!o.model||!o.model.Nh)continue;const l=o.gA+1-o.EA,c=o.CA+1-o._A;this.ug(n,o.model,128*(o.EA-i)+64*(l-h),y,128*(o._A-s)+64*(c-e),r)}}o--,r=!1}};ug=(t,i,s,h,e,n)=>{this.FE++;let r=0;const o=i.Fh,l=i.Ts;if(t.Nh&&t.Ph)for(let n=0;n<t.Ts;n++){const a=t.Nh[n],c=t.Ph[n];if(c&&0!==c.w){const f=t.Rh[n]-h;if(f>i.Qh)continue;const u=t.Fh[n]-s;if(u<i.jh||u>i.Zh)continue;const d=t.Uh[n]-e;if(d<i.qh||d>i.$h)continue;if(i.Nh&&i.Ph)for(let t=0;t<l;t++){const s=i.Nh[t],h=i.Ph[t];u!==o[t]||d!==i.Uh[t]||f!==i.Rh[t]||h&&0===h.w||(a&&s&&h&&(a.x+=h.x,a.y+=h.y,a.z+=h.z,a.w+=h.w,s.x+=c.x,s.y+=c.y,s.z+=c.z,s.w+=c.w,r++),this.xE[n]=this.FE,this.DE[t]=this.FE)}}}if(!(r<3)&&n){if(t.Dh)for(let i=0;i<t.Os;i++)this.xE[t.Bh[i]]===this.FE&&this.xE[t.Gh[i]]===this.FE&&this.xE[t.Hh[i]]===this.FE&&(t.Dh[i]=-1);if(i.Dh)for(let t=0;t<i.Os;t++)this.DE[i.Bh[t]]===this.FE&&this.DE[i.Gh[t]]===this.FE&&this.DE[i.Hh[t]]===this.FE&&(i.Dh[t]=-1)}};wg=(t,i,s,h,e,n)=>{const r=this.RE[t][i][s];if(!r)return;const o=r.SA;if(o){const t=o.color;if(0!==t)for(let i=0;i<4;i++)h[e]=t,h[e+1]=t,h[e+2]=t,h[e+3]=t,e+=n;return}const l=r.RA;if(!l)return;const a=l.shape,c=l.angle,f=l._I,u=l.CI,d=St.EE[a],w=St.gE[c];let y=0;if(0===f)for(let t=0;t<4;t++)0!==d[w[y++]]&&(h[e]=u),0!==d[w[y++]]&&(h[e+1]=u),0!==d[w[y++]]&&(h[e+2]=u),0!==d[w[y++]]&&(h[e+3]=u),e+=n;else for(let t=0;t<4;t++)h[e]=0===d[w[y++]]?f:u,h[e+1]=0===d[w[y++]]?f:u,h[e+2]=0===d[w[y++]]?f:u,h[e+3]=0===d[w[y++]]?f:u,e+=n};click=(t,i)=>{St.oE=!0,St.gh=t,St._h=i,St.TE=-1,St.OE=-1};draw=(t,i,s,h,e,n,r)=>{t<0?t=0:t>=128*this.KA&&(t=128*this.KA-1),s<0?s=0:s>=128*this.zA&&(s=128*this.zA-1),St.Ji++,St.XI=O.sin[n],St.zI=O.cos[n],St.jI=O.sin[e],St.ZI=O.cos[e],St.lE=St.xI[(n-128)/32|0][e/64|0],St.qI=t,St.$I=i,St.JI=s,St.QI=t/128|0,St.tE=s/128|0,St.nE=h,St.iE=St.QI-25,St.iE<0&&(St.iE=0),St.hE=St.tE-25,St.hE<0&&(St.hE=0),St.sE=St.QI+25,St.sE>this.KA&&(St.sE=this.KA),St.eE=St.tE+25,St.eE>this.zA&&(St.eE=this.zA),this.yg(),St.rE=0;for(let t=this.PE;t<this.vE;t++){const s=this.RE[t];for(let e=St.iE;e<St.sE;e++)for(let n=St.hE;n<St.eE;n++){const r=s[e][n];r&&(r.UA<=h&&(St.lE[e+25-St.QI][n+25-St.tE]||this.SE[t][e][n]-i>=2e3)?(r.visible=!0,r.update=!0,r.BA=r.PA>0,St.rE++):(r.visible=!1,r.update=!1,r.GA=0))}}for(let t=this.PE;t<this.vE;t++){const i=this.RE[t];for(let t=-25;t<=0;t++){const s=St.QI+t,h=St.QI-t;if(!(s<St.iE&&h>=St.sE))for(let t=-25;t<=0;t++){const e=St.tE+t,n=St.tE-t;let o;if(s>=St.iE&&(e>=St.hE&&(o=i[s][e],o&&o.visible&&this.pg(o,!0,r)),n<St.eE&&(o=i[s][n],o&&o.visible&&this.pg(o,!0,r))),h<St.sE&&(e>=St.hE&&(o=i[h][e],o&&o.visible&&this.pg(o,!0,r)),n<St.eE&&(o=i[h][n],o&&o.visible&&this.pg(o,!0,r))),0===St.rE)return void(St.oE=!1)}}}for(let t=this.PE;t<this.vE;t++){const i=this.RE[t];for(let t=-25;t<=0;t++){const s=St.QI+t,h=St.QI-t;if(!(s<St.iE&&h>=St.sE))for(let t=-25;t<=0;t++){const e=St.tE+t,n=St.tE-t;let o;if(s>=St.iE&&(e>=St.hE&&(o=i[s][e],o&&o.visible&&this.pg(o,!1,r)),n<St.eE&&(o=i[s][n],o&&o.visible&&this.pg(o,!1,r))),h<St.sE&&(e>=St.hE&&(o=i[h][e],o&&o.visible&&this.pg(o,!1,r)),n<St.eE&&(o=i[h][n],o&&o.visible&&this.pg(o,!1,r))),0===St.rE)return void(St.oE=!1)}}}};QE=(t,i,s,h,e,n,r,o,l,a,c,f,u,d)=>{if(!l&&!a)return!1;for(let t=e;t<e+r;t++)for(let i=n;i<n+o;i++){if(t<0||i<0||t>=this.KA||i>=this.zA)return!1;const s=this.RE[h][t][i];if(s&&s.PA>=5)return!1}const w=new pt(h,s,t,i,l,a,u,e,e+r-1,n,n+o-1,c,f);for(let t=e;t<e+r;t++)for(let i=n;i<n+o;i++){let s=0;t>e&&(s|=1),t<e+r-1&&(s+=4),i>n&&(s+=8),i<n+o-1&&(s+=2);for(let s=h;s>=0;s--)this.RE[s][t][i]||(this.RE[s][t][i]=new At(s,t,i));const l=this.RE[h][t][i];l&&(l.LA[l.PA]=w,l.vA[l.PA]=s,l.FA|=s,l.PA++)}return d&&(this.ME[this.NE++]=w),!0};sg=t=>{for(let i=t.EA;i<=t.gA;i++)for(let s=t._A;s<=t.CA;s++){const h=this.RE[t.level][i][s];if(h){for(let i=0;i<h.PA;i++)if(h.LA[i]===t){h.PA--;for(let t=i;t<h.PA;t++)h.LA[t]=h.LA[t+1],h.vA[t]=h.vA[t+1];h.LA[h.PA]=null;break}h.FA=0;for(let t=0;t<h.PA;t++)h.FA|=h.vA[t]}}};yg=()=>{const t=St.NI[St.nE],i=St.FI[St.nE];St.CE=0;for(let s=0;s<t;s++){const t=i[s];if(!t)continue;let h,e,n,r;if(1===t.type){if(h=t.VA+25-St.QI,h>=0&&h<=50){e=t.XA+25-St.tE,e<0&&(e=0),n=t.zA+25-St.tE,n>50&&(n=50);let i=!1;for(;e<=n;)if(St.lE&&St.lE[h][e++]){i=!0;break}if(i){if(r=St.qI-t.jh,r>32)t.mode=1;else{if(r>=-32)continue;t.mode=2,r=-r}t.qA=(t.qh-St.JI<<8)/r|0,t.$A=(t.$h-St.JI<<8)/r|0,t.JA=(t.Qh-St.$I<<8)/r|0,t.QA=(t.te-St.$I<<8)/r|0,St.UI[St.CE++]=t}}}else if(2===t.type){if(h=t.XA+25-St.tE,h>=0&&h<=50){e=t.VA+25-St.QI,e<0&&(e=0),n=t.KA+25-St.QI,n>50&&(n=50);let i=!1;for(;e<=n;)if(St.lE&&St.lE[e++][h]){i=!0;break}if(i){if(r=St.JI-t.qh,r>32)t.mode=3;else{if(r>=-32)continue;t.mode=4,r=-r}t.jA=(t.jh-St.qI<<8)/r|0,t.ZA=(t.Zh-St.qI<<8)/r|0,t.JA=(t.Qh-St.$I<<8)/r|0,t.QA=(t.te-St.$I<<8)/r|0,St.UI[St.CE++]=t}}}else if(4===t.type&&(h=t.Qh-St.$I,h>128&&(e=t.XA+25-St.tE,e<0&&(e=0),n=t.zA+25-St.tE,n>50&&(n=50),e<=n))){let i=t.VA+25-St.QI;i<0&&(i=0),r=t.KA+25-St.QI,r>50&&(r=50);let s=!1;t:for(let t=i;t<=r;t++)for(let i=e;i<=n;i++)if(St.lE&&St.lE[t][i]){s=!0;break t}s&&(t.mode=5,t.jA=(t.jh-St.qI<<8)/h|0,t.ZA=(t.Zh-St.qI<<8)/h|0,t.qA=(t.qh-St.JI<<8)/h|0,t.$A=(t.$h-St.JI<<8)/h|0,St.UI[St.CE++]=t)}}};pg=(t,i,s)=>{for(St.BI.rt(t);;){let t;do{if(t=St.BI.lt(),!t)return}while(!t.update);const h=t.x,e=t.z,n=t.level,r=t.bA,o=this.RE[n];if(t.visible){if(i){if(n>0){const t=this.RE[n-1][h][e];if(t&&t.update)continue}if(h<=St.QI&&h>St.iE){const i=o[h-1][e];if(i&&i.update&&(i.visible||!(1&t.FA)))continue}if(h>=St.QI&&h<St.sE-1){const i=o[h+1][e];if(i&&i.update&&(i.visible||!(4&t.FA)))continue}if(e<=St.tE&&e>St.hE){const i=o[h][e-1];if(i&&i.update&&(i.visible||!(8&t.FA)))continue}if(e>=St.tE&&e<St.eE-1){const i=o[h][e+1];if(i&&i.update&&(i.visible||!(2&t.FA)))continue}}else i=!0;if(t.visible=!1,t.NA){const i=t.NA;i.SA?this.Ag(0,h,e)||this.mg(i.SA,0,h,e,St.XI,St.zI,St.jI,St.ZI):i.RA&&!this.Ag(0,h,e)&&this.Ig(h,e,i.RA,St.XI,St.zI,St.jI,St.ZI);const n=i.MA;n&&n.jm?.draw(0,St.XI,St.zI,St.jI,St.ZI,n.x-St.qI,n.y-St.$I,n.z-St.JI,n.TA);for(let t=0;t<i.PA;t++){const h=i.LA[t];if(h){let t=h.model;t||(t=h.mA?.draw(s)??null),t?.draw(h.IA,St.XI,St.zI,St.jI,St.ZI,h.x-St.qI,h.y-St.$I,h.z-St.JI,h.TA)}}}let l=!1;t.SA?this.Ag(r,h,e)||(l=!0,this.mg(t.SA,r,h,e,St.XI,St.zI,St.jI,St.ZI)):t.RA&&!this.Ag(r,h,e)&&(l=!0,this.Ig(h,e,t.RA,St.XI,St.zI,St.jI,St.ZI));let a=0,c=0;const f=t.MA,u=t.kA;if((f||u)&&(St.QI===h?a+=1:St.QI<h&&(a+=2),St.tE===e?a+=3:St.tE>e&&(a+=6),c=St.aE[a],t.YA=St.fE[a]),f&&(f.Xm&St.cE[a]?16===f.Xm?(t.GA=3,t.HA=St.uE[a],t.WA=3-t.HA):32===f.Xm?(t.GA=6,t.HA=St.dE[a],t.WA=6-t.HA):64===f.Xm?(t.GA=12,t.HA=St.wE[a],t.WA=12-t.HA):(t.GA=9,t.HA=St.yE[a],t.WA=9-t.HA):t.GA=0,f.Xm&c&&!this.Eg(r,h,e,f.Xm)&&f.jm?.draw(0,St.XI,St.zI,St.jI,St.ZI,f.x-St.qI,f.y-St.$I,f.z-St.JI,f.TA),f.zm&c&&!this.Eg(r,h,e,f.zm)&&f.Zm?.draw(0,St.XI,St.zI,St.jI,St.ZI,f.x-St.qI,f.y-St.$I,f.z-St.JI,f.TA)),u&&!this.visible(r,h,e,u.model.te))if(u.type&c)u.model.draw(u.angle,St.XI,St.zI,St.jI,St.ZI,u.x-St.qI,u.y-St.$I,u.z-St.JI,u.TA);else if(768&u.type){const t=u.x-St.qI,i=u.y-St.$I,s=u.z-St.JI,h=u.angle;let e,n;if(e=h===M.fn||h===M.un?-t:t,n=h===M.un||h===M.dn?-s:s,256&u.type&&n<e){const e=t+St.pE[h],n=s+St.AE[h];u.model.draw(512*h+256,St.XI,St.zI,St.jI,St.ZI,e,i,n,u.TA)}if(512&u.type&&n>e){const e=t+St.mE[h],n=s+St.IE[h];u.model.draw(512*h+1280&2047,St.XI,St.zI,St.jI,St.ZI,e,i,n,u.TA)}}if(l){const i=t.xA;i&&i.model?.draw(0,St.XI,St.zI,St.jI,St.ZI,i.x-St.qI,i.y-St.$I,i.z-St.JI,i.TA);const s=t.DA;s&&0===s.offset&&(s.Jm&&s.Jm.draw(0,St.XI,St.zI,St.jI,St.ZI,s.x-St.qI,s.y-St.$I,s.z-St.JI,s.TA),s.$m&&s.$m.draw(0,St.XI,St.zI,St.jI,St.ZI,s.x-St.qI,s.y-St.$I,s.z-St.JI,s.TA),s.qm&&s.qm.draw(0,St.XI,St.zI,St.jI,St.ZI,s.x-St.qI,s.y-St.$I,s.z-St.JI,s.TA))}const d=t.FA;if(0!==d){if(h<St.QI&&4&d){const t=o[h+1][e];t&&t.update&&St.BI.rt(t)}if(e<St.tE&&2&d){const t=o[h][e+1];t&&t.update&&St.BI.rt(t)}if(h>St.QI&&1&d){const t=o[h-1][e];t&&t.update&&St.BI.rt(t)}if(e>St.tE&&8&d){const t=o[h][e-1];t&&t.update&&St.BI.rt(t)}}}if(0!==t.GA){let i=!0;for(let s=0;s<t.PA;s++){const h=t.LA[s];if(h&&(h.Ji!==St.Ji&&(t.vA[s]&t.GA)===t.HA)){i=!1;break}}if(i){const i=t.MA;i&&!this.Eg(r,h,e,i.Xm)&&i.jm?.draw(0,St.XI,St.zI,St.jI,St.ZI,i.x-St.qI,i.y-St.$I,i.z-St.JI,i.TA),t.GA=0}}if(t.BA){const i=t.PA;t.BA=!1;let n=0;t:for(let s=0;s<i;s++){const i=t.LA[s];if(!i||i.Ji===St.Ji)continue;for(let s=i.EA;s<=i.gA;s++)for(let h=i._A;h<=i.CA;h++){const e=o[s][h];if(e){if(!e.visible){if(0===e.GA)continue;let n=0;if(s>i.EA&&(n+=1),s<i.gA&&(n+=4),h>i._A&&(n+=8),h<i.CA&&(n+=2),(n&e.GA)!==t.WA)continue}t.BA=!0;continue t}}St.DI[n++]=i;let h=St.QI-i.EA;const e=i.gA-St.QI;e>h&&(h=e);const r=St.tE-i._A,l=i.CA-St.tE;i.OA=l>r?h+l:h+r}for(;;){let t=-50,i=-1;for(let s=0;s<n;s++){const h=St.DI[s];h&&(h.Ji!==St.Ji&&h.OA>t&&(t=h.OA,i=s))}if(-1===i)break;const l=St.DI[i];if(l){l.Ji=St.Ji;let t=l.model;t||(t=l.mA?.draw(s)??null),t&&!this.gg(r,l.EA,l.gA,l._A,l.CA,t.te)&&t.draw(l.IA,St.XI,St.zI,St.jI,St.ZI,l.x-St.qI,l.y-St.$I,l.z-St.JI,l.TA);for(let t=l.EA;t<=l.gA;t++)for(let i=l._A;i<=l.CA;i++){const s=o[t][i];s&&(0!==s.GA?St.BI.rt(s):t===h&&i===e||!s.update||St.BI.rt(s))}}}if(t.BA)continue}if(!t.update||0!==t.GA)continue;if(h<=St.QI&&h>St.iE){const t=o[h-1][e];if(t&&t.update)continue}if(h>=St.QI&&h<St.sE-1){const t=o[h+1][e];if(t&&t.update)continue}if(e<=St.tE&&e>St.hE){const t=o[h][e-1];if(t&&t.update)continue}if(e>=St.tE&&e<St.eE-1){const t=o[h][e+1];if(t&&t.update)continue}t.update=!1,St.rE--;const l=t.DA;if(l&&0!==l.offset&&(l.Jm&&l.Jm.draw(0,St.XI,St.zI,St.jI,St.ZI,l.x-St.qI,l.y-St.$I-l.offset,l.z-St.JI,l.TA),l.$m&&l.$m.draw(0,St.XI,St.zI,St.jI,St.ZI,l.x-St.qI,l.y-St.$I-l.offset,l.z-St.JI,l.TA),l.qm&&l.qm.draw(0,St.XI,St.zI,St.jI,St.ZI,l.x-St.qI,l.y-St.$I-l.offset,l.z-St.JI,l.TA)),0!==t.YA){const i=t.kA;if(i&&!this.visible(r,h,e,i.model.te))if(i.type&t.YA)i.model.draw(i.angle,St.XI,St.zI,St.jI,St.ZI,i.x-St.qI,i.y-St.$I,i.z-St.JI,i.TA);else if(768&i.type){const t=i.x-St.qI,s=i.y-St.$I,h=i.z-St.JI,e=i.angle;let n,r;if(n=e===M.fn||e===M.un?-t:t,r=e===M.un||e===M.dn?-h:h,256&i.type&&r>=n){const n=t+St.pE[e],r=h+St.AE[e];i.model.draw(512*e+256,St.XI,St.zI,St.jI,St.ZI,n,s,r,i.TA)}if(512&i.type&&r<=n){const n=t+St.mE[e],r=h+St.IE[e];i.model.draw(512*e+1280&2047,St.XI,St.zI,St.jI,St.ZI,n,s,r,i.TA)}}const s=t.MA;s&&(s.zm&t.YA&&!this.Eg(r,h,e,s.zm)&&s.Zm?.draw(0,St.XI,St.zI,St.jI,St.ZI,s.x-St.qI,s.y-St.$I,s.z-St.JI,s.TA),s.Xm&t.YA&&!this.Eg(r,h,e,s.Xm)&&s.jm?.draw(0,St.XI,St.zI,St.jI,St.ZI,s.x-St.qI,s.y-St.$I,s.z-St.JI,s.TA))}if(n<this.vE-1){const t=this.RE[n+1][h][e];t&&t.update&&St.BI.rt(t)}if(h<St.QI){const t=o[h+1][e];t&&t.update&&St.BI.rt(t)}if(e<St.tE){const t=o[h][e+1];t&&t.update&&St.BI.rt(t)}if(h>St.QI){const t=o[h-1][e];t&&t.update&&St.BI.rt(t)}if(e>St.tE){const t=o[h][e-1];t&&t.update&&St.BI.rt(t)}}};mg=(t,i,s,h,e,n,r,o)=>{let l,a,c,f,u=l=(s<<7)-St.qI,d=a=(h<<7)-St.JI,w=c=u+128,y=f=d+128,p=this.SE[i][s][h]-St.$I,A=this.SE[i][s+1][h]-St.$I,m=this.SE[i][s+1][h+1]-St.$I,I=this.SE[i][s][h+1]-St.$I,E=d*r+u*o>>16;if(d=d*o-u*r>>16,u=E,E=p*n-d*e>>16,d=p*e+d*n>>16,p=E,d<50)return;if(E=a*r+w*o>>16,a=a*o-w*r>>16,w=E,E=A*n-a*e>>16,a=A*e+a*n>>16,A=E,a<50)return;if(E=y*r+c*o>>16,y=y*o-c*r>>16,c=E,E=m*n-y*e>>16,y=m*e+y*n>>16,m=E,y<50)return;if(E=f*r+l*o>>16,f=f*o-l*r>>16,l=E,E=I*n-f*e>>16,f=I*e+f*n>>16,I=E,f<50)return;const g=O.Ki+((u<<9)/d|0),_=O.Xi+((p<<9)/d|0),T=O.Ki+((w<<9)/a|0),b=O.Xi+((A<<9)/a|0),L=O.Ki+((c<<9)/y|0),v=O.Xi+((m<<9)/y|0),S=O.Ki+((l<<9)/f|0),R=O.Xi+((I<<9)/f|0);if(O.alpha=0,(L-S)*(b-R)-(v-R)*(T-S)>0)if(O.ji=L<0||S<0||T<0||L>C.pi||S>C.pi||T>C.pi,St.oE&&this._g(St.gh,St._h,v,R,b,L,S,T)&&(St.TE=s,St.OE=h),-1===t.hI)12345678!==t.iI&&O.ps(L,S,T,v,R,b,t.iI,t.sI,t.tI);else if(St.Bi){const i=St._E[t.hI];O.ps(L,S,T,v,R,b,this.Cg(i,t.iI),this.Cg(i,t.sI),this.Cg(i,t.tI))}else t.flat?O.gs(L,S,T,v,R,b,t.iI,t.sI,t.tI,u,p,d,w,l,A,I,a,f,t.hI):O.gs(L,S,T,v,R,b,t.iI,t.sI,t.tI,c,m,y,l,w,I,A,f,a,t.hI);if(!((g-T)*(R-b)-(_-b)*(S-T)<=0))if(O.ji=g<0||T<0||S<0||g>C.pi||T>C.pi||S>C.pi,St.oE&&this._g(St.gh,St._h,_,b,R,g,T,S)&&(St.TE=s,St.OE=h),-1!==t.hI){if(!St.Bi)return void O.gs(g,T,S,_,b,R,t.Qm,t.tI,t.sI,u,p,d,w,l,A,I,a,f,t.hI);const i=St._E[t.hI];O.ps(g,T,S,_,b,R,this.Cg(i,t.Qm),this.Cg(i,t.tI),this.Cg(i,t.sI))}else 12345678!==t.Qm&&O.ps(g,T,S,_,b,R,t.Qm,t.tI,t.sI)};Ig=(t,i,s,h,e,n,r)=>{let o=s.Fh.length;for(let t=0;t<o;t++){let i=s.Fh[t]-St.qI,o=s.Rh[t]-St.$I,l=s.Uh[t]-St.JI,a=l*n+i*r>>16;if(l=l*r-i*n>>16,i=a,a=o*e-l*h>>16,l=o*h+l*e>>16,o=a,l<50)return;s.gI&&(Lt.rI[t]=i,Lt.oI[t]=o,Lt.lI[t]=l),Lt.eI[t]=O.Ki+((i<<9)/l|0),Lt.nI[t]=O.Xi+((o<<9)/l|0)}O.alpha=0,o=s.mI.length;for(let h=0;h<o;h++){const e=s.mI[h],n=s.II[h],r=s.EI[h],o=Lt.eI[e],l=Lt.eI[n],a=Lt.eI[r],c=Lt.nI[e],f=Lt.nI[n],u=Lt.nI[r];if((o-l)*(u-f)-(c-f)*(a-l)>0)if(O.ji=o<0||l<0||a<0||o>C.pi||l>C.pi||a>C.pi,St.oE&&this._g(St.gh,St._h,c,f,u,o,l,a)&&(St.TE=t,St.OE=i),s.gI&&-1!==s.gI[h])if(St.Bi){const t=St._E[s.gI[h]];O.ps(o,l,a,c,f,u,this.Cg(t,s.yI[h]),this.Cg(t,s.pI[h]),this.Cg(t,s.AI[h]))}else s.flat?O.gs(o,l,a,c,f,u,s.yI[h],s.pI[h],s.AI[h],Lt.rI[0],Lt.oI[0],Lt.lI[0],Lt.rI[1],Lt.rI[3],Lt.oI[1],Lt.oI[3],Lt.lI[1],Lt.lI[3],s.gI[h]):O.gs(o,l,a,c,f,u,s.yI[h],s.pI[h],s.AI[h],Lt.rI[e],Lt.oI[e],Lt.lI[e],Lt.rI[n],Lt.rI[r],Lt.oI[n],Lt.oI[r],Lt.lI[n],Lt.lI[r],s.gI[h]);else 12345678!==s.yI[h]&&O.ps(o,l,a,c,f,u,s.yI[h],s.pI[h],s.AI[h])}};Ag=(t,i,s)=>{const h=this.kE[t][i][s];if(h===-St.Ji)return!1;if(h===St.Ji)return!0;{const h=i<<7,e=s<<7;return this.Tg(h+1,this.SE[t][i][s],e+1)&&this.Tg(h+128-1,this.SE[t][i+1][s],e+1)&&this.Tg(h+128-1,this.SE[t][i+1][s+1],e+128-1)&&this.Tg(h+1,this.SE[t][i][s+1],e+128-1)?(this.kE[t][i][s]=St.Ji,!0):(this.kE[t][i][s]=-St.Ji,!1)}};Eg=(t,i,s,h)=>{if(!this.Ag(t,i,s))return!1;const e=i<<7,n=s<<7,r=this.SE[t][i][s]-1,o=r-120,l=r-230,a=r-238;if(h<16){if(1===h){if(e>St.qI){if(!this.Tg(e,r,n))return!1;if(!this.Tg(e,r,n+128))return!1}if(t>0){if(!this.Tg(e,o,n))return!1;if(!this.Tg(e,o,n+128))return!1}return!!this.Tg(e,l,n)&&this.Tg(e,l,n+128)}if(2===h){if(n<St.JI){if(!this.Tg(e,r,n+128))return!1;if(!this.Tg(e+128,r,n+128))return!1}if(t>0){if(!this.Tg(e,o,n+128))return!1;if(!this.Tg(e+128,o,n+128))return!1}return!!this.Tg(e,l,n+128)&&this.Tg(e+128,l,n+128)}if(4===h){if(e<St.qI){if(!this.Tg(e+128,r,n))return!1;if(!this.Tg(e+128,r,n+128))return!1}if(t>0){if(!this.Tg(e+128,o,n))return!1;if(!this.Tg(e+128,o,n+128))return!1}return!!this.Tg(e+128,l,n)&&this.Tg(e+128,l,n+128)}if(8===h){if(n>St.JI){if(!this.Tg(e,r,n))return!1;if(!this.Tg(e+128,r,n))return!1}if(t>0){if(!this.Tg(e,o,n))return!1;if(!this.Tg(e+128,o,n))return!1}return!!this.Tg(e,l,n)&&this.Tg(e+128,l,n)}}return!!this.Tg(e+64,a,n+64)&&(16===h?this.Tg(e,l,n+128):32===h?this.Tg(e+128,l,n+128):64===h?this.Tg(e+128,l,n):128===h?this.Tg(e,l,n):(console.warn('Warning unsupported wall type!'),!0))};visible=(t,i,s,h)=>{if(this.Ag(t,i,s)){const e=i<<7,n=s<<7;return this.Tg(e+1,this.SE[t][i][s]-h,n+1)&&this.Tg(e+128-1,this.SE[t][i+1][s]-h,n+1)&&this.Tg(e+128-1,this.SE[t][i+1][s+1]-h,n+128-1)&&this.Tg(e+1,this.SE[t][i][s+1]-h,n+128-1)}return!1};gg=(t,i,s,h,e,n)=>{let r,o;if(i!==s||h!==e){for(r=i;r<=s;r++)for(o=h;o<=e;o++)if(this.kE[t][r][o]===-St.Ji)return!1;o=1+(i<<7);const l=2+(h<<7),a=this.SE[t][i][h]-n;if(!this.Tg(o,a,l))return!1;const c=(s<<7)-1;if(!this.Tg(c,a,l))return!1;const f=(e<<7)-1;return!!this.Tg(o,a,f)&&this.Tg(c,a,f)}return!!this.Ag(t,i,h)&&(r=i<<7,o=h<<7,this.Tg(r+1,this.SE[t][i][h]-n,o+1)&&this.Tg(r+128-1,this.SE[t][i+1][h]-n,o+1)&&this.Tg(r+128-1,this.SE[t][i+1][h+1]-n,o+128-1)&&this.Tg(r+1,this.SE[t][i][h+1]-n,o+128-1))};Tg=(t,i,s)=>{for(let h=0;h<St.CE;h++){const e=St.UI[h];if(e)if(1===e.mode){const h=e.jh-t;if(h>0){const t=e.qh+(e.qA*h>>8),n=e.$h+(e.$A*h>>8),r=e.Qh+(e.JA*h>>8),o=e.te+(e.QA*h>>8);if(s>=t&&s<=n&&i>=r&&i<=o)return!0}}else if(2===e.mode){const h=t-e.jh;if(h>0){const t=e.qh+(e.qA*h>>8),n=e.$h+(e.$A*h>>8),r=e.Qh+(e.JA*h>>8),o=e.te+(e.QA*h>>8);if(s>=t&&s<=n&&i>=r&&i<=o)return!0}}else if(3===e.mode){const h=e.qh-s;if(h>0){const s=e.jh+(e.jA*h>>8),n=e.Zh+(e.ZA*h>>8),r=e.Qh+(e.JA*h>>8),o=e.te+(e.QA*h>>8);if(t>=s&&t<=n&&i>=r&&i<=o)return!0}}else if(4===e.mode){const h=s-e.qh;if(h>0){const s=e.jh+(e.jA*h>>8),n=e.Zh+(e.ZA*h>>8),r=e.Qh+(e.JA*h>>8),o=e.te+(e.QA*h>>8);if(t>=s&&t<=n&&i>=r&&i<=o)return!0}}else if(5===e.mode){const h=i-e.Qh;if(h>0){const i=e.jh+(e.jA*h>>8),n=e.Zh+(e.ZA*h>>8),r=e.qh+(e.qA*h>>8),o=e.$h+(e.$A*h>>8);if(t>=i&&t<=n&&s>=r&&s<=o)return!0}}}return!1};_g=(t,i,s,h,e,n,r,o)=>{if(i<s&&i<h&&i<e)return!1;if(i>s&&i>h&&i>e)return!1;if(t<n&&t<r&&t<o)return!1;if(t>n&&t>r&&t>o)return!1;const l=(i-h)*(o-r)-(t-r)*(e-h);return((i-s)*(r-n)-(t-n)*(h-s))*l>0&&l*((i-e)*(n-o)-(t-o)*(s-e))>0};Cg=(t,i)=>((i=(127-i)*(127&t)/160|0)<2?i=2:i>126&&(i=126),(65408&t)+i)}class Rt extends t{static count=0;static $t=[];static Jt=t=>{const i=new a(t.read('flo.dat'));this.count=i.Rt;for(let t=0;t<this.count;t++)this.$t[t]=new Rt(t).it(i)};static Og=(t,i,s)=>(s>179&&(i=i/2|0),s>192&&(i=i/2|0),s>217&&(i=i/2|0),s>243&&(i=i/2|0),(t/4<<10)+(i/32<<7)+(s/2|0));static bg=(t,i)=>-1===t?12345678:((i=i*(127&t)/128|0)<2?i=2:i>126&&(i=126),(65408&t)+i);static Lg=(t,i)=>-2===t?12345678:-1===t?(i<0?i=0:i>127&&(i=127),127-i):((i=i*(127&t)/128|0)<2?i=2:i>126&&(i=126),(65408&t)+i);vg=0;texture=-1;Sg=!1;Rn=!0;Rg=0;Mg=0;kg=0;xg=0;Dg=0;Ng=0;decode(t,i){1===t?(this.vg=i.kt,this.setColor(this.vg)):2===t?this.texture=i.st:3===t?this.Sg=!0:5===t?this.Rn=!1:6===t?this.tt=i.Ft:console.log('Error unrecognised config code: ',t)}setColor(t){const i=(t>>16&255)/256,s=(t>>8&255)/256,h=(255&t)/256;let e=i;s<i&&(e=s),h<e&&(e=h);let n=i;s>i&&(n=s),h>n&&(n=h);let r=0,o=0;const l=(e+n)/2;e!==n&&(l<.5&&(o=(n-e)/(n+e)),l>=.5&&(o=(n-e)/(2-n-e)),i===n?r=(s-h)/(n-e):s===n?r=(h-i)/(n-e)+2:h===n&&(r=(i-s)/(n-e)+4)),r/=6,this.Rg=256*r|0,this.Mg=256*o|0,this.kg=256*l|0,this.Mg<0?this.Mg=0:this.Mg>255&&(this.Mg=255),this.kg<0?this.kg=0:this.kg>255&&(this.kg=255),this.xg=l>.5?(1-l)*o*512|0:l*o*512|0,this.xg<1&&(this.xg=1),this.Dg=r*this.xg|0;let a=this.Rg+(16*Math.random()|0)-8;a<0?a=0:a>255&&(a=255);let c=this.Mg+(48*Math.random()|0)-24;c<0?c=0:c>255&&(c=255);let f=this.kg+(48*Math.random()|0)-24;f<0?f=0:f>255&&(f=255),this.Ng=Rt.Og(a,c,f)}}class Mt extends r{Pg;Fg;Ug;Bg;index;vl;jc;Zc;constructor(t,i,s,h,e,n,r){super(),this.Pg=i,this.Fg=s,this.Ug=h,this.Bg=e,this.index=t,this.vl=n,r&&-1!==n.hi&&this.vl.delay?(this.jc=Math.random()*this.vl.ii|0,this.Zc=Math.random()*this.vl.delay[this.jc]|0):(this.jc=-1,this.Zc=0)}}class kt{static Gg=Int8Array.of(1,2,4,8);static Hg=Uint8Array.of(16,32,64,128);static Wg=Int8Array.of(1,0,-1,0);static Yg=Int8Array.of(0,-1,0,1);static Vg=(17*Math.random()|0)-8;static Kg=(33*Math.random()|0)-16;static Bi=!0;static Xg=0;static zg=!1;static jg=(t,i)=>{let s=this.Zg(t+45365,i+91923,4)+(this.Zg(t+10294,i+37821,2)-128>>1)+(this.Zg(t,i,1)-128>>2)-128;return s=35+(.3*s|0),s<10?s=10:s>60&&(s=60),s};static Zg=(t,i,s)=>{const h=t/s|0,e=t&s-1,n=i/s|0,r=i&s-1,o=this.qg(h,n),l=this.qg(h+1,n),a=this.qg(h,n+1),c=this.qg(h+1,n+1),f=this.$g(o,l,e,s),u=this.$g(a,c,e,s);return this.$g(f,u,r,s)};static $g=(t,i,s,h)=>{const e=65536-O.cos[1024*s/h|0]>>1;return(t*(65536-e)>>16)+(i*e>>16)};static qg=(t,i)=>((this.Zy(t-1,i-1)+this.Zy(t+1,i-1)+this.Zy(t-1,i+1)+this.Zy(t+1,i+1))/16|0)+((this.Zy(t-1,i)+this.Zy(t+1,i)+this.Zy(t,i-1)+this.Zy(t,i+1))/8|0)+(this.Zy(t,i)/4|0);static Zy=(t,i)=>{const s=t+57*i,h=BigInt(s<<13^s);return 255&Number((h*(h*h*15731n+789221n)+1376312589n&0x7fffffffn)>>19n)};static Bm=(t,i,s,h,e,n,r,o,l,a,c)=>{const f=e[c][i][s],u=e[c][i+1][s],d=e[c][i+1][s+1],w=e[c][i][s+1],y=f+u+d+w>>2,p=k.get(o);let A=i+(s<<7)+(o<<14)+1073741824|0;p.active||(A+=-2147483648),A|=0;const m=(a<<6)+l<<24>>24;if(l===R.Ue.id)h?.WE(p.jn(R.Ue.id,a,f,u,d,w,-1),t,i,s,y,A,m),p.bn&&p.active&&r?.Fm(i,s),-1!==p.Mn&&n.rt(new Mt(o,t,3,i,s,I.$t[p.Mn],!0));else if(l===R.Ze.id||l===R.qe.id){const e=p.jn(R.Ze.id,a,f,u,d,w,-1);if(e){let n,r,o=0;l===R.qe.id&&(o+=256),a===M.fn||a===M.dn?(n=p.length,r=p.width):(n=p.width,r=p.length),h?.Bm(t,i,s,y,e,null,A,m,n,r,o)}p.bn&&r?.Bm(i,s,p.width,p.length,a,p.Ln),-1!==p.Mn&&n.rt(new Mt(o,t,2,i,s,I.$t[p.Mn],!0))}else if(l>=R.$e.id)h?.Bm(t,i,s,y,p.jn(l,a,f,u,d,w,-1),null,A,m,1,1,0),p.bn&&r?.Bm(i,s,p.width,p.length,a,p.Ln),-1!==p.Mn&&n.rt(new Mt(o,t,2,i,s,I.$t[p.Mn],!0));else if(l===R.Be.id)h?.Hm(t,i,s,y,kt.Gg[a],0,p.jn(R.Be.id,a,f,u,d,w,-1),null,A,m),p.bn&&r?.Hm(i,s,l,a,p.Ln),-1!==p.Mn&&n.rt(new Mt(o,t,0,i,s,I.$t[p.Mn],!0));else if(l===R.Ge.id)h?.Hm(t,i,s,y,kt.Hg[a],0,p.jn(R.Ge.id,a,f,u,d,w,-1),null,A,m),p.bn&&r?.Hm(i,s,l,a,p.Ln),-1!==p.Mn&&n.rt(new Mt(o,t,0,i,s,I.$t[p.Mn],!0));else if(l===R.He.id){const e=a+1&3;h?.Hm(t,i,s,y,kt.Gg[a],kt.Gg[e],p.jn(R.He.id,a+4,f,u,d,w,-1),p.jn(R.He.id,e,f,u,d,w,-1),A,m),p.bn&&r?.Hm(i,s,l,a,p.Ln),-1!==p.Mn&&n.rt(new Mt(o,t,0,i,s,I.$t[p.Mn],!0))}else if(l===R.We.id)h?.Hm(t,i,s,y,kt.Hg[a],0,p.jn(R.We.id,a,f,u,d,w,-1),null,A,m),p.bn&&r?.Hm(i,s,l,a,p.Ln),-1!==p.Mn&&n.rt(new Mt(o,t,0,i,s,I.$t[p.Mn],!0));else if(l===R.je.id)h?.Bm(t,i,s,y,p.jn(l,a,f,u,d,w,-1),null,A,m,1,1,0),p.bn&&r?.Bm(i,s,p.width,p.length,a,p.Ln),-1!==p.Mn&&n.rt(new Mt(o,t,2,i,s,I.$t[p.Mn],!0));else if(l===R.Ye.id)h?.XE(t,i,s,y,0,0,A,p.jn(R.Ye.id,M.cn,f,u,d,w,-1),m,512*a,kt.Gg[a]),-1!==p.Mn&&n.rt(new Mt(o,t,1,i,s,I.$t[p.Mn],!0));else if(l===R.Ve.id){let e=16;if(h){const n=h.ng(t,i,s);n>0&&(e=k.get(n>>14&32767).xn)}h?.XE(t,i,s,y,kt.Wg[a]*e,kt.Yg[a]*e,A,p.jn(R.Ye.id,M.cn,f,u,d,w,-1),m,512*a,kt.Gg[a]),-1!==p.Mn&&n.rt(new Mt(o,t,1,i,s,I.$t[p.Mn],!0))}else l===R.Ke.id?(h?.XE(t,i,s,y,0,0,A,p.jn(R.Ye.id,M.cn,f,u,d,w,-1),m,a,256),-1!==p.Mn&&n.rt(new Mt(o,t,1,i,s,I.$t[p.Mn],!0))):l===R.Xe.id?(h?.XE(t,i,s,y,0,0,A,p.jn(R.Ye.id,M.cn,f,u,d,w,-1),m,a,512),-1!==p.Mn&&n.rt(new Mt(o,t,1,i,s,I.$t[p.Mn],!0))):l===R.ze.id&&(h?.XE(t,i,s,y,0,0,A,p.jn(R.Ye.id,M.cn,f,u,d,w,-1),m,a,768),-1!==p.Mn&&n.rt(new Mt(o,t,1,i,s,I.$t[p.Mn],!0)))};KA;zA;Jg;Qg;t_;i_;s_;h_;e_;n_;r_;o_;l_;a_;c_;f_;constructor(t,i,s,h){this.KA=t,this.zA=i,this.Jg=s,this.Qg=h,this.t_=new w(gt.Dm,t,i),this.i_=new w(gt.Dm,t,i),this.s_=new w(gt.Dm,t,i),this.h_=new w(gt.Dm,t,i),this.f_=new p(gt.Dm,t+1,i+1),this.e_=new w(gt.Dm,t+1,i+1),this.n_=new y(t+1,i+1),this.r_=new Int32Array(i),this.o_=new Int32Array(i),this.l_=new Int32Array(i),this.a_=new Int32Array(i),this.c_=new Int32Array(i)}u_=(t,i)=>{for(let t=0;t<gt.Dm;t++)for(let s=0;s<gt.Nm;s++)for(let h=0;h<gt.Nm;h++)if(!(1&~this.Qg[t][s][h])){let e=t;2&~this.Qg[1][s][h]||e--,e>=0&&i[e]?.Fm(s,h)}kt.Vg+=(5*Math.random()|0)-2,kt.Vg<-8?kt.Vg=-8:kt.Vg>8&&(kt.Vg=8),kt.Kg+=(5*Math.random()|0)-2,kt.Kg<-16?kt.Kg=-16:kt.Kg>16&&(kt.Kg=16);for(let i=0;i<gt.Dm;i++){const s=this.e_[i],h=96,e=-50,n=-10,r=-50,o=768*(0|Math.sqrt(e*e+n*n+r*r))>>8;for(let t=1;t<this.zA-1;t++)for(let l=1;l<this.KA-1;l++){const a=this.Jg[i][l+1][t]-this.Jg[i][l-1][t],c=this.Jg[i][l][t+1]-this.Jg[i][l][t-1],f=0|Math.sqrt(a*a+c*c+65536),u=h+((e*((a<<8)/f|0)+n*(65536/f|0)+r*((c<<8)/f|0))/o|0),d=(s[l-1][t]>>2)+(s[l+1][t]>>3)+(s[l][t-1]>>2)+(s[l][t+1]>>3)+(s[l][t]>>1);this.n_[l][t]=u-d}for(let t=0;t<this.zA;t++)this.r_[t]=0,this.o_[t]=0,this.l_[t]=0,this.a_[t]=0,this.c_[t]=0;for(let s=-5;s<this.KA+5;s++){for(let t=0;t<this.zA;t++){const h=s+5;let e;if(h>=0&&h<this.KA){const s=255&this.t_[i][h][t];if(s>0){const i=Rt.$t[s-1];this.r_[t]+=i.Dg,this.o_[t]+=i.Mg,this.l_[t]+=i.kg,this.a_[t]+=i.xg,e=this.c_[t]++}}const n=s-5;if(n>=0&&n<this.KA){const s=255&this.t_[i][n][t];if(s>0){const i=Rt.$t[s-1];this.r_[t]-=i.Dg,this.o_[t]-=i.Mg,this.l_[t]-=i.kg,this.a_[t]-=i.xg,e=this.c_[t]--}}}if(s>=1&&s<this.KA-1){let h=0,e=0,n=0,r=0,o=0;for(let l=-5;l<this.zA+5;l++){const a=l+5;a>=0&&a<this.zA&&(h+=this.r_[a],e+=this.o_[a],n+=this.l_[a],r+=this.a_[a],o+=this.c_[a]);const c=l-5;if(c>=0&&c<this.zA&&(h-=this.r_[c],e-=this.o_[c],n-=this.l_[c],r-=this.a_[c],o-=this.c_[c]),l>=1&&l<this.zA-1&&(!kt.Bi||!(16&this.Qg[i][s][l])&&this.d_(i,s,l)===kt.Xg)){const a=255&this.t_[i][s][l],c=255&this.i_[i][s][l];if(a>0||c>0){const f=this.Jg[i][s][l],u=this.Jg[i][s+1][l],d=this.Jg[i][s+1][l+1],w=this.Jg[i][s][l+1],y=this.n_[s][l],p=this.n_[s+1][l],A=this.n_[s+1][l+1],m=this.n_[s][l+1];let I=-1,E=-1;if(a>0){const t=256*h/r|0,i=e/o|0;let s=n/o|0;I=Rt.Og(t,i,s);const l=t+kt.Vg&255;s+=kt.Kg,s<0?s=0:s>255&&(s=255),E=Rt.Og(l,i,s)}if(i>0){let t=0!==a||this.s_[i][s][l]===vt.TI;c>0&&!Rt.$t[c-1].Rn&&(t=!1),t&&f===u&&f===d&&f===w&&(this.f_[i][s][l]|=2340)}let g=0;if(-1!==I&&(g=O.palette[Rt.bg(E,96)]),0===c)t?.HE(i,s,l,vt.TI,M.cn,-1,f,u,d,w,Rt.bg(I,y),Rt.bg(I,p),Rt.bg(I,A),Rt.bg(I,m),B.ar,B.ar,B.ar,B.ar,g,B.ar);else{const h=this.s_[i][s][l]+1,e=this.h_[i][s][l],n=Rt.$t[c-1];let r,o,a=n.texture;a>=0?(o=O.fs(a),r=-1):n.vg===B.rr?(o=0,r=-2,a=-1):(r=Rt.Og(n.Rg,n.Mg,n.kg),o=O.palette[Rt.Lg(n.Ng,96)]),t?.HE(i,s,l,h,e,a,f,u,d,w,Rt.bg(I,y),Rt.bg(I,p),Rt.bg(I,A),Rt.bg(I,m),Rt.Lg(r,y),Rt.Lg(r,p),Rt.Lg(r,A),Rt.Lg(r,m),g,o)}}}}}}for(let s=1;s<this.zA-1;s++)for(let h=1;h<this.KA-1;h++)t?.GE(i,h,s,this.d_(i,h,s))}kt.zg||t?.cg(64,768,-50,-10,-50);for(let i=0;i<this.KA;i++)for(let s=0;s<this.zA;s++)2&~this.Qg[1][i][s]||t?.BE(i,s);if(!kt.zg){let t=1,i=2,s=4;for(let h=0;h<gt.Dm;h++){h>0&&(t<<=3,i<<=3,s<<=3);for(let e=0;e<=h;e++)for(let n=0;n<=this.zA;n++)for(let r=0;r<=this.KA;r++){if(this.f_[e][r][n]&t){let i=n,s=n,o=e,l=e;for(;i>0&&this.f_[e][r][i-1]&t;)i--;for(;s<this.zA&&this.f_[e][r][s+1]&t;)s++;t:for(;o>0;){for(let h=i;h<=s;h++)if(!(this.f_[o-1][r][h]&t))break t;o--}t:for(;l<h;){for(let h=i;h<=s;h++)if(!(this.f_[l+1][r][h]&t))break t;l++}if((l+1-o)*(s+1-i)>=8){const e=this.Jg[l][r][i]-240,n=this.Jg[o][r][i];St.LE(h,1,128*r,e,128*i,128*r,n,128*s+128);for(let h=o;h<=l;h++)for(let e=i;e<=s;e++)this.f_[h][r][e]&=~t}}if(this.f_[e][r][n]&i){let t=r,s=r,o=e,l=e;for(;t>0&&this.f_[e][t-1][n]&i;)t--;for(;s<this.KA&&this.f_[e][s+1][n]&i;)s++;t:for(;o>0;){for(let h=t;h<=s;h++)if(!(this.f_[o-1][h][n]&i))break t;o--}t:for(;l<h;){for(let h=t;h<=s;h++)if(!(this.f_[l+1][h][n]&i))break t;l++}if((l+1-o)*(s+1-t)>=8){const e=this.Jg[l][t][n]-240,r=this.Jg[o][t][n];St.LE(h,2,128*t,e,128*n,128*s+128,r,128*n);for(let h=o;h<=l;h++)for(let e=t;e<=s;e++)this.f_[h][e][n]&=~i}}if(this.f_[e][r][n]&s){let t=r,i=r,o=n,l=n;for(;o>0&&this.f_[e][r][o-1]&s;)o--;for(;l<this.zA&&this.f_[e][r][l+1]&s;)l++;t:for(;t>0;){for(let i=o;i<=l;i++)if(!(this.f_[e][t-1][i]&s))break t;t--}t:for(;i<this.KA;){for(let t=o;t<=l;t++)if(!(this.f_[e][i+1][t]&s))break t;i++}if((i+1-t)*(l+1-o)>=4){const n=this.Jg[e][t][o];St.LE(h,4,128*t,n,128*o,128*i+128,n,128*l+128);for(let h=t;h<=i;h++)for(let t=o;t<=l;t++)this.f_[e][h][t]&=~s}}}}}};w_=(t,i,s,h)=>{let e=0;for(let t=0;t<Rt.count;t++)if('water'===Rt.$t[t].tt?.toLowerCase()){e=t+1<<24>>24;break}for(let n=t;n<t+s;n++)for(let t=i;t<i+h;t++)if(t>=0&&t<this.KA&&n>=0&&n<this.zA){this.i_[0][t][n]=e;for(let i=0;i<gt.Dm;i++)this.Jg[i][t][n]=0,this.Qg[i][t][n]=0}};y_=(t,i,s,h,e)=>{const n=new a(new Uint8Array(e));for(let e=0;e<gt.Dm;e++)for(let r=0;r<64;r++)for(let o=0;o<64;o++){const l=r+s,a=o+h;let c;if(l>=0&&l<gt.Nm&&a>=0&&a<gt.Nm)for(this.Qg[e][l][a]=0;;){if(c=n.st,0===c){0===e?this.Jg[0][l][a]=8*-kt.jg(l+t+932731,a+556238+i):this.Jg[e][l][a]=this.Jg[e-1][l][a]-240;break}if(1===c){let t=n.st;1===t&&(t=0),0===e?this.Jg[0][l][a]=8*-t:this.Jg[e][l][a]=this.Jg[e-1][l][a]-8*t;break}c<=49?(this.i_[e][l][a]=n.St,this.s_[e][l][a]=(c-2)/4<<24>>24,this.h_[e][l][a]=(c-2&3)<<24>>24):c<=81?this.Qg[e][l][a]=c-49<<24>>24:this.t_[e][l][a]=c-81<<24>>24}else for(;c=n.st,0!==c;){if(1===c){n.st;break}c<=49&&n.st}}};p_=(t,i,s,h,e,n)=>{const r=new a(new Uint8Array(h));let o=-1;for(;;){const h=r.Pt;if(0===h)return;o+=h;let l=0;for(;;){const h=r.Pt;if(0===h)break;l+=h-1;const a=63&l,c=l>>6&63,f=l>>12,u=r.st,d=u>>2,w=3&u,y=c+e,p=a+n;if(y>0&&p>0&&y<gt.Nm-1&&p<gt.Nm-1){let h=f;2&~this.Qg[1][y][p]||(h=f-1);let e=null;h>=0&&(e=s[h]),this.Bm(f,y,p,t,i,e,o,d,w)}}}};Bm=(t,i,s,h,e,n,r,o,l)=>{if(kt.Bi){if(16&this.Qg[t][i][s])return;if(this.d_(t,i,s)!==kt.Xg)return}const a=this.Jg[t][i][s],c=this.Jg[t][i+1][s],f=this.Jg[t][i+1][s+1],u=this.Jg[t][i][s+1],d=a+c+f+u>>2,w=k.get(r);let y=i+(s<<7)+(r<<14)+1073741824|0;w.active||(y+=-2147483648),y|=0;const p=(l<<6)+o<<24>>24;if(o===R.Ue.id)(!kt.Bi||w.active||w.zn)&&(h?.WE(w.jn(R.Ue.id,l,a,c,f,u,-1),t,i,s,d,y,p),w.bn&&w.active&&n?.Fm(i,s),-1!==w.Mn&&e.rt(new Mt(r,t,3,i,s,I.$t[w.Mn],!0)));else if(o===R.Ze.id||o===R.qe.id){const A=w.jn(R.Ze.id,l,a,c,f,u,-1);if(A){let e,n,r=0;if(o===R.qe.id&&(r+=256),l===M.fn||l===M.dn?(e=w.length,n=w.width):(e=w.width,n=w.length),h?.Bm(t,i,s,d,A,null,y,p,e,n,r)&&w.Bn)for(let h=0;h<=e;h++)for(let e=0;e<=n;e++){let n=A.Jh/4|0;n>30&&(n=30),n>this.e_[t][i+h][s+e]&&(this.e_[t][i+h][s+e]=n<<24>>24)}}w.bn&&n?.Bm(i,s,w.width,w.length,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,2,i,s,I.$t[w.Mn],!0))}else if(o>=R.$e.id)h?.Bm(t,i,s,d,w.jn(o,l,a,c,f,u,-1),null,y,p,1,1,0),o>=R.$e.id&&o<=R.hn.id&&o!==R.Je.id&&t>0&&(this.f_[t][i][s]|=2340),w.bn&&n?.Bm(i,s,w.width,w.length,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,2,i,s,I.$t[w.Mn],!0));else if(o===R.Be.id)h?.Hm(t,i,s,d,kt.Gg[l],0,w.jn(R.Be.id,l,a,c,f,u,-1),null,y,p),l===M.cn?(w.Bn&&(this.e_[t][i][s]=50,this.e_[t][i][s+1]=50),w.Rn&&(this.f_[t][i][s]|=585)):l===M.fn?(w.Bn&&(this.e_[t][i][s+1]=50,this.e_[t][i+1][s+1]=50),w.Rn&&(this.f_[t][i][s+1]|=1170)):l===M.un?(w.Bn&&(this.e_[t][i+1][s]=50,this.e_[t][i+1][s+1]=50),w.Rn&&(this.f_[t][i+1][s]|=585)):l===M.dn&&(w.Bn&&(this.e_[t][i][s]=50,this.e_[t][i+1][s]=50),w.Rn&&(this.f_[t][i][s]|=1170)),w.bn&&n?.Hm(i,s,o,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,0,i,s,I.$t[w.Mn],!0)),16!==w.xn&&h?.jE(t,i,s,w.xn);else if(o===R.Ge.id)h?.Hm(t,i,s,d,kt.Hg[l],0,w.jn(R.Ge.id,l,a,c,f,u,-1),null,y,p),w.Bn&&(l===M.cn?this.e_[t][i][s+1]=50:l===M.fn?this.e_[t][i+1][s+1]=50:l===M.un?this.e_[t][i+1][s]=50:l===M.dn&&(this.e_[t][i][s]=50)),w.bn&&n?.Hm(i,s,o,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,0,i,s,I.$t[w.Mn],!0));else if(o===R.He.id){const A=l+1&3;h?.Hm(t,i,s,d,kt.Gg[l],kt.Gg[A],w.jn(R.He.id,l+4,a,c,f,u,-1),w.jn(R.He.id,A,a,c,f,u,-1),y,p),w.Rn&&(l===M.cn?(this.f_[t][i][s]|=265,this.f_[t][i][s+1]|=1170):l===M.fn?(this.f_[t][i][s+1]|=1170,this.f_[t][i+1][s]|=585):l===M.un?(this.f_[t][i+1][s]|=585,this.f_[t][i][s]|=1170):l===M.dn&&(this.f_[t][i][s]|=1170,this.f_[t][i][s]|=585)),w.bn&&n?.Hm(i,s,o,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,0,i,s,I.$t[w.Mn],!0)),16!==w.xn&&h?.jE(t,i,s,w.xn)}else if(o===R.We.id)h?.Hm(t,i,s,d,kt.Hg[l],0,w.jn(R.We.id,l,a,c,f,u,-1),null,y,p),w.Bn&&(l===M.cn?this.e_[t][i][s+1]=50:l===M.fn?this.e_[t][i+1][s+1]=50:l===M.un?this.e_[t][i+1][s]=50:l===M.dn&&(this.e_[t][i][s]=50)),w.bn&&n?.Hm(i,s,o,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,0,i,s,I.$t[w.Mn],!0));else if(o===R.je.id)h?.Bm(t,i,s,d,w.jn(o,l,a,c,f,u,-1),null,y,p,1,1,0),w.bn&&n?.Bm(i,s,w.width,w.length,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,2,i,s,I.$t[w.Mn],!0));else if(o===R.Ye.id)h?.XE(t,i,s,d,0,0,y,w.jn(R.Ye.id,M.cn,a,c,f,u,-1),p,512*l,kt.Gg[l]),-1!==w.Mn&&e.rt(new Mt(r,t,1,i,s,I.$t[w.Mn],!0));else if(o===R.Ve.id){let n=16;if(h){const e=h.ng(t,i,s);e>0&&(n=k.get(e>>14&32767).xn)}h?.XE(t,i,s,d,kt.Wg[l]*n,kt.Yg[l]*n,y,w.jn(R.Ye.id,M.cn,a,c,f,u,-1),p,512*l,kt.Gg[l]),-1!==w.Mn&&e.rt(new Mt(r,t,1,i,s,I.$t[w.Mn],!0))}else o===R.Ke.id?(h?.XE(t,i,s,d,0,0,y,w.jn(R.Ye.id,M.cn,a,c,f,u,-1),p,l,256),-1!==w.Mn&&e.rt(new Mt(r,t,1,i,s,I.$t[w.Mn],!0))):o===R.Xe.id?(h?.XE(t,i,s,d,0,0,y,w.jn(R.Ye.id,M.cn,a,c,f,u,-1),p,l,512),-1!==w.Mn&&e.rt(new Mt(r,t,1,i,s,I.$t[w.Mn],!0))):o===R.ze.id&&(h?.XE(t,i,s,d,0,0,y,w.jn(R.Ye.id,M.cn,a,c,f,u,-1),p,l,768),-1!==w.Mn&&e.rt(new Mt(r,t,1,i,s,I.$t[w.Mn],!0)))};d_=(t,i,s)=>8&this.Qg[t][i][s]?0:t<=0||!(2&this.Qg[1][i][s])?t:t-1}class xt extends r{A_;an;x;z;m_;angle;shape;I_;E_;g_;constructor(t,i,s,h,e,n,r,o,l,a){super(),this.A_=t,this.an=i,this.x=s,this.z=h,this.m_=e,this.angle=n,this.shape=r,this.I_=o,this.E_=l,this.g_=a}}class Dt extends r{A_;an;x;z;m_;angle;shape;__;constructor(t,i,s,h,e,n,r,o){super(),this.A_=t,this.an=i,this.x=s,this.z=h,this.m_=e,this.angle=n,this.shape=r,this.__=o}}class Nt extends r{}class Pt extends Nt{x=0;z=0;IA=0;C_=!1;size=1;T_=-1;O_=-1;b_=-1;L_=-1;v_=-1;S_=-1;R_=-1;M_=null;k_=100;x_=0;D_=0;N_=0;P_=0;F_=-1e3;U_=0;B_=0;G_=-1;H_=0;W_=0;Y_=-1;V_=0;K_=0;X_=-1;z_=0;j_=0;Z_=0;q_=0;J_=-1;Q_=0;tC=0;iC=0;sC=0;hC=0;eC=0;nC=0;rC=0;oC=0;lC=0;aC=0;Ji=0;height=0;cC=0;pathLength=0;fC=new Int32Array(10);uC=new Int32Array(10);dC=new c(10,!1);wC=0;yC=-1;pC=-1;AC=-1;mC=-1;move(t,i,s){if(-1!==this.X_&&I.$t[this.X_].priority<=1&&(this.X_=-1),!t){const t=i-this.fC[0],h=s-this.uC[0];if(t>=-8&&t<=8&&h>=-8&&h<=8){this.pathLength<9&&this.pathLength++;for(let t=this.pathLength;t>0;t--)this.fC[t]=this.fC[t-1],this.uC[t]=this.uC[t-1],this.dC[t]=this.dC[t-1];return this.fC[0]=i,this.uC[0]=s,void(this.dC[0]=!1)}}this.pathLength=0,this.wC=0,this.fC[0]=i,this.uC[0]=s,this.x=128*this.fC[0]+64*this.size,this.z=128*this.uC[0]+64*this.size}step(t,i){let s=this.fC[0],h=this.uC[0];0===i?(s--,h++):1===i?h++:2===i?(s++,h++):3===i?s--:4===i?s++:5===i?(s--,h--):6===i?h--:7===i&&(s++,h--),-1!==this.X_&&I.$t[this.X_].priority<=1&&(this.X_=-1),this.pathLength<9&&this.pathLength++;for(let t=this.pathLength;t>0;t--)this.fC[t]=this.fC[t-1],this.uC[t]=this.uC[t-1],this.dC[t]=this.dC[t-1];this.fC[0]=s,this.uC[0]=h,this.dC[0]=t}}class Ft extends Pt{static IC=1;static EC=2;static gC=4;static _C=8;static CC=16;static TC=32;static OC=64;static bC=128;static LC=256;static vC=512;static SC=[B.no,B.ro,B.oo,B.lo,B.ao,B.co,B.fo,B.uo,B.do,B.wo,B.yo,B.po,B.Ao,B.mo,B.Io,B.Eo];static RC=[[B.Sr,B.Rr,B.Mr,B.kr,B.Dr,B.Nr,B.Pr,B.Fr,B.Ur,B.Br,B.Gr,B.Hr],[B.Wr,B.Yr,B.Vr,B.Kr,B.Xr,B.zr,B.jr,B.Zr,B.qr,B.$r,B.Jr,B.Qr,B.io,B.so,B.ho,B.eo],[B.eo-1,B.Wr+1,B.Yr,B.Vr,B.Kr,B.Xr,B.zr,B.jr,B.Zr,B.qr,B.$r,B.Jr,B.Qr,B.io,B.so,B.ho],[B._o,B.Co,B.To,B.Oo,B.bo,B.Lo],[B.So,B.Ro,B.Mo,B.ko,B.xo,B.Do,B.No,B.vo]];static Fo=new _(200);name=null;visible=!1;MC=0;kC=0;xC=new Uint16Array(12);DC=new Uint16Array(5);NC=0;PC=0n;y=0;FC=0;UC=0;BC=0;GC=0;HC=0;WC=null;VA=0;XA=0;KA=0;zA=0;Bi=!1;draw(t){if(!this.visible)return null;let i=this.Ll();if(this.height=i.te,i.we=!0,this.Bi)return i;if(-1!==this.J_&&-1!==this.Q_){const t=Y.$t[this.J_],s=v.he(t.jn(),!0,!t.kn,!1);s.translate(-this.sC,0,0),s.me(),t.vl&&t.vl.frames&&s.ge(t.vl.frames[this.Q_]),s.le=null,s.oe=null,128===t.Ol&&128===t.bl||s.scale(t.Ol,t.bl,t.Ol),s.be(t.Dn+64,t.Nn+850,-30,-50,-30,!0);const h=[i,s];i=v.ae(h,2)}if(this.WC&&(t>=this.UC&&(this.WC=null),t>=this.FC&&t<this.UC)){const t=this.WC;if(t){t.translate(this.GC-this.y,this.BC-this.x,this.HC-this.z),512===this.cC?(t._e(),t._e(),t._e()):1024===this.cC?(t._e(),t._e()):1536===this.cC&&t._e();const s=[i,t];i=v.ae(s,2),512===this.cC?t._e():1024===this.cC?(t._e(),t._e()):1536===this.cC&&(t._e(),t._e(),t._e()),t.translate(this.y-this.GC,this.x-this.BC,this.z-this.HC)}}return i.we=!0,i}isVisible(){return this.visible}read(t){t.bt=0,this.MC=t.st,this.kC=t.st;for(let i=0;i<12;i++){const s=t.st;this.xC[i]=0===s?0:(s<<8)+t.st}for(let i=0;i<5;i++){let s=t.st;(s<0||s>=Ft.RC[i].length)&&(s=0),this.DC[i]=s}this.T_=t.Rt,65535===this.T_&&(this.T_=-1),this.O_=t.Rt,65535===this.O_&&(this.O_=-1),this.b_=t.Rt,65535===this.b_&&(this.b_=-1),this.L_=t.Rt,65535===this.L_&&(this.L_=-1),this.v_=t.Rt,65535===this.v_&&(this.v_=-1),this.S_=t.Rt,65535===this.S_&&(this.S_=-1),this.R_=t.Rt,65535===this.R_&&(this.R_=-1),this.name=K.Wl(K.Ul(t.Dt)),this.NC=t.st,this.visible=!0,this.PC=0n;for(let t=0;t<12;t++)this.PC<<=0x4n,this.xC[t]>=256&&(this.PC+=BigInt(this.xC[t])-256n);this.xC[0]>=256&&(this.PC+=BigInt(this.xC[0])-256n>>4n),this.xC[1]>=256&&(this.PC+=BigInt(this.xC[1])-256n>>8n);for(let t=0;t<5;t++)this.PC<<=0x3n,this.PC+=BigInt(this.DC[t]);this.PC<<=0x1n,this.PC+=BigInt(this.MC)}pl(){if(!this.visible)return null;const t=new c(12,null);let i=0;for(let s=0;s<12;s++){const h=this.xC[s];if(h>=256&&h<512&&(t[i++]=W.$t[h-256].pl()),h>=512){const s=G.get(h-512).pl(this.MC);s&&(t[i++]=s)}}const s=v.fe(t,i);for(let t=0;t<5;t++)0!==this.DC[t]&&(s.Te(Ft.RC[t][0],Ft.RC[t][this.DC[t]]),1===t&&s.Te(Ft.SC[0],Ft.SC[this.DC[t]]));return s}Ll(){let t=this.PC,i=-1,s=-1,h=-1,e=-1;if(this.X_>=0&&0===this.Z_){const n=I.$t[this.X_];if(n.frames&&(i=n.frames[this.z_]),this.Y_>=0&&this.Y_!==this.T_){const t=I.$t[this.Y_].frames;t&&(s=t[this.V_])}n.ri>=0&&(h=n.ri,t+=BigInt(h-this.xC[5])<<8n),n.oi>=0&&(e=n.oi,t+=BigInt(e-this.xC[3])<<16n)}else if(this.Y_>=0){const t=I.$t[this.Y_].frames;t&&(i=t[this.V_])}let n=Ft.Fo?.get(t);if(!n){const i=new c(12,null);let s=0;for(let t=0;t<12;t++){let n=this.xC[t];if(e>=0&&3===t&&(n=e),h>=0&&5===t&&(n=h),n>=256&&n<512){const t=W.$t[n-256].jn();t&&(i[s++]=t)}if(n>=512){const t=G.get(n-512).yl(this.MC);t&&(i[s++]=t)}}n=v.fe(i,s);for(let t=0;t<5;t++)0!==this.DC[t]&&(n.Te(Ft.RC[t][0],Ft.RC[t][this.DC[t]]),1===t&&n.Te(Ft.SC[0],Ft.SC[this.DC[t]]));n.me(),n.be(64,850,-30,-50,-30,!0),Ft.Fo?.put(t,n)}if(this.Bi)return n;const r=v.re(n,!0);return-1!==i&&-1!==s?r.Ie(i,s,I.$t[this.X_].ei):-1!==i&&r.ge(i),r.ce(),r.le=null,r.oe=null,r}}class Ut extends Pt{static EC=2;static gC=4;static _C=8;static CC=16;static YC=32;static LC=64;static TC=128;type=null;draw(t){if(!this.type)return null;if(-1===this.J_||-1===this.Q_)return this.Ll();const i=this.Ll();if(!i)return null;const s=Y.$t[this.J_],h=v.he(s.jn(),!0,!s.kn,!1);h.translate(-this.sC,0,0),h.me(),s.vl&&s.vl.frames&&h.ge(s.vl.frames[this.Q_]),h.le=null,h.oe=null,128===s.Ol&&128===s.bl||h.scale(s.Ol,s.bl,s.Ol),h.be(64+s.Dn,850+s.Nn,-30,-50,-30,!0);const e=[i,h],n=v.ae(e,2);return 1===this.type.size&&(n.we=!0),n}isVisible(){return null!==this.type}Ll(){if(!this.type)return null;if(this.X_>=0&&0===this.Z_){const t=I.$t[this.X_].frames;if(t){const i=t[this.z_];let s=-1;if(this.Y_>=0&&this.Y_!==this.T_){const t=I.$t[this.Y_].frames;t&&(s=t[this.V_])}return this.type.Ll(i,s,I.$t[this.X_].ei)}}let t=-1;if(this.Y_>=0){const i=I.$t[this.Y_].frames;i&&(t=i[this.V_])}const i=this.type.Ll(t,-1,null);return i?(this.height=i.te,i):null}}class Bt extends r{index;count;constructor(t,i){super(),this.index=t,this.count=i}}class Gt extends Nt{VC;level;KC;XC;zC;offsetY;jC;__;ZC;arc;target;mobile=!1;x=0;z=0;y=0;velocityX=0;qC=0;$C=0;velocityY=0;JC=0;IA=0;pitch=0;jc=0;Zc=0;constructor(t,i,s,h,e,n,r,o,l,a,c){super(),this.VC=Y.$t[t],this.level=i,this.KC=s,this.XC=e,this.zC=h,this.jC=n,this.__=r,this.ZC=o,this.arc=l,this.target=a,this.offsetY=c}QC(t,i,s,h){if(!this.mobile){const i=t-this.KC,h=s-this.XC,e=Math.sqrt(i*i+h*h);this.x=this.KC+i*this.arc/e,this.z=this.XC+h*this.arc/e,this.y=this.zC}const e=this.__+1-h;this.velocityX=(t-this.x)/e,this.qC=(s-this.z)/e,this.$C=Math.sqrt(this.velocityX*this.velocityX+this.qC*this.qC),this.mobile||(this.velocityY=-this.$C*Math.tan(.02454369*this.ZC)),this.JC=2*(i-this.y-this.velocityY*e)/(e*e)}update(t){if(this.mobile=!0,this.x+=this.velocityX*t,this.z+=this.qC*t,this.y+=this.velocityY*t+.5*this.JC*t*t,this.velocityY+=this.JC*t,this.IA=325.949*Math.atan2(this.velocityX,this.qC)+1024&2047,this.pitch=325.949*Math.atan2(this.velocityY,this.$C)&2047,this.VC.vl&&this.VC.vl.delay)for(this.Zc+=t;this.Zc>this.VC.vl.delay[this.jc];)this.Zc-=this.VC.vl.delay[this.jc]+1,this.jc++,this.jc>=this.VC.vl.ii&&(this.jc=0)}draw(){const t=this.VC.jn(),i=v.he(t,!0,!this.VC.kn,!1);return this.VC.vl&&this.VC.vl.frames&&(i.me(),i.ge(this.VC.vl.frames[this.jc]),i.le=null,i.oe=null),128===this.VC.Ol&&128===this.VC.bl||i.scale(this.VC.Ol,this.VC.bl,this.VC.Ol),i.Ce(this.pitch),i.be(64+this.VC.Dn,850+this.VC.Nn,-30,-50,-30,!0),i}}class Ht extends Nt{type;level;x;z;y;jC;tT=!1;jc=0;Zc=0;constructor(t,i,s,h,e,n,r){super(),this.type=Y.$t[t],this.level=i,this.x=s,this.z=h,this.y=e,this.jC=n+r}update(t){if(this.type.vl&&this.type.vl.delay)for(this.Zc+=t;this.Zc>this.type.vl.delay[this.jc];)this.Zc-=this.type.vl.delay[this.jc]+1,this.jc++,this.jc>=this.type.vl.ii&&(this.jc=0,this.tT=!0)}draw(){const t=this.type.jn(),i=v.he(t,!0,!this.type.kn,!1);return!this.tT&&this.type.vl&&this.type.vl.frames&&(i.me(),i.ge(this.type.vl.frames[this.jc]),i.le=null,i.oe=null),128===this.type.Ol&&128===this.type.bl||i.scale(this.type.Ol,this.type.bl,this.type.Ol),0!==this.type.orientation&&(90===this.type.orientation?i._e():180===this.type.orientation?(i._e(),i._e()):270===this.type.orientation&&(i._e(),i._e(),i._e())),i.be(64+this.type.Dn,850+this.type.Nn,-30,-50,-30,!0),i}}let Wt;async function Yt(t,i){Vt(i);try{const i=await window.audioContext.decodeAudioData(Uint8Array.from(t).buffer);let s=window.audioContext.createBufferSource();s.buffer=i,s.connect(Wt),s.start()}catch(t){console.log(t)}}function Vt(t){Wt||(Wt=window.audioContext.createGain(),Wt.connect(window.audioContext.destination)),Wt.gain.value=t/256}function Kt(t,i,s){window._tinyMidiPlay&&window._tinyMidiPlay(t,i/256,s)}function Xt(t){window._tinyMidiVolume&&window._tinyMidiVolume(t/256)}function zt(t){window._tinyMidiStop&&window._tinyMidiStop(t)}class jt{static zf=t=>{let i=0;t=t.toUpperCase();for(let s=0;s<t.length;s++)i=61*i+t.charCodeAt(s)-32|0;return i};buffer;iT;sT;hT;eT;nT;rT;oT=[];constructor(t){t instanceof Uint8Array&&(t=new Int8Array(t));let i=new a(new Uint8Array(t));const s=i.kt,h=i.kt;s===h?(this.buffer=t,this.iT=!1):(this.buffer=wt.read(s,t,h,6),i=new a(new Uint8Array(this.buffer)),this.iT=!0),this.sT=i.Rt,this.hT=[],this.eT=[],this.nT=[],this.rT=[];let e=i.bt+10*this.sT;for(let t=0;t<this.sT;t++)this.hT.push(i.xt),this.eT.push(i.kt),this.nT.push(i.kt),this.rT.push(e),e+=this.nT[t]}read(t){const i=jt.zf(t),s=this.hT.indexOf(i);return-1===s?null:this.lT(s)}lT(t){if(t<0||t>=this.sT)return null;if(this.oT[t])return this.oT[t];const i=this.rT[t],s=i+this.nT[t];if(this.iT){const h=Uint8Array.from(this.buffer.subarray(i,i+s));return this.oT[t]=h,h}{const i=Uint8Array.from(wt.read(this.eT[t],this.buffer,this.nT[t],this.rT[t]));return this.oT[t]=i,i}}}const Zt=['F11','F12'],qt={'Backspace':{code:8,ch:8},'Enter':{code:10,ch:10},'Shift':{code:16,ch:65535},'Escape':{code:27,ch:27},'Tab':{code:9,ch:9},'CapsLock':{code:20,ch:65535},' ':{code:32,ch:32},'Control':{code:17,ch:65535},'Alt':{code:18,ch:65535},'Meta':{code:524,ch:65535},'ArrowLeft':{code:37,ch:65535},'ArrowRight':{code:39,ch:65535},'ArrowUp':{code:38,ch:65535},'ArrowDown':{code:40,ch:65535},'Insert':{code:155,ch:65535},'Home':{code:36,ch:65535},'PageUp':{code:33,ch:65535},'Delete':{code:127,ch:127},'End':{code:35,ch:65535},'PageDown':{code:34,ch:65535},'`':{code:192,ch:96},'~':{code:192,ch:126},'!':{code:49,ch:33},'@':{code:50,ch:64},'#':{code:51,ch:35},'$':{code:52,ch:36},'%':{code:53,ch:37},'^':{code:54,ch:94},'&':{code:55,ch:38},'*':{code:56,ch:42},'(':{code:57,ch:40},')':{code:48,ch:41},'-':{code:45,ch:45},'_':{code:45,ch:95},'=':{code:61,ch:61},'+':{code:61,ch:43},'[':{code:91,ch:91},'{':{code:91,ch:123},']':{code:93,ch:93},'}':{code:93,ch:125},'\\':{code:92,ch:92},'|':{code:92,ch:124},';':{code:59,ch:59},':':{code:59,ch:58},"'":{code:222,ch:39},'"':{code:222,ch:34},',':{code:44,ch:44},'<':{code:44,ch:60},'.':{code:46,ch:46},'>':{code:46,ch:62},'/':{code:47,ch:47},'?':{code:47,ch:63},'F1':{code:112,ch:65535},'F2':{code:113,ch:65535},'F3':{code:114,ch:65535},'F4':{code:115,ch:65535},'F5':{code:116,ch:65535},'F6':{code:117,ch:65535},'F7':{code:118,ch:65535},'F8':{code:119,ch:65535},'F9':{code:120,ch:65535},'F10':{code:121,ch:65535},'F11':{code:122,ch:65535},'F12':{code:123,ch:65535},0:{code:48,ch:48},1:{code:49,ch:49},2:{code:50,ch:50},3:{code:51,ch:51},4:{code:52,ch:52},5:{code:53,ch:53},6:{code:54,ch:54},7:{code:55,ch:55},8:{code:56,ch:56},9:{code:57,ch:57},'a':{code:65,ch:97},'b':{code:66,ch:98},'c':{code:67,ch:99},'d':{code:68,ch:100},'e':{code:69,ch:101},'f':{code:70,ch:102},'g':{code:71,ch:103},'h':{code:72,ch:104},'i':{code:73,ch:105},'j':{code:74,ch:106},'k':{code:75,ch:107},'l':{code:76,ch:108},'m':{code:77,ch:109},'n':{code:78,ch:110},'o':{code:79,ch:111},'p':{code:80,ch:112},'q':{code:81,ch:113},'r':{code:82,ch:114},'s':{code:83,ch:115},'t':{code:84,ch:116},'u':{code:85,ch:117},'v':{code:86,ch:118},'w':{code:87,ch:119},'x':{code:88,ch:120},'y':{code:89,ch:121},'z':{code:90,ch:122},'A':{code:65,ch:65},'B':{code:66,ch:66},'C':{code:67,ch:67},'D':{code:68,ch:68},'E':{code:69,ch:69},'F':{code:70,ch:70},'G':{code:71,ch:71},'H':{code:72,ch:72},'I':{code:73,ch:73},'J':{code:74,ch:74},'K':{code:75,ch:75},'L':{code:76,ch:76},'M':{code:77,ch:77},'N':{code:78,ch:78},'O':{code:79,ch:79},'P':{code:80,ch:80},'Q':{code:81,ch:81},'R':{code:82,ch:82},'S':{code:83,ch:83},'T':{code:84,ch:84},'U':{code:85,ch:85},'V':{code:86,ch:86},'W':{code:87,ch:87},'X':{code:88,ch:88},'Y':{code:89,ch:89},'Z':{code:90,ch:90}};class $t{static getParameter(t){return new URLSearchParams(window.location.search).get(t)??''}static setParameter(t,i){const s=new URL(window.location.toString());s.searchParams.set(t,i),window.history.pushState(null,'',s.toString())}aT=0;cT=[];fT=0;uT=null;state=0;dT=20;wT=1;yT=[];pT=0;AT=0;mT=[];IT=!0;ET=!1;gT=50;hasFocus=!0;_T=!1;CT=Date.now();TT=0;gh=0;_h=0;OT=0;bT=0;LT=0;vT=[];ST=[];RT=0;MT=0;input=null;kT=!1;xT=!1;DT=!1;time=-1;NT=0;PT=0;FT=0;UT=0;BT=0;GT=0;constructor(t=!1){x.tabIndex=-1,D.fillStyle='black',D.fillRect(0,0,x.width,x.height),this.ET=t,this.ET?this.resize(window.innerWidth,window.innerHeight):this.resize(x.width,x.height)}get width(){return x.width}get height(){return x.height}resize=(t,i)=>{x.width=t,x.height=i,this.uT=new z(t,i),O.rs()};run=async()=>{x.addEventListener('resize',(()=>{this.ET&&this.resize(window.innerWidth,window.innerHeight)}),!1),x.onmousedown=this.onmousedown,x.onmouseup=this.onmouseup,x.onmouseenter=this.onmouseenter,x.onmouseleave=this.onmouseleave,x.onmousemove=this.onmousemove,window.onbeforeunload=this.ns,x.onfocus=this.onfocus,x.onblur=this.onblur,this.HT?(x.ontouchstart=this.ontouchstart,x.ontouchend=this.ontouchend,x.ontouchmove=this.ontouchmove):(x.onkeydown=this.onkeydown,x.onkeyup=this.onkeyup),x.oncontextmenu=t=>{t.preventDefault()},window.oncontextmenu=t=>{t.preventDefault()},await this.WT(0,'Loading...'),await this.load();for(let t=0;t<10;t++)this.yT[t]=performance.now();let t,s=0,h=256,e=1,n=0;for(;this.state>=0;){if(this.state>0&&(this.state--,0===this.state))return void this.YT();const r=h,o=e;h=300,e=1,t=performance.now();const l=this.yT[s];if(0===l?(h=r,e=o):t>l&&(h=2560*this.dT/(t-l)|0),h<25?h=25:h>256&&(h=256,e=this.dT-(t-l)/10|0),this.yT[s]=t,s=(s+1)%10,e>1)for(let t=0;t<10;t++)0!==this.yT[t]&&(this.yT[t]+=e);for(e<this.wT&&(e=this.wT),await i(e);n<256;)await this.update(),this.OT=0,this.RT=this.MT,n+=h;n&=255,this.dT>0&&(this.pT=1e3*h/(256*this.dT)|0);const a=performance.now();if(this.IT&&this.refresh(),await this.draw(),this.mT[this.AT]=(performance.now()-a)/1e3,this.AT=(this.AT+1)%this.mT.length,this.gT<50){const s=1e3/this.gT-(performance.now()-t);s>0&&await i(s)}}-1===this.state&&this.YT()};YT=()=>{this.state=-2,this.ns()};VT=t=>{this.dT=1e3/t|0};KT=t=>{this.gT=Math.max(Math.min(50,0|t),0)};start=()=>{this.state>=0&&(this.state=0)};stop=()=>{this.state>=0&&(this.state=4e3/this.dT|0)};destroy=()=>{this.state=-1};load=async()=>{};update=async()=>{};ns=()=>{};draw=async()=>{};refresh=()=>{};async WT(t,s){const h=this.width,e=this.height;this.IT&&(D.fillStyle='black',D.fillRect(0,0,h,e),this.IT=!1);const n=e/2-18;D.fillStyle='rgb(140, 17, 17)',D.rect((h/2|0)-152,n,304,34),D.fillRect((h/2|0)-150,n+2,3*t,30),D.fillStyle='black',D.fillRect((h/2|0)-150+3*t,n+2,300-3*t,30),D.font='bold 13px helvetica, sans-serif',D.textAlign='center',D.fillStyle='white',D.fillText(s,h/2|0,n+22),await i(5)}XT=()=>{let t=-1;return this.MT!==this.RT&&(t=this.ST[this.RT],this.RT=this.RT+1&127),t};get ms(){const t=this.mT.length;let i=0;for(let s=0;s<t;s++)i+=this.mT[s];const s=i/t*1e3;return s>this.aT&&(this.aT=s),this.cT[this.fT]=s,this.fT=(this.fT+1)%250,s}get zT(){return this.cT.reduce(((t,i)=>t+i),0)/250}onkeydown=t=>{const i=t.key;this.CT=Date.now();const s=qt[i];if(!s||0===t.code.length&&!t.isTrusted)return void console.warn(`Unhandled key: ${i}`);const h=s.code;let e=s.ch;t.ctrlKey&&(e>='A'.charCodeAt(0)&&e<=']'.charCodeAt(0)||e=='_'.charCodeAt(0)?e-='A'.charCodeAt(0)-1:e>='a'.charCodeAt(0)&&e<='z'.charCodeAt(0)&&(e-='a'.charCodeAt(0)-1)),e<30&&(e=0),h===qt.ArrowLeft.code?e=1:h===qt.ArrowRight.code?e=2:h===qt.ArrowUp.code?e=3:h===qt.ArrowDown.code?e=4:h===qt.Control.code?e=5:h===qt.Shift.code?e=6:h===qt.Alt.code?e=7:h===qt.Backspace.code||h===qt.Delete.code?e=8:h===qt.Tab.code?e=9:h===qt.Enter.code?e=10:h>=qt.F1.code&&h<=qt.F12.code?e=h+1008-qt.F1.code:h===qt.Home.code?e=1e3:h===qt.End.code?e=1001:h===qt.PageUp.code?e=1002:h===qt.PageDown.code&&(e=1003),e>0&&e<128&&(this.vT[e]=1),e>4&&(this.ST[this.MT]=e,this.MT=this.MT+1&127),yt.enabled&&yt.uA(e),Zt.includes(i)||t.preventDefault()};onkeyup=t=>{const i=t.key;this.CT=Date.now();const s=qt[i];if(!s||0===t.code.length&&!t.isTrusted)return void console.warn(`Unhandled key: ${i}`);const h=s.code;let e=s.ch;e<30&&(e=0),h===qt.ArrowLeft.code?e=1:h===qt.ArrowRight.code?e=2:h===qt.ArrowUp.code?e=3:h===qt.ArrowDown.code?e=4:h===qt.Control.code?e=5:h===qt.Shift.code?e=6:h===qt.Alt.code?e=7:h===qt.Backspace.code||h===qt.Delete.code?e=8:h===qt.Tab.code?e=9:h===qt.Enter.code?e=10:h>=qt.F1.code&&h<=qt.F12.code?e=h+1008-qt.F1.code:h===qt.Home.code?e=1e3:h===qt.End.code?e=1001:h===qt.PageUp.code?e=1002:h===qt.PageDown.code&&(e=1003),e>0&&e<128&&(this.vT[e]=0),yt.enabled&&yt.dA(e),Zt.includes(i)||t.preventDefault()};onmousedown=t=>{if(this.kT=!1,(t.clientX>0||t.clientY>0)&&this.jT(t),this.CT=Date.now(),this.bT=this.gh,this.LT=this._h,this.HT&&!this.ZT){if(this.qT()||this.$T()||this.JT())return this.OT=1,void(this.TT=1);t.timeStamp>=this.time+500?(this.OT=2,this.TT=2):(this.OT=1,this.TT=1)}else 2===t.button?(this.OT=2,this.TT=2):(this.OT=1,this.TT=1);yt.enabled&&yt.lA(this.bT,this.LT,t.buttons)};onmouseup=t=>{this.jT(t),this.CT=Date.now(),this.TT=0,yt.enabled&&yt.cA(t.buttons)};onmouseenter=t=>{this.jT(t),yt.enabled&&yt.pA()};onmouseleave=t=>{this.jT(t),this.CT=Date.now(),this.gh=-1,this._h=-1,this.TT=0,this.bT=-1,this.LT=-1,yt.enabled&&yt.AA()};onmousemove=t=>{this.jT(t),this.CT=Date.now(),yt.enabled&&yt.fA(this.gh,this._h)};onfocus=t=>{this.hasFocus=!0,this.IT=!0,this.refresh(),yt.enabled&&yt.wA()};onblur=t=>{this.hasFocus=!1,yt.enabled&&yt.yA()};ontouchstart=t=>{if(!this.HT)return;null!==this.input&&(this.input.parentNode?.removeChild(this.input),this.input=null),this.kT=!0;const i=t.changedTouches[0],s=0|i.clientX,h=0|i.clientY;this.onmousemove(new MouseEvent('mousemove',{clientX:s,clientY:h})),this.NT=this.BT=this.FT=0|i.screenX,this.PT=this.GT=this.UT=0|i.screenY,this.time=t.timeStamp,this.xT=this.QT(),this.DT=this.tO()};ontouchend=t=>{if(!this.HT||!this.kT)return;const i=t.changedTouches[0],s=0|i.clientX,h=0|i.clientY;if(this.onmousemove(new MouseEvent('mousemove',{clientX:s,clientY:h})),this.BT=0|i.screenX,this.GT=0|i.screenY,this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowLeft',code:'ArrowLeft'})),this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowUp',code:'ArrowUp'})),this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowRight',code:'ArrowRight'})),this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowDown',code:'ArrowDown'})),this.xT&&!this.QT())return void(this.kT=!1);if(this.DT&&!this.tO())return void(this.kT=!1);if(this.qT()||this.iO()||this.$T()||this.JT()){null!==this.input&&(this.input.parentNode?.contains(this.input)&&this.input.parentNode?.removeChild(this.input),this.input=null);const t=document.createElement('input');return this.$T()?(t.setAttribute('id','username'),t.setAttribute('placeholder','Username')):this.JT()?(t.setAttribute('id','password'),t.setAttribute('placeholder','Password')):this.qT()?(t.setAttribute('id','chatinput'),t.setAttribute('placeholder','Chatinput')):this.iO()&&(t.setAttribute('id','chatpopup'),t.setAttribute('placeholder','Chatpopup')),this.sO?t.setAttribute('type','password'):t.setAttribute('type',this.JT()?'password':'text'),t.setAttribute('autofocus','autofocus'),t.setAttribute('spellcheck','false'),t.setAttribute('autocomplete','off'),t.setAttribute('style',`position: fixed; left: ${s}px; top: ${h}px; width: 1px; height: 1px; opacity: 0;`),document.body.appendChild(t),t.focus(),t.click(),this.sO&&(t.oninput=t=>{if(!(t instanceof InputEvent))return;const i=t,s=i.data;null!==s&&'insertText'===i.inputType&&this.onkeydown(new KeyboardEvent('keydown',{key:s,code:s}))}),t.onkeydown=t=>{this.sO&&'Enter'!==t.key&&'Backspace'!==t.key||this.onkeydown(new KeyboardEvent('keydown',{key:t.key,code:t.key}))},t.onkeyup=t=>{this.sO&&'Enter'!==t.key&&'Backspace'!==t.key||this.onkeyup(new KeyboardEvent('keyup',{key:t.key,code:t.key}))},t.onfocus=t=>{this.input?.parentNode?.removeChild(this.input),this.input=null,this.onfocus(t)},this.input=t,void(this.kT=!1)}const e=t.timeStamp>=this.time+500,n=Math.abs(this.NT-this.BT)>16||Math.abs(this.PT-this.GT)>16;e&&!n?(this.kT=!0,this.onmousedown(new MouseEvent('mousedown',{buttons:2}))):(this.TT=0,this.kT=!1)};ontouchmove=t=>{if(!this.HT||!this.kT)return;const i=t.changedTouches[0],s=0|i.clientX,h=0|i.clientY;this.onmousemove(new MouseEvent('mousemove',{clientX:s,clientY:h})),this.BT=0|i.screenX,this.GT=0|i.screenY,this.xT&&-1===this.hO()?(this.FT-this.BT>0?this.rotate(2):this.FT-this.BT<0&&this.rotate(0),this.UT-this.GT>0?this.rotate(3):this.UT-this.GT<0&&this.rotate(1)):(this.DT||-1!==this.hO())&&this.onmousedown(new MouseEvent('mousedown',{buttons:1})),this.FT=this.BT,this.UT=this.GT};get HT(){return['Android','webOS','iPhone','iPad','iPod','BlackBerry','Windows Phone'].some((t=>navigator.userAgent.includes(t)))}get sO(){return['Android'].some((t=>navigator.userAgent.includes(t)))}get ZT(){return['Capacitor'].some((t=>navigator.userAgent.includes(t)))}QT=()=>this._T&&this.gh>=8&&this.gh<=520&&this._h>=11&&this._h<=345;qT=()=>this._T&&-1===this.eO()&&!this.nO()&&!this.rO()&&this.gh>=11&&this.gh<=506&&this._h>=449&&this._h<=482;iO=()=>this._T&&(this.nO()||this.rO())&&this.gh>=11&&this.gh<=506&&this._h>=383&&this._h<=482;tO=()=>this._T&&this.gh>=562&&this.gh<=752&&this._h>=231&&this._h<=492;$T=()=>!this._T&&2===this.oO()&&this.gh>=301&&this.gh<=562&&this._h>=262&&this._h<=279;JT=()=>!this._T&&2===this.oO()&&this.gh>=301&&this.gh<=562&&this._h>=279&&this._h<=296;rotate=t=>{0===t?(this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowRight',code:'ArrowRight'})),this.onkeydown(new KeyboardEvent('keydown',{key:'ArrowLeft',code:'ArrowLeft'}))):1===t?(this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowDown',code:'ArrowDown'})),this.onkeydown(new KeyboardEvent('keydown',{key:'ArrowUp',code:'ArrowUp'}))):2===t?(this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowLeft',code:'ArrowLeft'})),this.onkeydown(new KeyboardEvent('keydown',{key:'ArrowRight',code:'ArrowRight'}))):3===t&&(this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowUp',code:'ArrowUp'})),this.onkeydown(new KeyboardEvent('keydown',{key:'ArrowDown',code:'ArrowDown'})))};lO=()=>null!==document.fullscreenElement;jT=t=>{if(this.lO()){const i=t.target.getBoundingClientRect(),s=window.innerHeight/x.height,h=(window.innerWidth-x.width*s)/2;this.gh=0|this.aO(t.clientX-i.left-h,0,x.width*s,0,789),this._h=0|this.aO(t.clientY-i.top,0,x.height*s,0,532)}else{const i=x.getBoundingClientRect(),s=x.width/i.width,h=x.height/i.height;this.gh=(t.clientX-i.left)*s|0,this._h=(t.clientY-i.top)*h|0}this.gh<0&&(this.gh=0),this._h<0&&(this._h=0),this.gh>789&&(this.gh=789),this._h>532&&(this._h=532)};aO=(t,i,s,h,e)=>(t-i)*(e-h)/(s-i)+h}function Jt(t,i){var s;(s=document.createElement('a')).href=t,s.download=i,document.body.appendChild(s),s.style='display: none',s.click(),s.remove()}class Qt{cO=new Map;fO;uO=self.isSecureContext?self.crypto.randomUUID():'0';constructor(t){this.fO=t}async dO(){const t=new RTCPeerConnection({wO:[{yO:'stun:stun.l.google.com:19302'}]}),i=t.createDataChannel('channel'),s=crypto.randomUUID();this.cO.set(s,i),await t.setLocalDescription(await t.createOffer()),t.onicegatheringstatechange=async()=>{if('complete'===t.iceGatheringState){let i;self.isSecureContext?await navigator.clipboard.writeText(JSON.stringify(t.localDescription)):console.log(JSON.stringify(t.localDescription));try{for(;null===(i=prompt('Offer copied to clipboard, paste answer here')););t.setRemoteDescription(new RTCSessionDescription(JSON.parse(i)))}catch(t){console.error(t)}}},i.onopen=()=>{i.send(JSON.stringify({type:'id',id:s})),console.log('Connected to peer!')},i.onerror=t=>{console.error(t)},i.onmessage=t=>{const i=JSON.parse(t.data);i.data&&(i.data=Object.values(i.data)),this.fO&&this.fO.postMessage(i)}}postMessage(t){const i=this.cO.get(t.data.id),s=t.data;s.data&&(s.data=Array.from(t.data.data)),i&&'open'===i.readyState&&i.send(JSON.stringify(s))}}class ti{pc;pO=void 0;uO;constructor(t){this.pc=new RTCPeerConnection({wO:[{yO:'stun:stun.l.google.com:19302'}]}),this.pc.ondatachannel=i=>{this.pO=i.channel,this.pO.onopen=()=>{console.log('Connected to host!')},this.pO.onerror=t=>{console.error(t)},this.pO.onmessage=i=>{if(!this.uO){const t=JSON.parse(i.data);if('id'===t.type)return void(this.uO=t.id)}t.onmessage&&t.onmessage(i)}},this.pc.onicegatheringstatechange=async()=>{'complete'===this.pc.iceGatheringState&&(self.isSecureContext?await navigator.clipboard.writeText(JSON.stringify(this.pc.localDescription)):console.log(JSON.stringify(this.pc.localDescription)))}}async AO(t){await this.pc.setRemoteDescription(new RTCSessionDescription(JSON.parse(t))),await this.pc.setLocalDescription(await this.pc.createAnswer())}}class ii extends $t{static mO=225;static IO=10;static portOffset=0;static members=!0;static Bi=!1;static EO='';static gO='';static _O=!1;static CO=2;static TO=!1;static OO='https://raw.githubusercontent.com/2004scape/Server/main';static exponent=58778699976184461502525193738213253649000149147835990136706041084440742975821n;static bO=7162900525229798032761816791230527296329313291232324290237849263501208207972894053929065636522363163621000728841182238772712427862772219676577293600221789n;static LO=0;static vO=0;static SO=0;static RO=0;static MO=0;static kO=0;static xO=0;static DO=0;static NO=0;static PO=0;static FO=0;static UO=0;static BO=0;static GO=0;static HO=0;static WO=()=>{St.Bi=!1,O.Bi=!1,ii.Bi=!1,kt.Bi=!1};static YO=()=>{St.Bi=!0,O.Bi=!0,ii.Bi=!0,kt.Bi=!0};VO=2048;KO=2047;XO=!1;zO=!1;jO=!1;ZO=!1;db=null;qO=0;$O=[];stream=null;in=a.vt(1);JO=a.vt(1);QO=a.vt(1);tb=0n;ib=0;sb=0;hb=0;eb=null;nb=0;packetSize=0;rb=0;ob=0;lb=0;ab=null;cb=!0;fb=0;ub=0;wb=null;yb=null;pb=null;Ab=null;mb=null;Ib=null;Eb=null;gb=null;_b=null;Cb=null;Tb=null;Ob='';bb='';username='';password='';Lb=null;vb=null;Sb=null;Rb=null;Mb=[];kb=!1;xb=null;Db=null;Nb=null;Pb=null;Fb=null;Ub=null;Bb=null;Gb=null;Hb=null;Wb=null;Yb=new Int32Array(256);Vb=0;Kb=0;Xb=0;zb=null;jb=null;Zb=null;qb=null;$b=null;Jb=null;Qb=null;tL=null;iL=null;sL=null;hL=null;eL=null;nL=null;rL=null;oL=null;lL=null;aL=null;cL=null;fL=null;uL=null;dL=null;wL=new Int32Array(33);yL=new Int32Array(33);pL=new Int32Array(151);mL=new Int32Array(151);IL=null;EL=null;gL=null;_L=null;CL=null;TL=null;OL=new c(13,null);bL=null;LL=null;vL=new c(50,null);SL=new c(50,null);RL=new c(20,null);ML=new c(20,null);kL=null;xL=new c(8,null);DL=null;NL=null;PL=null;FL=null;UL=null;BL=null;HL=null;WL=null;YL=null;VL=null;KL=null;XL=null;zL=null;jL=null;ZL=null;qL=null;$L=null;JL=null;QL=new c(1e3,null);tv=!1;iv=!1;sv=!1;hv=!1;ev=-1;nv=0;rv=0;ov=0;lv=0;av=0;cv=0;fv=!1;uv=0;dv=0;wv=0;yv=0;pv=0;Av=0;mv=[];Iv=-1;Ev=-1;gv=new X;_v=78;Cv=0;Tv=0;Ov=[];bv=0;Lv=0;vv=0;Sv=0;Rv=0;Mv=0;kv=0;xv=0;Dv=[];Nv=[];Pv=[];Fv=[];Uv=null;Bv=-1;Gv=3;Hv=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];Wv=0;Yv=0;Vv=0;Kv=!1;Xv=0;zv=!1;jv='';Zv='';qv=0;$v='';Jv=!1;Qv=-1;tS=new c(100,null);iS=new c(100,null);messageType=new Int32Array(100);sS=new Int32Array(100);hS=0;eS=0;nS=0;rS='';oS=0;lS=0;aS=0;cS=0;fS=0;uS=0;dS=0;wS=0;yS=0;pS=!1;AS=0;mS=0;IS=0;ES=0;gS=null;_S=0;CS=0;TS=0;OS=0;bS=!1;LS=[];vS=[];SS=0;RS=0;MS=0;kS=null;xS=0;DS=new Int32Array(500);NS=new Int32Array(500);PS=new Int32Array(500);US=new Int32Array(500);BS=0;GS=0;HS=0;WS='';YS=!1;VS=-1;KS=0;XS=0;zS=0;jS=0;ZS=0;qS=new Int32Array(1e3);$S=new Int32Array(1e3);JS=null;QS=0;tR=0;iR=0;sR=0;hR=0;eR=!1;nR=0;rR=0;oR=0;lR=0;aR=2;cR=2;fR=1;uR=new Int32Array(5);dR=new c(5,!1);wR=new Int32Array(5);yR=new Int32Array(5);pR=new Int32Array(5);AR=0;mR=0;IR=0;ER=0;gR=0;_R=0;CR=0;TR=0;OR=0;bR=1;LR=2;vR=-1;Ah=0;Ih=0;SR=0;RR=0;MR=0;kR=0;xR=null;DR=null;NR=null;PR=0;FR=0;UR=new Int8Array(16384);BR=new c(gt.Dm,null);GR=0;HR=0;WR=128;YR=0;VR=0;KR=0;XR=0;zR=0;Jg=null;Qg=null;jR=new y(gt.Nm,gt.Nm);ZR=0;qR=0;$R=0;JR=0;QR=0;tM=0;iM=0;sM=0;hM=0;eM=0;nM=0;rM=0;oM=new c(this.VO,null);lM=0;aM=new Int32Array(this.VO);cM=0;fM=0;uM=new Int32Array(this.VO);dM=new Int32Array(1e3);wM=new c(this.VO,null);yM=new c(8192,null);pM=0;AM=new Int32Array(8192);mM=new o;IM=new o;EM=new o;ME=new o;gM=new u(gt.Dm,gt.Nm,gt.Nm,null);_M=new o;CM=new Int32Array(4e3);TM=new Int32Array(4e3);OM=new Int32Array(gt.Nm*gt.Nm);bM=new Int32Array(gt.Nm*gt.Nm);LM=0;vM=null;SM=0;RM=0;MM=-1;kM=0;xM=0;DM=0;NM=0;PM=!1;FM=!0;UM=!1;BM=new Int32Array(7);GM=new Int32Array(5);HM=0;WM=0;static YM=50;VM=new Int32Array(ii.YM);KM=new Int32Array(ii.YM);XM=new Int32Array(ii.YM);zM=new Int32Array(ii.YM);jM=new Int32Array(ii.YM);ZM=new Int32Array(ii.YM);qM=new Int32Array(ii.YM);$M=new c(ii.YM,null);JM=new c(100,null);QM=new BigInt64Array(100);tk=new Int32Array(100);ik=null;sk=0;hk=!0;ek=new Int32Array(50);nk=new Int32Array(50);rk=new Int32Array(50);lk=192;ak=-1;ck=-1;fk=0;uk=0;dk=0;wk=!0;yk=null;pk=0;Ak=0;mk=192;fO=void 0;Ik=!1;host=null;Ek=null;gk=new c(16,null);_k=0;Ck=!1;ns=()=>{try{this.stream&&this.stream.close()}catch(t){}this.stream=null,zt(!1),this.JO=null,this.QO=null,this.in=null,this.NR=null,this.xR=null,this.DR=null,this.Jg=null,this.Qg=null,this.JS=null,this.BR=null,this.OM=null,this.bM=null,this.CM=null,this.TM=null,this.UR=null,this.jb=null,this.Zb=null,this.qb=null,this.$b=null,this.Jb=null,this.Qb=null,this.tL=null,this.iL=null,this.sL=null,this.hL=null,this.eL=null,this.nL=null,this.rL=null,this.oL=null,this.lL=null,this.aL=null,this.cL=null,this.IL=null,this.gL=null,this.EL=null,this._L=null,this.CL=null,this.TL=null,this.OL=null,this.HL=null,this.WL=null,this.YL=null,this.VL=null,this.KL=null,this.XL=null,this.zL=null,this.jL=null,this.ZL=null,this.qL=null,this.LL=null,this.RL=null,this.ML=null,this.xL=null,this.DL=null,this.NL=null,this.PL=null,this.FL=null,this.vL=null,this.SL=null,this.jR=null,this.oM=null,this.aM=null,this.uM=null,this.wM=null,this.dM=null,this.yM=null,this.AM=null,this.gM=null,this._M=null,this.ME=null,this.mM=null,this.IM=null,this.EM=null,this.PS=null,this.US=null,this.DS=null,this.NS=null,this.mv=null,this.LS=null,this.qS=null,this.$S=null,this.QL=null,this.bL=null,this.JM=null,this.QM=null,this.tk=null,this.Ab=null,this.mb=null,this.wb=null,this.yb=null,this.pb=null,this.Ib=null,this.Eb=null,this.gb=null,this._b=null,this.Tk(),k.ns(),H.ns(),G.ns(),Rt.$t=null,W.$t=null,X.$t=null,I.$t=null,Y.$t=null,Y.Fo=null,V.$t=null,this.uT=null,Ft.Fo=null,O.ns(),St.ns(),v.ns(),A.$t=[],m.$t=[]};oO(){return this.fb}nO(){return this.Jv}rO(){return this.zv}eO(){return this.Ev}hO(){return this.ev}Tk=()=>{this.kb=!1,this.zb&&(clearInterval(this.zb),this.zb=null),this.Cb=null,this.Tb=null,this.Mb=[],this.Bb=null,this.Gb=null,this.Hb=null,this.Wb=null,this.Pb=null,this.Nb=null,this.Fb=null,this.Ub=null,this.xb=null,this.Db=null};Ok=()=>{'999'===ii.getParameter('world')?(this.fO=new Worker('worker.js',{type:'module'}),this.fO.onmessage=this.onmessage,this.host=new Qt(this.fO)):'998'===ii.getParameter('world')&&(this.fO={onmessage:t=>{this.stream.bk.onmessage(t)},postMessage:t=>{this.Ek&&this.Ek.pO&&'open'===this.Ek.pO.readyState&&this.Ek.pO.send(JSON.stringify(t))},onerror:null,onmessageerror:null,terminate:()=>{throw new Error},addEventListener:()=>{throw new Error},removeEventListener:()=>{throw new Error},dispatchEvent:()=>{throw new Error}},this.Ek=new ti(this.fO))};onmessage=t=>{switch(t.data.type){case'ready':return void(this.Ik=!0);case'save':return Jt(t.data.value,t.data.path.split('/').pop().split('\\').pop()),void URL.revokeObjectURL(t.data.value);case'close':return void this.fO?.postMessage({type:'close',id:t.data.id})}this.host?.uO===t.data.id?this.stream.bk.onmessage(t.data):this.host?.postMessage(t)};Lk=async()=>{if(999==+ii.getParameter('world'))this.host&&await this.host.dO();else if(998==+ii.getParameter('world')&&this.Ek){if(this.Ek.pO)return void console.log('You are already connected.');const t=prompt('Paste offer here, answer will be copied to clipboard');if(t)try{await this.Ek.AO(t)}catch(t){console.error(t)}}};vk=async(t,s,h,n)=>{let r=5,o=await(this.db?.Kf(t));if(o&&a.Ot(o)!==h&&(o=void 0),o)return new jt(o);for(;!o;){await this.WT(n,`Requesting ${s}`);try{o=await e(`${ii.gO}/${t}${h}`)}catch(t){o=void 0;for(let t=r;t>0;t--)await this.WT(n,`Error loading - Will retry in ${t} secs.`),await i(1e3);r*=2,r>60&&(r=60)}}return await(this.db?.Xf(t,o)),new jt(o)};Sk=async(t,i,s,h)=>{let n=await(this.db?.Kf(t+'.mid'));if(n&&12345678!==i&&a.Ot(n)!==i&&(n=void 0),!n)try{n=await e(`${ii.gO}/${t}_${i}.mid`),s!==n.length&&(n=n.slice(0,s))}catch(t){}if(n)try{await(this.db?.Xf(t+'.mid',n));const i=new a(Uint8Array.from(n)).xt;Kt(wt.read(i,n,s,4),this.mk,h)}catch(t){}};Rk=()=>{if(D.fillStyle='black',D.fillRect(0,0,this.width,this.height),this.VT(1),this.jO){this.kb=!1,D.font='bold 16px helvetica, sans-serif',D.textAlign='left',D.fillStyle='yellow';let t=35;D.fillText('Sorry, an error has occured whilst loading RuneScape',30,t),t+=50,D.fillStyle='white',D.fillText('To fix this try the following (in order):',30,t),t+=50,D.font='bold 12px helvetica, sans-serif',D.fillText('1: Try closing ALL open web-browser windows, and reloading',30,t),t+=30,D.fillText('2: Try clearing your web-browsers cache from tools->internet options',30,t),t+=30,D.fillText('3: Try using a different game-world',30,t),t+=30,D.fillText('4: Try rebooting your computer',30,t),t+=30,D.fillText('5: Try selecting a different version of Java from the play-game menu',30,t)}if(this.ZO&&(this.kb=!1,D.font='bold 20px helvetica, sans-serif',D.textAlign='left',D.fillStyle='white',D.fillText('Error - unable to load game!',50,50),D.fillText('To play RuneScape make sure you play from',50,100),D.fillText('https://2004scape.org',50,150)),this.zO){this.kb=!1,D.font='bold 13px helvetica, sans-serif',D.textAlign='left',D.fillStyle='yellow';let t=35;D.fillText('Error a copy of RuneScape already appears to be loaded',30,t),t+=50,D.fillStyle='white',D.fillText('To fix this try the following (in order):',30,t),t+=50,D.font='bold 12px helvetica, sans-serif',D.fillText('1: Try closing ALL open web-browser windows, and reloading',30,t),t+=30,D.fillText('2: Try rebooting your computer, and reloading',30,t)}};Mk=t=>{if(!t.yc)return!1;for(let i=0;i<t.yc.length;i++){const s=this.kk(t,i);if(!t.Ac)return!1;const h=t.Ac[i];if(2===t.yc[i]){if(s>=h)return!1}else if(3===t.yc[i]){if(s<=h)return!1}else if(4===t.yc[i]){if(s===h)return!1}else if(s!==h)return!1}return!0};xk=(t,i,s,h,e)=>{this.UL?.draw(t,i),this.BL?.draw(t,i+e-16),C.fillRect(t,i+16,16,e-32,B._r);let n=(e-32)*e/h|0;n<8&&(n=8);const r=(e-n-32)*s/(h-e)|0;C.fillRect(t,i+r+16,16,n,B.Cr),C.Ci(t,i+r+16,B.Tr,n),C.Ci(t+1,i+r+16,B.Tr,n),C._i(t,i+r+16,B.Tr,16),C._i(t,i+r+17,B.Tr,16),C.Ci(t+15,i+r+16,B.Or,n),C.Ci(t+14,i+r+17,B.Or,n-1),C._i(t,i+r+n+15,B.Or,16),C._i(t+1,i+r+n+14,B.Or,15)};Dk=(t,i)=>{let s=!1;const h=X.$t[t];if(!h.mc)return!1;for(let t=0;t<h.mc.length&&-1!==h.mc[t];t++){const e=X.$t[h.mc[t]];if(1===e.type&&(s||=this.Dk(e.id,i)),6===e.type&&(-1!==e.Mn||-1!==e.Hc)){let t;if(t=this.Mk(e)?e.Hc:e.Mn,-1!==t){const h=I.$t[t];if(e.Zc+=i,h.delay)for(;e.Zc>h.delay[e.jc];)e.Zc-=h.delay[e.jc]+1,e.jc++,e.jc>=h.ii&&(e.jc-=h.hi,(e.jc<0||e.jc>=h.ii)&&(e.jc=0)),s=!0}}}return s};Nk=(t,i,s,h,e=!1)=>{if(0!==t.type||!t.mc||t.hide&&this.oS!==t.id&&this.lS!==t.id&&this.aS!==t.id)return;const n=C.left,r=C.top,o=C.right,l=C.bottom;C.Ii(i,s,i+t.width,s+t.height);const a=t.mc.length;for(let n=0;n<a;n++){if(!t.Ic||!t.Ec)continue;let r=t.Ic[n]+i,o=t.Ec[n]+s-h;const l=X.$t[t.mc[n]];if(r+=l.x,o+=l.y,e&&C.gi(r,o,l.width,l.height,B.lr),l.dc>0&&this.Pk(l),l.type===X.Kl)l.zc>l.scroll-l.height&&(l.zc=l.scroll-l.height),l.zc<0&&(l.zc=0),this.Nk(l,r,o,l.zc,e),l.scroll>l.height&&this.xk(r+l.width,o,l.zc,l.scroll,l.height);else if(l.type===X.zl){let t=0;for(let i=0;i<l.height;i++)for(let s=0;s<l.width;s++){if(!(l.Lc&&l.vc&&l.gc&&l._c))continue;let h=r+s*(l.Oc+32),e=o+i*(l.bc+32);if(t<20&&(h+=l.Lc[t],e+=l.vc[t]),l.gc[t]>0){let i=0,s=0;const n=l.gc[t]-1;if(h>=-32&&h<=512&&e>=-32&&e<=334||0!==this.uS&&this.fS===t){const r=G.Wo(n,l._c[t]);if(0!==this.uS&&this.fS===t&&this.cS===l.id?(i=this.gh-this.dS,s=this._h-this.wS,i<5&&i>-5&&(i=0),s<5&&s>-5&&(s=0),this.yS<5&&(i=0,s=0),r.$n(128,h+i,e+s)):0!==this._S&&this.CS===t&&this.TS===l.id?r.$n(128,h,e):r.draw(h,e),33===r.Ri||1!==l._c[t]){const n=l._c[t];this.Lb?.uf(h+i+1,e+10+s,this.Fk(n),B.ar),this.Lb?.uf(h+i,e+9+s,this.Fk(n),B.er)}}}else if(l.Sc&&t<20){const i=l.Sc[t];i?.draw(h,e)}t++}}else if(l.type===X.jl)l.fill?C.fillRect(r,o,l.width,l.height,l.Nc):C.gi(r,o,l.width,l.height,l.Nc);else if(l.type===X.Zl){const t=l.font;let i=l.Nc,s=l.text;if(this.aS!==l.id&&this.lS!==l.id&&this.oS!==l.id||0===l.Fc||(i=l.Fc),this.Mk(l)&&(i=l.Pc,l.Dc&&l.Dc.length>0&&(s=l.Dc)),l.uc===X.ea&&this.bS&&(s='Please wait...',i=l.Nc),!t||!s)continue;for(let h=o+t.height;s.length>0;h+=t.height){if(-1!==s.indexOf('%')){for(;;){const t=s.indexOf('%1');if(-1===t)break;s=s.substring(0,t)+this.Uk(this.kk(l,0))+s.substring(t+2)}for(;;){const t=s.indexOf('%2');if(-1===t)break;s=s.substring(0,t)+this.Uk(this.kk(l,1))+s.substring(t+2)}for(;;){const t=s.indexOf('%3');if(-1===t)break;s=s.substring(0,t)+this.Uk(this.kk(l,2))+s.substring(t+2)}for(;;){const t=s.indexOf('%4');if(-1===t)break;s=s.substring(0,t)+this.Uk(this.kk(l,3))+s.substring(t+2)}for(;;){const t=s.indexOf('%5');if(-1===t)break;s=s.substring(0,t)+this.Uk(this.kk(l,4))+s.substring(t+2)}}const e=s.indexOf('\\n');let n;-1!==e?(n=s.substring(0,e),s=s.substring(e+2)):(n=s,s=''),l.kc?t.Af(r+(l.width/2|0),h,n,i,l.xc):t.wf(r,h,n,i,l.xc)}}else if(l.type===X.ql){let t;t=this.Mk(l)?l.Bc:l.Uc,t?.draw(r,o)}else if(l.type===X.$l){const t=O.Ki,i=O.Xi;O.Ki=r+(l.width/2|0),O.Xi=o+(l.height/2|0);const s=O.sin[l.Wc]*l.zoom>>16,h=O.cos[l.Wc]*l.zoom>>16,e=this.Mk(l);let n;n=e?l.Hc:l.Mn;let a=null;if(-1===n)a=l.jn(-1,-1,e);else{const t=I.$t[n];t.frames&&t.si&&(a=l.jn(t.frames[l.jc],t.si[l.jc],e))}a&&a.Se(0,l.Yc,0,l.Wc,0,s,h),O.Ki=t,O.Xi=i}else if(l.type===X.Jl){const t=l.font;if(!t||!l.gc||!l._c)continue;let i=0;for(let s=0;s<l.height;s++)for(let h=0;h<l.width;h++){if(l.gc[i]>0){const e=G.get(l.gc[i]-1);let n=e.name;if((e.Qo||1!==l._c[i])&&(n=n+' x'+this.Bk(l._c[i])),!n)continue;const a=r+h*(l.Oc+115),c=o+s*(l.bc+12);l.kc?t.Af(a+(l.width/2|0),c,n,l.Nc,l.xc):t.wf(a,c,n,l.Nc,l.xc)}i++}}}C.Ii(n,r,o,l)};Pk=t=>{let i=t.dc;if(i>=X.na&&i<=X.ra)i--,i>=this.HM?(t.text='',t.uc=0):(t.text=this.JM[i],t.uc=1);else if(i>=X.oa&&i<=X.la)i-=X.oa,i>=this.HM?(t.text='',t.uc=0):(0===this.tk[i]?t.text='@red@Offline':this.tk[i]===ii.IO?t.text='@gre@World-'+(this.tk[i]-9):t.text='@yel@World-'+(this.tk[i]-9),t.uc=1);else if(i===X.fa)t.scroll=15*this.HM+20,t.scroll<=t.height&&(t.scroll=t.height+1);else if(i>=X.Ha&&i<=X.Wa)i-=X.Ha,i>=this.Tv?(t.text='',t.uc=0):(t.text=K.Wl(K.Ul(this.Ov[i])),t.uc=1);else if(i===X.Ka)t.scroll=15*this.Tv+20,t.scroll<=t.height&&(t.scroll=t.height+1);else if(i===X.Ga){if(t.Wc=150,t.Yc=256*Math.sin(this.qO/40)&2047,this.UM){this.UM=!1;const i=new c(7,null);let s=0;for(let t=0;t<7;t++){const h=this.BM[t];h>=0&&(i[s++]=W.$t[h].jn())}const h=v.fe(i,s);for(let t=0;t<5;t++)0!==this.GM[t]&&(h.Te(Ft.RC[t][0],Ft.RC[t][this.GM[t]]),1===t&&h.Te(Ft.SC[0],Ft.SC[this.GM[t]]));if(this.vM){const i=I.$t[this.vM.T_].frames;i&&(h.me(),h.ge(i[0]),h.be(64,850,-30,-50,-30,!0),t.model=h)}}}else if(i===X.Fa)this.$L||(this.$L=t.Uc,this.JL=t.Bc),this.FM?t.Uc=this.JL:t.Uc=this.$L;else if(i===X.Ua)this.$L||(this.$L=t.Uc,this.JL=t.Bc),this.FM?t.Uc=this.$L:t.Uc=this.JL;else if(i===X.Xa)t.text=this.WS,this.qO%20<10?t.text=t.text+'|':t.text=t.text+' ';else if(i===X.nc)this.PM?this.YS?(t.Nc=B.RED,t.text='Moderator option: Mute player for 48 hours: <ON>'):(t.Nc=B.lr,t.text='Moderator option: Mute player for 48 hours: <OFF>'):t.text='';else if(i===X.rc||i===X.fc)if(0===this.KS)t.text='';else{let i;i=0===this.XS?'earlier today':1===this.XS?'yesterday':this.XS+' days ago',t.text='You last logged in '+i+' from: '+K.Hl(this.KS)}else if(i===X.oc)0===this.jS&&(t.text='0 unread messages',t.Nc=B.er),1===this.jS&&(t.text='1 unread message',t.Nc=B.GREEN),this.jS>1&&(t.text=this.jS+' unread messages',t.Nc=B.GREEN);else if(i===X.lc)if(201===this.zS)t.text='';else if(200===this.zS)t.text='You have not yet set any password recovery questions.';else{let i;i=0===this.zS?'Earlier today':1===this.zS?'Yesterday':this.zS+' days ago',t.text=i+' you changed your recovery questions'}else i===X.ac?201===this.zS?t.text='':200===this.zS?t.text='We strongly recommend you do so now to secure your account.':t.text='If you do not remember making this change then cancel it immediately':i===X.cc&&(201===this.zS?t.text='':(this.zS,t.text="Do this from the 'account management' area on our front webpage"))};kk=(t,i)=>{if(!t.scripts||i>=t.scripts.length)return-2;try{const s=t.scripts[i];if(!s)return-1;let h=0,e=0;for(;;){const t=s[e++];if(0===t)return h;if(1===t)h+=this.Nv[s[e++]];else if(2===t)h+=this.Pv[s[e++]];else if(3===t)h+=this.Dv[s[e++]];else if(4===t){const t=X.$t[s[e++]],i=s[e++]+1;if(t.gc&&t._c)for(let s=0;s<t.gc.length;s++)t.gc[s]===i&&(h+=t._c[s]);else h+=0}else if(5===t)h+=this.LS[s[e++]];else if(6===t)h+=this.Fv[this.Pv[s[e++]]-1];else if(7===t)h+=100*this.LS[s[e++]]/46875|0;else if(8===t)h+=this.vM?.NC||0;else if(9===t)for(let t=0;t<19;t++)18===t&&(t=20),h+=this.Pv[t];else if(10===t){const t=X.$t[s[e++]],i=s[e++]+1;for(let s=0;s<t.gc.length;s++)if(t.gc[s]===i){h+=999999999;break}}else if(11===t)h+=this.SM;else if(12===t)h+=this.kM;else if(13===t){const t=this.LS[s[e++]];h+=t&1<<s[e++]?1:0}}}catch(t){return-1}};Uk=t=>t<999999999?String(t):'*';Bk=t=>{let i=String(t);for(let t=i.length-3;t>0;t-=3)i=i.substring(0,t)+','+i.substring(t);return i.length>8?i='@gre@'+i.substring(0,i.length-8)+' million @whi@('+i+')':i.length>4&&(i='@cya@'+i.substring(0,i.length-4)+'K @whi@('+i+')'),' '+i};Fk=t=>t<1e5?String(t):t<1e7?(t/1e3|0)+'K':(t/1e6|0)+'M'}class si extends ii{constructor(t,i,s,h){if(super(),console.log(`RS2 user client - release #${ii.mO}`),void 0!==t){ii.IO=t;const i=new URL(window.location.href);ii.EO=`${i.protocol}//${i.hostname}`,ii.gO=`${i.protocol}//${i.hostname}:${i.port}`}void 0!==i&&(ii.portOffset=i),void 0!==h&&(ii.members=h),void 0!==s&&(s?ii.YO():ii.WO()),this.run()}load=async()=>{if(this.HT&&ii.Bi&&(this.gT=30),this.XO)this.zO=!0;else{this.XO=!0;try{await this.WT(10,'Connecting to fileserver'),await wt.load(await(await fetch('bz2.wasm')).arrayBuffer()),this.db=new st(await st.openDatabase());const t=new a(new Uint8Array(await e(`${ii.gO}/crc`)));for(let i=0;i<9;i++)this.$O[i]=t.xt;ii.Bi||await this.Sk('scape_main',12345678,4e4,!1);const i=await this.vk('title','title screen',this.$O[1],10);this.ab=i,this.Lb=Z.ki(i,'p11'),this.vb=Z.ki(i,'p12'),this.Sb=Z.ki(i,'b12'),this.Rb=Z.ki(i,'q8'),await this.Gk(),this.Hk();const s=await this.vk('config','config',this.$O[2],15),h=await this.vk('interface','interface',this.$O[3],20),n=await this.vk('media','2d graphics',this.$O[4],30),r=await this.vk('models','3d graphics',this.$O[5],40),o=await this.vk('textures','textures',this.$O[6],60),l=await this.vk('wordenc','chat system',this.$O[7],65),c=await this.vk('sounds','sound effects',this.$O[8],70);this.Qg=new w(gt.Dm,gt.Nm,gt.Nm),this.Jg=new p(gt.Dm,gt.Nm+1,gt.Nm+1),this.Jg&&(this.JS=new St(this.Jg,gt.Nm,gt.Dm,gt.Nm));for(let t=0;t<gt.Dm;t++)this.BR[t]=new gt;this.bL=new U(512,512),await this.WT(75,'Unpacking media'),this.IL=T.ki(n,'invback',0),this.EL=T.ki(n,'chatback',0),this.gL=T.ki(n,'mapback',0),this._L=T.ki(n,'backbase1',0),this.CL=T.ki(n,'backbase2',0),this.TL=T.ki(n,'backhmid1',0);for(let t=0;t<13;t++)this.OL[t]=T.ki(n,'sideicons',t);this.LL=U.ki(n,'compass',0);try{for(let t=0;t<50;t++)22!==t&&(this.vL[t]=T.ki(n,'mapscene',t))}catch(t){}try{for(let t=0;t<50;t++)this.SL[t]=U.ki(n,'mapfunction',t)}catch(t){}try{for(let t=0;t<20;t++)this.RL[t]=U.ki(n,'hitmarks',t)}catch(t){}try{for(let t=0;t<20;t++)this.ML[t]=U.ki(n,'headicons',t)}catch(t){}this.kL=U.ki(n,'mapflag',0);for(let t=0;t<8;t++)this.xL[t]=U.ki(n,'cross',t);this.DL=U.ki(n,'mapdots',0),this.NL=U.ki(n,'mapdots',1),this.PL=U.ki(n,'mapdots',2),this.FL=U.ki(n,'mapdots',3),this.UL=T.ki(n,'scrollbar',0),this.BL=T.ki(n,'scrollbar',1),this.HL=T.ki(n,'redstone1',0),this.WL=T.ki(n,'redstone2',0),this.YL=T.ki(n,'redstone3',0),this.VL=T.ki(n,'redstone1',0),this.VL?.Di(),this.KL=T.ki(n,'redstone2',0),this.KL?.Di(),this.XL=T.ki(n,'redstone1',0),this.XL?.Ni(),this.zL=T.ki(n,'redstone2',0),this.zL?.Ni(),this.jL=T.ki(n,'redstone3',0),this.jL?.Ni(),this.ZL=T.ki(n,'redstone1',0),this.ZL?.Di(),this.ZL?.Ni(),this.qL=T.ki(n,'redstone2',0),this.qL?.Di(),this.qL?.Ni();const f=U.ki(n,'backleft1',0);this.iL=new z(f.width,f.height),f.Qn(0,0);const u=U.ki(n,'backleft2',0);this.sL=new z(u.width,u.height),u.Qn(0,0);const d=U.ki(n,'backright1',0);this.hL=new z(d.width,d.height),d.Qn(0,0);const y=U.ki(n,'backright2',0);this.eL=new z(y.width,y.height),y.Qn(0,0);const E=U.ki(n,'backtop1',0);this.nL=new z(E.width,E.height),E.Qn(0,0);const g=U.ki(n,'backtop2',0);this.rL=new z(g.width,g.height),g.Qn(0,0);const _=U.ki(n,'backvmid1',0);this.oL=new z(_.width,_.height),_.Qn(0,0);const C=U.ki(n,'backvmid2',0);this.lL=new z(C.width,C.height),C.Qn(0,0);const b=U.ki(n,'backvmid3',0);this.aL=new z(b.width,b.height),b.Qn(0,0);const L=U.ki(n,'backhmid2',0);this.cL=new z(L.width,L.height),L.Qn(0,0);const S=(21*Math.random()|0)-10,R=(21*Math.random()|0)-10,M=(21*Math.random()|0)-10,x=(41*Math.random()|0)-20;for(let t=0;t<50;t++)this.SL[t]&&this.SL[t]?.translate(S+x,R+x,M+x),this.vL[t]&&this.vL[t]?.translate(S+x,R+x,M+x);await this.WT(80,'Unpacking textures'),O.cs(o),O.ds(.8),O.ys(20),await this.WT(83,'Unpacking models'),v.Jt(r),A.Jt(r),m.Jt(r),await this.WT(86,'Unpacking config'),I.Jt(s),k.Jt(s),Rt.Jt(s),G.Jt(s,ii.members),H.Jt(s),W.Jt(s),Y.Jt(s),V.Jt(s),ii.Bi||(await this.WT(90,'Unpacking sounds'),at.Jt(c)),await this.WT(92,'Unpacking interfaces'),X.Jt(h,n,[this.Lb,this.vb,this.Sb,this.Rb]),await this.WT(97,'Preparing game engine');for(let t=0;t<33;t++){let i=999,s=0;for(let h=0;h<35;h++)if(0===this.gL.di[h+t*this.gL.width])999===i&&(i=h);else if(999!==i){s=h;break}this.wL[t]=i,this.yL[t]=s-i}for(let t=9;t<160;t++){let i=999,s=0;for(let h=10;h<168;h++)if(0===this.gL.di[h+t*this.gL.width]&&(h>34||t>34))999===i&&(i=h);else if(999!==i){s=h;break}this.pL[t-9]=i-21,this.mL[t-9]=s-i}O.os(479,96),this.fL=O.Vi,O.os(190,261),this.uL=O.Vi,O.os(512,334),this.dL=O.Vi;const D=new Int32Array(9);for(let t=0;t<9;t++){const i=32*t+128+15,s=3*i+600,h=O.sin[i];D[t]=s*h>>16}St.init(512,334,500,800,D),nt.Jt(l),this.Wk()}catch(t){console.error(t),this.jO=!0}}};update=async()=>{this.zO||this.jO||this.ZO||(this.qO++,this._T?await this.Yk():await this.Vk())};draw=async()=>{this.zO||this.jO||this.ZO?this.Rk():(this._T?this.Kk():await this.Xk(),this.nv=0)};refresh=()=>{this.cb=!0};WT=async(t,s)=>{if(console.log(`${t}%: ${s}`),await this.zk(),!this.ab)return void await super.WT(t,s);this.pb?.bind();this.Sb?.mf(180,54,'RuneScape is loading - please wait...',B.lr);C.gi(28,62,304,34,B.Er),C.gi(29,63,302,32,B.ar),C.fillRect(30,64,3*t,30,B.Er),C.fillRect(30+3*t,64,300-3*t,30,B.ar),this.Sb?.mf(180,85,s,B.lr),this.pb?.draw(214,186),this.cb&&(this.cb=!1,this.kb||(this.Ab?.draw(0,0),this.mb?.draw(661,0)),this.wb?.draw(128,0),this.yb?.draw(214,386),this.Ib?.draw(0,265),this.Eb?.draw(574,265),this.gb?.draw(128,186),this._b?.draw(574,186)),await i(5)};jk=()=>{this.kb&&(this.Zk(),this.Zk(),this.qk())};zk=async()=>{this.wb||(this.uT=null,this.$b=null,this.Zb=null,this.jb=null,this.qb=null,this.Jb=null,this.Qb=null,this.tL=null,this.Ab=new z(128,265),C.clear(),this.mb=new z(128,265),C.clear(),this.wb=new z(533,186),C.clear(),this.yb=new z(360,146),C.clear(),this.pb=new z(360,200),C.clear(),this.Ib=new z(214,267),C.clear(),this.Eb=new z(215,267),C.clear(),this.gb=new z(86,79),C.clear(),this._b=new z(87,79),C.clear(),this.ab&&(await this.Gk(),this.Hk()),this.cb=!0)};Gk=async()=>{if(!this.ab)return;const t=await U.Zn(this.ab,'title');this.Ab?.bind(),t.Qn(0,0),this.mb?.bind(),t.Qn(-661,0),this.wb?.bind(),t.Qn(-128,0),this.yb?.bind(),t.Qn(-214,-386),this.pb?.bind(),t.Qn(-214,-186),this.Ib?.bind(),t.Qn(0,-265),this.Eb?.bind(),t.Qn(-128,-186),this.gb?.bind(),t.Qn(-128,-186),this._b?.bind(),t.Qn(-574,-186),t.Di(),this.Ab?.bind(),t.Qn(394,0),this.mb?.bind(),t.Qn(-267,0),this.wb?.bind(),t.Qn(266,0),this.yb?.bind(),t.Qn(180,-386),this.pb?.bind(),t.Qn(180,-186),this.Ib?.bind(),t.Qn(394,-265),this.Eb?.bind(),t.Qn(-180,-265),this.gb?.bind(),t.Qn(212,-186),this._b?.bind(),t.Qn(-180,-186);const i=U.ki(this.ab,'logo');this.wb?.bind(),i.draw((this.width/2|0)-(i.width/2|0)-128,18)};$k=t=>{if(!this.Pb||!this.Nb)return;this.Pb.fill(0);for(let t=0;t<5e3;t++){const t=128*Math.random()*256|0;this.Pb[t]=256*Math.random()|0}for(let t=0;t<20;t++){for(let t=1;t<255;t++)for(let i=1;i<127;i++){const s=i+(t<<7);this.Nb[s]=(this.Pb[s-1]+this.Pb[s+1]+this.Pb[s-128]+this.Pb[s+128])/4|0}const t=this.Pb;this.Pb=this.Nb,this.Nb=t}if(t){let i=0;for(let s=0;s<t.height;s++)for(let h=0;h<t.width;h++)if(0!==t.di[i++]){const i=h+t.vi+16+(s+t.Si+16<<7);this.Pb[i]=0}}};Hk=()=>{if(this.ab){this.Cb=T.ki(this.ab,'titlebox'),this.Tb=T.ki(this.ab,'titlebutton');for(let t=0;t<12;t++)this.Mb[t]=T.ki(this.ab,'runes',t);this.xb=new U(128,265),this.Db=new U(128,265),this.Ab&&n(this.Ab.di,0,this.xb.di,0,33920),this.mb&&n(this.mb.di,0,this.Db.di,0,33920),this.Gb=new Int32Array(256);for(let t=0;t<64;t++)this.Gb[t]=262144*t;for(let t=0;t<64;t++)this.Gb[t+64]=1024*t+B.RED;for(let t=0;t<64;t++)this.Gb[t+128]=4*t+B.er;for(let t=0;t<64;t++)this.Gb[t+192]=B.lr;this.Hb=new Int32Array(256);for(let t=0;t<64;t++)this.Hb[t]=1024*t;for(let t=0;t<64;t++)this.Hb[t+64]=4*t+B.GREEN;for(let t=0;t<64;t++)this.Hb[t+128]=262144*t+B.nr;for(let t=0;t<64;t++)this.Hb[t+192]=B.lr;this.Wb=new Int32Array(256);for(let t=0;t<64;t++)this.Wb[t]=4*t;for(let t=0;t<64;t++)this.Wb[t+64]=262144*t+B.BLUE;for(let t=0;t<64;t++)this.Wb[t+128]=1024*t+B.rr;for(let t=0;t<64;t++)this.Wb[t+192]=B.lr;this.Bb=new Int32Array(256),this.Pb=new Int32Array(32768),this.Nb=new Int32Array(32768),this.$k(null),this.Fb=new Int32Array(32768),this.Ub=new Int32Array(32768),this.WT(10,'Connecting to fileserver').then((()=>{this.kb||(this.kb=!0,this.zb=setInterval(this.jk,35))}))}};Vk=async()=>{if(0===this.fb){let t=(this.width/2|0)-80,i=20+(this.height/2|0);i+=20,1===this.OT&&this.bT>=t-75&&this.bT<=t+75&&this.LT>=i-20&&this.LT<=i+20&&(this.fb=3,this.ub=0),t=80+(this.width/2|0),1===this.OT&&this.bT>=t-75&&this.bT<=t+75&&this.LT>=i-20&&this.LT<=i+20&&(this.Ob='',this.bb='Enter your username & password.',this.fb=2,this.ub=0)}else if(2===this.fb){let t=(this.height/2|0)-40;t+=30,t+=25,1===this.OT&&this.LT>=t-15&&this.LT<t&&(this.ub=0),t+=15,1===this.OT&&this.LT>=t-15&&this.LT<t&&(this.ub=1);let i=(this.width/2|0)-80,s=50+(this.height/2|0);for(s+=20,1===this.OT&&this.bT>=i-75&&this.bT<=i+75&&this.LT>=s-20&&this.LT<=s+20&&await this.Jk(this.username,this.password,!1),i=80+(this.width/2|0),1===this.OT&&this.bT>=i-75&&this.bT<=i+75&&this.LT>=s-20&&this.LT<=s+20&&(this.fb=0,this.username='',this.password='');;){const t=this.XT();if(-1===t)return;let i=!1;for(let s=0;s<Z.sf.length;s++)if(String.fromCharCode(t)===Z.sf.charAt(s)){i=!0;break}0===this.ub?(8===t&&this.username.length>0&&(this.username=this.username.substring(0,this.username.length-1)),9!==t&&10!==t&&13!==t||(this.ub=1),i&&(this.username=this.username+String.fromCharCode(t)),this.username.length>12&&(this.username=this.username.substring(0,12))):1===this.ub&&(8===t&&this.password.length>0&&(this.password=this.password.substring(0,this.password.length-1)),9!==t&&10!==t&&13!==t||(this.ub=0),i&&(this.password=this.password+String.fromCharCode(t)),this.password.length>20&&(this.password=this.password.substring(0,20)))}}else if(3===this.fb){const t=this.width/2|0;let i=50+(this.height/2|0);i+=20,1===this.OT&&this.bT>=t-75&&this.bT<=t+75&&this.LT>=i-20&&this.LT<=i+20&&(this.fb=0)}};Xk=async()=>{await this.zk(),this.pb?.bind(),this.Cb?.draw(0,0);if(0===this.fb){let t=180,i=80;this.Sb?.Af(t,i,'Welcome to RuneScape',B.er,!0),t=100,i=120,this.Tb?.draw(t-73,i-20),this.Sb?.Af(t,i+5,'New user',B.lr,!0),t=260,this.Tb?.draw(t-73,i-20),this.Sb?.Af(t,i+5,'Existing User',B.lr,!0)}else if(2===this.fb){let t=100,i=60;this.Ob.length>0?(this.Sb?.Af(180,i-15,this.Ob,B.er,!0),this.Sb?.Af(180,i,this.bb,B.er,!0),i+=30):(this.Sb?.Af(180,i-7,this.bb,B.er,!0),i+=30),this.Sb?.wf(90,i,`Username: ${this.username}${0===this.ub&&this.qO%40<20?'@yel@|':''}`,B.lr,!0),i+=15,this.Sb?.wf(92,i,`Password: ${K.Gl(this.password)}${1===this.ub&&this.qO%40<20?'@yel@|':''}`,B.lr,!0),i=150,this.Tb?.draw(t-73,i-20),this.Sb?.Af(t,i+5,'Login',B.lr,!0),t=260,this.Tb?.draw(t-73,i-20),this.Sb?.Af(t,i+5,'Cancel',B.lr,!0)}else if(3===this.fb){this.Sb?.Af(180,40,'Create a free account',B.er,!0);const t=180;let i=65;this.Sb?.Af(180,i,'To create a new account you need to',B.lr,!0),i+=15,this.Sb?.Af(180,i,'go back to the main RuneScape webpage',B.lr,!0),i+=15,this.Sb?.Af(180,i,"and choose the red 'create account'",B.lr,!0),i+=15,this.Sb?.Af(180,i,'button at the top right of that page.',B.lr,!0),i=150,this.Tb?.draw(t-73,i-20),this.Sb?.Af(t,i+5,'Cancel',B.lr,!0)}this.pb?.draw(214,186),this.cb&&(this.cb=!1,this.wb?.draw(128,0),this.yb?.draw(214,386),this.Ib?.draw(0,265),this.Eb?.draw(574,265),this.gb?.draw(128,186),this._b?.draw(574,186))};Jk=async(t,s,h)=>{try{h||(this.Ob='',this.bb='Connecting to server...',await this.Xk()),this.stream=new q(await q.Sf({host:ii.EO,port:43594+ii.portOffset})),await this.stream.kf(this.in.data,0,8),this.in.bt=0,this.tb=this.in.Dt;const e=new Int32Array([Math.floor(99999999*Math.random()),Math.floor(99999999*Math.random()),Number(this.tb>>32n),Number(this.tb&BigInt(4294967295))]);this.JO.bt=0,this.JO.p1(10),this.JO.p4(e[0]),this.JO.p4(e[1]),this.JO.p4(e[2]),this.JO.p4(e[3]),this.JO.p4(0),this.JO.Vt(t),this.JO.Vt(s),this.JO.qt(ii.bO,ii.exponent),this.QO.bt=0,h?this.QO.p1(18):this.QO.p1(16),this.QO.p1(this.JO.bt+36+1+1),this.QO.p1(ii.mO),this.QO.p1(ii.Bi?1:0);for(let t=0;t<9;t++)this.QO.p4(this.$O[t]);this.QO.Kt(this.JO.data,this.JO.bt,0),this.JO.random=new it(e);for(let t=0;t<4;t++)e[t]+=50;this.eb=new it(e),this.stream?.write(this.QO.data,this.QO.bt);const n=await this.stream.read();if(1===n)return await i(2e3),void await this.Jk(t,s,h);if(2===n||18===n){this.PM=18===n,yt.oA(),this._T=!0,this.JO.bt=0,this.in.bt=0,this.nb=-1,this.rb=-1,this.ob=-1,this.lb=-1,this.packetSize=0,this.ib=0,this.hb=0,this.sb=0,this.bv=0,this.Av=0,this.fv=!1,this.CT=Date.now();for(let t=0;t<100;t++)this.tS[t]=null;this.AS=0,this.SS=0,this.QS=0,this.sk=0,this.rR=(100*Math.random()|0)-50,this.oR=(110*Math.random()|0)-55,this.lR=(80*Math.random()|0)-40,this.TR=(120*Math.random()|0)-60,this.OR=(30*Math.random()|0)-20,this.YR=(20*Math.random()|0)-10&2047,this.vR=-1,this.sR=0,this.hR=0,this.lM=0,this.pM=0;for(let t=0;t<this.VO;t++)this.oM[t]=null,this.wM[t]=null;for(let t=0;t<8192;t++)this.yM[t]=null;this.vM=this.oM[this.KO]=new Ft,this.mM.clear(),this.IM.clear(),this.ME.clear();for(let t=0;t<gt.Dm;t++)for(let i=0;i<gt.Nm;i++)for(let s=0;s<gt.Nm;s++)this.gM[t][i][s]=null;this._M=new o,this.HM=0,this.Qv=-1,this.Ev=-1,this.ev=-1,this.Iv=-1,this.bS=!1,this.Gv=3,this.Jv=!1,this.fv=!1,this.zv=!1,this.Uv=null,this.RM=0,this.Bv=-1,this.FM=!0,this.Qk();for(let t=0;t<5;t++)this.GM[t]=0;return zt(!0),ii.xO=0,ii.DO=0,ii.NO=0,ii.PO=0,ii.FO=0,ii.UO=0,ii.BO=0,ii.GO=0,ii.HO=0,void this.tx()}if(3===n)return this.Ob='',void(this.bb='Invalid username or password.');if(4===n)return this.Ob='Your account has been disabled.',void(this.bb='Please check your message-centre for details.');if(5===n)return this.Ob='Your account is already logged in.',void(this.bb='Try again in 60 secs...');if(6===n)return this.Ob='RuneScape has been updated!',void(this.bb='Please reload this page.');if(7===n)return this.Ob='This world is full.',void(this.bb='Please use a different world.');if(8===n)return this.Ob='Unable to connect.',void(this.bb='Login server offline.');if(9===n)return this.Ob='Login limit exceeded.',void(this.bb='Too many connections from your address.');if(10===n)return this.Ob='Unable to connect.',void(this.bb='Bad session id.');if(11===n)return this.bb='Login server rejected session.',void(this.bb='Please try again.');if(12===n)return this.Ob='You need a members account to login to this world.',void(this.bb='Please subscribe, or use a different world.');if(13===n)return this.Ob='Could not complete login.',void(this.bb='Please try using a different world.');if(14===n)return this.Ob='The server is being updated.',void(this.bb='Please wait 1 minute and try again.');if(15===n)return this._T=!0,this.JO.bt=0,this.in.bt=0,this.nb=-1,this.rb=-1,this.ob=-1,this.lb=-1,this.packetSize=0,this.ib=0,this.hb=0,this.Av=0,void(this.fv=!1);if(16===n)return this.Ob='Login attempts exceeded.',void(this.bb='Please wait 1 minute and try again.');17===n&&(this.Ob='You are standing in a members-only area.',this.bb='To play on this world move to a free area first')}catch(t){console.log(t),this.Ob='',this.bb='Error connecting to server.'}};Yk=async()=>{if(null!==this.oM){this.hb>1&&this.hb--,this.sb>0&&this.sb--;for(let t=0;t<5&&await this.read();t++);if(this._T){for(let t=0;t<this.sk;t++)if(this.rk[t]<=0){try{const i=at.up(this.ek[t],this.nk[t]);if(!i)throw new Error;Date.now()+(i.bt/22|0)>this.uk+(this.fk/22|0)&&(this.fk=i.bt,this.uk=Date.now(),this.ak=this.ek[t],this.ck=this.nk[t],await Yt(i.data.slice(0,i.bt),this.lk))}catch(t){console.error(t)}this.sk--;for(let i=t;i<this.sk;i++)this.ek[i]=this.ek[i+1],this.nk[i]=this.nk[i+1],this.rk[i]=this.rk[i+1];t--}else this.rk[t]--;this.dk>0&&(this.dk-=20,this.dk<0&&(this.dk=0),0===this.dk&&this.wk&&!ii.Bi&&this.yk&&await this.Sk(this.yk,this.pk,this.Ak,!1));const t=yt.flush();if(t&&(this.JO.Bt(et.pd),this.JO.p2(t.bt),this.JO.Kt(t.data,t.bt,0),t.release()),this.ib++,this.ib>750&&await this.ix(),this.sx(),this.hx(),this.nx(),this.ox(),(1===this.vT[1]||1===this.vT[2]||1===this.vT[3]||1===this.vT[4])&&this.HR++>5&&(this.HR=0,this.JO.Bt(et.Ad),this.JO.p2(this.WR),this.JO.p2(this.YR),this.JO.p1(this.TR),this.JO.p1(this.OR)),this.tR++,0!==this.rv&&(this.ov+=20,this.ov>=400&&(this.rv=0)),0!==this._S&&(this.OS++,this.OS>=15&&(2===this._S&&(this.tv=!0),3===this._S&&(this.iv=!0),this._S=0)),0!==this.uS&&(this.yS++,(this.gh>this.dS+5||this.gh<this.dS-5||this._h>this.wS+5||this._h<this.wS-5)&&(this.pS=!0),0===this.TT)){if(2===this.uS&&(this.tv=!0),3===this.uS&&(this.iv=!0),this.uS=0,this.pS&&this.yS>=5){if(this.BS=-1,this.lx(),this.BS===this.cS&&this.GS!==this.fS){const t=X.$t[this.cS];if(t.gc){const i=t.gc[this.GS];t.gc[this.GS]=t.gc[this.fS],t.gc[this.fS]=i}if(t._c){const i=t._c[this.GS];t._c[this.GS]=t._c[this.fS],t._c[this.fS]=i}this.JO.Bt(et.bw),this.JO.p2(this.cS),this.JO.p2(this.fS),this.JO.p2(this.GS)}}else(1===this.xS||this.ux(this.Av-1))&&this.Av>2?this.wx():this.Av>0&&await this.yx(this.Av-1);this.OS=10,this.OT=0}if(ii.SO++,ii.SO>127&&(ii.SO=0,this.JO.Bt(et.Sd),this.JO.p3(4991788)),-1!==St.TE&&this.vM){const t=St.TE,i=St.OE,s=this.Ax(this.vM.fC[0],this.vM.uC[0],t,i,0,0,0,0,0,0,!0);St.TE=-1,s&&(this.lv=this.bT,this.av=this.LT,this.rv=1,this.ov=0)}1===this.OT&&this.Uv&&(this.Uv=null,this.iv=!0,this.OT=0),await this.mx(),this.Ix(),this.Ex(),this.gx(),1!==this.TT&&1!==this.OT||this.nv++,2===this.QS&&(ii.TO?this._x():this.Cx()),2===this.QS&&this.eR&&this.Tx();for(let t=0;t<5;t++)this.uR[t]++;if(await this.Ox(),Date.now()-this.CT>9e4&&(this.sb=250,this.CT=Date.now()-1e4,this.JO.Bt(et.yd)),this.nR++,this.nR>500){this.nR=0;const t=8*Math.random()|0;1&~t||(this.rR+=this.aR),2&~t||(this.oR+=this.cR),4&~t||(this.lR+=this.fR)}if(this.rR<-50&&(this.aR=2),this.rR>50&&(this.aR=-2),this.oR<-55&&(this.cR=2),this.oR>55&&(this.cR=-2),this.lR<-40&&(this.fR=1),this.lR>40&&(this.fR=-1),this.CR++,this.CR>500){this.CR=0;const t=8*Math.random()|0;1&~t||(this.TR+=this.LR),2&~t||(this.OR+=this.bR)}this.TR<-60&&(this.LR=2),this.TR>60&&(this.LR=-2),this.OR<-20&&(this.bR=1),this.OR>10&&(this.bR=-1),ii.RO++,ii.RO>110&&(ii.RO=0,this.JO.Bt(et.Rd),this.JO.p4(0)),this.xM++,this.xM>50&&this.JO.Bt(et.wd);try{this.stream&&this.JO.bt>0&&(this.stream.write(this.JO.data,this.JO.bt),this.JO.bt=0,this.xM=0)}catch(t){console.log(t),await this.ix()}}}};Kk=()=>{if(null===this.oM)return;this.cb&&(this.cb=!1,this.iL?.draw(0,11),this.sL?.draw(0,375),this.hL?.draw(729,5),this.eL?.draw(752,231),this.nL?.draw(0,0),this.rL?.draw(561,0),this.oL?.draw(520,11),this.lL?.draw(520,231),this.aL?.draw(501,375),this.cL?.draw(0,345),this.tv=!0,this.iv=!0,this.sv=!0,this.hv=!0,2!==this.QS&&(this.qb?.draw(8,11),this.Zb?.draw(561,5))),2===this.QS&&this.bx(),this.fv&&1===this.uv&&(this.tv=!0);let t=!1;if(-1!==this.Iv&&(t=this.Dk(this.Iv,this.tR),t&&(this.tv=!0)),2===this._S&&(this.tv=!0),2===this.uS&&(this.tv=!0),this.tv&&(this.Lx(),this.tv=!1),-1===this.Ev){this.gv.zc=this._v-this.Cv-77,this.gh>453&&this.gh<565&&this._h>350&&this.vx(this.gh-22,this._h-375,this._v,77,!1,463,0,this.gv);let t=this._v-this.gv.zc-77;t<0&&(t=0),t>this._v-77&&(t=this._v-77),this.Cv!==t&&(this.Cv=t,this.iv=!0)}-1!==this.Ev&&(t=this.Dk(this.Ev,this.tR),t&&(this.iv=!0)),3===this._S&&(this.iv=!0),3===this.uS&&(this.iv=!0),this.Uv&&(this.iv=!0),this.fv&&2===this.uv&&(this.iv=!0),this.iv&&(this.Sx(),this.iv=!1),2===this.QS&&(this.Rx(),this.Zb?.draw(561,5)),-1!==this.Bv&&(this.sv=!0),this.sv&&(-1!==this.Bv&&this.Bv===this.Gv&&(this.Bv=-1,this.JO.Bt(et._w),this.JO.p1(this.Gv)),this.sv=!1,this.tL?.bind(),this.TL?.draw(0,0),-1===this.Iv&&(-1!==this.Hv[this.Gv]&&(0===this.Gv?this.HL?.draw(29,30):1===this.Gv?this.WL?.draw(59,29):2===this.Gv?this.WL?.draw(87,29):3===this.Gv?this.YL?.draw(115,29):4===this.Gv?this.KL?.draw(156,29):5===this.Gv?this.KL?.draw(184,29):6===this.Gv&&this.VL?.draw(212,30)),-1!==this.Hv[0]&&(0!==this.Bv||this.qO%20<10)&&this.OL[0]?.draw(35,34),-1!==this.Hv[1]&&(1!==this.Bv||this.qO%20<10)&&this.OL[1]?.draw(59,32),-1!==this.Hv[2]&&(2!==this.Bv||this.qO%20<10)&&this.OL[2]?.draw(86,32),-1!==this.Hv[3]&&(3!==this.Bv||this.qO%20<10)&&this.OL[3]?.draw(121,33),-1!==this.Hv[4]&&(4!==this.Bv||this.qO%20<10)&&this.OL[4]?.draw(157,34),-1!==this.Hv[5]&&(5!==this.Bv||this.qO%20<10)&&this.OL[5]?.draw(185,32),-1!==this.Hv[6]&&(6!==this.Bv||this.qO%20<10)&&this.OL[6]?.draw(212,34)),this.tL?.draw(520,165),this.Qb?.bind(),this.CL?.draw(0,0),-1===this.Iv&&(-1!==this.Hv[this.Gv]&&(7===this.Gv?this.XL?.draw(49,0):8===this.Gv?this.zL?.draw(81,0):9===this.Gv?this.zL?.draw(108,0):10===this.Gv?this.jL?.draw(136,1):11===this.Gv?this.qL?.draw(178,0):12===this.Gv?this.qL?.draw(205,0):13===this.Gv&&this.ZL?.draw(233,0)),-1!==this.Hv[8]&&(8!==this.Bv||this.qO%20<10)&&this.OL[7]?.draw(80,2),-1!==this.Hv[9]&&(9!==this.Bv||this.qO%20<10)&&this.OL[8]?.draw(107,3),-1!==this.Hv[10]&&(10!==this.Bv||this.qO%20<10)&&this.OL[9]?.draw(142,4),-1!==this.Hv[11]&&(11!==this.Bv||this.qO%20<10)&&this.OL[10]?.draw(179,2),-1!==this.Hv[12]&&(12!==this.Bv||this.qO%20<10)&&this.OL[11]?.draw(206,2),-1!==this.Hv[13]&&(13!==this.Bv||this.qO%20<10)&&this.OL[12]?.draw(230,2)),this.Qb?.draw(501,492),this.qb?.bind()),this.hv&&(this.hv=!1,this.Jb?.bind(),this._L?.draw(0,0),this.vb?.Af(57,33,'Public chat',B.lr,!0),0===this.Wv&&this.vb?.Af(57,46,'On',B.GREEN,!0),1===this.Wv&&this.vb?.Af(57,46,'Friends',B.er,!0),2===this.Wv&&this.vb?.Af(57,46,'Off',B.RED,!0),3===this.Wv&&this.vb?.Af(57,46,'Hide',B.nr,!0),this.vb?.Af(186,33,'Private chat',B.lr,!0),0===this.Yv&&this.vb?.Af(186,46,'On',B.GREEN,!0),1===this.Yv&&this.vb?.Af(186,46,'Friends',B.er,!0),2===this.Yv&&this.vb?.Af(186,46,'Off',B.RED,!0),this.vb?.Af(326,33,'Trade/duel',B.lr,!0),0===this.Vv&&this.vb?.Af(326,46,'On',B.GREEN,!0),1===this.Vv&&this.vb?.Af(326,46,'Friends',B.er,!0),2===this.Vv&&this.vb?.Af(326,46,'Off',B.RED,!0),this.vb?.Af(462,38,'Report abuse',B.lr,!0),this.Jb?.draw(0,471),this.qb?.bind()),this.tR=0};bx=()=>{if(this.iR++,this.Mx(),this.kx(),this.xx(),this.Dx(),this.Nx(),!this.eR){let t=this.WR;(this._R/256|0)>t&&(t=this._R/256|0),this.dR[4]&&this.yR[4]+128>t&&(t=this.yR[4]+128);const i=this.YR+this.lR&2047;if(this.vM&&this.Px(this.XR,this.Fx(this.GR,this.vM.x,this.vM.z)-50,this.zR,i,t,3*t+600),ii.vO++,ii.vO>1802){ii.vO=0,this.JO.Bt(et.vd),this.JO.p1(0);const t=this.JO.bt;this.JO.p2(29711),this.JO.p1(70),this.JO.p1(256*Math.random()|0),this.JO.p1(242),this.JO.p1(186),this.JO.p1(39),this.JO.p1(61),2*Math.random()|0||this.JO.p1(13),2*Math.random()|0||this.JO.p2(57856),this.JO.p2(65536*Math.random()|0),this.JO.Xt(this.JO.bt-t)}}let t;t=this.eR?this.Ux():this.Bx();const i=this.AR,s=this.mR,h=this.IR,e=this.ER,n=this.gR;let r;for(let t=0;t<5;t++)this.dR[t]&&(r=Math.random()*(2*this.wR[t]+1)-this.wR[t]+Math.sin(this.uR[t]*(this.pR[t]/100))*this.yR[t]|0,0===t&&(this.AR+=r),1===t&&(this.mR+=r),2===t&&(this.IR+=r),3===t&&(this.gR=this.gR+r&2047),4===t&&(this.ER+=r,this.ER<128&&(this.ER=128),this.ER>383&&(this.ER=383)));r=O.Ji,v.Eh=!0,v.Ch=0,v.gh=this.gh-8,v._h=this._h-11,C.clear(),this.JS?.draw(this.AR,this.mR,this.IR,t,this.gR,this.ER,this.qO),this.JS?.eg(),this.Gx(),this.Hx(),ii._O&&this.Wx(),this.Yx(r),this.Vx(),this.qb?.draw(8,11),this.AR=i,this.mR=s,this.IR=h,this.ER=e,this.gR=n};Kx=()=>{k.An?.clear(),k.mn?.clear(),H.Fo?.clear(),G.Fo?.clear(),G.Uo?.clear(),Ft.Fo?.clear(),Y.Fo?.clear()};Xx=(t,i)=>{this.zx(t.x,i,t.z)};zx=(t,i,s)=>{if(t<128||s<128||t>13056||s>13056)return this.ZR=-1,void(this.qR=-1);const h=this.Fx(this.GR,t,s)-i;this.jx(t,h,s)};jx=(t,i,s)=>{let h=t-this.AR,e=i-this.mR,n=s-this.IR;const r=O.sin[this.ER],o=O.cos[this.ER],l=O.sin[this.gR],a=O.cos[this.gR];let c=n*l+h*a>>16;n=n*a-h*l>>16,h=c,c=e*o-n*r>>16,n=e*r+n*o>>16,e=c,n>=50?(this.ZR=O.Ki+((h<<9)/n|0),this.qR=O.Xi+((e<<9)/n|0)):(this.ZR=-1,this.qR=-1)};Gx=()=>{this.WM=0;for(let t=-1;t<this.lM+this.pM;t++){let i=null;if(i=-1===t?this.vM:t<this.lM?this.oM[this.aM[t]]:this.yM[this.AM[t-this.lM]],i&&i.isVisible()){if(t<this.lM){let s=30;const h=i;if(0!==h.kC&&(this.Xx(i,i.height+15),this.ZR>-1))for(let t=0;t<8;t++)h.kC&1<<t&&(this.ML[t]?.draw(this.ZR-12,this.qR-s),s-=25);t>=0&&10===this.bv&&this.Rv===this.aM[t]&&(this.Xx(i,i.height+15),this.ZR>-1&&this.ML[7]?.draw(this.ZR-12,this.qR-s))}else 1===this.bv&&this.Lv===this.AM[t-this.lM]&&this.qO%20<10&&(this.Xx(i,i.height+15),this.ZR>-1&&this.ML[2]?.draw(this.ZR-12,this.qR-28));if(i.M_&&(t>=this.lM||0===this.Wv||3===this.Wv||1===this.Wv&&this.Zx(i.name))&&(this.Xx(i,i.height),this.ZR>-1&&this.WM<ii.YM&&this.Sb&&(this.zM[this.WM]=this.Sb.pf(i.M_)/2|0,this.XM[this.WM]=this.Sb.height,this.VM[this.WM]=this.ZR,this.KM[this.WM]=this.qR,this.jM[this.WM]=i.x_,this.ZM[this.WM]=i.D_,this.qM[this.WM]=i.k_,this.$M[this.WM++]=i.M_,0===this.nS&&1===i.D_&&(this.XM[this.WM]+=10,this.KM[this.WM]+=5),0===this.nS&&2===i.D_&&(this.zM[this.WM]=60))),i.F_>this.qO+100&&(this.Xx(i,i.height+15),this.ZR>-1)){let t=30*i.U_/i.B_|0;t>30&&(t=30),C.fillRect(this.ZR-15,this.qR-3,t,5,B.GREEN),C.fillRect(this.ZR-15+t,this.qR-3,30-t,5,B.RED)}if(i.F_>this.qO+330&&(this.Xx(i,i.height/2|0),this.ZR>-1&&(this.RL[i.P_]?.draw(this.ZR-12,this.qR-12),this.Lb?.mf(this.ZR,this.qR+4,i.N_.toString(),B.ar),this.Lb?.mf(this.ZR-1,this.qR+3,i.N_.toString(),B.lr))),ii._O){if(i.pathLength>0||i.oC>=this.qO||i.lC>this.qO){const t=64*i.size;this.qx(128*i.fC[0]+t,128*i.uC[0]+t,this.GR,i.size,65535,!1)}this.qx(i.x,i.z,this.GR,i.size,6710886,!1);let s=0;if(this.Xx(i,i.height+30),t<this.lM){const t=i;if(this.Lb?.mf(this.ZR,this.qR+s,t.name,B.lr),s-=15,-1!==t.yC&&this.qO-t.pC<30){if((t.yC&Ft.IC)===Ft.IC&&(this.Lb?.mf(this.ZR,this.qR+s,'Appearance Update',B.lr),s-=15),(t.yC&Ft.EC)===Ft.EC&&(this.Lb?.mf(this.ZR,this.qR+s,'Play Seq: '+t.X_,B.lr),s-=15),(t.yC&Ft.gC)===Ft.gC){let i=t.G_;i>32767&&(i-=32768),this.Lb?.mf(this.ZR,this.qR+s,'Face Entity: '+i,B.lr),s-=15}(t.yC&Ft._C)===Ft._C&&(this.Lb?.mf(this.ZR,this.qR+s,'Say',B.lr),s-=15),(t.yC&Ft.CC)===Ft.CC&&(this.Lb?.mf(this.ZR,this.qR+s,'Hit: Type '+t.P_+' Amount '+t.N_+' HP '+t.U_+'/'+t.B_,B.lr),s-=15),(t.yC&Ft.TC)===Ft.TC&&(this.Lb?.mf(this.ZR,this.qR+s,'Face Coord: '+t.AC/2+' '+t.mC/2,B.lr),s-=15),(t.yC&Ft.OC)===Ft.OC&&(this.Lb?.mf(this.ZR,this.qR+s,'Chat',B.lr),s-=15),(t.yC&Ft.LC)===Ft.LC&&(this.Lb?.mf(this.ZR,this.qR+s,'Play Spotanim: '+t.J_,B.lr),s-=15),(t.yC&Ft.vC)===Ft.vC&&(this.Lb?.mf(this.ZR,this.qR+s,'Exact Move',B.lr),s-=15)}}else{const t=i;let s=0;if(this.Xx(i,i.height+30),this.Lb?.mf(this.ZR,this.qR+s,t.type?.name??null,B.lr),s-=15,-1!==t.yC&&this.qO-t.pC<30){if((t.yC&Ut.EC)===Ut.EC&&(this.Lb?.mf(this.ZR,this.qR+s,'Play Seq: '+t.X_,B.lr),s-=15),(t.yC&Ut.gC)===Ut.gC){let i=t.G_;i>32767&&(i-=32768),this.Lb?.mf(this.ZR,this.qR+s,'Face Entity: '+i,B.lr),s-=15}(t.yC&Ut._C)===Ut._C&&(this.Lb?.mf(this.ZR,this.qR+s,'Say',B.lr),s-=15),(t.yC&Ut.CC)===Ut.CC&&(this.Lb?.mf(this.ZR,this.qR+s,'Hit: Type '+t.P_+' Amount '+t.N_+' HP '+t.U_+'/'+t.B_,B.lr),s-=15),(t.yC&Ut.YC)===Ut.YC&&(this.Lb?.mf(this.ZR,this.qR+s,'Change Type: '+t.type?.id??null,B.lr),s-=15),(t.yC&Ut.LC)===Ut.LC&&(this.Lb?.mf(this.ZR,this.qR+s,'Play Spotanim: '+t.J_,B.lr),s-=15),(t.yC&Ut.TC)===Ut.TC&&(this.Lb?.mf(this.ZR,this.qR+s,'Face Coord: '+t.AC/2+' '+t.mC/2,B.lr),s-=15)}}}}}if(ii._O)for(let t=0;t<this.gk.length;t++){const i=this.gk[t];!i||i.level!==this.GR||i.x<0||i.z<0||i.x>=104||i.z>=104||this.qx(128*i.x+64,128*i.z+64,i.level,1,16776960,!1)}for(let t=0;t<this.WM;t++){const i=this.VM[t];let s=this.KM[t];const h=this.zM[t],e=this.XM[t];let n=!0;for(;n;){n=!1;for(let r=0;r<t;r++)s+2>this.KM[r]-this.XM[r]&&s-e<this.KM[r]+2&&i-h<this.VM[r]+this.zM[r]&&i+h>this.VM[r]-this.zM[r]&&this.KM[r]-this.XM[r]<s&&(s=this.KM[r]-this.XM[r],n=!0)}this.ZR=this.VM[t],this.qR=this.KM[t]=s;const r=this.$M[t];if(0===this.nS){let i=B.er;if(this.jM[t]<6&&(i=B.vr[this.jM[t]]),6===this.jM[t]&&(i=this.iR%20<10?B.RED:B.er),7===this.jM[t]&&(i=this.iR%20<10?B.BLUE:B.nr),8===this.jM[t]&&(i=this.iR%20<10?45056:8454016),9===this.jM[t]){const s=150-this.qM[t];s<50?i=1280*s+B.RED:s<100?i=B.er-327680*(s-50):s<150&&(i=5*(s-100)+B.GREEN)}if(10===this.jM[t]){const s=150-this.qM[t];s<50?i=5*s+B.RED:s<100?i=B.rr-327680*(s-50):s<150&&(i=327680*(s-100)+B.BLUE-5*(s-100))}if(11===this.jM[t]){const s=150-this.qM[t];s<50?i=B.lr-327685*s:s<100?i=327685*(s-50)+B.GREEN:s<150&&(i=B.lr-327680*(s-100))}if(0===this.ZM[t]&&(this.Sb?.mf(this.ZR,this.qR+1,r,B.ar),this.Sb?.mf(this.ZR,this.qR,r,i)),1===this.ZM[t]&&(this.Sb?._f(this.ZR,this.qR+1,r,B.ar,this.iR),this.Sb?._f(this.ZR,this.qR,r,i,this.iR)),2===this.ZM[t]){const s=this.Sb?.pf(r)??0,h=(150-this.qM[t])*(s+100)/150;C.Ii(this.ZR-50,0,this.ZR+50,334),this.Sb?.uf(this.ZR+50-h,this.qR+1,r,B.ar),this.Sb?.uf(this.ZR+50-h,this.qR,r,i),C.Ei()}}else this.Sb?.mf(this.ZR,this.qR+1,r,B.ar),this.Sb?.mf(this.ZR,this.qR,r,B.er)}};Hx=()=>{2===this.bv&&this.ML[2]&&(this.zx((this.Mv-this.MR<<7)+this.vv,2*this.xv,(this.kv-this.kR<<7)+this.Sv),this.ZR>-1&&this.qO%20<10&&this.ML[2].draw(this.ZR-12,this.qR-28))};Wx=()=>{const t=507;let i=13;this.Ck?this.Lb?.gf(t,i,'tock',B.er,!0):this.Sb?.gf(t,i,'tick',B.er,!0),i+=13,this.Lb?.gf(t,i,`Fps: ${this.pT}, ${this.dT} ms`,B.er,!0),i+=13,this.Lb?.gf(t,i,`Draw: ${this.ms.toFixed(1)}, Avg: ${this.zT.toFixed(1)}, Slow: ${this.aT.toFixed(1)} ms`,B.er,!0),i+=13,this.Lb?.gf(t,i,`Occluders: ${St.NI[St.nE]} Active: ${St.CE}`,B.er,!0),i+=13,this.Lb?.gf(t,i,'Local Pos: '+(this.vM?.x??-1)+', '+(this.vM?.z??-1)+', '+(this.vM?.y??-1),B.er,!0),i+=13,this.Lb?.gf(t,i,'Camera Pos: '+this.AR+', '+this.IR+', '+this.mR,B.er,!0),i+=13,this.Lb?.gf(t,i,'Camera Angle: '+this.gR+', '+this.ER,B.er,!0),i+=13,this.Lb?.gf(t,i,'Cutscene Source: '+this.sM+', '+this.hM+' '+this.eM+'; '+this.nM+', '+this.rM,B.er,!0),i+=13,this.Lb?.gf(t,i,'Cutscene Destination: '+this.$R+', '+this.JR+' '+this.QR+'; '+this.tM+', '+this.iM,B.er,!0),ii.TO&&(i+=13,this.Lb?.gf(t,i,'Instructions:',B.er,!0),i+=13,this.Lb?.gf(t,i,'- Arrows to move Camera',B.er,!0),i+=13,this.Lb?.gf(t,i,'- Shift to control Source or Dest',B.er,!0),i+=13,this.Lb?.gf(t,i,'- Alt to control Height',B.er,!0),i+=13,this.Lb?.gf(t,i,'- Ctrl to control Modifier',B.er,!0))};qx=(t,i,s,h,e,n)=>{const r=this.Fx(s,t,i),o=64*h;this.jx(t-o,r,i-o);const l=this.ZR,a=this.qR;this.jx(t+o,r,i-o);const c=this.ZR,f=this.qR;this.jx(t-o,r,i+o);const u=this.ZR,d=this.qR;this.jx(t+o,r,i+o);const w=this.ZR,y=this.qR;-1!==l&&-1!==c&&-1!==u&&-1!==w&&(n&&(C.Ti(l,a,w,y,(16711422&e)>>1),C.Ti(c,f,u,d,(16711422&e)>>1)),C.Ti(l,a,c,f,e),C.Ti(l,a,u,d,e),C.Ti(c,f,w,y,e),C.Ti(u,d,w,y,e))};_x(){const t=1==this.vT[5]?2:1;1==this.vT[6]?(1==this.vT[1]?(this.$R-=t,this.$R<1&&(this.$R=1)):1==this.vT[2]&&(this.$R+=t,this.$R>102&&(this.$R=102)),1==this.vT[3]?1==this.vT[7]?this.QR+=2*t:(this.JR+=1,this.JR>102&&(this.JR=102)):1==this.vT[4]&&(1==this.vT[7]?this.QR-=2*t:(this.JR-=1,this.JR<1&&(this.JR=1)))):(1==this.vT[1]?(this.sM-=t,this.sM<1&&(this.sM=1)):1==this.vT[2]&&(this.sM+=t,this.sM>102&&(this.sM=102)),1==this.vT[3]?1==this.vT[7]?this.eM+=2*t:(this.hM+=t,this.hM>102&&(this.hM=102)):1==this.vT[4]&&(1==this.vT[7]?this.eM-=2*t:(this.hM-=t,this.hM<1&&(this.hM=1)))),this.AR=128*this.sM+64,this.IR=128*this.hM+64,this.mR=this.Fx(this.GR,this.sM,this.hM)-this.eM;const i=128*this.$R+64,s=128*this.JR+64,h=this.Fx(this.GR,this.$R,this.JR)-this.QR,e=i-this.AR,n=h-this.mR,r=s-this.IR,o=0|Math.sqrt(e*e+r*r);this.ER=325.949*Math.atan2(n,o)&2047,this.gR=-325.949*Math.atan2(e,r)&2047,this.ER<128&&(this.ER=128),this.ER>383&&(this.ER=383)}Vx=()=>{if(this.$x(),1===this.rv&&this.xL[this.ov/100|0]?.draw(this.lv-8-8,this.av-8-11),2===this.rv&&this.xL[4+(this.ov/100|0)]?.draw(this.lv-8-8,this.av-8-11),-1!==this.ev&&(this.Dk(this.ev,this.tR),this.Nk(X.$t[this.ev],0,0,0)),this.Jx(),this.fv?0===this.uv&&this.Qx():(this.lx(),this.tD()),1===this.RM&&(this.DM>0||1===this.NM?this.ML[1]?.draw(472,258):this.ML[1]?.draw(472,296)),this.DM>0&&(this.ML[0]?.draw(472,296),this.vb?.mf(484,329,'Level: '+this.DM,B.er)),1===this.NM&&(this.ML[6]?.draw(472,296),this.vb?.mf(484,329,'Arena',B.er)),0!==this.hb){let t=this.hb/50|0;const i=t/60|0;t%=60,t<10?this.vb?.uf(4,329,'System update in: '+i+':0'+t,B.er):this.vb?.uf(4,329,'System update in: '+i+':'+t,B.er)}};$x=()=>{if(0===this.eS)return;const t=this.vb;let i=0;0!==this.hb&&(i=1);for(let s=0;s<100;s++){if(!this.tS[s])continue;const h=this.messageType[s];let e;if((3===h||7===h)&&(7===h||0===this.Yv||1===this.Yv&&this.Zx(this.iS[s]))&&(e=329-13*i,t?.uf(4,e,'From '+this.iS[s]+': '+this.tS[s],B.ar),t?.uf(4,e-1,'From '+this.iS[s]+': '+this.tS[s],B.nr),i++,i>=5))return;if(5===h&&this.Yv<2&&(e=329-13*i,t?.uf(4,e,this.tS[s],B.ar),t?.uf(4,e-1,this.tS[s],B.nr),i++,i>=5))return;if(6===h&&this.Yv<2&&(e=329-13*i,t?.uf(4,e,'To '+this.iS[s]+': '+this.tS[s],B.ar),t?.uf(4,e-1,'To '+this.iS[s]+': '+this.tS[s],B.nr),i++,i>=5))return}};Jx=()=>{if(!this.vM)return;const t=(this.vM.x>>7)+this.MR,i=(this.vM.z>>7)+this.kR;if(this.DM=t>=2944&&t<3392&&i>=3520&&i<6400?1+((i-3520)/8|0):t>=2944&&t<3392&&i>=9920&&i<12800?1+((i-9920)/8|0):0,this.NM=0,t>=3328&&t<3392&&i>=3200&&i<3264){const s=63&t,h=63&i;(s>=4&&s<=29&&h>=44&&h<=58||s>=36&&s<=61&&h>=44&&h<=58||s>=4&&s<=29&&h>=25&&h<=39||s>=36&&s<=61&&h>=25&&h<=39||s>=4&&s<=29&&h>=6&&h<=20||s>=36&&s<=61&&h>=6&&h<=20)&&(this.NM=1)}0===this.NM&&t>=3328&&t<=3393&&i>=3203&&i<=3325&&(this.NM=2),this.cv=0,(t>=3053&&t<=3156&&i>=3056&&i<=3136||t>=3072&&t<=3118&&i>=9492&&i<=9535)&&(this.cv=1),1===this.cv&&t>=3139&&t<=3199&&i>=3008&&i<=3062&&(this.cv=0)};Lx=()=>{this.jb?.bind(),this.uL&&(O.Vi=this.uL),this.IL?.draw(0,0),-1!==this.Iv?this.Nk(X.$t[this.Iv],0,0,0):-1!==this.Hv[this.Gv]&&this.Nk(X.$t[this.Hv[this.Gv]],0,0,0),this.fv&&1===this.uv&&this.Qx(),this.jb?.draw(562,231),this.qb?.bind(),this.dL&&(O.Vi=this.dL)};Sx=()=>{if(this.$b?.bind(),this.fL&&(O.Vi=this.fL),this.EL?.draw(0,0),this.zv)this.Sb?.mf(239,40,this.jv,B.ar),this.Sb?.mf(239,60,this.Zv+'*',B.dr);else if(this.Jv)this.Sb?.mf(239,40,'Enter amount:',B.ar),this.Sb?.mf(239,60,this.$v+'*',B.dr);else if(this.Uv)this.Sb?.mf(239,40,this.Uv,B.ar),this.Sb?.mf(239,60,'Click to continue',B.dr);else if(-1!==this.Ev)this.Nk(X.$t[this.Ev],0,0,0);else if(-1===this.Qv){let t=this.vb;0===ii.CO&&(t=this.Rb);let i=0;C.Ii(0,0,463,77);for(let s=0;s<100;s++){const h=this.tS[s];if(!h)continue;const e=this.messageType[s],n=this.Cv+70-14*i;0===e&&(n>0&&n<110&&t?.uf(4,n,h,B.ar),i++),1===e&&(n>0&&n<110&&(t?.uf(4,n,this.iS[s]+':',B.lr),t?.uf(t.pf(this.iS[s])+12,n,h,B.BLUE)),i++),2===e&&(0===this.Wv||1===this.Wv&&this.Zx(this.iS[s]))&&(n>0&&n<110&&(t?.uf(4,n,this.iS[s]+':',B.ar),t?.uf(t.pf(this.iS[s])+12,n,h,B.BLUE)),i++),3!==e&&7!==e||0!==this.eS||!(7===e||0===this.Yv||1===this.Yv&&this.Zx(this.iS[s]))||(n>0&&n<110&&(t?.uf(4,n,'From '+this.iS[s]+':',B.ar),t?.uf(t.pf('From '+this.iS[s])+12,n,h,B.ur)),i++),4===e&&(0===this.Vv||1===this.Vv&&this.Zx(this.iS[s]))&&(n>0&&n<110&&t?.uf(4,n,this.iS[s]+' '+this.tS[s],B.br),i++),5===e&&0===this.eS&&this.Yv<2&&(n>0&&n<110&&t?.uf(4,n,h,B.ur),i++),6===e&&0===this.eS&&this.Yv<2&&(n>0&&n<110&&(t?.uf(4,n,'To '+this.iS[s]+':',B.ar),t?.uf(t.pf('To '+this.iS[s])+12,n,h,B.ur)),i++),8===e&&(0===this.Vv||1===this.Vv&&this.Zx(this.iS[s]))&&(n>0&&n<110&&t?.uf(4,n,this.iS[s]+' '+this.tS[s],B.Lr),i++)}C.Ei(),this._v=14*i+7,this._v<78&&(this._v=78),this.xk(463,0,this._v-this.Cv-77,this._v,77),0==ii.CO?t?.uf(3,90,this.rS+'*',B.ar):1==ii.CO?t?.uf(3,90,this.rS+'*',B.BLUE):(t?.uf(4,90,K.Wl(this.username)+':',B.ar),t?.uf(t.pf(this.username+': ')+6,90,this.rS+'*',B.BLUE)),C._i(0,77,B.ar,479)}else this.Nk(X.$t[this.Qv],0,0,0);this.fv&&2===this.uv&&this.Qx(),this.$b?.draw(22,375),this.qb?.bind(),this.dL&&(O.Vi=this.dL)};Rx=()=>{if(this.Zb?.bind(),!this.vM)return;const t=this.YR+this.TR&2047;let i=48+(this.vM.x/32|0),s=464-(this.vM.z/32|0);this.bL?.ir(21,9,146,151,this.pL,this.mL,i,s,t,this.OR+256),this.LL?.ir(0,0,33,33,this.wL,this.yL,25,25,this.YR,256);for(let t=0;t<this.ZS;t++)i=4*this.qS[t]+2-(this.vM.x/32|0),s=4*this.$S[t]+2-(this.vM.z/32|0),this.iD(s,this.QL[t],i);for(let t=0;t<gt.Nm;t++)for(let h=0;h<gt.Nm;h++){this.gM[this.GR][t][h]&&(i=4*t+2-(this.vM.x/32|0),s=4*h+2-(this.vM.z/32|0),this.iD(s,this.DL,i))}for(let t=0;t<this.pM;t++){const h=this.yM[this.AM[t]];h&&h.isVisible()&&h.type&&h.type.Cl&&(i=(h.x/32|0)-(this.vM.x/32|0),s=(h.z/32|0)-(this.vM.z/32|0),this.iD(s,this.NL,i))}for(let t=0;t<this.lM;t++){const h=this.oM[this.aM[t]];if(h&&h.isVisible()&&h.name){i=(h.x/32|0)-(this.vM.x/32|0),s=(h.z/32|0)-(this.vM.z/32|0);let t=!1;const e=K.Fl(h.name);for(let i=0;i<this.HM;i++)if(e===this.QM[i]&&0!==this.tk[i]){t=!0;break}t?this.iD(s,this.FL,i):this.iD(s,this.PL,i)}}0!==this.sR&&(i=4*this.sR+2-(this.vM.x/32|0),s=4*this.hR+2-(this.vM.z/32|0),this.iD(s,this.kL,i)),C.fillRect(93,82,3,3,B.lr),this.qb?.bind()};iD=(t,i,s)=>{if(!i)return;const h=this.YR+this.TR&2047,e=s*s+t*t;if(e>6400)return;let n=O.sin[h],r=O.cos[h];n=256*n/(this.OR+256)|0,r=256*r/(this.OR+256)|0;const o=t*n+s*r>>16,l=t*r-s*n>>16;e>2500&&this.gL?i.sr(o+94-(i.Ri/2|0),83-l-(i.Mi/2|0),this.gL):i.draw(o+94-(i.Ri/2|0),83-l-(i.Mi/2|0))};sD=t=>{if(!this.bL)return;const i=this.bL.di,s=i.length;for(let t=0;t<s;t++)i[t]=0;for(let s=1;s<gt.Nm-1;s++){let h=512*(gt.Nm-1-s)*4+24628;for(let e=1;e<gt.Nm-1;e++)!this.Qg||24&this.Qg[t][e][s]||this.JS?.wg(t,e,s,i,h,512),t<3&&this.Qg&&8&this.Qg[t+1][e][s]&&this.JS?.wg(t+1,e,s,i,h,512),h+=4}const h=(238+(20*Math.random()|0)-10<<16)+(238+(20*Math.random()|0)-10<<8)+(20*Math.random()|0)+238-10,e=238+(20*Math.random()|0)-10<<16;this.bL.bind();for(let i=1;i<gt.Nm-1;i++)for(let s=1;s<gt.Nm-1;s++)!this.Qg||24&this.Qg[t][s][i]||this.hD(s,i,t,h,e),t<3&&this.Qg&&8&this.Qg[t+1][s][i]&&this.hD(s,i,t+1,h,e);this.qb?.bind(),this.ZS=0;for(let t=0;t<gt.Nm;t++)for(let i=0;i<gt.Nm;i++){let s=this.JS?.lg(this.GR,t,i)??0;if(0===s)continue;s=s>>14&32767;const h=k.get(s).Pn;if(h<0)continue;let e=t,n=i;if(22!==h&&29!==h&&34!==h&&36!==h&&46!==h&&47!==h&&48!==h){const s=gt.Nm,h=gt.Nm,r=this.BR[this.GR];if(r){const o=r.flags;for(let r=0;r<10;r++){const r=4*Math.random()|0;0===r&&e>0&&e>t-3&&(o[gt.index(e-1,n)]&It.bm)===It.OPEN&&e--,1===r&&e<s-1&&e<t+3&&(o[gt.index(e+1,n)]&It.Rm)===It.OPEN&&e++,2===r&&n>0&&n>i-3&&(o[gt.index(e,n-1)]&It.Om)===It.OPEN&&n--,3===r&&n<h-1&&n<i+3&&(o[gt.index(e,n+1)]&It.vm)===It.OPEN&&n++}}}this.QL[this.ZS]=this.SL[h],this.qS[this.ZS]=e,this.$S[this.ZS]=n,this.ZS++}};hD=(t,i,s,h,e)=>{if(!this.JS||!this.bL)return;let n=this.JS.ng(s,t,i);if(0!==n){const r=this.JS.ag(s,t,i,n),o=r>>6&3,l=31&r;let a=h;n>0&&(a=e);const c=this.bL.di,f=4*t+512*(103-i)*4+24624,u=n>>14&32767,d=k.get(u);if(-1===d.Fn)l!==R.Be.id&&l!==R.He.id||(o===M.cn?(c[f]=a,c[f+512]=a,c[f+1024]=a,c[f+1536]=a):o===M.fn?(c[f]=a,c[f+1]=a,c[f+2]=a,c[f+3]=a):o===M.un?(c[f+3]=a,c[f+3+512]=a,c[f+3+1024]=a,c[f+3+1536]=a):o===M.dn&&(c[f+1536]=a,c[f+1536+1]=a,c[f+1536+2]=a,c[f+1536+3]=a)),l===R.We.id&&(o===M.cn?c[f]=a:o===M.fn?c[f+3]=a:o===M.un?c[f+3+1536]=a:o===M.dn&&(c[f+1536]=a)),l===R.He.id&&(o===M.dn?(c[f]=a,c[f+512]=a,c[f+1024]=a,c[f+1536]=a):o===M.cn?(c[f]=a,c[f+1]=a,c[f+2]=a,c[f+3]=a):o===M.fn?(c[f+3]=a,c[f+3+512]=a,c[f+3+1024]=a,c[f+3+1536]=a):o===M.un&&(c[f+1536]=a,c[f+1536+1]=a,c[f+1536+2]=a,c[f+1536+3]=a));else{const s=this.vL[d.Fn];if(s){const h=(4*d.width-s.width)/2|0,e=(4*d.length-s.height)/2|0;s.draw(4*t+48+h,4*(gt.Nm-i-d.length)+e+48)}}}if(n=this.JS.og(s,t,i),0!==n){const h=this.JS.ag(s,t,i,n),e=h>>6&3,r=31&h,o=n>>14&32767,l=k.get(o);if(-1!==l.Fn){const s=this.vL[l.Fn];if(s){const h=(4*l.width-s.width)/2|0,e=(4*l.length-s.height)/2|0;s.draw(4*t+48+h,4*(gt.Nm-i-l.length)+e+48)}}else if(r===R.je.id){let s=15658734;n>0&&(s=15597568);const h=this.bL.di,r=4*t+512*(gt.Nm-1-i)*4+24624;e===M.cn||e===M.un?(h[r+1536]=s,h[r+1024+1]=s,h[r+512+2]=s,h[r+3]=s):(h[r]=s,h[r+512+1]=s,h[r+1024+2]=s,h[r+1536+3]=s)}}if(n=this.JS.lg(s,t,i),0!==n){const s=k.get(n>>14&32767);if(-1!==s.Fn){const h=this.vL[s.Fn];if(h){const e=(4*s.width-h.width)/2|0,n=(4*s.length-h.height)/2|0;h.draw(4*t+48+e,4*(gt.Nm-i-s.length)+n+48)}}}};tD=()=>{if(this.Av<2&&0===this.AS&&0===this.SS)return;let t;t=1===this.AS&&this.Av<2?'Use '+this.gS+' with...':1===this.SS&&this.Av<2?this.kS+'...':this.mv[this.Av-1],this.Av>2&&(t=t+'@whi@ / '+(this.Av-2)+' more options'),this.Sb?.If(4,15,t,B.lr,!0,this.qO/1e3|0)};Qx=()=>{const t=this.dv,i=this.wv,s=this.yv,h=this.pv,e=B.gr;C.fillRect(t,i,s,h,e),C.fillRect(t+1,i+1,s-2,16,B.ar),C.gi(t+1,i+18,s-2,h-19,B.ar),this.Sb?.uf(t+3,i+14,'Choose Option',e);let n=this.gh,r=this._h;0===this.uv&&(n-=8,r-=11),1===this.uv&&(n-=562,r-=231),2===this.uv&&(n-=22,r-=375);for(let h=0;h<this.Av;h++){const e=i+15*(this.Av-1-h)+31;let o=B.lr;n>t&&n<t+s&&r>e-13&&r<e+3&&(o=B.er),this.Sb?.wf(t+3,e,this.mv[h],o,!0)}};mx=async()=>{if(0!==this.uS)return;let t=this.OT;if(1===this.SS&&this.bT>=520&&this.LT>=165&&this.bT<=788&&this.LT<=230&&(t=0),this.fv){if(1!==t){let t=this.gh,i=this._h;0===this.uv?(t-=8,i-=11):1===this.uv?(t-=562,i-=231):2===this.uv&&(t-=22,i-=375),(t<this.dv-10||t>this.dv+this.yv+10||i<this.wv-10||i>this.wv+this.pv+10)&&(this.fv=!1,1===this.uv&&(this.tv=!0),2===this.uv&&(this.iv=!0))}if(1===t){const t=this.dv,i=this.wv,s=this.yv;let h=this.bT,e=this.LT;0===this.uv?(h-=8,e-=11):1===this.uv?(h-=562,e-=231):2===this.uv&&(h-=22,e-=375);let n=-1;for(let r=0;r<this.Av;r++){const o=i+15*(this.Av-1-r)+31;h>t&&h<t+s&&e>o-13&&e<o+3&&(n=r)}-1!==n&&await this.yx(n),this.fv=!1,1===this.uv?this.tv=!0:2===this.uv&&(this.iv=!0)}}else{if(1===t&&this.Av>0){const t=this.DS[this.Av-1];if(602===t||596===t||22===t||892===t||415===t||405===t||38===t||422===t||478===t||347===t||188===t){const t=this.PS[this.Av-1],i=this.US[this.Av-1];if(X.$t[i].draggable)return this.pS=!1,this.yS=0,this.cS=i,this.fS=t,this.uS=2,this.dS=this.bT,this.wS=this.LT,X.$t[i].an===this.ev&&(this.uS=1),void(X.$t[i].an===this.Ev&&(this.uS=3))}}if(1===t&&(1===this.xS||this.ux(this.Av-1))&&this.Av>2&&(t=2),1===t&&this.Av>0&&await this.yx(this.Av-1),2!==t||this.Av<=0)return;this.wx()}};Ix=()=>{if(1===this.OT&&this.vM){let t=this.bT-21-561,i=this.LT-9-5;if(t>=0&&i>=0&&t<146&&i<151){t-=73,i-=75;const s=this.YR+this.TR&2047;let h=O.sin[s],e=O.cos[s];h=h*(this.OR+256)>>8,e=e*(this.OR+256)>>8;const n=i*h+t*e>>11,r=i*e-t*h>>11,o=this.vM.x+n>>7,l=this.vM.z-r>>7;this.Ax(this.vM.fC[0],this.vM.uC[0],o,l,1,0,0,0,0,0,!0)&&(this.JO.p1(t),this.JO.p1(i),this.JO.p2(this.YR),this.JO.p1(57),this.JO.p1(this.TR),this.JO.p1(this.OR),this.JO.p1(89),this.JO.p2(this.vM.x),this.JO.p2(this.vM.z),this.JO.p1(this.LM),this.JO.p1(63))}}};ux=t=>{if(t<0)return!1;let i=this.DS[t];return i>=2e3&&(i-=2e3),406===i};yx=async t=>{if(t<0)return;this.Jv&&(this.Jv=!1,this.iv=!0);let i=this.DS[t];const s=this.NS[t],h=this.PS[t],e=this.US[t];if(i>=2e3&&(i-=2e3),903===i||363===i){let s=this.mv[t];const h=s.indexOf('@whi@');if(-1!==h){s=s.substring(h+5).trim();const t=K.Wl(K.Ul(K.Fl(s)));let e=!1;for(let s=0;s<this.lM;s++){const h=this.oM[this.aM[s]];if(h&&h.name&&h.name.toLowerCase()===t.toLowerCase()&&this.vM){this.Ax(this.vM.fC[0],this.vM.uC[0],h.fC[0],h.uC[0],2,1,1,0,0,0,!1),903===i?this.JO.Bt(et.hw):363===i&&this.JO.Bt(et.tw),this.JO.p2(this.aM[s]),e=!0;break}}e||this.eD(0,'Unable to find '+t,'')}}else if(450===i&&this.nD(et.Qd,h,e,s))this.JO.p2(this.ES),this.JO.p2(this.mS),this.JO.p2(this.IS);else if(405===i||38===i||422===i||478===i||347===i)478===i?(3&h||ii.FO++,ii.FO>=90&&this.JO.Bt(et._d),this.JO.Bt(et.aw)):347===i?this.JO.Bt(et.cw):422===i?this.JO.Bt(et.lw):405===i?(ii.NO+=s,ii.NO>=97&&(this.JO.Bt(et.Ed),this.JO.p3(14953816)),this.JO.Bt(et.rw)):38===i&&this.JO.Bt(et.ow),this.JO.p2(s),this.JO.p2(h),this.JO.p2(e),this.OS=0,this.TS=e,this.CS=h,this._S=2,X.$t[e].an===this.ev&&(this._S=1),X.$t[e].an===this.Ev&&(this._S=3);else if(728===i||542===i||6===i||963===i||245===i){const t=this.yM[s];t&&this.vM&&(this.Ax(this.vM.fC[0],this.vM.uC[0],t.fC[0],t.uC[0],2,1,1,0,0,0,!1),this.lv=this.bT,this.av=this.LT,this.rv=2,this.ov=0,542===i?this.JO.Bt(et.Hd):6===i?(3&s||ii.DO++,ii.DO>=124&&(this.JO.Bt(et.Id),this.JO.p4(0)),this.JO.Bt(et.Wd)):963===i?this.JO.Bt(et.Yd):728===i?this.JO.Bt(et.Gd):245===i&&(3&s||ii.PO++,ii.PO>=85&&(this.JO.Bt(et.gd),this.JO.p2(39596)),this.JO.Bt(et.Vd)),this.JO.p2(s))}else if(217===i){if(this.vM){this.Ax(this.vM.fC[0],this.vM.uC[0],h,e,2,0,0,0,0,0,!1)||this.Ax(this.vM.fC[0],this.vM.uC[0],h,e,2,1,1,0,0,0,!1),this.lv=this.bT,this.av=this.LT,this.rv=2,this.ov=0,this.JO.Bt(et.Bd),this.JO.p2(h+this.MR),this.JO.p2(e+this.kR),this.JO.p2(s),this.JO.p2(this.ES),this.JO.p2(this.mS),this.JO.p2(this.IS)}}else if(1175===i){const t=s>>14&32767,i=k.get(t);let h;h=i.Cn?i.Cn:"It's a "+i.name+'.',this.eD(0,h,'')}else if(285===i)this.nD(et.zd,h,e,s);else if(881===i)this.JO.Bt(et.uw),this.JO.p2(s),this.JO.p2(h),this.JO.p2(e),this.JO.p2(this.ES),this.JO.p2(this.mS),this.JO.p2(this.IS),this.OS=0,this.TS=e,this.CS=h,this._S=2,X.$t[e].an===this.ev&&(this._S=1),X.$t[e].an===this.Ev&&(this._S=3);else if(391===i)this.JO.Bt(et.fw),this.JO.p2(s),this.JO.p2(h),this.JO.p2(e),this.JO.p2(this.RS),this.OS=0,this.TS=e,this.CS=h,this._S=2,X.$t[e].an===this.ev&&(this._S=1),X.$t[e].an===this.Ev&&(this._S=3);else if(660===i)this.fv?this.JS?.click(h-8,e-11):this.JS?.click(this.bT-8,this.LT-11);else{if(188===i)return this.AS=1,this.mS=h,this.IS=e,this.ES=s,this.gS=G.get(s).name,void(this.SS=0);if(44===i)this.bS||(this.JO.Bt(et.Iw),this.JO.p2(e),this.bS=!0);else if(1773===i){const t=G.get(s);let i;i=e>=1e5?e+' x '+t.name:t.Cn?t.Cn:"It's a "+t.name+'.',this.eD(0,i,'')}else if(900===i){const t=this.yM[s];t&&this.vM&&(this.Ax(this.vM.fC[0],this.vM.uC[0],t.fC[0],t.uC[0],2,1,1,0,0,0,!1),this.lv=this.bT,this.av=this.LT,this.rv=2,this.ov=0,this.JO.Bt(et.Xd),this.JO.p2(s),this.JO.p2(this.ES),this.JO.p2(this.mS),this.JO.p2(this.IS))}else if(1373===i||1544===i||151===i||1101===i){const t=this.oM[s];t&&this.vM&&(this.Ax(this.vM.fC[0],this.vM.uC[0],t.fC[0],t.uC[0],2,1,1,0,0,0,!1),this.lv=this.bT,this.av=this.LT,this.rv=2,this.ov=0,1101===i?this.JO.Bt(et.tw):151===i?(ii.GO++,ii.GO>=90&&(this.JO.Bt(et.Od),this.JO.p2(31114)),this.JO.Bt(et.iw)):1373===i?this.JO.Bt(et.hw):1544===i&&this.JO.Bt(et.sw),this.JO.p2(s))}else if(265===i){const t=this.yM[s];t&&this.vM&&(this.Ax(this.vM.fC[0],this.vM.uC[0],t.fC[0],t.uC[0],2,1,1,0,0,0,!1),this.lv=this.bT,this.av=this.LT,this.rv=2,this.ov=0,this.JO.Bt(et.Kd),this.JO.p2(s),this.JO.p2(this.RS))}else if(679===i){const i=this.mv[t],s=i.indexOf('@whi@');if(-1!==s){const t=K.Fl(i.substring(s+5).trim());let h=-1;for(let i=0;i<this.HM;i++)if(this.QM[i]===t){h=i;break}-1!==h&&this.tk[h]>0&&(this.iv=!0,this.Jv=!1,this.zv=!0,this.Zv='',this.qv=3,this.ik=this.QM[h],this.jv='Enter message to send to '+this.JM[h])}}else if(55===i)this.nD(et.Jd,h,e,s)&&this.JO.p2(this.RS);else if(224===i||993===i||99===i||746===i||877===i){if(this.vM){this.Ax(this.vM.fC[0],this.vM.uC[0],h,e,2,0,0,0,0,0,!1)||this.Ax(this.vM.fC[0],this.vM.uC[0],h,e,2,1,1,0,0,0,!1),this.lv=this.bT,this.av=this.LT,this.rv=2,this.ov=0,224===i?this.JO.Bt(et.xd):746===i?this.JO.Bt(et.Pd):877===i?this.JO.Bt(et.Fd):99===i?this.JO.Bt(et.Nd):993===i&&this.JO.Bt(et.Dd),this.JO.p2(h+this.MR),this.JO.p2(e+this.kR),this.JO.p2(s)}}else if(1607===i){const t=this.yM[s];if(t&&t.type){let i;i=t.type.Cn?t.type.Cn:"It's a "+t.type.name+'.',this.eD(0,i,'')}}else if(504===i)this.nD(et.jd,h,e,s);else{if(930===i){const t=X.$t[e];this.SS=1,this.RS=e,this.MS=t.Kc,this.AS=0;let i=t.Vc;i&&-1!==i.indexOf(' ')&&(i=i.substring(0,i.indexOf(' ')));let s=t.Vc;return s&&-1!==s.indexOf(' ')&&(s=s.substring(s.indexOf(' ')+1)),this.kS=i+' '+t.action+' '+s,void(16===this.MS&&(this.tv=!0,this.Gv=3,this.sv=!0))}if(951===i){const t=X.$t[e];let i=!0;t.dc>0&&(i=this.rD(t)),i&&(this.JO.Bt(et.mw),this.JO.p2(e))}else if(602===i||596===i||22===i||892===i||415===i)22===i?this.JO.Bt(et.yw):415===i?(3&e||ii.BO++,ii.BO>=55&&(this.JO.Bt(et.Td),this.JO.p4(0)),this.JO.Bt(et.Aw)):602===i?this.JO.Bt(et.dw):892===i?(3&h||ii.HO++,ii.HO>=130&&(this.JO.Bt(et.bd),this.JO.p1(177)),this.JO.Bt(et.pw)):596===i&&this.JO.Bt(et.ww),this.JO.p2(s),this.JO.p2(h),this.JO.p2(e),this.OS=0,this.TS=e,this.CS=h,this._S=2,X.$t[e].an===this.ev&&(this._S=1),X.$t[e].an===this.Ev&&(this._S=3);else if(581===i)3&s||ii.xO++,ii.xO>=99&&(this.JO.Bt(et.md),this.JO.p4(0)),this.nD(et.qd,h,e,s);else if(965===i){if(this.vM){this.Ax(this.vM.fC[0],this.vM.uC[0],h,e,2,0,0,0,0,0,!1)||this.Ax(this.vM.fC[0],this.vM.uC[0],h,e,2,1,1,0,0,0,!1),this.lv=this.bT,this.av=this.LT,this.rv=2,this.ov=0,this.JO.Bt(et.Ud),this.JO.p2(h+this.MR),this.JO.p2(e+this.kR),this.JO.p2(s),this.JO.p2(this.RS)}}else if(1501===i)ii.UO+=this.kR,ii.UO>=92&&(this.JO.Bt(et.Cd),this.JO.p4(0)),this.nD(et.$d,h,e,s);else if(364===i)this.nD(et.Zd,h,e,s);else if(1102===i){const t=G.get(s);let i;i=t.Cn?t.Cn:"It's a "+t.name+'.',this.eD(0,i,'')}else if(960===i){this.JO.Bt(et.mw),this.JO.p2(e);const t=X.$t[e];if(t.scripts&&t.scripts[0]&&5===t.scripts[0][0]){const i=t.scripts[0][1];t.Ac&&this.LS[i]!==t.Ac[0]&&(this.LS[i]=t.Ac[0],await this.oD(i),this.tv=!0)}}else if(34===i){const i=this.mv[t],s=i.indexOf('@whi@');if(-1!==s){this.lD(),this.WS=i.substring(s+5).trim(),this.YS=!1;for(let t=0;t<X.$t.length;t++)if(X.$t[t]&&X.$t[t].dc===X.Xa){this.VS=this.ev=X.$t[t].an;break}}}else if(947===i)this.lD();else if(367===i){const t=this.oM[s];t&&this.vM&&(this.Ax(this.vM.fC[0],this.vM.uC[0],t.fC[0],t.uC[0],2,1,1,0,0,0,!1),this.lv=this.bT,this.av=this.LT,this.rv=2,this.ov=0,this.JO.Bt(et.nw),this.JO.p2(s),this.JO.p2(this.ES),this.JO.p2(this.mS),this.JO.p2(this.IS))}else if(465===i){this.JO.Bt(et.mw),this.JO.p2(e);const t=X.$t[e];if(t.scripts&&t.scripts[0]&&5===t.scripts[0][0]){const i=t.scripts[0][1];this.LS[i]=1-this.LS[i],await this.oD(i),this.tv=!0}}else if(406===i||436===i||557===i||556===i){const s=this.mv[t],h=s.indexOf('@whi@');if(-1!==h){const t=K.Fl(s.substring(h+5).trim());406===i?this.aD(t):436===i?this.cD(t):557===i?this.fD(t):556===i&&this.uD(t)}}else if(651===i){const t=this.oM[s];t&&this.vM&&(this.Ax(this.vM.fC[0],this.vM.uC[0],t.fC[0],t.uC[0],2,1,1,0,0,0,!1),this.lv=this.bT,this.av=this.LT,this.rv=2,this.ov=0,this.JO.Bt(et.ew),this.JO.p2(s),this.JO.p2(this.RS))}}}this.AS=0,this.SS=0};rD=t=>{const i=t.dc;if(i===X.aa&&(this.iv=!0,this.Jv=!1,this.zv=!0,this.Zv='',this.qv=1,this.jv='Enter name of friend to add to list'),i===X.ca&&(this.iv=!0,this.Jv=!1,this.zv=!0,this.Zv='',this.qv=2,this.jv='Enter name of friend to delete from list'),i===X.ua)return this.sb=250,!0;if(i===X.Ya&&(this.iv=!0,this.Jv=!1,this.zv=!0,this.Zv='',this.qv=4,this.jv='Enter name of player to add to list'),i===X.Va&&(this.iv=!0,this.Jv=!1,this.zv=!0,this.Zv='',this.qv=5,this.jv='Enter name of player to delete from list'),i>=X.da&&i<=X.ba){const t=(i-300)/2|0,s=1&i;let h=this.BM[t];if(-1!==h)for(;;)if(0===s&&(h--,h<0&&(h=W.count-1)),1===s&&(h++,h>=W.count&&(h=0)),!W.$t[h].disable&&W.$t[h].type===t+(this.FM?0:7)){this.BM[t]=h,this.UM=!0;break}}if(i>=X.La&&i<=X.Pa){const t=(i-314)/2|0,s=1&i;let h=this.GM[t];0===s&&(h--,h<0&&(h=Ft.RC[t].length-1)),1===s&&(h++,h>=Ft.RC[t].length&&(h=0)),this.GM[t]=h,this.UM=!0}if(i!==X.Fa||this.FM||(this.FM=!0,this.Qk()),i===X.Ua&&this.FM&&(this.FM=!1,this.Qk()),i===X.Ba){this.JO.Bt(et.Rw),this.JO.p1(this.FM?0:1);for(let t=0;t<7;t++)this.JO.p1(this.BM[t]);for(let t=0;t<5;t++)this.JO.p1(this.GM[t]);return!0}return i===X.nc&&(this.YS=!this.YS),i>=X.za&&i<=X.ec&&(this.lD(),this.WS.length>0&&(this.JO.Bt(et.Tw),this.JO.Yt(K.Fl(this.WS)),this.JO.p1(i-601),this.JO.p1(this.YS?1:0))),!1};Qk=()=>{this.UM=!0;for(let t=0;t<7;t++){this.BM[t]=-1;for(let i=0;i<W.count;i++)if(!W.$t[i].disable&&W.$t[i].type===t+(this.FM?0:7)){this.BM[t]=i;break}}};nD=(t,i,s,h)=>{if(!this.vM||!this.JS)return!1;const e=h>>14&32767,n=this.JS.ag(this.GR,i,s,h);if(-1===n)return!1;const r=31&n,o=n>>6&3;if(r===R.Ze.id||r===R.qe.id||r===R.Ue.id){const t=k.get(e);let h,n;o===M.cn||o===M.un?(h=t.width,n=t.length):(h=t.length,n=t.width);let r=t.Yn;0!==o&&(r=(r<<o&15)+(r>>4-o)),this.Ax(this.vM.fC[0],this.vM.uC[0],i,s,2,h,n,0,0,r,!1)}else this.Ax(this.vM.fC[0],this.vM.uC[0],i,s,2,0,0,o,r+1,0,!1);return this.lv=this.bT,this.av=this.LT,this.rv=2,this.ov=0,this.JO.Bt(t),this.JO.p2(i+this.MR),this.JO.p2(s+this.kR),this.JO.p2(e),!0};Ex=()=>{1===this.OT&&(this.bT>=549&&this.bT<=583&&this.LT>=195&&this.LT<231&&-1!==this.Hv[0]?(this.tv=!0,this.Gv=0,this.sv=!0):this.bT>=579&&this.bT<=609&&this.LT>=194&&this.LT<231&&-1!==this.Hv[1]?(this.tv=!0,this.Gv=1,this.sv=!0):this.bT>=607&&this.bT<=637&&this.LT>=194&&this.LT<231&&-1!==this.Hv[2]?(this.tv=!0,this.Gv=2,this.sv=!0):this.bT>=635&&this.bT<=679&&this.LT>=194&&this.LT<229&&-1!==this.Hv[3]?(this.tv=!0,this.Gv=3,this.sv=!0):this.bT>=676&&this.bT<=706&&this.LT>=194&&this.LT<231&&-1!==this.Hv[4]?(this.tv=!0,this.Gv=4,this.sv=!0):this.bT>=704&&this.bT<=734&&this.LT>=194&&this.LT<231&&-1!==this.Hv[5]?(this.tv=!0,this.Gv=5,this.sv=!0):this.bT>=732&&this.bT<=766&&this.LT>=195&&this.LT<231&&-1!==this.Hv[6]?(this.tv=!0,this.Gv=6,this.sv=!0):this.bT>=550&&this.bT<=584&&this.LT>=492&&this.LT<528&&-1!==this.Hv[7]?(this.tv=!0,this.Gv=7,this.sv=!0):this.bT>=582&&this.bT<=612&&this.LT>=492&&this.LT<529&&-1!==this.Hv[8]?(this.tv=!0,this.Gv=8,this.sv=!0):this.bT>=609&&this.bT<=639&&this.LT>=492&&this.LT<529&&-1!==this.Hv[9]?(this.tv=!0,this.Gv=9,this.sv=!0):this.bT>=637&&this.bT<=681&&this.LT>=493&&this.LT<528&&-1!==this.Hv[10]?(this.tv=!0,this.Gv=10,this.sv=!0):this.bT>=679&&this.bT<=709&&this.LT>=492&&this.LT<529&&-1!==this.Hv[11]?(this.tv=!0,this.Gv=11,this.sv=!0):this.bT>=706&&this.bT<=736&&this.LT>=492&&this.LT<529&&-1!==this.Hv[12]?(this.tv=!0,this.Gv=12,this.sv=!0):this.bT>=734&&this.bT<=768&&this.LT>=492&&this.LT<528&&-1!==this.Hv[13]&&(this.tv=!0,this.Gv=13,this.sv=!0),ii.LO++,ii.LO>150&&(ii.LO=0,this.JO.Bt(et.Ld),this.JO.p1(43)))};Ox=async()=>{for(;;){let t;do{for(;;){if(t=this.XT(),-1===t)return;if(-1!==this.ev&&this.ev===this.VS){8===t&&this.WS.length>0&&(this.WS=this.WS.substring(0,this.WS.length-1));break}if(this.zv){if(t>=32&&t<=122&&this.Zv.length<80&&(this.Zv=this.Zv+String.fromCharCode(t),this.iv=!0),8===t&&this.Zv.length>0&&(this.Zv=this.Zv.substring(0,this.Zv.length-1),this.iv=!0),13===t||10===t){let t;if(this.zv=!1,this.iv=!0,1===this.qv&&(t=K.Fl(this.Zv),this.aD(t)),2===this.qv&&this.HM>0&&(t=K.Fl(this.Zv),this.fD(t)),3===this.qv&&this.Zv.length>0&&this.ik){this.JO.Bt(et.Lu),this.JO.p1(0);const t=this.JO.bt;this.JO.Yt(this.ik),rt.Ky(this.JO,this.Zv),this.JO.Xt(this.JO.bt-t),this.Zv=K.Bl(this.Zv),this.Zv=nt.filter(this.Zv),this.eD(6,this.Zv,K.Wl(K.Ul(this.ik))),2===this.Yv&&(this.Yv=1,this.hv=!0,this.JO.Bt(et.Mw),this.JO.p1(this.Wv),this.JO.p1(this.Yv),this.JO.p1(this.Vv))}4===this.qv&&this.Tv<100&&(t=K.Fl(this.Zv),this.cD(t)),5===this.qv&&this.Tv>0&&(t=K.Fl(this.Zv),this.uD(t))}}else if(this.Jv){if(t>=48&&t<=57&&this.$v.length<10&&(this.$v=this.$v+String.fromCharCode(t),this.iv=!0),8===t&&this.$v.length>0&&(this.$v=this.$v.substring(0,this.$v.length-1),this.iv=!0),13===t||10===t){if(this.$v.length>0){let t=0;try{t=parseInt(this.$v,10)}catch(t){}this.JO.Bt(et.gw),this.JO.p4(t)}this.Jv=!1,this.iv=!0}}else if(-1===this.Ev&&(t>=32&&t<=122&&this.rS.length<80&&(this.rS=this.rS+String.fromCharCode(t),this.iv=!0),8===t&&this.rS.length>0&&(this.rS=this.rS.substring(0,this.rS.length-1),this.iv=!0),(13===t||10===t)&&this.rS.length>0)){if('::clientdrop'===this.rS)await this.ix();else if(this.PM&&'::noclip'===this.rS)for(let t=0;t<gt.Dm;t++)for(let i=1;i<gt.Nm-1;i++)for(let s=1;s<gt.Nm-1;s++){const h=this.BR[t];h&&(h.flags[gt.index(i,s)]=0)}else if('::debug'===this.rS)ii._O=!ii._O;else if('::chat'===this.rS)ii.CO=(ii.CO+1)%3;else if(this.rS.startsWith('::fps '))try{this.KT(parseInt(this.rS.substring(6),10))}catch(t){}else if(this.rS.startsWith('::camera'))ii.TO=!ii.TO,this.eR=ii.TO,this.$R=52,this.JR=52,this.sM=52,this.hM=52,this.eM=1e3,this.QR=1e3;else if(this.rS.startsWith('::camsrc ')){const t=this.rS.split(' ');3===t.length?(this.sM=parseInt(t[1],10),this.hM=parseInt(t[2],10)):4===t.length&&(this.sM=parseInt(t[1],10),this.hM=parseInt(t[2],10),this.eM=parseInt(t[3],10))}else if(this.rS.startsWith('::camdst ')){const t=this.rS.split(' ');3===t.length?(this.$R=parseInt(t[1],10),this.JR=parseInt(t[2],10)):4===t.length&&(this.$R=parseInt(t[1],10),this.JR=parseInt(t[2],10),this.QR=parseInt(t[3],10))}if(this.rS.startsWith('::'))this.JO.Bt(et.Dw),this.JO.p1(this.rS.length-1),this.JO.Vt(this.rS.substring(2));else{let t=0;this.rS.startsWith('yellow:')?(t=0,this.rS=this.rS.substring(7)):this.rS.startsWith('red:')?(t=1,this.rS=this.rS.substring(4)):this.rS.startsWith('green:')?(t=2,this.rS=this.rS.substring(6)):this.rS.startsWith('cyan:')?(t=3,this.rS=this.rS.substring(5)):this.rS.startsWith('purple:')?(t=4,this.rS=this.rS.substring(7)):this.rS.startsWith('white:')?(t=5,this.rS=this.rS.substring(6)):this.rS.startsWith('flash1:')?(t=6,this.rS=this.rS.substring(7)):this.rS.startsWith('flash2:')?(t=7,this.rS=this.rS.substring(7)):this.rS.startsWith('flash3:')?(t=8,this.rS=this.rS.substring(7)):this.rS.startsWith('glow1:')?(t=9,this.rS=this.rS.substring(6)):this.rS.startsWith('glow2:')?(t=10,this.rS=this.rS.substring(6)):this.rS.startsWith('glow3:')&&(t=11,this.rS=this.rS.substring(6));let i=0;this.rS.startsWith('wave:')&&(i=1,this.rS=this.rS.substring(5)),this.rS.startsWith('scroll:')&&(i=2,this.rS=this.rS.substring(7)),this.JO.Bt(et.Nw),this.JO.p1(0);const s=this.JO.bt;this.JO.p1(t),this.JO.p1(i),rt.Ky(this.JO,this.rS),this.JO.Xt(this.JO.bt-s),this.rS=K.Bl(this.rS),this.rS=nt.filter(this.rS),this.vM&&this.vM.name&&(this.vM.M_=this.rS,this.vM.x_=t,this.vM.D_=i,this.vM.k_=150,this.eD(2,this.vM.M_,this.vM.name)),2===this.Wv&&(this.Wv=3,this.hv=!0,this.JO.Bt(et.Mw),this.JO.p1(this.Wv),this.JO.p1(this.Yv),this.JO.p1(this.Vv))}this.rS='',this.iv=!0}}}while((t<97||t>122)&&(t<65||t>90)&&(t<48||t>57)&&32!==t);this.WS.length<12&&(this.WS=this.WS+String.fromCharCode(t))}};gx=()=>{if(1===this.OT)if(this.bT>=8&&this.bT<=108&&this.LT>=490&&this.LT<=522)this.Wv=(this.Wv+1)%4,this.hv=!0,this.iv=!0,this.JO.Bt(et.Mw),this.JO.p1(this.Wv),this.JO.p1(this.Yv),this.JO.p1(this.Vv);else if(this.bT>=137&&this.bT<=237&&this.LT>=490&&this.LT<=522)this.Yv=(this.Yv+1)%3,this.hv=!0,this.iv=!0,this.JO.Bt(et.Mw),this.JO.p1(this.Wv),this.JO.p1(this.Yv),this.JO.p1(this.Vv);else if(this.bT>=275&&this.bT<=375&&this.LT>=490&&this.LT<=522)this.Vv=(this.Vv+1)%3,this.hv=!0,this.iv=!0,this.JO.Bt(et.Mw),this.JO.p1(this.Wv),this.JO.p1(this.Yv),this.JO.p1(this.Vv);else if(this.bT>=416&&this.bT<=516&&this.LT>=490&&this.LT<=522){this.lD(),this.WS='',this.YS=!1;for(let t=0;t<X.$t.length;t++)if(X.$t[t]&&600===X.$t[t].dc)return void(this.VS=this.ev=X.$t[t].an)}};vx=(t,i,s,h,e,n,r,o)=>{if(this.Kv?this.Xv=32:this.Xv=0,this.Kv=!1,t>=n&&t<n+16&&i>=r&&i<r+16)o.zc-=4*this.nv,e&&(this.tv=!0);else if(t>=n&&t<n+16&&i>=r+h-16&&i<r+h)o.zc+=4*this.nv,e&&(this.tv=!0);else if(t>=n-this.Xv&&t<n+this.Xv+16&&i>=r+16&&i<r+h-16&&this.nv>0){let t=(h-32)*h/s|0;t<8&&(t=8);const n=i-r-(t/2|0)-16,l=h-t-32;o.zc=(s-h)*n/l|0,e&&(this.tv=!0),this.Kv=!0}};tx=()=>{this.$b||(this.Tk(),this.uT=null,this.wb=null,this.yb=null,this.pb=null,this.Ab=null,this.mb=null,this.Ib=null,this.Eb=null,this.gb=null,this._b=null,this.$b=new z(479,96),this.Zb=new z(168,160),C.clear(),this.gL?.draw(0,0),this.jb=new z(190,261),this.qb=new z(512,334),C.clear(),this.Jb=new z(501,61),this.Qb=new z(288,40),this.tL=new z(269,66),this.cb=!0)};Zx=t=>{if(!t)return!1;for(let i=0;i<this.HM;i++)if(t.toLowerCase()===this.JM[i]?.toLowerCase())return!0;return!!this.vM&&t.toLowerCase()===this.vM.name?.toLowerCase()};aD=t=>{if(0n===t)return;if(this.HM>=100)return void this.eD(0,'Your friends list is full. Max of 100 hit','');const i=K.Wl(K.Ul(t));for(let s=0;s<this.HM;s++)if(this.QM[s]===t)return void this.eD(0,i+' is already on your friend list','');for(let s=0;s<this.Tv;s++)if(this.Ov[s]===t)return void this.eD(0,'Please remove '+i+' from your ignore list first','');this.vM&&this.vM.name&&i!==this.vM.name&&(this.JM[this.HM]=i,this.QM[this.HM]=t,this.tk[this.HM]=0,this.HM++,this.tv=!0,this.JO.Bt(et.xw),this.JO.Yt(t))};fD=t=>{if(0n!==t)for(let i=0;i<this.HM;i++)if(this.QM[i]===t){this.HM--,this.tv=!0;for(let t=i;t<this.HM;t++)this.JM[t]=this.JM[t+1],this.tk[t]=this.tk[t+1],this.QM[t]=this.QM[t+1];return this.JO.Bt(et.kw),void this.JO.Yt(t)}};cD=t=>{if(0n===t)return;if(this.Tv>=100)return void this.eD(0,'Your ignore list is full. Max of 100 hit','');const i=K.Wl(K.Ul(t));for(let s=0;s<this.Tv;s++)if(this.Ov[s]===t)return void this.eD(0,i+' is already on your ignore list','');for(let s=0;s<this.HM;s++)if(this.QM[s]===t)return void this.eD(0,'Please remove '+i+' from your friend list first','');this.Ov[this.Tv++]=t,this.tv=!0,this.JO.Bt(et.Sw),this.JO.Yt(t)};uD=t=>{if(0n!==t)for(let i=0;i<this.Tv;i++)if(this.Ov[i]===t){this.Tv--,this.tv=!0;for(let t=i;t<this.Tv;t++)this.Ov[t]=this.Ov[t+1];return this.JO.Bt(et.Lw),void this.JO.Yt(t)}};dD=(t,i)=>{const s=this.gM[this.GR][t][i];if(!s)return void this.JS?.KE(this.GR,t,i);let h=-99999999,e=null;for(let t=s.head();t;t=s.next()){const i=G.get(t.index);let s=i.sl;i.Qo&&(s*=t.count+1),s>h&&(h=s,e=t)}if(!e)return;s.ot(e);let n=-1,r=-1,o=0,l=0;for(let t=s.head();t;t=s.next())t.index!==e.index&&-1===n&&(n=t.index,o=t.count),t.index!==e.index&&t.index!==n&&-1===r&&(r=t.index,l=t.count);let a=null;-1!==n&&(a=G.get(n).Ko(o));let c=null;-1!==r&&(c=G.get(r).Ko(l));const f=t+(i<<7)+1610612736|0,u=G.get(e.index);this.JS?.VE(t,i,this.Fx(this.GR,128*t+64,128*i+64),this.GR,f,u.Ko(e.count),c,a)};Bm=(t,i,s,h,e,n,r)=>{if(i<1||s<1||i>102||s>102)return;if(ii.Bi&&t!==this.GR)return;if(!this.JS)return;let o=0;if(r===S.Ne&&(o=this.JS.ng(t,i,s)),r===S.Pe&&(o=this.JS.rg(t,s,i)),r===S.Fe&&(o=this.JS.og(t,i,s)),r===S.Ue&&(o=this.JS.lg(t,i,s)),0!==o){const h=this.JS.ag(t,i,s,o),e=o>>14&32767,n=31&h,l=h>>6;if(r===S.Ne){this.JS?.Wm(t,i,s,1);const h=k.get(e);h.bn&&this.BR[t]?.Wm(i,s,n,l,h.Ln)}if(r===S.Pe&&this.JS?.zE(t,i,s),r===S.Fe){this.JS.Gm(t,i,s);const h=k.get(e);if(i+h.width>gt.Nm-1||s+h.width>gt.Nm-1||i+h.length>gt.Nm-1||s+h.length>gt.Nm-1)return;h.bn&&this.BR[t]?.Gm(i,s,h.width,h.length,l,h.Ln)}if(r===S.Ue){this.JS?.YE(t,i,s);const h=k.get(e);h.bn&&h.active&&this.BR[t]?.Um(i,s)}}if(h>=0){let r=t;this.Qg&&t<3&&!(2&~this.Qg[1][i][s])&&(r=t+1),this.Jg&&kt.Bm(t,i,s,this.JS,this.Jg,this.EM,this.BR[t],h,n,e,r)}};lD=()=>{this.JO.Bt(et.Ew),-1!==this.Iv&&(this.Iv=-1,this.tv=!0,this.bS=!1,this.sv=!0),-1!==this.Ev&&(this.Ev=-1,this.iv=!0,this.bS=!1),this.ev=-1};ix=async()=>{this.sb>0?await this.wD():(this.qb?.bind(),this.vb?.mf(257,144,'Connection lost',B.ar),this.vb?.mf(256,143,'Connection lost',B.lr),this.vb?.mf(257,159,'Please wait - attempting to reestablish',B.ar),this.vb?.mf(256,158,'Please wait - attempting to reestablish',B.lr),this.qb?.draw(8,11),this.sR=0,this.stream?.close(),this._T=!1,await this.Jk(this.username,this.password,!0),this._T||await this.wD())};wD=async()=>{this.stream&&this.stream.close(),this.stream=null,this._T=!1,this.fb=0,this.username='',this.password='',yt.oA(),this.Kx(),this.JS?.reset();for(let t=0;t<gt.Dm;t++)this.BR[t]?.reset();zt(!1),this.yk=null,this.dk=0,ii.Bi||await this.Sk('scape_main',12345678,4e4,!1)};read=async()=>{if(!this.stream)return!1;try{let t=this.stream.available;if(0===t)return!1;if(-1===this.nb&&(await this.stream.kf(this.in.data,0,1),this.nb=255&this.in.data[0],this.eb&&(this.nb=this.nb-this.eb.Gt&255),this.packetSize=tt.Hf[this.nb],t--),-1===this.packetSize){if(t<=0)return!1;await this.stream.kf(this.in.data,0,1),this.packetSize=255&this.in.data[0],t--}if(-2===this.packetSize){if(t<=1)return!1;await this.stream.kf(this.in.data,0,2),this.in.bt=0,this.packetSize=this.in.Rt,t-=2}if(t<this.packetSize)return!1;if(this.in.bt=0,await this.stream.kf(this.in.data,0,this.packetSize),this.ib=0,this.lb=this.ob,this.ob=this.rb,this.rb=this.nb,this.nb===ht.Xu){const t=this.in.Rt,i=this.in.St;return this.vS[t]=i,this.LS[t]!==i&&(this.LS[t]=i,await this.oD(t),this.tv=!0,-1!==this.Qv&&(this.iv=!0)),this.nb=-1,!0}if(this.nb===ht.vu){const t=this.in.Dt,i=this.in.st;let s=K.Wl(K.Ul(t));for(let h=0;h<this.HM;h++)if(t===this.QM[h]){this.tk[h]!==i&&(this.tk[h]=i,this.tv=!0,i>0&&this.eD(5,s+' has logged in.',''),0===i&&this.eD(5,s+' has logged out.','')),s=null;break}s&&this.HM<100&&(this.QM[this.HM]=t,this.JM[this.HM]=s,this.tk[this.HM]=i,this.HM++,this.tv=!0);let h=!1;for(;!h;){h=!0;for(let t=0;t<this.HM-1;t++)if(this.tk[t]!==ii.IO&&this.tk[t+1]===ii.IO||0===this.tk[t]&&0!==this.tk[t+1]){const i=this.tk[t];this.tk[t]=this.tk[t+1],this.tk[t+1]=i;const s=this.JM[t];this.JM[t]=this.JM[t+1],this.JM[t+1]=s;const e=this.QM[t];this.QM[t]=this.QM[t+1],this.QM[t+1]=e,this.tv=!0,h=!1}}return this.nb=-1,!0}if(this.nb===ht.ku)return this.hb=30*this.in.Rt,this.nb=-1,!0;if(this.nb===ht.Wu){const t=this.in.st,i=this.in.st;let s=-1;if(this.NR)for(let h=0;h<this.NR.length;h++)this.NR[h]===(t<<8)+i&&(s=h);if(-1!==s){const h=this.xR;if(h){const e=h[s];-1!==s&&e&&(this.db?.Xf(`m${t}_${i}`,e),this.QS=1)}}return this.nb=-1,!0}if(this.nb===ht.Eu)return this.yD(this.in,this.packetSize),this.nb=-1,!0;if(this.nb===ht.Ku){const t=this.in.Rt,i=this.in.Rt;if(this.SR===t&&this.RR===i&&0!==this.QS)return this.nb=-1,!0;this.SR=t,this.RR=i,this.MR=8*(this.SR-6),this.kR=8*(this.RR-6),this.QS=1,this.qb?.bind(),this.vb?.mf(257,151,'Loading - please wait.',B.ar),this.vb?.mf(256,150,'Loading - please wait.',B.lr),this.qb?.draw(8,11);const s=(this.packetSize-2)/10|0;this.xR=new c(s,null),this.DR=new c(s,null),this.NR=new Int32Array(s),this.JO.Bt(et.dd),this.JO.p1(0);let h=0;for(let t=0;t<s;t++){const i=this.in.st,s=this.in.st,e=this.in.xt,n=this.in.xt;let r;this.NR[t]=(i<<8)+s,0!==e&&(r=await(this.db?.Kf(`m${i}_${s}`)),r&&a.Ot(r)!==e&&(r=void 0),r?this.xR[t]=r:(this.QS=0,this.JO.p1(0),this.JO.p1(i),this.JO.p1(s),h+=3)),0!==n&&(r=await(this.db?.Kf(`l${i}_${s}`)),r&&a.Ot(r)!==n&&(r=void 0),r?this.DR[t]=r:(this.QS=0,this.JO.p1(1),this.JO.p1(i),this.JO.p1(s),h+=3))}this.JO.Xt(h),this.qb?.bind(),0===this.QS&&(this.vb?.mf(257,166,'Map area updated since last visit, so load will take longer this time only',B.ar),this.vb?.mf(256,165,'Map area updated since last visit, so load will take longer this time only',B.lr)),this.qb?.draw(8,11);const e=this.MR-this.PR,n=this.kR-this.FR;this.PR=this.MR,this.FR=this.kR;for(let t=0;t<8192;t++){const i=this.yM[t];if(i){for(let t=0;t<10;t++)i.fC[t]-=e,i.uC[t]-=n;i.x-=128*e,i.z-=128*n}}for(let t=0;t<this.VO;t++){const i=this.oM[t];if(i){for(let t=0;t<10;t++)i.fC[t]-=e,i.uC[t]-=n;i.x-=128*e,i.z-=128*n}}let r=0,o=gt.Nm,l=1;e<0&&(r=gt.Nm-1,o=-1,l=-1);let f=0,u=gt.Nm,d=1;n<0&&(f=gt.Nm-1,u=-1,d=-1);for(let t=r;t!==o;t+=l)for(let i=f;i!==u;i+=d){const s=t+e,h=i+n;for(let e=0;e<gt.Dm;e++)s>=0&&h>=0&&s<gt.Nm&&h<gt.Nm?this.gM[e][t][i]=this.gM[e][s][h]:this.gM[e][t][i]=null}for(let t=this._M.head();t;t=this._M.next())t.x-=e,t.z-=n,(t.x<0||t.z<0||t.x>=gt.Nm||t.z>=gt.Nm)&&t.et();return 0!==this.sR&&(this.sR-=e,this.hR-=n),this.eR=!1,this.nb=-1,!0}if(this.nb===ht.ou)return X.$t[this.in.Rt].model=this.vM?.pl()||null,this.nb=-1,!0;if(this.nb===ht.Mu)return this.bv=this.in.st,1===this.bv&&(this.Lv=this.in.Rt),this.bv>=2&&this.bv<=6&&(2===this.bv&&(this.vv=64,this.Sv=64),3===this.bv&&(this.vv=0,this.Sv=64),4===this.bv&&(this.vv=128,this.Sv=64),5===this.bv&&(this.vv=64,this.Sv=0),6===this.bv&&(this.vv=64,this.Sv=128),this.bv=2,this.Mv=this.in.Rt,this.kv=this.in.Rt,this.xv=this.in.st),10===this.bv&&(this.Rv=this.in.Rt),this.nb=-1,!0;if(this.nb===ht.qu){const t=this.in.Ft,i=this.in.xt,s=this.in.xt;return t!==this.yk&&this.wk&&!ii.Bi&&await this.Sk(t,i,s,!0),this.yk=t,this.pk=i,this.Ak=s,this.dk=0,this.nb=-1,!0}if(this.nb===ht.Uu)return await this.wD(),this.nb=-1,!1;if(this.nb===ht.Hu){const t=this.in.st,i=this.in.st;let s=-1;if(this.NR)for(let h=0;h<this.NR.length;h++)this.NR[h]===(t<<8)+i&&(s=h);if(-1!==s){const h=this.DR;if(h){const e=h[s];-1!==s&&e&&(this.db?.Xf(`l${t}_${i}`,e),this.QS=1)}}return this.nb=-1,!0}if(this.nb===ht.Su)return this.sR=0,this.nb=-1,!0;if(this.nb===ht.Pu)return this.MM=this.in.Rt,this.nb=-1,!0;if(this.nb===ht.ad||this.nb===ht.sd||this.nb===ht.nd||this.nb===ht.fd||this.nb===ht.od||this.nb===ht.ed||this.nb===ht.ud||this.nb===ht.hd||this.nb===ht.ld||this.nb===ht.rd)return this.pD(this.in,this.nb),this.nb=-1,!0;if(this.nb===ht.Zf){const t=this.in.Rt,i=this.in.Rt;return-1!==this.Ev&&(this.Ev=-1,this.iv=!0),this.Jv&&(this.Jv=!1,this.iv=!0),this.ev=t,this.Iv=i,this.tv=!0,this.sv=!0,this.bS=!1,this.nb=-1,!0}if(this.nb===ht.zu){const t=this.in.Rt,i=this.in.xt;return this.vS[t]=i,this.LS[t]!==i&&(this.LS[t]=i,await this.oD(t),this.tv=!0,-1!==this.Qv&&(this.iv=!0)),this.nb=-1,!0}if(this.nb===ht.ru){const t=this.in.Rt;return X.$t[t].Mn=this.in.Rt,this.nb=-1,!0}if(this.nb===ht.$f){let t=this.in.Rt;const i=this.in.st;return 65535===t&&(t=-1),this.Hv[i]=t,this.tv=!0,this.sv=!0,this.nb=-1,!0}if(this.nb===ht.Vu){const t=this.in.st,i=this.in.st,s=this.in.Rt,h=this.in.Rt;let e=-1;if(this.NR)for(let s=0;s<this.NR.length;s++)this.NR[s]===(t<<8)+i&&(e=s);if(-1!==e&&this.DR){this.DR[e]&&this.DR[e]?.length===h||(this.DR[e]=new Int8Array(h));const t=this.DR[e];t&&this.in.Ut(this.packetSize-6,s,t)}return this.nb=-1,!0}if(this.nb===ht._u){const t=yt.stop();return t&&(this.JO.Bt(et.pd),this.JO.p2(t.bt),this.JO.Kt(t.data,t.bt,0),t.release()),this.nb=-1,!0}if(this.nb===ht.wu){this.tv=!0;const t=this.in.Rt,i=X.$t[t],s=this.in.st;if(i.gc&&i._c){for(let t=0;t<s;t++){i.gc[t]=this.in.Rt;let s=this.in.st;255===s&&(s=this.in.xt),i._c[t]=s}for(let t=s;t<i.gc.length;t++)i.gc[t]=0,i._c[t]=0}else for(let t=0;t<s;t++)this.in.Rt,255===this.in.st&&this.in.xt;return this.nb=-1,!0}if(this.nb===ht.Cu)return yt.rA(),this.nb=-1,!0;if(this.nb===ht.Bu)return this.zv=!1,this.Jv=!0,this.$v='',this.iv=!0,this.nb=-1,!0;if(this.nb===ht.du){const t=X.$t[this.in.Rt];if(t.gc)for(let i=0;i<t.gc.length;i++)t.gc[i]=-1,t.gc[i]=0;return this.nb=-1,!0}if(this.nb===ht.Fu){if(this.KS=this.in.xt,this.XS=this.in.Rt,this.zS=this.in.st,this.jS=this.in.Rt,0!==this.KS&&-1===this.ev){this.lD();let t=650;201!==this.zS&&(t=655),this.WS='',this.YS=!1;for(let i=0;i<X.$t.length;i++)if(X.$t[i]&&X.$t[i].dc===t){this.ev=X.$t[i].an;break}}return this.nb=-1,!0}if(this.nb===ht.fu)return this.Bv=this.in.st,this.Bv===this.Gv&&(3===this.Bv?this.Gv=1:this.Gv=3,this.tv=!0),this.nb=-1,!0;if(this.nb===ht.$u){if(this.wk&&!ii.Bi){const t=this.in.Rt,i=this.in.xt,s=this.packetSize-6;Kt(wt.read(i,Int8Array.from(this.in.data),s,this.in.bt),this.mk,!1),this.dk=t}return this.nb=-1,!0}if(this.nb===ht.Gu)return this.RM=this.in.st,this.nb=-1,!0;if(this.nb===ht.Zu){const t=this.in.Rt,i=this.in.st,s=this.in.Rt;return this.hk&&!ii.Bi&&this.sk<50&&(this.ek[this.sk]=t,this.nk[this.sk]=i,this.rk[this.sk]=s+at.wp[t],this.sk++),this.nb=-1,!0}if(this.nb===ht.au){const t=this.in.Rt,i=this.in.Rt,s=H.get(i);return X.$t[t].model=s.pl(),this.nb=-1,!0}if(this.nb===ht.Ju)return this.Ah=this.in.st,this.Ih=this.in.st,this.nb=-1,!0;if(this.nb===ht.nu){const t=this.in.Rt,i=this.in.Rt,s=this.in.Rt,h=X.$t[t].model;return h?.Te(i,s),this.nb=-1,!0}if(this.nb===ht.bu)return this.Wv=this.in.st,this.Yv=this.in.st,this.Vv=this.in.st,this.hv=!0,this.iv=!0,this.nb=-1,!0;if(this.nb===ht.Qf){const t=this.in.Rt;return this.AD(t),-1!==this.Ev&&(this.Ev=-1,this.iv=!0),this.Jv&&(this.Jv=!1,this.iv=!0),this.Iv=t,this.tv=!0,this.sv=!0,this.ev=-1,this.bS=!1,this.nb=-1,!0}if(this.nb===ht.jf){const t=this.in.Rt;return this.AD(t),-1!==this.Iv&&(this.Iv=-1,this.tv=!0,this.sv=!0),this.Ev=t,this.iv=!0,this.ev=-1,this.bS=!1,this.nb=-1,!0}if(this.nb===ht.cu){const t=this.in.Rt,i=this.in.Mt,s=this.in.Mt,h=X.$t[t];return h.x=i,h.y=s,this.nb=-1,!0}if(this.nb===ht.mu)return this.eR=!0,this.sM=this.in.st,this.hM=this.in.st,this.eM=this.in.Rt,this.nM=this.in.st,this.rM=this.in.st,this.rM>=100&&(this.AR=128*this.sM+64,this.IR=128*this.hM+64,this.mR=this.Fx(this.GR,this.sM,this.hM)-this.eM),this.nb=-1,!0;if(this.nb===ht.Qu){this.Ah=this.in.st,this.Ih=this.in.st;for(let t=this.Ah;t<this.Ah+8;t++)for(let i=this.Ih;i<this.Ih+8;i++)this.gM[this.GR][t][i]&&(this.gM[this.GR][t][i]=null,this.dD(t,i));for(let t=this._M.head();t;t=this._M.next())t.x>=this.Ah&&t.x<this.Ah+8&&t.z>=this.Ih&&t.z<this.Ih+8&&t.A_===this.GR&&(this.Bm(t.A_,t.x,t.z,t.I_,t.E_,t.g_,t.an),t.et());return this.nb=-1,!0}if(this.nb===ht.Yu){const t=this.in.st,i=this.in.st,s=this.in.Rt,h=this.in.Rt;let e=-1;if(this.NR)for(let s=0;s<this.NR.length;s++)this.NR[s]===(t<<8)+i&&(e=s);if(-1!==e&&this.xR){this.xR[e]&&this.xR[e]?.length===h||(this.xR[e]=new Int8Array(h));const t=this.xR[e];t&&this.in.Ut(this.packetSize-6,s,t)}return this.nb=-1,!0}if(this.nb===ht.Lu){const t=this.in.Dt,i=this.in.xt,s=this.in.st;let h=!1;for(let t=0;t<100;t++)if(this.sS[t]===i){h=!0;break}if(s<=1)for(let i=0;i<this.Tv;i++)if(this.Ov[i]===t){h=!0;break}if(!h&&0===this.cv)try{this.sS[this.hS]=i,this.hS=(this.hS+1)%100;const h=rt.Jt(this.in,this.packetSize-13),e=nt.filter(h);s>1?this.eD(7,e,K.Wl(K.Ul(t))):this.eD(3,e,K.Wl(K.Ul(t)))}catch(t){}return this.nb=-1,!0}if(this.nb===ht.ju){for(let t=0;t<this.LS.length;t++)this.LS[t]!==this.vS[t]&&(this.LS[t]=this.vS[t],await this.oD(t),this.tv=!0);return this.nb=-1,!0}if(this.nb===ht.eu){const t=this.in.Rt,i=this.in.Rt;return X.$t[t].model=v.model(i),this.nb=-1,!0}if(this.nb===ht.uu)return this.Qv=this.in.Mt,this.iv=!0,this.nb=-1,!0;if(this.nb===ht.Du)return 12===this.Gv&&(this.tv=!0),this.SM=this.in.st,this.nb=-1,!0;if(this.nb===ht.pu){if(this.eR=!0,this.$R=this.in.st,this.JR=this.in.st,this.QR=this.in.Rt,this.tM=this.in.st,this.iM=this.in.st,this.iM>=100){const t=128*this.$R+64,i=128*this.JR+64,s=this.Fx(this.GR,this.$R,this.JR)-this.QR,h=t-this.AR,e=s-this.mR,n=i-this.IR,r=0|Math.sqrt(h*h+n*n);this.ER=325.949*Math.atan2(e,r)&2047,this.gR=-325.949*Math.atan2(h,n)&2047,this.ER<128&&(this.ER=128),this.ER>383&&(this.ER=383)}return this.nb=-1,!0}if(this.nb===ht.hu)return this.Gv=this.in.st,this.tv=!0,this.sv=!0,this.nb=-1,!0;if(this.nb===ht.Tu){const t=this.in.Ft;let i;if(t.endsWith(':tradereq:')){const s=t.substring(0,t.indexOf(':'));i=K.Fl(s);let h=!1;for(let t=0;t<this.Tv;t++)if(this.Ov[t]===i){h=!0;break}h||0!==this.cv||this.eD(4,'wishes to trade with you.',s)}else if(t.endsWith(':duelreq:')){const s=t.substring(0,t.indexOf(':'));i=K.Fl(s);let h=!1;for(let t=0;t<this.Tv;t++)if(this.Ov[t]===i){h=!0;break}h||0!==this.cv||this.eD(8,'wishes to duel with you.',s)}else this.eD(0,t,'');return this.nb=-1,!0}if(this.nb===ht.su){const t=this.in.Rt,i=this.in.Rt,s=this.in.Rt,h=G.get(i);return X.$t[t].model=h.Ko(50),X.$t[t].Wc=h.Xo,X.$t[t].Yc=h.jo,X.$t[t].zoom=100*h.zo/s|0,this.nb=-1,!0}if(this.nb===ht.Jf){const t=this.in.Rt;return this.AD(t),-1!==this.Iv&&(this.Iv=-1,this.tv=!0,this.sv=!0),-1!==this.Ev&&(this.Ev=-1,this.iv=!0),this.Jv&&(this.Jv=!1,this.iv=!0),this.ev=t,this.bS=!1,this.nb=-1,!0}if(this.nb===ht.tu){const t=this.in.Rt,i=this.in.Rt,s=i>>10&31,h=i>>5&31,e=31&i;return X.$t[t].Nc=(s<<19)+(h<<11)+(e<<3),this.nb=-1,!0}if(this.nb===ht.Nu){for(let t=0;t<this.oM.length;t++){const i=this.oM[t];i&&(i.X_=-1)}for(let t=0;t<this.yM.length;t++){const i=this.yM[t];i&&(i.X_=-1)}return this.nb=-1,!0}if(this.nb===ht.iu){const t=this.in.Rt;return X.$t[t].hide=1===this.in.st,this.nb=-1,!0}if(this.nb===ht.Ou){this.Tv=this.packetSize/8|0;for(let t=0;t<this.Tv;t++)this.Ov[t]=this.in.Dt;return this.nb=-1,!0}if(this.nb===ht.Iu){this.eR=!1;for(let t=0;t<5;t++)this.dR[t]=!1;return this.nb=-1,!0}if(this.nb===ht.qf)return-1!==this.Iv&&(this.Iv=-1,this.tv=!0,this.sv=!0),-1!==this.Ev&&(this.Ev=-1,this.iv=!0),this.Jv&&(this.Jv=!1,this.iv=!0),this.ev=-1,this.bS=!1,this.nb=-1,!0;if(this.nb===ht.lu){const t=this.in.Rt;return X.$t[t].text=this.in.Ft,X.$t[t].an===this.Hv[this.Gv]&&(this.tv=!0),this.nb=-1,!0}if(this.nb===ht.xu){this.tv=!0;const t=this.in.st,i=this.in.xt,s=this.in.st;this.Dv[t]=i,this.Nv[t]=s,this.Pv[t]=1;for(let s=0;s<98;s++)i>=this.Fv[s]&&(this.Pv[t]=s+2);return this.nb=-1,!0}if(this.nb===ht.td){for(this.Ah=this.in.st,this.Ih=this.in.st;this.in.bt<this.packetSize;){const t=this.in.st;this.pD(this.in,t)}return this.nb=-1,!0}if(this.nb===ht.Ru)return 12===this.Gv&&(this.tv=!0),this.kM=this.in.Mt,this.nb=-1,!0;if(this.nb===ht.Au){const t=this.in.st,i=this.in.st,s=this.in.st,h=this.in.st;return this.dR[t]=!0,this.wR[t]=i,this.yR[t]=s,this.pR[t]=h,this.uR[t]=0,this.nb=-1,!0}if(this.nb===ht.yu){this.tv=!0;const t=this.in.Rt,i=X.$t[t];for(;this.in.bt<this.packetSize;){const t=this.in.st,s=this.in.Rt;let h=this.in.st;255===h&&(h=this.in.xt),i.gc&&i._c&&t>=0&&t<i.gc.length&&(i.gc[t]=s,i._c[t]=h)}return this.nb=-1,!0}if(this.nb===ht.gu)return this.Ck=!this.Ck,this.mD(this.in,this.packetSize),1===this.QS&&(this.QS=2,kt.Xg=this.GR,this.ID()),ii.Bi&&2===this.QS&&kt.Xg!==this.GR&&(this.qb?.bind(),this.vb?.mf(257,151,'Loading - please wait.',B.ar),this.vb?.mf(256,150,'Loading - please wait.',B.lr),this.qb?.draw(8,11),kt.Xg=this.GR,this.ID()),this.GR!==this.vR&&2===this.QS&&(this.vR=this.GR,this.sD(this.GR)),this.nb=-1,!0;await this.wD()}catch(t){console.log(t),await this.ix()}return!0};ID=()=>{try{this.vR=-1,this.ME.clear(),this.EM.clear(),this.IM.clear(),this.mM.clear(),O.ls(),this.Kx(),this.JS?.reset();for(let t=0;t<gt.Dm;t++)this.BR[t]?.reset();const t=new kt(gt.Nm,gt.Nm,this.Jg,this.Qg);kt.Bi=ii.Bi;const i=this.xR?.length??0;if(this.NR)for(let t=0;t<i;t++){const i=this.NR[t]>>8,s=255&this.NR[t];if(33===i&&s>=71&&s<=73){kt.Bi=!1;break}}if(ii.Bi?this.JS?.UE(this.GR):this.JS?.UE(0),this.NR&&this.xR){this.JO.Bt(et.wd);for(let s=0;s<i;s++){const i=64*(this.NR[s]>>8)-this.MR,h=64*(255&this.NR[s])-this.kR,e=this.xR[s];if(e){const s=new a(new Uint8Array(e)).xt,n=wt.read(s,e,e.length-4,4);t.y_(8*(this.SR-6),8*(this.RR-6),i,h,n)}else this.RR<800&&t.w_(h,i,64,64)}}if(this.NR&&this.DR){this.JO.Bt(et.wd);for(let s=0;s<i;s++){const i=this.DR[s];if(i){const h=new a(new Uint8Array(i)).xt,e=wt.read(h,i,i.length-4,4),n=64*(this.NR[s]>>8)-this.MR,r=64*(255&this.NR[s])-this.kR;t.p_(this.JS,this.EM,this.BR,e,n,r)}}}this.JO.Bt(et.wd),t.u_(this.JS,this.BR),this.qb?.bind(),this.JO.Bt(et.wd);for(let t=this.EM.head();t;t=this.EM.next())2===(this.Qg&&2&this.Qg[1][t.Ug][t.Bg])&&(t.Pg--,t.Pg<0&&t.et());for(let t=0;t<gt.Nm;t++)for(let i=0;i<gt.Nm;i++)this.dD(t,i);for(let t=this._M.head();t;t=this._M.next())this.Bm(t.A_,t.x,t.z,t.m_,t.angle,t.shape,t.an)}catch(t){}k.An?.clear(),O.ys(20)};AD=t=>{const i=X.$t[t];if(i.mc)for(let t=0;t<i.mc.length&&-1!==i.mc[t];t++){const s=X.$t[i.mc[t]];1===s.type&&this.AD(s.id),s.jc=0,s.Zc=0}};Wk=()=>{let t=0;for(let i=0;i<99;i++){const s=i+1;t+=s+300*Math.pow(2,s/7)|0,this.Fv[i]=t/4|0}};eD=(t,i,s)=>{0===t&&-1!==this.Qv&&(this.Uv=i,this.OT=0),-1===this.Ev&&(this.iv=!0);for(let t=99;t>0;t--)this.messageType[t]=this.messageType[t-1],this.iS[t]=this.iS[t-1],this.tS[t]=this.tS[t-1];ii._O&&0===t&&(i='['+(this.qO/30|0)+']: '+i),this.messageType[0]=t,this.iS[0]=s,this.tS[0]=i};oD=async t=>{const i=V.$t[t].kl;if(0!==i){const s=this.LS[t];if(1===i&&(1===s&&O.ds(.9),2===s&&O.ds(.8),3===s&&O.ds(.7),4===s&&O.ds(.6),G.Uo?.clear(),this.cb=!0),3===i){const t=this.wk;0===s&&(this.mk=256,Xt(256),this.wk=!0),1===s&&(this.mk=192,Xt(192),this.wk=!0),2===s&&(this.mk=128,Xt(128),this.wk=!0),3===s&&(this.mk=64,Xt(64),this.wk=!0),4===s&&(this.wk=!1),this.wk!==t&&(this.wk&&this.yk?await this.Sk(this.yk,this.pk,this.Ak,!1):zt(!1),this.dk=0)}4===i&&(0===s&&(this.lk=256,Vt(256),this.hk=!0),1===s&&(this.lk=192,Vt(192),this.hk=!0),2===s&&(this.lk=128,Vt(128),this.hk=!0),3===s&&(this.lk=64,Vt(64),this.hk=!0),4===s&&(this.hk=!1)),5===i&&(this.xS=s),6===i&&(this.nS=s),8===i&&(this.eS=s,this.iv=!0)}};ED=(t,i)=>{let s=0;for(let t=0;t<100;t++){if(!this.tS[t])continue;const h=this.messageType[t],e=this.Cv+70+4-14*s;if(e<-20)break;0===h&&s++,1!==h&&2!==h||!(1===h||0===this.Wv||1===this.Wv&&this.Zx(this.iS[t]))||(i>e-14&&i<=e&&this.vM&&this.iS[t]!==this.vM.name&&(this.PM&&(this.mv[this.Av]='Report abuse @whi@'+this.iS[t],this.DS[this.Av]=34,this.Av++),this.mv[this.Av]='Add ignore @whi@'+this.iS[t],this.DS[this.Av]=436,this.Av++,this.mv[this.Av]='Add friend @whi@'+this.iS[t],this.DS[this.Av]=406,this.Av++),s++),3!==h&&7!==h||0!==this.eS||!(7===h||0===this.Yv||1===this.Yv&&this.Zx(this.iS[t]))||(i>e-14&&i<=e&&(this.PM&&(this.mv[this.Av]='Report abuse @whi@'+this.iS[t],this.DS[this.Av]=34,this.Av++),this.mv[this.Av]='Add ignore @whi@'+this.iS[t],this.DS[this.Av]=436,this.Av++,this.mv[this.Av]='Add friend @whi@'+this.iS[t],this.DS[this.Av]=406,this.Av++),s++),4===h&&(0===this.Vv||1===this.Vv&&this.Zx(this.iS[t]))&&(i>e-14&&i<=e&&(this.mv[this.Av]='Accept trade @whi@'+this.iS[t],this.DS[this.Av]=903,this.Av++),s++),(5===h||6===h)&&0===this.eS&&this.Yv<2&&s++,8===h&&(0===this.Vv||1===this.Vv&&this.Zx(this.iS[t]))&&(i>e-14&&i<=e&&(this.mv[this.Av]='Accept duel @whi@'+this.iS[t],this.DS[this.Av]=363,this.Av++),s++)}};gD=t=>{if(0===this.eS)return;let i=0;0!==this.hb&&(i=1);for(let s=0;s<100;s++)if(null!==this.tS[s]){const h=this.messageType[s];if((3===h||7===h)&&(7===h||0===this.Yv||1===this.Yv&&this.Zx(this.iS[s]))){const h=329-13*i;if(this.gh>8&&this.gh<520&&t-11>h-10&&t-11<=h+3&&(this.PM&&(this.mv[this.Av]='Report abuse @whi@'+this.iS[s],this.DS[this.Av]=2034,this.Av++),this.mv[this.Av]='Add ignore @whi@'+this.iS[s],this.DS[this.Av]=2436,this.Av++,this.mv[this.Av]='Add friend @whi@'+this.iS[s],this.DS[this.Av]=2406,this.Av++),i++,i>=5)return}if((5===h||6===h)&&this.Yv<2&&(i++,i>=5))return}};_D=(t,i,s,h,e,n)=>{if(0!==t.type||!t.mc||t.hide||i<h||s<e||i>h+t.width||s>e+t.height||!t.Ic||!t.Ec)return;const r=t.mc.length;for(let o=0;o<r;o++){let r=t.Ic[o]+h,l=t.Ec[o]+e-n;const a=X.$t[t.mc[o]];if(r+=a.x,l+=a.y,(a.wc>=0||0!==a.Fc)&&i>=r&&s>=l&&i<r+a.width&&s<l+a.height&&(a.wc>=0?this.HS=a.wc:this.HS=a.id),0===a.type)this._D(a,i,s,r,l,a.zc),a.scroll>a.height&&this.vx(i,s,a.scroll,a.height,!0,r+a.width,l,a);else if(2===a.type){let t=0;for(let h=0;h<a.height;h++)for(let e=0;e<a.width;e++){let n=r+e*(a.Oc+32),o=l+h*(a.bc+32);if(t<20&&a.Lc&&a.vc&&(n+=a.Lc[t],o+=a.vc[t]),i<n||s<o||i>=n+32||s>=o+32){t++;continue}if(this.GS=t,this.BS=a.id,!a.gc||a.gc[t]<=0){t++;continue}const c=G.get(a.gc[t]-1);if(1===this.AS&&a.Cc)a.id===this.IS&&t===this.mS||(this.mv[this.Av]='Use '+this.gS+' with @lre@'+c.name,this.DS[this.Av]=881,this.NS[this.Av]=c.id,this.PS[this.Av]=t,this.US[this.Av]=a.id,this.Av++);else if(1===this.SS&&a.Cc)16&~this.MS||(this.mv[this.Av]=this.kS+' @lre@'+c.name,this.DS[this.Av]=391,this.NS[this.Av]=c.id,this.PS[this.Av]=t,this.US[this.Av]=a.id,this.Av++);else{if(a.Cc)for(let i=4;i>=3;i--)c.Ho&&c.Ho[i]?(this.mv[this.Av]=c.Ho[i]+' @lre@'+c.name,3===i?this.DS[this.Av]=478:4===i&&(this.DS[this.Av]=347),this.NS[this.Av]=c.id,this.PS[this.Av]=t,this.US[this.Av]=a.id,this.Av++):4===i&&(this.mv[this.Av]='Drop @lre@'+c.name,this.DS[this.Av]=347,this.NS[this.Av]=c.id,this.PS[this.Av]=t,this.US[this.Av]=a.id,this.Av++);if(a.Tc&&(this.mv[this.Av]='Use @lre@'+c.name,this.DS[this.Av]=188,this.NS[this.Av]=c.id,this.PS[this.Av]=t,this.US[this.Av]=a.id,this.Av++),a.Cc&&c.Ho)for(let i=2;i>=0;i--)c.Ho[i]&&(this.mv[this.Av]=c.Ho[i]+' @lre@'+c.name,0===i?this.DS[this.Av]=405:1===i?this.DS[this.Av]=38:2===i&&(this.DS[this.Av]=422),this.NS[this.Av]=c.id,this.PS[this.Av]=t,this.US[this.Av]=a.id,this.Av++);if(a.Mc)for(let i=4;i>=0;i--)a.Mc[i]&&(this.mv[this.Av]=a.Mc[i]+' @lre@'+c.name,0===i?this.DS[this.Av]=602:1===i?this.DS[this.Av]=596:2===i?this.DS[this.Av]=22:3===i?this.DS[this.Av]=892:4===i&&(this.DS[this.Av]=415),this.NS[this.Av]=c.id,this.PS[this.Av]=t,this.US[this.Av]=a.id,this.Av++);this.mv[this.Av]='Examine @lre@'+c.name,ii._O&&(this.mv[this.Av]+='@whi@ ('+c.id+')'),this.DS[this.Av]=1773,this.NS[this.Av]=c.id,a._c&&(this.US[this.Av]=a._c[t]),this.Av++}t++}}else if(i>=r&&s>=l&&i<r+a.width&&s<l+a.height)if(a.uc===X.Ql){let t=!1;0!==a.dc&&(t=this.CD(a)),!t&&a.Xc&&(this.mv[this.Av]=a.Xc,this.DS[this.Av]=951,this.US[this.Av]=a.id,this.Av++)}else if(a.uc===X.ta&&0===this.SS){let t=a.Vc;t&&-1!==t.indexOf(' ')&&(t=t.substring(0,t.indexOf(' '))),this.mv[this.Av]=t+' @gre@'+a.action,this.DS[this.Av]=930,this.US[this.Av]=a.id,this.Av++}else a.uc===X.ia?(this.mv[this.Av]='Close',this.DS[this.Av]=947,this.US[this.Av]=a.id,this.Av++):a.uc===X.sa&&a.Xc?(this.mv[this.Av]=a.Xc,this.DS[this.Av]=465,this.US[this.Av]=a.id,this.Av++):a.uc===X.ha&&a.Xc?(this.mv[this.Av]=a.Xc,this.DS[this.Av]=960,this.US[this.Av]=a.id,this.Av++):a.uc===X.ea&&!this.bS&&a.Xc&&(this.mv[this.Av]=a.Xc,this.DS[this.Av]=44,this.US[this.Av]=a.id,this.Av++)}};CD=t=>{let i=t.dc;return i>=X.na&&i<=X.la?(i>=X.oa?i-=X.oa:i--,this.mv[this.Av]='Remove @whi@'+this.JM[i],this.DS[this.Av]=557,this.Av++,this.mv[this.Av]='Message @whi@'+this.JM[i],this.DS[this.Av]=679,this.Av++,!0):i>=X.Ha&&i<=X.Wa&&(this.mv[this.Av]='Remove @whi@'+t.text,this.DS[this.Av]=556,this.Av++,!0)};TD=()=>{0===this.AS&&0===this.SS&&(this.mv[this.Av]='Walk here',this.DS[this.Av]=660,this.PS[this.Av]=this.gh,this.US[this.Av]=this._h,this.Av++);let t=-1;for(let i=0;i<v.Ch;i++){const s=v.Th[i],h=127&s,e=s>>7&127,n=s>>29&3,r=s>>14&32767;if(s!==t){if(t=s,2===n&&this.JS&&this.JS.ag(this.GR,h,e,s)>=0){const t=k.get(r);if(1===this.AS)this.mv[this.Av]='Use '+this.gS+' with @cya@'+t.name,this.DS[this.Av]=450,this.NS[this.Av]=s,this.PS[this.Av]=h,this.US[this.Av]=e,this.Av++;else if(1!==this.SS){if(t.gn)for(let i=4;i>=0;i--)t.gn[i]&&(this.mv[this.Av]=t.gn[i]+' @cya@'+t.name,0===i&&(this.DS[this.Av]=285),1===i&&(this.DS[this.Av]=504),2===i&&(this.DS[this.Av]=364),3===i&&(this.DS[this.Av]=581),4===i&&(this.DS[this.Av]=1501),this.NS[this.Av]=s,this.PS[this.Av]=h,this.US[this.Av]=e,this.Av++);this.mv[this.Av]='Examine @cya@'+t.name,ii._O&&(this.mv[this.Av]+='@whi@ ('+t.id+')'),this.DS[this.Av]=1175,this.NS[this.Av]=s,this.PS[this.Av]=h,this.US[this.Av]=e,this.Av++}else 4&~this.MS||(this.mv[this.Av]=this.kS+' @cya@'+t.name,this.DS[this.Av]=55,this.NS[this.Av]=s,this.PS[this.Av]=h,this.US[this.Av]=e,this.Av++)}if(1===n){const t=this.yM[r];if(t&&t.type&&1===t.type.size&&64==(127&t.x)&&64==(127&t.z))for(let i=0;i<this.pM;i++){const s=this.yM[this.AM[i]];s&&s!==t&&s.type&&1===s.type.size&&s.x===t.x&&s.z===t.z&&this.OD(s.type,this.AM[i],h,e)}t&&t.type&&this.OD(t.type,r,h,e)}if(0===n){const t=this.oM[r];if(t&&64==(127&t.x)&&64==(127&t.z)){for(let i=0;i<this.pM;i++){const s=this.yM[this.AM[i]];s&&s.type&&1===s.type.size&&s.x===t.x&&s.z===t.z&&this.OD(s.type,this.AM[i],h,e)}for(let i=0;i<this.lM;i++){const s=this.oM[this.aM[i]];s&&s!==t&&s.x===t.x&&s.z===t.z&&this.bD(s,this.aM[i],h,e)}}t&&this.bD(t,r,h,e)}if(3===n){const t=this.gM[this.GR][h][e];if(!t)continue;for(let i=t.ct();i;i=t.ht()){const t=G.get(i.index);if(1===this.AS)this.mv[this.Av]='Use '+this.gS+' with @lre@'+t.name,this.DS[this.Av]=217,this.NS[this.Av]=i.index,this.PS[this.Av]=h,this.US[this.Av]=e,this.Av++;else if(1!==this.SS){for(let s=4;s>=0;s--)t.gn&&t.gn[s]?(this.mv[this.Av]=t.gn[s]+' @lre@'+t.name,0===s&&(this.DS[this.Av]=224),1===s&&(this.DS[this.Av]=993),2===s&&(this.DS[this.Av]=99),3===s&&(this.DS[this.Av]=746),4===s&&(this.DS[this.Av]=877),this.NS[this.Av]=i.index,this.PS[this.Av]=h,this.US[this.Av]=e,this.Av++):2===s&&(this.mv[this.Av]='Take @lre@'+t.name,this.DS[this.Av]=99,this.NS[this.Av]=i.index,this.PS[this.Av]=h,this.US[this.Av]=e,this.Av++);this.mv[this.Av]='Examine @lre@'+t.name,ii._O&&(this.mv[this.Av]+='@whi@ ('+i.index+')'),this.DS[this.Av]=1102,this.NS[this.Av]=i.index,this.PS[this.Av]=h,this.US[this.Av]=e,this.Av++}else 1&~this.MS||(this.mv[this.Av]=this.kS+' @lre@'+t.name,this.DS[this.Av]=965,this.NS[this.Av]=i.index,this.PS[this.Av]=h,this.US[this.Av]=e,this.Av++)}}}}};OD=(t,i,s,h)=>{if(this.Av>=400)return;let e=t.name;if(0!==t.Tl&&this.vM&&(e=e+this.LD(this.vM.NC,t.Tl)+' (level-'+t.Tl+')'),1===this.AS)this.mv[this.Av]='Use '+this.gS+' with @yel@'+e,this.DS[this.Av]=900,this.NS[this.Av]=i,this.PS[this.Av]=s,this.US[this.Av]=h,this.Av++;else if(1!==this.SS){let n;if(t.gn)for(n=4;n>=0;n--)t.gn[n]&&'attack'!==t.gn[n]?.toLowerCase()&&(this.mv[this.Av]=t.gn[n]+' @yel@'+e,0===n?this.DS[this.Av]=728:1===n?this.DS[this.Av]=542:2===n?this.DS[this.Av]=6:3===n?this.DS[this.Av]=963:4===n&&(this.DS[this.Av]=245),this.NS[this.Av]=i,this.PS[this.Av]=s,this.US[this.Av]=h,this.Av++);if(t.gn)for(n=4;n>=0;n--)if(t.gn[n]&&'attack'===t.gn[n]?.toLowerCase()){let r=0;this.vM&&t.Tl>this.vM.NC&&(r=2e3),this.mv[this.Av]=t.gn[n]+' @yel@'+e,0===n?this.DS[this.Av]=r+728:1===n?this.DS[this.Av]=r+542:2===n?this.DS[this.Av]=r+6:3===n?this.DS[this.Av]=r+963:4===n&&(this.DS[this.Av]=r+245),this.NS[this.Av]=i,this.PS[this.Av]=s,this.US[this.Av]=h,this.Av++}this.mv[this.Av]='Examine @yel@'+e,ii._O&&(this.mv[this.Av]+='@whi@ ('+t.id+')'),this.DS[this.Av]=1607,this.NS[this.Av]=i,this.PS[this.Av]=s,this.US[this.Av]=h,this.Av++}else 2&~this.MS||(this.mv[this.Av]=this.kS+' @yel@'+e,this.DS[this.Av]=265,this.NS[this.Av]=i,this.PS[this.Av]=s,this.US[this.Av]=h,this.Av++)};bD=(t,i,s,h)=>{if(t===this.vM||this.Av>=400)return;let e=null;this.vM&&(e=t.name+this.LD(this.vM.NC,t.NC)+' (level-'+t.NC+')'),1===this.AS?(this.mv[this.Av]='Use '+this.gS+' with @whi@'+e,this.DS[this.Av]=367,this.NS[this.Av]=i,this.PS[this.Av]=s,this.US[this.Av]=h,this.Av++):1!==this.SS?(this.mv[this.Av]='Follow @whi@'+e,this.DS[this.Av]=1544,this.NS[this.Av]=i,this.PS[this.Av]=s,this.US[this.Av]=h,this.Av++,0===this.cv&&(this.mv[this.Av]='Trade with @whi@'+e,this.DS[this.Av]=1373,this.NS[this.Av]=i,this.PS[this.Av]=s,this.US[this.Av]=h,this.Av++),this.DM>0&&(this.mv[this.Av]='Attack @whi@'+e,this.vM&&this.vM.NC>=t.NC?this.DS[this.Av]=151:this.DS[this.Av]=2151,this.NS[this.Av]=i,this.PS[this.Av]=s,this.US[this.Av]=h,this.Av++),1===this.NM&&(this.mv[this.Av]='Fight @whi@'+e,this.DS[this.Av]=151,this.NS[this.Av]=i,this.PS[this.Av]=s,this.US[this.Av]=h,this.Av++),2===this.NM&&(this.mv[this.Av]='Duel-with @whi@'+e,this.DS[this.Av]=1101,this.NS[this.Av]=i,this.PS[this.Av]=s,this.US[this.Av]=h,this.Av++)):8&~this.MS||(this.mv[this.Av]=this.kS+' @whi@'+e,this.DS[this.Av]=651,this.NS[this.Av]=i,this.PS[this.Av]=s,this.US[this.Av]=h,this.Av++);for(let t=0;t<this.Av;t++)if(660===this.DS[t])return void(this.mv[t]='Walk here @whi@'+e)};LD=(t,i)=>{const s=t-i;return s<-9?'@red@':s<-6?'@or3@':s<-3?'@or2@':s<0?'@or1@':s>9?'@gre@':s>6?'@gr3@':s>3?'@gr2@':s>0?'@gr1@':'@yel@'};lx=()=>{if(0===this.uS){this.mv[0]='Cancel',this.DS[0]=1252,this.Av=1,this.gD(this._h),this.HS=0,this.gh>8&&this._h>11&&this.gh<520&&this._h<345&&(-1===this.ev?this.TD():this._D(X.$t[this.ev],this.gh,this._h,8,11,0)),this.HS!==this.oS&&(this.oS=this.HS),this.HS=0,this.gh>562&&this._h>231&&this.gh<752&&this._h<492&&(-1!==this.Iv?this._D(X.$t[this.Iv],this.gh,this._h,562,231,0):-1!==this.Hv[this.Gv]&&this._D(X.$t[this.Hv[this.Gv]],this.gh,this._h,562,231,0)),this.HS!==this.lS&&(this.tv=!0,this.lS=this.HS),this.HS=0,this.gh>22&&this._h>375&&this.gh<431&&this._h<471&&(-1===this.Ev?this.ED(this.gh-22,this._h-375):this._D(X.$t[this.Ev],this.gh,this._h,22,375,0)),-1!==this.Ev&&this.HS!==this.aS&&(this.iv=!0,this.aS=this.HS);let t=!1;for(;!t;){t=!0;for(let i=0;i<this.Av-1;i++)if(this.DS[i]<1e3&&this.DS[i+1]>1e3){const s=this.mv[i];this.mv[i]=this.mv[i+1],this.mv[i+1]=s;const h=this.DS[i];this.DS[i]=this.DS[i+1],this.DS[i+1]=h;const e=this.PS[i];this.PS[i]=this.PS[i+1],this.PS[i+1]=e;const n=this.US[i];this.US[i]=this.US[i+1],this.US[i+1]=n;const r=this.NS[i];this.NS[i]=this.NS[i+1],this.NS[i+1]=r,t=!1}}}};wx=()=>{let t=0;if(this.Sb){let i;t=this.Sb.pf('Choose Option');for(let s=0;s<this.Av;s++)i=this.Sb.pf(this.mv[s]),i>t&&(t=i)}t+=8;const i=15*this.Av+21;let s,h;this.bT>8&&this.LT>11&&this.bT<520&&this.LT<345&&(s=this.bT-(t/2|0)-8,s+t>512?s=512-t:s<0&&(s=0),h=this.LT-11,h+i>334?h=334-i:h<0&&(h=0),this.fv=!0,this.uv=0,this.dv=s,this.wv=h,this.yv=t,this.pv=15*this.Av+22),this.bT>562&&this.LT>231&&this.bT<752&&this.LT<492&&(s=this.bT-(t/2|0)-562,s<0?s=0:s+t>190&&(s=190-t),h=this.LT-231,h<0?h=0:h+i>261&&(h=261-i),this.fv=!0,this.uv=1,this.dv=s,this.wv=h,this.yv=t,this.pv=15*this.Av+22),this.bT>22&&this.LT>375&&this.bT<501&&this.LT<471&&(s=this.bT-(t/2|0)-22,s<0?s=0:s+t>479&&(s=479-t),h=this.LT-375,h<0?h=0:h+i>96&&(h=96-i),this.fv=!0,this.uv=2,this.dv=s,this.wv=h,this.yv=t,this.pv=15*this.Av+22)};Ax=(t,i,s,h,e,n,r,o,l,a,c)=>{const f=this.BR[this.GR];if(!f)return!1;const u=gt.Nm,d=gt.Nm;for(let t=0;t<u;t++)for(let i=0;i<d;i++){const s=gt.index(t,i);this.OM[s]=0,this.bM[s]=99999999}let w=t,y=i;const p=gt.index(t,i);this.OM[p]=99,this.bM[p]=0;let A=0,m=0;this.CM[A]=t,this.TM[A++]=i;let I=!1,E=this.CM.length;const g=f.flags;for(;m!==A;){if(w=this.CM[m],y=this.TM[m],m=(m+1)%E,w===s&&y===h){I=!0;break}if(l!==R.Be.id){if((l<R.Ve.id||l===R.Ze.id)&&f.Ym(w,y,s,h,l-1,o)){I=!0;break}if(l<R.Ze.id&&f.Vm(w,y,s,h,l-1,o)){I=!0;break}}if(0!==n&&0!==r&&f.Km(w,y,s,h,n,r,a)){I=!0;break}const t=this.bM[gt.index(w,y)]+1;let i=gt.index(w-1,y);w>0&&0===this.OM[i]&&(g[i]&It.bm)===It.OPEN&&(this.CM[A]=w-1,this.TM[A]=y,A=(A+1)%E,this.OM[i]=2,this.bM[i]=t),i=gt.index(w+1,y),w<u-1&&0===this.OM[i]&&(g[i]&It.Rm)===It.OPEN&&(this.CM[A]=w+1,this.TM[A]=y,A=(A+1)%E,this.OM[i]=8,this.bM[i]=t),i=gt.index(w,y-1),y>0&&0===this.OM[i]&&(g[i]&It.Om)===It.OPEN&&(this.CM[A]=w,this.TM[A]=y-1,A=(A+1)%E,this.OM[i]=1,this.bM[i]=t),i=gt.index(w,y+1),y<d-1&&0===this.OM[i]&&(g[i]&It.vm)===It.OPEN&&(this.CM[A]=w,this.TM[A]=y+1,A=(A+1)%E,this.OM[i]=4,this.bM[i]=t),i=gt.index(w-1,y-1),w>0&&y>0&&0===this.OM[i]&&!(g[i]&It.Lm)&&(g[gt.index(w-1,y)]&It.bm)===It.OPEN&&(g[gt.index(w,y-1)]&It.Om)===It.OPEN&&(this.CM[A]=w-1,this.TM[A]=y-1,A=(A+1)%E,this.OM[i]=3,this.bM[i]=t),i=gt.index(w+1,y-1),w<u-1&&y>0&&0===this.OM[i]&&!(g[i]&It.Mm)&&(g[gt.index(w+1,y)]&It.Rm)===It.OPEN&&(g[gt.index(w,y-1)]&It.Om)===It.OPEN&&(this.CM[A]=w+1,this.TM[A]=y-1,A=(A+1)%E,this.OM[i]=9,this.bM[i]=t),i=gt.index(w-1,y+1),w>0&&y<d-1&&0===this.OM[i]&&!(g[i]&It.Sm)&&(g[gt.index(w-1,y)]&It.bm)===It.OPEN&&(g[gt.index(w,y+1)]&It.vm)===It.OPEN&&(this.CM[A]=w-1,this.TM[A]=y+1,A=(A+1)%E,this.OM[i]=6,this.bM[i]=t),i=gt.index(w+1,y+1),w<u-1&&y<d-1&&0===this.OM[i]&&!(g[i]&It.km)&&(g[gt.index(w+1,y)]&It.Rm)===It.OPEN&&(g[gt.index(w,y+1)]&It.vm)===It.OPEN&&(this.CM[A]=w+1,this.TM[A]=y+1,A=(A+1)%E,this.OM[i]=12,this.bM[i]=t)}if(this.LM=0,!I){if(c){let t=100;for(let i=1;i<2;i++){for(let e=s-i;e<=s+i;e++)for(let s=h-i;s<=h+i;s++){const i=gt.index(e,s);e>=0&&s>=0&&e<gt.Nm&&s<gt.Nm&&this.bM[i]<t&&(t=this.bM[i],w=e,y=s,this.LM=1,I=!0)}if(I)break}}if(!I)return!1}m=0,this.CM[m]=w,this.TM[m++]=y;let _=this.OM[gt.index(w,y)],C=_;for(;w!==t||y!==i;)C!==_&&(_=C,this.CM[m]=w,this.TM[m++]=y),C&Et.un?w++:C&Et.cn&&w--,C&Et.fn?y++:C&Et.dn&&y--,C=this.OM[gt.index(w,y)];if(m>0){E=Math.min(m,25),m--;const t=this.CM[m],i=this.TM[m];if(ii._O&&1===this.vT[6]&&1===this.vT[7]){for(let t=0;t<this.gk.length;t++){const i=this.gk[t];if(i&&i.x===St.TE&&i.z===St.OE)return this.gk[t]=null,!1}return this.gk[this._k]=new At(this.GR,St.TE,St.OE),this._k=this._k+1&this.gk.length-1,!1}0===e?(this.JO.Bt(et.Pw),this.JO.p1(E+E+3)):1===e?(this.JO.Bt(et.Ow),this.JO.p1(E+E+3+14)):2===e&&(this.JO.Bt(et.Cw),this.JO.p1(E+E+3)),1===this.vT[5]?this.JO.p1(1):this.JO.p1(0),this.JO.p2(t+this.MR),this.JO.p2(i+this.kR),this.sR=this.CM[0],this.hR=this.TM[0];for(let s=1;s<E;s++)m--,this.JO.p1(this.CM[m]-t),this.JO.p1(this.TM[m]-i);return!0}return 1!==e};mD=(t,i)=>{this.fM=0,this.cM=0,this.vD(t),this.SD(t),this.RD(t,i),this.MD(t);for(let t=0;t<this.fM;t++){const i=this.dM[t],s=this.oM[i];s&&(s.Ji!==this.qO&&(this.oM[i]=null))}if(t.bt!==i)throw new Error(`eek! Error packet size mismatch in getplayer pos:${t.bt} psize:${i}`);for(let t=0;t<this.lM;t++)if(!this.oM[this.aM[t]])throw new Error(`eek! ${this.username} null entry in pl list - pos:${t} size:${this.lM}`)};vD=t=>{t.zt();if(0!==t.Zt(1)){const i=t.Zt(2);if(0===i)this.uM[this.cM++]=this.KO;else if(1===i){const i=t.Zt(3);this.vM?.step(!1,i);1===t.Zt(1)&&(this.uM[this.cM++]=this.KO)}else if(2===i){const i=t.Zt(3);this.vM?.step(!0,i);const s=t.Zt(3);this.vM?.step(!0,s);1===t.Zt(1)&&(this.uM[this.cM++]=this.KO)}else if(3===i){this.GR=t.Zt(2);const i=t.Zt(7),s=t.Zt(7),h=t.Zt(1);this.vM?.move(1===h,i,s);1===t.Zt(1)&&(this.uM[this.cM++]=this.KO)}}};SD=t=>{const i=t.Zt(8);if(i<this.lM)for(let t=i;t<this.lM;t++)this.dM[this.fM++]=this.aM[t];if(i>this.lM)throw new Error(`eek! ${this.username} Too many players`);this.lM=0;for(let s=0;s<i;s++){const i=this.aM[s],h=this.oM[i];if(0===t.Zt(1))this.aM[this.lM++]=i,h&&(h.Ji=this.qO);else{const s=t.Zt(2);if(0===s)this.aM[this.lM++]=i,h&&(h.Ji=this.qO),this.uM[this.cM++]=i;else if(1===s){this.aM[this.lM++]=i,h&&(h.Ji=this.qO);const s=t.Zt(3);h?.step(!1,s);1===t.Zt(1)&&(this.uM[this.cM++]=i)}else if(2===s){this.aM[this.lM++]=i,h&&(h.Ji=this.qO);const s=t.Zt(3);h?.step(!0,s);const e=t.Zt(3);h?.step(!0,e);1===t.Zt(1)&&(this.uM[this.cM++]=i)}else 3===s&&(this.dM[this.fM++]=i)}}};RD=(t,i)=>{let s;for(;t.Lt+10<8*i&&(s=t.Zt(11),2047!==s);){if(!this.oM[s]){this.oM[s]=new Ft;const t=this.wM[s];t&&this.oM[s]?.read(t)}this.aM[this.lM++]=s;const i=this.oM[s];i&&(i.Ji=this.qO);let h=t.Zt(5);h>15&&(h-=32);let e=t.Zt(5);e>15&&(e-=32);const n=t.Zt(1);this.vM&&i?.move(1===n,this.vM.fC[0]+h,this.vM.uC[0]+e);1===t.Zt(1)&&(this.uM[this.cM++]=s)}t.jt()};MD=t=>{for(let i=0;i<this.cM;i++){const s=this.uM[i],h=this.oM[s];if(!h)continue;let e=t.st;(e&Ft.bC)===Ft.bC&&(e+=t.st<<8),this.kD(h,s,e,t)}};kD=(t,i,s,h)=>{if(t.yC=s,t.pC=this.qO,(s&Ft.IC)===Ft.IC){const s=h.st,e=new Uint8Array(s),n=new a(e);h.Ut(s,0,e),this.wM[i]=n,t.read(n)}if((s&Ft.EC)===Ft.EC){let i=h.Rt;65535===i&&(i=-1),i===t.X_&&(t.q_=0);const s=h.st;(-1===i||-1===t.X_||I.$t[i].priority>I.$t[t.X_].priority||0===I.$t[t.X_].priority)&&(t.X_=i,t.z_=0,t.j_=0,t.Z_=s,t.q_=0)}if((s&Ft.gC)===Ft.gC&&(t.G_=h.Rt,65535===t.G_&&(t.G_=-1)),(s&Ft._C)===Ft._C&&(t.M_=h.Ft,t.x_=0,t.D_=0,t.k_=150,t.name&&this.eD(2,t.M_,t.name)),(s&Ft.CC)===Ft.CC&&(t.N_=h.st,t.P_=h.st,t.F_=this.qO+400,t.U_=h.st,t.B_=h.st),(s&Ft.TC)===Ft.TC&&(t.H_=h.Rt,t.W_=h.Rt,t.AC=t.H_,t.mC=t.W_),(s&Ft.OC)===Ft.OC){const i=h.Rt,s=h.st,e=h.st,n=h.bt;if(t.name){const n=K.Fl(t.name);let r=!1;if(s<=1)for(let t=0;t<this.Tv;t++)if(this.Ov[t]===n){r=!0;break}if(!r&&0===this.cv)try{const n=rt.Jt(h,e),r=nt.filter(n);t.M_=r,t.x_=i>>8,t.D_=255&i,t.k_=150,s>1?this.eD(1,r,t.name):this.eD(2,r,t.name)}catch(t){}}h.bt=n+e}if((s&Ft.LC)===Ft.LC){t.J_=h.Rt;const i=h.xt;t.sC=i>>16,t.iC=this.qO+(65535&i),t.Q_=0,t.tC=0,t.iC>this.qO&&(t.Q_=-1),65535===t.J_&&(t.J_=-1)}(s&Ft.vC)===Ft.vC&&(t.hC=h.st,t.nC=h.st,t.eC=h.st,t.rC=h.st,t.oC=h.Rt+this.qO,t.lC=h.Rt+this.qO,t.aC=h.st,t.pathLength=0,t.fC[0]=t.eC,t.uC[0]=t.rC)};yD=(t,i)=>{this.fM=0,this.cM=0,this.xD(t),this.DD(t,i),this.ND(t);for(let t=0;t<this.fM;t++){const i=this.dM[t],s=this.yM[i];s&&(s.Ji!==this.qO&&(s.type=null,this.yM[i]=null))}if(t.bt!==i)throw new Error(`eek! ${this.username} size mismatch in getnpcpos - pos:${t.bt} psize:${i}`);for(let t=0;t<this.pM;t++)if(!this.yM[this.AM[t]])throw new Error(`eek! ${this.username} null entry in npc list - pos:${t} size:${this.pM}`)};xD=t=>{t.zt();const i=t.Zt(8);if(i<this.pM)for(let t=i;t<this.pM;t++)this.dM[this.fM++]=this.AM[t];if(i>this.pM)throw new Error(`eek! ${this.username} Too many npcs`);this.pM=0;for(let s=0;s<i;s++){const i=this.AM[s],h=this.yM[i];if(0===t.Zt(1))this.AM[this.pM++]=i,h&&(h.Ji=this.qO);else{const s=t.Zt(2);if(0===s)this.AM[this.pM++]=i,h&&(h.Ji=this.qO),this.uM[this.cM++]=i;else if(1===s){this.AM[this.pM++]=i,h&&(h.Ji=this.qO);const s=t.Zt(3);h?.step(!1,s);1===t.Zt(1)&&(this.uM[this.cM++]=i)}else if(2===s){this.AM[this.pM++]=i,h&&(h.Ji=this.qO);const s=t.Zt(3);h?.step(!0,s);const e=t.Zt(3);h?.step(!0,e);1===t.Zt(1)&&(this.uM[this.cM++]=i)}else 3===s&&(this.dM[this.fM++]=i)}}};DD=(t,i)=>{for(;t.Lt+21<8*i;){const i=t.Zt(13);if(8191===i)break;this.yM[i]||(this.yM[i]=new Ut);const s=this.yM[i];this.AM[this.pM++]=i,s?(s.Ji=this.qO,s.type=H.get(t.Zt(11)),s.size=s.type.size,s.b_=s.type.Il,s.L_=s.type.El,s.v_=s.type.gl,s.S_=s.type._l,s.T_=s.type.ml):t.Zt(11);let h=t.Zt(5);h>15&&(h-=32);let e=t.Zt(5);e>15&&(e-=32),this.vM&&s?.move(!1,this.vM.fC[0]+h,this.vM.uC[0]+e);1===t.Zt(1)&&(this.uM[this.cM++]=i)}t.jt()};ND=t=>{for(let i=0;i<this.cM;i++){const s=this.uM[i],h=this.yM[s];if(!h)continue;const e=t.st;if(h.yC=e,h.pC=this.qO,(e&Ut.EC)===Ut.EC){let i=t.Rt;65535===i&&(i=-1),i===h.X_&&(h.q_=0);const s=t.st;(-1===i||-1===h.X_||I.$t[i].priority>I.$t[h.X_].priority||0===I.$t[h.X_].priority)&&(h.X_=i,h.z_=0,h.j_=0,h.Z_=s,h.q_=0)}if((e&Ut.gC)===Ut.gC&&(h.G_=t.Rt,65535===h.G_&&(h.G_=-1)),(e&Ut._C)===Ut._C&&(h.M_=t.Ft,h.k_=100),(e&Ut.CC)===Ut.CC&&(h.N_=t.st,h.P_=t.st,h.F_=this.qO+400,h.U_=t.st,h.B_=t.st),(e&Ut.YC)===Ut.YC&&(h.type=H.get(t.Rt),h.b_=h.type.Il,h.L_=h.type.El,h.v_=h.type.gl,h.S_=h.type._l,h.T_=h.type.ml),(e&Ut.LC)===Ut.LC){h.J_=t.Rt;const i=t.xt;h.sC=i>>16,h.iC=this.qO+(65535&i),h.Q_=0,h.tC=0,h.iC>this.qO&&(h.Q_=-1),65535===h.J_&&(h.J_=-1)}(e&Ut.TC)===Ut.TC&&(h.H_=t.Rt,h.W_=t.Rt,h.AC=h.H_,h.mC=h.W_)}};sx=()=>{for(let t=-1;t<this.lM;t++){let i;i=-1===t?this.KO:this.aM[t];const s=this.oM[i];s&&this.PD(s)}if(ii.kO++,ii.kO>1406){ii.kO=0,this.JO.Bt(et.kd),this.JO.p1(0);const t=this.JO.bt;this.JO.p1(162),this.JO.p1(22),2*Math.random()|0||this.JO.p1(84),this.JO.p2(31824),this.JO.p2(13490),2*Math.random()|0||this.JO.p1(123),2*Math.random()|0||this.JO.p1(134),this.JO.p1(100),this.JO.p1(94),this.JO.p2(35521),this.JO.Xt(this.JO.bt-t)}};PD=t=>{(t.x<128||t.z<128||t.x>=13184||t.z>=13184)&&(t.X_=-1,t.J_=-1,t.oC=0,t.lC=0,t.x=128*t.fC[0]+64*t.size,t.z=128*t.uC[0]+64*t.size,t.pathLength=0),t===this.vM&&(t.x<1536||t.z<1536||t.x>=11776||t.z>=11776)&&(t.X_=-1,t.J_=-1,t.oC=0,t.lC=0,t.x=128*t.fC[0]+64*t.size,t.z=128*t.uC[0]+64*t.size,t.pathLength=0),t.oC>this.qO?this.FD(t):t.lC>=this.qO?this.UD(t):this.BD(t),this.GD(t),this.HD(t)};Mx=()=>{if(this.vM){this.vM.x>>7===this.sR&&this.vM.z>>7===this.hR&&(this.sR=0);for(let t=-1;t<this.lM;t++){let i,s;if(-1===t?(i=this.vM,s=this.KO<<14):(i=this.oM[this.aM[t]],s=this.aM[t]<<14),!i||!i.isVisible())continue;i.Bi=(ii.Bi&&this.lM>50||this.lM>200)&&-1!==t&&i.Y_===i.T_;const h=i.x>>7,e=i.z>>7;if(!(h<0||h>=gt.Nm||e<0||e>=gt.Nm))if(!i.WC||this.qO<i.FC||this.qO>=i.UC){if(64==(127&i.x)&&64==(127&i.z)){if(this.jR[h][e]===this.iR)continue;this.jR[h][e]=this.iR}i.y=this.Fx(this.GR,i.x,i.z),this.JS?.tg(this.GR,i.x,i.y,i.z,null,i,s,i.IA,60,i.C_)}else i.Bi=!1,i.y=this.Fx(this.GR,i.x,i.z),this.JS?.ig(this.GR,i.x,i.y,i.z,i.VA,i.XA,i.KA,i.zA,null,i,s,i.IA)}}};hx=()=>{for(let t=0;t<this.pM;t++){const i=this.AM[t],s=this.yM[i];s&&s.type&&this.PD(s)}};kx=()=>{for(let t=0;t<this.pM;t++){const i=this.yM[this.AM[t]],s=536870912+(this.AM[t]<<14)|0;if(!i||!i.isVisible())continue;const h=i.x>>7,e=i.z>>7;if(!(h<0||h>=gt.Nm||e<0||e>=gt.Nm)){if(1===i.size&&64==(127&i.x)&&64==(127&i.z)){if(this.jR[h][e]===this.iR)continue;this.jR[h][e]=this.iR}this.JS?.tg(this.GR,i.x,this.Fx(this.GR,i.x,i.z),i.z,null,i,s,i.IA,64*(i.size-1)+60,i.C_)}}};xx=()=>{for(let t=this.mM.head();t;t=this.mM.next())if(t.level!==this.GR||this.qO>t.__)t.et();else if(this.qO>=t.jC){if(t.target>0){const i=this.yM[t.target-1];i&&t.QC(i.x,this.Fx(t.level,i.x,i.z)-t.offsetY,i.z,this.qO)}if(t.target<0){const i=-t.target-1;let s;s=i===this.MM?this.vM:this.oM[i],s&&t.QC(s.x,this.Fx(t.level,s.x,s.z)-t.offsetY,s.z,this.qO)}t.update(this.tR),this.JS?.tg(this.GR,0|t.x,0|t.y,0|t.z,null,t,-1,t.IA,60,!1)}};Dx=()=>{for(let t=this.IM.head();t;t=this.IM.next())t.level!==this.GR||t.tT?t.et():this.qO>=t.jC&&(t.update(this.tR),t.tT?t.et():this.JS?.tg(t.level,t.x,t.y,t.z,null,t,-1,0,60,!1))};Nx=()=>{for(let t=this.EM.head();t;t=this.EM.next()){let i=!1;if(t.Zc+=this.tR,-1===t.jc&&(t.jc=0,i=!0),t.vl.delay)for(;t.Zc>t.vl.delay[t.jc];)if(t.Zc-=t.vl.delay[t.jc]+1,t.jc++,i=!0,t.jc>=t.vl.ii&&(t.jc-=t.vl.hi,t.jc<0||t.jc>=t.vl.ii)){t.et(),i=!1;break}if(i&&this.JS){const i=t.Pg,s=t.Ug,h=t.Bg;let e=0;if(0===t.Fg?e=this.JS.ng(i,s,h):1===t.Fg?e=this.JS.rg(i,h,s):2===t.Fg?e=this.JS.og(i,s,h):3===t.Fg&&(e=this.JS.lg(i,s,h)),this.Jg&&0!==e&&(e>>14&32767)===t.index){const n=this.Jg[i][s][h],r=this.Jg[i][s+1][h],o=this.Jg[i][s+1][h+1],l=this.Jg[i][s][h+1],a=k.get(t.index);let c=-1;if(-1!==t.jc&&t.vl.frames&&(c=t.vl.frames[t.jc]),2===t.Fg){const t=this.JS.ag(i,s,h,e);let f=31&t;const u=t>>6;f===R.qe.id&&(f=R.Ze.id),this.JS?.hg(i,s,h,a.jn(f,u,n,r,o,l,c))}else if(1===t.Fg)this.JS?.ZE(i,s,h,a.jn(R.Ye.id,0,n,r,o,l,c));else if(0===t.Fg){const t=this.JS.ag(i,s,h,e),f=31&t,u=t>>6;if(f===R.He.id){const t=u+1&3;this.JS?.JE(s,h,i,a.jn(R.He.id,u+4,n,r,o,l,c),a.jn(R.He.id,t,n,r,o,l,c))}else this.JS?.$E(i,s,h,a.jn(f,u,n,r,o,l,c))}else if(3===t.Fg){const t=this.JS.ag(i,s,h,e)>>6;this.JS?.qE(i,s,h,a.jn(R.Ue.id,t,n,r,o,l,c))}}else t.et()}}};nx=()=>{for(let t=-1;t<this.lM;t++){let i;i=-1===t?this.KO:this.aM[t];const s=this.oM[i];s&&s.k_>0&&(s.k_--,0===s.k_&&(s.M_=null))}for(let t=0;t<this.pM;t++){const i=this.AM[t],s=this.yM[i];s&&s.k_>0&&(s.k_--,0===s.k_&&(s.M_=null))}};ox=()=>{if(2===this.QS){for(let t=this.ME.head();t;t=this.ME.next())this.qO>=t.__&&(this.Bm(t.A_,t.x,t.z,t.m_,t.angle,t.shape,t.an),t.et());ii.MO++,ii.MO>85&&(ii.MO=0,this.JO.Bt(et.Md))}};FD=t=>{const i=t.oC-this.qO,s=128*t.hC+64*t.size,h=128*t.nC+64*t.size;t.x+=(s-t.x)/i|0,t.z+=(h-t.z)/i|0,t.wC=0,0===t.aC&&(t.cC=1024),1===t.aC&&(t.cC=1536),2===t.aC&&(t.cC=0),3===t.aC&&(t.cC=512)};UD=t=>{if(t.lC===this.qO||-1===t.X_||0!==t.Z_||t.j_+1>I.$t[t.X_].delay[t.z_]){const i=t.lC-t.oC,s=this.qO-t.oC,h=128*t.hC+64*t.size,e=128*t.nC+64*t.size,n=128*t.eC+64*t.size,r=128*t.rC+64*t.size;t.x=(h*(i-s)+n*s)/i|0,t.z=(e*(i-s)+r*s)/i|0}t.wC=0,0===t.aC&&(t.cC=1024),1===t.aC&&(t.cC=1536),2===t.aC&&(t.cC=0),3===t.aC&&(t.cC=512),t.IA=t.cC};GD=t=>{if(-1!==t.G_&&t.G_<32768){const i=this.yM[t.G_];if(i){const s=t.x-i.x,h=t.z-i.z;0===s&&0===h||(t.cC=325.949*Math.atan2(s,h)&2047)}}if(t.G_>=32768){let i=t.G_-32768;i===this.MM&&(i=this.KO);const s=this.oM[i];if(s){const i=t.x-s.x,h=t.z-s.z;0===i&&0===h||(t.cC=325.949*Math.atan2(i,h)&2047)}}if((0!==t.H_||0!==t.W_)&&(0===t.pathLength||t.wC>0)){const i=t.x-64*(t.H_-this.MR-this.MR),s=t.z-64*(t.W_-this.kR-this.kR);0===i&&0===s||(t.cC=325.949*Math.atan2(i,s)&2047),t.H_=0,t.W_=0}const i=t.cC-t.IA&2047;if(0!==i&&(i<32||i>2016?t.IA=t.cC:i>1024?t.IA-=32:t.IA+=32,t.IA&=2047,t.Y_===t.T_&&t.IA!==t.cC)){if(-1!==t.O_)return void(t.Y_=t.O_);t.Y_=t.b_}};HD=t=>{let i;if(t.C_=!1,-1!==t.Y_&&(i=I.$t[t.Y_],t.K_++,i.delay&&t.V_<i.ii&&t.K_>i.delay[t.V_]&&(t.K_=0,t.V_++),t.V_>=i.ii&&(t.K_=0,t.V_=0)),-1!==t.X_&&0===t.Z_){for(i=I.$t[t.X_],t.j_++;i.delay&&t.z_<i.ii&&t.j_>i.delay[t.z_];)t.j_-=i.delay[t.z_],t.z_++;t.z_>=i.ii&&(t.z_-=i.hi,t.q_++,t.q_>=i.li&&(t.X_=-1),(t.z_<0||t.z_>=i.ii)&&(t.X_=-1)),t.C_=i.ni}if(t.Z_>0&&t.Z_--,-1!==t.J_&&this.qO>=t.iC){for(t.Q_<0&&(t.Q_=0),i=Y.$t[t.J_].vl,t.tC++;i&&i.delay&&t.Q_<i.ii&&t.tC>i.delay[t.Q_];)t.tC-=i.delay[t.Q_],t.Q_++;i&&t.Q_>=i.ii&&(t.Q_<0||t.Q_>=i.ii)&&(t.J_=-1)}};BD=t=>{if(t.Y_=t.T_,0===t.pathLength)return void(t.wC=0);if(-1!==t.X_&&0===t.Z_){if(!I.$t[t.X_].ei)return void t.wC++}const i=t.x,s=t.z,h=128*t.fC[t.pathLength-1]+64*t.size,e=128*t.uC[t.pathLength-1]+64*t.size;if(h-i<=256&&h-i>=-256&&e-s<=256&&e-s>=-256){t.cC=i<h?s<e?1280:s>e?1792:1536:i>h?s<e?768:s>e?256:512:s<e?1024:0;let n=t.cC-t.IA&2047;n>1024&&(n-=2048);let r=t.L_;n>=-256&&n<=256?r=t.b_:n>=256&&n<768?r=t.S_:n>=-768&&n<=-256&&(r=t.v_),-1===r&&(r=t.b_),t.Y_=r;let o=4;t.IA!==t.cC&&-1===t.G_&&(o=2),t.pathLength>2&&(o=6),t.pathLength>3&&(o=8),t.wC>0&&t.pathLength>1&&(o=8,t.wC--),t.dC[t.pathLength-1]&&(o<<=1),o>=8&&t.Y_===t.b_&&-1!==t.R_&&(t.Y_=t.R_),i<h?(t.x+=o,t.x>h&&(t.x=h)):i>h&&(t.x-=o,t.x<h&&(t.x=h)),s<e?(t.z+=o,t.z>e&&(t.z=e)):s>e&&(t.z-=o,t.z<e&&(t.z=e)),t.x===h&&t.z===e&&t.pathLength--}else t.x=h,t.z=e};Bx=()=>{let t=3;if(this.ER<310&&this.vM){let i=this.AR>>7,s=this.IR>>7;const h=this.vM.x>>7,e=this.vM.z>>7;let n,r,o,l;if(this.Qg&&4&this.Qg[this.GR][i][s]&&(t=this.GR),n=h>i?h-i:i-h,r=e>s?e-s:s-e,n>r)for(o=65536*r/n|0,l=32768;i!==h;)i<h?i++:i>h&&i--,this.Qg&&4&this.Qg[this.GR][i][s]&&(t=this.GR),l+=o,l>=65536&&(l-=65536,s<e?s++:s>e&&s--,this.Qg&&4&this.Qg[this.GR][i][s]&&(t=this.GR));else for(o=65536*n/r|0,l=32768;s!==e;)s<e?s++:s>e&&s--,this.Qg&&4&this.Qg[this.GR][i][s]&&(t=this.GR),l+=o,l>=65536&&(l-=65536,i<h?i++:i>h&&i--,this.Qg&&4&this.Qg[this.GR][i][s]&&(t=this.GR))}return this.vM&&this.Qg&&4&this.Qg[this.GR][this.vM.x>>7][this.vM.z>>7]&&(t=this.GR),t};Ux=()=>{if(!this.Qg)return 0;return this.Fx(this.GR,this.AR,this.IR)-this.mR>=800||!(4&this.Qg[this.GR][this.AR>>7][this.IR>>7])?3:this.GR};Fx=(t,i,s)=>{if(!this.Jg)return 0;const h=Math.min(i>>7,gt.Nm-1),e=Math.min(s>>7,gt.Nm-1);let n=t;t<3&&this.Qg&&!(2&~this.Qg[1][h][e])&&(n=t+1);const r=127&i,o=127&s;return(this.Jg[n][h][e]*(128-r)+this.Jg[n][h+1][e]*r>>7)*(128-o)+(this.Jg[n][h][e+1]*(128-r)+this.Jg[n][h+1][e+1]*r>>7)*o>>7};Px=(t,i,s,h,e,n)=>{const r=2048-e&2047,o=2048-h&2047;let l,a,c,f=0,u=0,d=n;0!==r&&(l=O.sin[r],a=O.cos[r],c=u*a-n*l>>16,d=u*l+n*a>>16,u=c),0!==o&&(l=O.sin[o],a=O.cos[o],c=d*l+f*a>>16,d=d*a-f*l>>16,f=c),this.AR=t-f,this.mR=i-u,this.IR=s-d,this.ER=e,this.gR=h};Cx=()=>{if(!this.vM)return;const t=this.vM.x+this.rR,i=this.vM.z+this.oR;(this.XR-t<-500||this.XR-t>500||this.zR-i<-500||this.zR-i>500)&&(this.XR=t,this.zR=i),this.XR!==t&&(this.XR+=(t-this.XR)/16|0),this.zR!==i&&(this.zR+=(i-this.zR)/16|0),1===this.vT[1]?this.VR+=(-this.VR-24)/2|0:1===this.vT[2]?this.VR+=(24-this.VR)/2|0:this.VR=this.VR/2|0,1===this.vT[3]?this.KR+=(12-this.KR)/2|0:1===this.vT[4]?this.KR+=(-this.KR-12)/2|0:this.KR=this.KR/2|0,this.YR=this.YR+this.VR/2&2047,this.WR+=this.KR/2|0,this.WR<128&&(this.WR=128),this.WR>383&&(this.WR=383);const s=this.XR>>7,h=this.zR>>7,e=this.Fx(this.GR,this.XR,this.zR);let n=0;if(this.Jg&&s>3&&h>3&&s<100&&h<100)for(let t=s-4;t<=s+4;t++)for(let i=h-4;i<=h+4;i++){let s=this.GR;s<3&&this.Qg&&!(2&~this.Qg[1][t][i])&&s++;const h=e-this.Jg[s][t][i];h>n&&(n=h)}let r=192*n;r>98048&&(r=98048),r<32768&&(r=32768),r>this._R?this._R+=(r-this._R)/24|0:r<this._R&&(this._R+=(r-this._R)/80|0)};Tx=()=>{let t=128*this.sM+64,i=128*this.hM+64,s=this.Fx(this.GR,this.sM,this.hM)-this.eM;this.AR<t&&(this.AR+=this.nM+((t-this.AR)*this.rM/1e3|0),this.AR>t&&(this.AR=t)),this.AR>t&&(this.AR-=this.nM+((this.AR-t)*this.rM/1e3|0),this.AR<t&&(this.AR=t)),this.mR<s&&(this.mR+=this.nM+((s-this.mR)*this.rM/1e3|0),this.mR>s&&(this.mR=s)),this.mR>s&&(this.mR-=this.nM+((this.mR-s)*this.rM/1e3|0),this.mR<s&&(this.mR=s)),this.IR<i&&(this.IR+=this.nM+((i-this.IR)*this.rM/1e3|0),this.IR>i&&(this.IR=i)),this.IR>i&&(this.IR-=this.nM+((this.IR-i)*this.rM/1e3|0),this.IR<i&&(this.IR=i)),t=128*this.$R+64,i=128*this.JR+64,s=this.Fx(this.GR,this.$R,this.JR)-this.QR;const h=t-this.AR,e=s-this.mR,n=i-this.IR,r=0|Math.sqrt(h*h+n*n);let o=325.949*Math.atan2(e,r)&2047;const l=-325.949*Math.atan2(h,n)&2047;o<128&&(o=128),o>383&&(o=383),this.ER<o&&(this.ER+=this.tM+((o-this.ER)*this.iM/1e3|0),this.ER>o&&(this.ER=o)),this.ER>o&&(this.ER-=this.tM+((this.ER-o)*this.iM/1e3|0),this.ER<o&&(this.ER=o));let a=l-this.gR;a>1024&&(a-=2048),a<-1024&&(a+=2048),a>0&&(this.gR+=this.tM+(a*this.iM/1e3|0),this.gR&=2047),a<0&&(this.gR-=this.tM+(-a*this.iM/1e3|0),this.gR&=2047);let c=l-this.gR;c>1024&&(c-=2048),c<-1024&&(c+=2048),(c<0&&a>0||c>0&&a<0)&&(this.gR=l)};pD=(t,i)=>{const s=t.st;let h=this.Ah+(s>>4&7),e=this.Ih+(7&s);if(i===ht.rd||i===ht.ld){const s=t.st,n=s>>2,r=3&s,o=R.of(n).an;let l;if(l=i===ht.ld?-1:t.Rt,h>=0&&e>=0&&h<gt.Nm&&e<gt.Nm){let t=null;for(let i=this._M.head();i;i=this._M.next())if(i.A_===this.GR&&i.x===h&&i.z===e&&i.an===o){t=i;break}if(!t&&this.JS){let i=0,s=-1,n=0,r=0;if(o===S.Ne?i=this.JS.ng(this.GR,h,e):o===S.Pe?i=this.JS.rg(this.GR,e,h):o===S.Fe?i=this.JS.og(this.GR,h,e):o===S.Ue&&(i=this.JS.lg(this.GR,h,e)),0!==i){const t=this.JS.ag(this.GR,h,e,i);s=i>>14&32767,n=31&t,r=t>>6}t=new xt(this.GR,o,h,e,0,M.cn,R.Be.id,s,r,n),this._M.rt(t)}t&&(t.m_=l,t.shape=n,t.angle=r),this.Bm(this.GR,h,e,l,r,n,o)}}else if(i===ht.hd){const i=t.st>>2,s=R.of(i).an,n=t.Rt;if(h>=0&&e>=0&&h<gt.Nm&&e<gt.Nm&&this.JS){let t=0;if(s===S.Ne?t=this.JS.ng(this.GR,h,e):s===S.Pe?t=this.JS.rg(this.GR,e,h):s===S.Fe?t=this.JS.og(this.GR,h,e):s===S.Ue&&(t=this.JS.lg(this.GR,h,e)),0!==t){const i=new Mt(t>>14&32767,this.GR,s,h,e,I.$t[n],!1);this.EM.rt(i)}}}else if(i===ht.ud){const i=t.Rt,s=t.Rt;if(h>=0&&e>=0&&h<gt.Nm&&e<gt.Nm){const t=new Bt(i,s);this.gM[this.GR][h][e]||(this.gM[this.GR][h][e]=new o),this.gM[this.GR][h][e]?.rt(t),this.dD(h,e)}}else if(i===ht.ed){const i=t.Rt;if(h>=0&&e>=0&&h<gt.Nm&&e<gt.Nm){const t=this.gM[this.GR][h][e];if(t){for(let s=t.head();s;s=t.next())if(s.index===(32767&i)){s.et();break}t.head()||(this.gM[this.GR][h][e]=null),this.dD(h,e)}}}else if(i===ht.od){let i=h+t.St,s=e+t.St;const n=t.Mt,r=t.Rt,o=t.st,l=t.st,a=t.Rt,c=t.Rt,f=t.st,u=t.st;if(h>=0&&e>=0&&h<gt.Nm&&e<gt.Nm&&i>=0&&s>=0&&i<gt.Nm&&s<gt.Nm){h=128*h+64,e=128*e+64,i=128*i+64,s=128*s+64;const t=new Gt(r,this.GR,h,this.Fx(this.GR,h,e)-o,e,a+this.qO,c+this.qO,f,u,n,l);t.QC(i,this.Fx(this.GR,i,s)-l,s,a+this.qO),this.mM.rt(t)}}else if(i===ht.fd){const i=t.Rt,s=t.st,n=t.Rt;if(h>=0&&e>=0&&h<gt.Nm&&e<gt.Nm){h=128*h+64,e=128*e+64;const t=new Ht(i,this.GR,h,e,this.Fx(this.GR,h,e)-s,this.qO,n);this.IM.rt(t)}}else if(i===ht.nd){const i=t.Rt,s=t.Rt,n=t.Rt;if(h>=0&&e>=0&&h<gt.Nm&&e<gt.Nm&&n!==this.MM){const t=new Bt(i,s);this.gM[this.GR][h][e]||(this.gM[this.GR][h][e]=new o),this.gM[this.GR][h][e]?.rt(t),this.dD(h,e)}}else if(i===ht.sd){const i=t.st,s=i>>2,n=3&i,r=R.of(s).an,o=t.Rt,l=t.Rt,a=t.Rt,c=t.Rt;let f,u=t.St,d=t.St,w=t.St,y=t.St;if(f=c===this.MM?this.vM:this.oM[c],f&&this.Jg){const t=new Dt(this.GR,r,h,e,-1,n,s,l+this.qO);this.ME.rt(t);const i=new Dt(this.GR,r,h,e,o,n,s,a+this.qO);this.ME.rt(i);const c=this.Jg[this.GR][h][e],p=this.Jg[this.GR][h+1][e],A=this.Jg[this.GR][h+1][e+1],m=this.Jg[this.GR][h][e+1],I=k.get(o);f.FC=l+this.qO,f.UC=a+this.qO,f.WC=I.jn(s,n,c,p,A,m,-1);let E,g=I.width,_=I.length;n!==M.fn&&n!==M.dn||(g=I.length,_=I.width),f.BC=128*h+64*g,f.HC=128*e+64*_,f.GC=this.Fx(this.GR,f.BC,f.HC),u>w&&(E=u,u=w,w=E),d>y&&(E=d,d=y,y=E),f.VA=h+u,f.KA=h+w,f.XA=e+d,f.zA=e+y}}else if(i===ht.ad){const i=t.Rt,s=t.Rt,n=t.Rt;if(h>=0&&e>=0&&h<gt.Nm&&e<gt.Nm){const t=this.gM[this.GR][h][e];if(t){for(let h=t.head();h;h=t.next())if(h.index===(32767&i)&&h.count===s){h.count=n;break}this.dD(h,e)}}}};Yx=t=>{if(!ii.Bi){if(O.Qi[17]>=t){const t=O.Wi[17];if(!t)return;const i=t.width*t.height-1,s=t.width*this.tR*2,h=t.di,e=this.UR;for(let t=0;t<=i;t++)e[t]=h[t-s&i];t.di=e,this.UR=h,O.ws(17)}if(O.Qi[24]>=t){const t=O.Wi[24];if(!t)return;const i=t.width*t.height-1,s=t.width*this.tR*2,h=t.di,e=this.UR;for(let t=0;t<=i;t++)e[t]=h[t-s&i];t.di=e,this.UR=h,O.ws(24)}}};Zk=()=>{if(!(this.Fb&&this.Ub&&this.Pb&&this.Yb))return;for(let t=10;t<117;t++){(100*Math.random()|0)<50&&(this.Fb[t+32512]=255)}for(let t=0;t<100;t++){const t=2+(124*Math.random()|0)+(128+(128*Math.random()|0)<<7);this.Fb[t]=192}for(let t=1;t<255;t++)for(let i=1;i<127;i++){const s=i+(t<<7);this.Ub[s]=(this.Fb[s-1]+this.Fb[s+1]+this.Fb[s-128]+this.Fb[s+128])/4|0}this.Vb+=128,this.Vb>this.Pb.length&&(this.Vb-=this.Pb.length,this.$k(this.Mb[12*Math.random()|0]));for(let t=1;t<255;t++)for(let i=1;i<127;i++){const s=i+(t<<7);let h=this.Ub[s+128]-(this.Pb[s+this.Vb&this.Pb.length-1]/5|0);h<0&&(h=0),this.Fb[s]=h}for(let t=0;t<255;t++)this.Yb[t]=this.Yb[t+1];if(this.Yb[255]=16*Math.sin(this.qO/14)+14*Math.sin(this.qO/15)+12*Math.sin(this.qO/16)|0,this.Kb>0&&(this.Kb-=4),this.Xb>0&&(this.Xb-=4),0===this.Kb&&0===this.Xb){const t=2e3*Math.random()|0;0===t?this.Kb=1024:1===t&&(this.Xb=1024)}};WD=(t,i,s)=>{const h=256-i;return((16711935&t)*h+(16711935&s)*i&4278255360)+((65280&t)*h+(65280&s)*i&16711680)>>8};qk=()=>{if(!(this.Bb&&this.Gb&&this.Hb&&this.Wb&&this.Yb&&this.Fb))return;const t=256;if(this.Kb>0)for(let t=0;t<256;t++)this.Kb>768?this.Bb[t]=this.WD(this.Gb[t],1024-this.Kb,this.Hb[t]):this.Kb>256?this.Bb[t]=this.Hb[t]:this.Bb[t]=this.WD(this.Hb[t],256-this.Kb,this.Gb[t]);else if(this.Xb>0)for(let t=0;t<256;t++)this.Xb>768?this.Bb[t]=this.WD(this.Gb[t],1024-this.Xb,this.Wb[t]):this.Xb>256?this.Bb[t]=this.Wb[t]:this.Bb[t]=this.WD(this.Wb[t],256-this.Xb,this.Gb[t]);else for(let t=0;t<256;t++)this.Bb[t]=this.Gb[t];for(let t=0;t<33920;t++)this.Ab&&this.xb&&(this.Ab.di[t]=this.xb.di[t]);let i=0,s=1152;for(let h=1;h<255;h++){let e=(this.Yb[h]*(t-h)/t|0)+22;e<0&&(e=0),i+=e;for(let t=e;t<128;t++){let t=this.Fb[i++];if(0===t)s++;else{const i=t,h=256-t;if(t=this.Bb[t],this.Ab){const e=this.Ab.di[s];this.Ab.di[s++]=((16711935&t)*i+(16711935&e)*h&4278255360)+((65280&t)*i+(65280&e)*h&16711680)>>8}}}s+=e}this.Ab?.draw(0,0);for(let t=0;t<33920;t++)this.mb&&this.Db&&(this.mb.di[t]=this.Db.di[t]);i=0,s=1176;for(let h=1;h<255;h++){const e=this.Yb[h]*(t-h)/t|0,n=103-e;s+=e;for(let t=0;t<n;t++){let t=this.Fb[i++];if(0===t)s++;else{const i=t,h=256-t;if(t=this.Bb[t],this.mb){const e=this.mb.di[s];this.mb.di[s++]=((16711935&t)*i+(16711935&e)*h&4278255360)+((65280&t)*i+(65280&e)*h&16711680)>>8}}}i+=128-n,s+=128-n-e}this.mb?.draw(661,0)}}})(),h=h.default})()));