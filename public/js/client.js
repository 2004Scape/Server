!function(t,i){'object'==typeof exports&&'object'==typeof module?module.exports=i():'function'==typeof define&&define.amd?define("Game",[],i):'object'==typeof exports?exports.Game=i():t.Game=i()}(self,(()=>(()=>{"use strict";var t={227:(t,i,s)=>{t.exports=s.p+"9f86b5397894e28b5ae2.wasm"}},i={};function s(h){var e=i[h];if(void 0!==e)return e.exports;var n=i[h]={exports:{}};return t[h](n,n.exports,s),n.exports}s.m=t,s.d=(t,i)=>{for(var h in i)s.o(i,h)&&!s.o(t,h)&&Object.defineProperty(t,h,{enumerable:!0,get:i[h]})},s.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),s.p="/",s.b=document.baseURI||self.location.href;var h={};return(()=>{s.d(h,{"default":()=>Qt});class t{id;tt=null;constructor(t){this.id=t}it(t){for(;;){const i=t.st;if(0===i)break;this.decode(i,t)}return this}}const i=async t=>new Promise((i=>setTimeout(i,t))),e=async t=>new Int8Array(await(await fetch(t)).arrayBuffer());function n(t,i,s,h,e){for(;e--;)s[h++]=t[i++]}class r{key;next;ht;constructor(){this.key=0n,this.next=this,this.ht=this}et(){this.ht&&this.next&&(this.ht.next=this.next,this.next.ht=this.ht,this.next=null,this.ht=null)}}class o{nt;cursor=null;constructor(){const t=new r;t.next=t,t.ht=t,this.nt=t}rt(t){t.ht&&t.et(),t.ht=this.nt.ht,t.next=this.nt,t.ht&&(t.ht.next=t),t.next.ht=t}ot(t){t.ht&&t.et(),t.ht=this.nt,t.next=this.nt.next,t.ht.next=t,t.next&&(t.next.ht=t)}lt(){const t=this.nt.next;return t===this.nt?null:(t?.et(),t)}head(){const t=this.nt.next;return t===this.nt?(this.cursor=null,null):(this.cursor=t?.next||null,t)}ct(){const t=this.nt.ht;return t===this.nt?(this.cursor=null,null):(this.cursor=t?.ht||null,t)}next(){const t=this.cursor;return t===this.nt?(this.cursor=null,null):(this.cursor=t?.next||null,t)}ht(){const t=this.cursor;return t===this.nt?(this.cursor=null,null):(this.cursor=t?.ht||null,t)}clear(){for(;;){const t=this.nt.next;if(t===this.nt)return;t?.et()}}}class l extends r{ft;ut;constructor(){super(),this.ft=this,this.ut=this}dt(){this.ut&&this.ft&&(this.ut.ft=this.ft,this.ft.ut=this.ut,this.ft=null,this.ut=null)}}class a extends l{static wt=3988292384;static yt=new Int32Array(256);static At=new Uint32Array(33);static It=new o;static Et=new o;static gt=new o;static _t=0;static Ct=0;static Tt=0;static{for(let t=0;t<32;t++)a.At[t]=(1<<t)-1;a.At[32]=4294967295;for(let t=0;t<256;t++){let i=t;for(let t=0;t<8;t++)1&~i?i>>>=1:i=i>>>1^a.wt;a.yt[t]=i}}static Ot=t=>{let i=4294967295;for(let s=0;s<t.length;s++)i=i>>>8^a.yt[255&(i^t[s])];return~i};view;data;bt=0;Lt=0;random=null;constructor(t){if(!t)throw new Error('Input src packet array was null!');super(),t instanceof Int8Array?this.data=new Uint8Array(t):this.data=t,this.view=new DataView(this.data.buffer,this.data.byteOffset,this.data.byteLength)}get length(){return this.view.byteLength}get available(){return this.length-this.bt}static vt=t=>{let i=null;return 0===t&&a._t>0?(a._t--,i=a.It.lt()):1===t&&a.Ct>0?(a.Ct--,i=a.Et.lt()):2===t&&a.Tt>0&&(a.Tt--,i=a.gt.lt()),i?(i.bt=0,i):new a(0===t?new Uint8Array(100):1===t?new Uint8Array(5e3):new Uint8Array(3e4))};release(){this.bt=0,100===this.view.byteLength&&a._t<1e3?(a.It.rt(this),a._t++):5e3===this.view.byteLength&&a.Ct<250?(a.Et.rt(this),a.Ct++):3e4===this.view.byteLength&&a.Tt<50&&(a.gt.rt(this),a.Tt++)}get st(){return this.view.getUint8(this.bt++)}get Rt(){return this.view.getInt8(this.bt++)}get St(){const t=this.view.getUint16(this.bt);return this.bt+=2,t}get Mt(){const t=this.view.getInt16(this.bt);return this.bt+=2,t}get xt(){const t=this.view.getUint8(this.bt++)<<16|this.view.getUint16(this.bt);return this.bt+=2,t}get kt(){const t=this.view.getInt32(this.bt);return this.bt+=4,t}get Dt(){const t=this.view.getBigInt64(this.bt);return this.bt+=8,t}get Nt(){return this.view.getUint8(this.bt)<128?this.st-64:this.St-49152}get Pt(){return this.view.getUint8(this.bt)<128?this.st:this.St-32768}get Ft(){const t=this.view,i=t.byteLength;let s,h='';for(;10!==(s=t.getUint8(this.bt++))&&this.bt<i;)h+=String.fromCharCode(s);return h}Ut(t,i,s){const h=this.view,e=i+t;for(let t=i;t<e;t++)s[t]=h.getUint8(this.bt++)}Bt(t){this.view.setUint8(this.bt++,t+(this.random?.Gt??0)&255)}p1(t){this.view.setUint8(this.bt++,t)}p2(t){this.view.setUint16(this.bt,t),this.bt+=2}Ht(t){this.view.setUint16(this.bt,t,!0),this.bt+=2}p3(t){this.view.setUint8(this.bt++,t>>16),this.view.setUint16(this.bt,t),this.bt+=2}p4(t){this.view.setInt32(this.bt,t),this.bt+=4}Wt(t){this.view.setInt32(this.bt,t,!0),this.bt+=4}Yt(t){this.view.setBigInt64(this.bt,t),this.bt+=8}Vt(t){const i=this.view,s=t.length;for(let h=0;h<s;h++)i.setUint8(this.bt++,t.charCodeAt(h));i.setUint8(this.bt++,10)}Kt(t,i,s){const h=this.view,e=s+i;for(let i=s;i<e;i++)h.setUint8(this.bt++,t[i])}Xt(t){this.view.setUint8(this.bt-t-1,t)}jt(){this.Lt=8*this.bt}zt(){this.bt=(this.Lt+7)/8|0}Zt(t){let i=this.Lt>>>3,s=8-(7&this.Lt),h=0;for(this.Lt+=t;t>s;s=8)h+=(this.view.getUint8(i++)&a.At[s])<<t-s,t-=s;return h+=t===s?this.view.getUint8(i)&a.At[s]:this.view.getUint8(i)>>>s-t&a.At[t],h}qt(t,i){const s=this.bt;this.bt=0;const h=new Uint8Array(s);this.Ut(s,0,h);const e=function(t){const i=[];for(;t>0n;)i.unshift(Number(0xffn&t)),t>>=8n;return 128&i[0]&&i.unshift(0),new Uint8Array(i)}(function(t,i,s){let h=1n;for(;i>0n;)i%2n===1n&&(h=h*t%s),t=t*t%s,i>>=1n;return h}(function(t){let i=0n;for(let s=0;s<t.length;s++)i=i<<8n|BigInt(t[s]);return i}(h),i,t));this.bt=0,this.p1(e.length),this.Kt(e,e.length,0)}}class c extends Array{constructor(t,i){super(t);for(let s=0;s<t;s++)this[s]=i}}class f extends Array{constructor(t,i,s){super(t);for(let h=0;h<t;h++){this[h]=new Array(i);for(let t=0;t<i;t++)this[h][t]=s}}}class u extends Array{constructor(t,i,s,h){super(t);for(let e=0;e<t;e++){this[e]=new Array(i);for(let t=0;t<i;t++){this[e][t]=new Array(s);for(let i=0;i<s;i++)this[e][t][i]=h}}}}class d extends Array{constructor(t,i,s,h,e){super(t);for(let n=0;n<t;n++){this[n]=new Array(i);for(let t=0;t<i;t++){this[n][t]=new Array(s);for(let i=0;i<s;i++){this[n][t][i]=new Array(h);for(let s=0;s<h;s++)this[n][t][i][s]=e}}}}}class w extends Array{constructor(t,i,s){super(t);for(let h=0;h<t;h++){this[h]=new Array(i);for(let t=0;t<i;t++)this[h][t]=new Uint8Array(s)}}}class y extends Array{constructor(t,i){super(t);for(let s=0;s<t;s++)this[s]=new Int32Array(i)}}class A extends Array{constructor(t,i,s){super(t);for(let h=0;h<t;h++){this[h]=new Array(i);for(let t=0;t<i;t++)this[h][t]=new Int32Array(s)}}}class p{static $t=[];static Jt=t=>{const i=new a(t.read('base_head.dat')),s=new a(t.read('base_type.dat')),h=new a(t.read('base_label.dat')),e=i.St;i.bt+=2;for(let t=0;t<e;t++){const t=i.St,e=i.st,n=new Uint8Array(e),r=new c(e,null);for(let t=0;t<e;t++){n[t]=s.st;const i=h.st,e=new Uint8Array(i);for(let t=0;t<i;t++)e[t]=h.st;r[t]=e}this.$t[t]=new p,this.$t[t].length=e,this.$t[t].types=n,this.$t[t].labels=r}};length=0;types=null;labels=null}class m{static $t=[];static Jt=t=>{const i=new a(t.read('frame_head.dat')),s=new a(t.read('frame_tran1.dat')),h=new a(t.read('frame_tran2.dat')),e=new a(t.read('frame_del.dat')),n=i.St;i.bt+=2;const r=new Int32Array(500),o=new Int32Array(500),l=new Int32Array(500),c=new Int32Array(500);for(let t=0;t<n;t++){const t=i.St,n=this.$t[t]=new m;n.delay=e.st;const a=i.St,f=p.$t[a];n.Qt=f;const u=i.st;let d=-1,w=0;for(let t=0;t<u;t++){if(!f.types)throw new Error('SeqBase not loaded!!!');const i=s.st;if(i>0){if(0!==f.types[t])for(let i=t-1;i>d;i--)if(0===f.types[i]){r[w]=i,o[w]=0,l[w]=0,c[w]=0,w++;break}r[w]=t;let s=0;3===f.types[r[w]]&&(s=128),o[w]=1&i?h.Nt:s,l[w]=2&i?h.Nt:s,c[w]=4&i?h.Nt:s,d=t,w++}}n.length=w,n.ti=new Int32Array(w),n.x=new Int32Array(w),n.y=new Int32Array(w),n.z=new Int32Array(w);for(let t=0;t<w;t++)n.ti[t]=r[t],n.x[t]=o[t],n.y[t]=l[t],n.z[t]=c[t]}};delay=0;Qt=null;length=0;ti=null;x=null;y=null;z=null}class I extends t{static count=0;static $t=[];static Jt=t=>{const i=new a(t.read('seq.dat'));this.count=i.St;for(let t=0;t<this.count;t++){const s=new I(t).it(i);0===s.ii&&(s.ii=1,s.frames=new Int16Array(1),s.frames[0]=-1,s.si=new Int16Array(1),s.si[0]=-1,s.delay=new Int16Array(1),s.delay[0]=-1),this.$t[t]=s}};ii=0;frames=null;si=null;delay=null;hi=-1;ei=null;ni=!1;priority=5;ri=-1;oi=-1;li=99;duration=0;decode(t,i){if(1===t){this.ii=i.st,this.frames=new Int16Array(this.ii),this.si=new Int16Array(this.ii),this.delay=new Int16Array(this.ii);for(let t=0;t<this.ii;t++)this.frames[t]=i.St,this.si[t]=i.St,65535===this.si[t]&&(this.si[t]=-1),this.delay[t]=i.St,0===this.delay[t]&&(this.delay[t]=m.$t[this.frames[t]].delay),0===this.delay[t]&&(this.delay[t]=1),this.duration+=this.delay[t]}else if(2===t)this.hi=i.St;else if(3===t){const t=i.st;this.ei=new Int32Array(t+1);for(let s=0;s<t;s++)this.ei[s]=i.st;this.ei[t]=9999999}else if(4===t)this.ni=!0;else if(5===t)this.priority=i.st;else if(6===t)this.ri=i.St;else if(7===t)this.oi=i.St;else{if(8!==t)throw new Error(`Unrecognized seq config code: ${t}`);this.li=i.st}}}class E{head;constructor(){this.head=new l}push(t){t.ut&&t.dt(),t.ut=this.head.ut,t.ft=this.head,t.ut&&(t.ut.ft=t),t.ft.ut=t}pop(){const t=this.head.ft;return t===this.head?null:(t?.dt(),t)}}class g{ai;ci;constructor(t){this.ci=[],this.ai=t;for(let i=0;i<t;i++)this.ci[i]=new r}get(t){const i=this.ci[Number(t&BigInt(this.ai-1))];if(!i.next)return null;for(let s=i.next;s!==i;s=s.next)if(s&&s.key===t)return s;return null}put(t,i){i.ht&&i.et();const s=this.ci[Number(t&BigInt(this.ai-1))];i.ht=s.ht,i.next=s,i.ht&&(i.ht.next=i),i.next.ht=i,i.key=t}}class _{fi;ui;history;available;constructor(t){this.fi=t,this.available=t,this.ui=new g(1024),this.history=new E}get(t){const i=this.ui.get(t);return i&&this.history.push(i),i}put(t,i){if(0===this.available){const t=this.history.pop();t?.et(),t?.dt()}else this.available--;this.ui.put(t,i),this.history.push(i)}clear(){const t=this.history.pop();t?(t.et(),t.dt()):this.available=this.fi}}class C extends l{static di=new Int32Array;static wi=0;static yi=0;static top=0;static bottom=0;static left=0;static right=0;static Ai=0;static pi=0;static mi=0;static bind=(t,i,s)=>{this.di=t,this.wi=i,this.yi=s,this.Ii(0,0,i,s)};static Ei=()=>{this.left=0,this.top=0,this.right=this.wi,this.bottom=this.yi,this.Ai=this.right-1,this.pi=this.right/2|0};static Ii=(t,i,s,h)=>{t<0&&(t=0),i<0&&(i=0),s>this.wi&&(s=this.wi),h>this.yi&&(h=this.yi),this.top=i,this.bottom=h,this.left=t,this.right=s,this.Ai=this.right-1,this.pi=this.right/2|0,this.mi=this.bottom/2|0};static clear=()=>{const t=this.wi*this.yi;for(let i=0;i<t;i++)this.di[i]=0};static gi=(t,i,s,h,e)=>{this._i(t,i,e,s),this._i(t,i+h-1,e,s),this.Ci(t,i,e,h),this.Ci(t+s-1,i,e,h)};static _i=(t,i,s,h)=>{if(i<this.top||i>=this.bottom)return;t<this.left&&(h-=this.left-t,t=this.left),t+h>this.right&&(h=this.right-t);const e=t+i*this.wi;for(let t=0;t<h;t++)this.di[e+t]=s};static Ci=(t,i,s,h)=>{if(t<this.left||t>=this.right)return;i<this.top&&(h-=this.top-i,i=this.top),i+h>this.bottom&&(h=this.bottom-i);const e=t+i*this.wi;for(let t=0;t<h;t++)this.di[e+t*this.wi]=s};static Ti=(t,i,s,h,e)=>{const n=Math.abs(s-t),r=Math.abs(h-i),o=t<s?1:-1,l=i<h?1:-1;let a=n-r;for(;t>=this.left&&t<this.right&&i>=this.top&&i<this.bottom&&(this.di[t+i*this.wi]=e),t!==s||i!==h;){const s=2*a;s>-r&&(a-=r,t+=o),s<n&&(a+=n,i+=l)}};static fillRect=(t,i,s,h,e)=>{t<this.left&&(s-=this.left-t,t=this.left),i<this.top&&(h-=this.top-i,i=this.top),t+s>this.right&&(s=this.right-t),i+h>this.bottom&&(h=this.bottom-i);const n=this.wi-s;let r=t+i*this.wi;for(let t=-h;t<0;t++){for(let t=-s;t<0;t++)this.di[r++]=e;r+=n}};static Oi(t,i,s,h,e,n){t<this.left&&(s-=this.left-t,t=this.left),i<this.top&&(h-=this.top-i,i=this.top),t+s>this.right&&(s=this.right-t),i+h>this.bottom&&(h=this.bottom-i);const r=256-n,o=(e>>16&255)*n,l=(e>>8&255)*n,a=(255&e)*n,c=this.wi-s;let f=t+i*this.wi;for(let t=0;t<h;t++){for(let t=-s;t<0;t++){const t=(o+(this.di[f]>>16&255)*r>>8<<16)+(l+(this.di[f]>>8&255)*r>>8<<8)+(a+(255&this.di[f])*r>>8);this.di[f++]=t}f+=c}}static bi(t,i,s,h,e){const n=256-e,r=(h>>16&255)*e,o=(h>>8&255)*e,l=(255&h)*e;let a=i-s;a<0&&(a=0);let c=i+s;c>=this.yi&&(c=this.yi-1);for(let h=a;h<=c;h++){const e=h-i,a=0|Math.sqrt(s*s-e*e);let c=t-a;c<0&&(c=0);let f=t+a;f>=this.wi&&(f=this.wi-1);let u=c+h*this.wi;for(let t=c;t<=f;t++){const t=(r+(this.di[u]>>16&255)*n>>8<<16)+(o+(this.di[u]>>8&255)*n>>8<<8)+(l+(255&this.di[u])*n>>8);this.di[u++]=t}}}static Li=(t,i,s)=>{t<this.left||t>=this.right||i<this.top||i>=this.bottom||(this.di[t+i*this.wi]=s)}}class T extends l{di;width;height;vi;Ri;Si;Mi;palette;constructor(t,i,s){super(),this.di=new Int8Array(t*i),this.width=this.Si=t,this.height=this.Mi=i,this.vi=this.Ri=0,this.palette=s}static xi=(t,i,s=0)=>{const h=new a(t.read(i+'.dat')),e=new a(t.read('index.dat'));e.bt=h.St;const n=e.St,r=e.St,o=e.st,l=new Int32Array(o);for(let t=1;t<o;t++)l[t]=e.xt,0===l[t]&&(l[t]=1);for(let t=0;t<s;t++)e.bt+=2,h.bt+=e.St*e.St,e.bt+=1;if(h.bt>h.length||e.bt>e.length)throw new Error;const c=e.st,f=e.st,u=e.St,d=e.St,w=new T(u,d,l);w.vi=c,w.Ri=f,w.Si=n,w.Mi=r;const y=w.di,A=e.st;if(0===A){const t=w.width*w.height;for(let i=0;i<t;i++)y[i]=h.Rt}else if(1===A){const t=w.width,i=w.height;for(let s=0;s<t;s++)for(let e=0;e<i;e++)y[s+e*t]=h.Rt}return w};draw(t,i){t|=0,i|=0;let s=(t+=this.vi)+(i+=this.Ri)*C.wi,h=0,e=this.height,n=this.width,r=C.wi-n,o=0;if(i<C.top){const t=C.top-i;e-=t,i=C.top,h+=t*n,s+=t*C.wi}if(i+e>C.bottom&&(e-=i+e-C.bottom),t<C.left){const i=C.left-t;n-=i,t=C.left,h+=i,s+=i,o+=i,r+=i}if(t+n>C.right){const i=t+n-C.right;n-=i,o+=i,r+=i}n>0&&e>0&&this.ki(n,e,this.di,h,o,C.di,s,r)}Di(){const t=this.di,i=this.width,s=this.height;for(let h=0;h<s;h++){const s=i/2|0;for(let e=0;e<s;e++){const s=e+h*i,n=i-e-1+h*i,r=t[s];t[s]=t[n],t[n]=r}}}Ni(){const t=this.di,i=this.width,s=this.height;for(let h=0;h<(s/2|0);h++)for(let e=0;e<i;e++){const n=e+h*i,r=e+(s-h-1)*i,o=t[n];t[n]=t[r],t[r]=o}}translate(t,i,s){for(let h=0;h<this.palette.length;h++){let e=this.palette[h]>>16&255;e+=t,e<0?e=0:e>255&&(e=255);let n=this.palette[h]>>8&255;n+=i,n<0?n=0:n>255&&(n=255);let r=255&this.palette[h];r+=s,r<0?r=0:r>255&&(r=255),this.palette[h]=(e<<16)+(n<<8)+r}}Pi(){this.Si|=0,this.Mi|=0,this.Si/=2,this.Mi/=2,this.Si|=0,this.Mi|=0;const t=new Int8Array(this.Si*this.Mi);let i=0;for(let s=0;s<this.height;s++)for(let h=0;h<this.width;h++)t[(h+this.vi>>1)+(s+this.Ri>>1)*this.Si]=this.di[i++];this.di=t,this.width=this.Si,this.height=this.Mi,this.vi=0,this.Ri=0}Fi(){if(this.width===this.Si&&this.height===this.Mi)return;const t=new Int8Array(this.Si*this.Mi);let i=0;for(let s=0;s<this.height;s++)for(let h=0;h<this.width;h++)t[h+this.vi+(s+this.Ri)*this.Si]=this.di[i++];this.di=t,this.width=this.Si,this.height=this.Mi,this.vi=0,this.Ri=0}ki(t,i,s,h,e,n,r,o){const l=-(t>>2);t=-(3&t);for(let a=-i;a<0;a++){for(let t=l;t<0;t++){let t=s[h++];0===t?r++:n[r++]=this.palette[255&t],t=s[h++],0===t?r++:n[r++]=this.palette[255&t],t=s[h++],0===t?r++:n[r++]=this.palette[255&t],t=s[h++],0===t?r++:n[r++]=this.palette[255&t]}for(let i=t;i<0;i++){const t=s[h++];0===t?r++:n[r++]=this.palette[255&t]}r+=o,h+=e}}clip(t,i,s,h){try{const e=this.width;this.height;let n=0,r=0;const o=this.Si,l=this.Mi,a=(o<<16)/s|0,c=(l<<16)/h|0;t=t+(this.vi*s+o-1)/o|0,i=i+(this.Ri*h+l-1)/l|0,this.vi*s%o!=0&&(n=(o-this.vi*s%o<<16)/s|0),this.Ri*h%l!=0&&(r=(l-this.Ri*h%l<<16)/h|0),s=s*(this.width-(n>>16))/o|0,h=h*(this.height-(r>>16))/l|0;let f,u=t+i*C.wi,d=C.wi-s;i<C.top&&(f=C.top-i,h-=f,i=0,u+=f*C.wi,r+=c*f),i+h>C.bottom&&(h-=i+h-C.bottom),t<C.left&&(f=C.left-t,s-=f,t=0,u+=f,n+=a*f,d+=f),t+s>C.right&&(f=t+s-C.right,s-=f,d+=f),this.Ui(C.di,this.di,this.palette,n,r,u,d,s,h,a,c,e)}catch(t){console.log('error in sprite clipping routine')}}Ui(t,i,s,h,e,n,r,o,l,a,c,f){try{const u=h;for(let d=-l;d<0;d++){const l=(e>>16)*f;for(let e=-o;e<0;e++){const e=i[(h>>16)+l];0==e?n++:t[n++]=s[255&e],h+=a}e+=c,h=u,n+=r}}catch(t){console.log('error in plot_scale')}}}class O extends C{static Bi=!1;static Gi=new Int32Array(512);static Hi=new Int32Array(2048);static sin=new Int32Array(2048);static cos=new Int32Array(2048);static palette=new Int32Array(65536);static Wi=new c(50,null);static Yi=0;static Vi=new Int32Array;static Ki=0;static Xi=0;static ji=!0;static zi=!1;static alpha=0;static Zi=null;static qi=new c(50,null);static $i=0;static Ji=0;static Qi=new Int32Array(50);static ts=new c(50,null);static ss=!1;static hs=new c(50,!1);static es=new Int32Array(50);static{for(let t=1;t<512;t++)this.Gi[t]=32768/t|0;for(let t=1;t<2048;t++)this.Hi[t]=65536/t|0;for(let t=0;t<2048;t++)this.sin[t]=65536*Math.sin(.0030679615757712823*t)|0,this.cos[t]=65536*Math.cos(.0030679615757712823*t)|0}static ns=()=>{this.Gi=null,this.Gi=null,this.sin=null,this.cos=null,this.Vi=null,this.Wi=null,this.hs=null,this.es=null,this.Zi=null,this.qi=null,this.Qi=null,this.palette=null,this.ts=null,console.log('Draw3D unloaded!')};static rs=()=>{this.Vi=new Int32Array(C.yi);for(let t=0;t<C.yi;t++)this.Vi[t]=C.wi*t;this.Ki=C.wi/2|0,this.Xi=C.yi/2|0};static os=(t,i)=>{this.Vi=new Int32Array(i);for(let s=0;s<i;s++)this.Vi[s]=t*s;this.Ki=t/2|0,this.Xi=i/2|0};static ls=()=>{this.Zi=null,this.qi.fill(null)};static cs=t=>{this.Yi=0;for(let i=0;i<50;i++)try{this.Wi[i]=T.xi(t,i.toString()),this.Bi&&128===this.Wi[i]?.Si?this.Wi[i]?.Pi():this.Wi[i]?.Fi(),this.Yi++}catch(t){}};static fs=t=>{if(0!==this.es[t])return this.es[t];const i=this.ts[t];if(!i)return 0;let s=0,h=0,e=0;const n=i.length;for(let t=0;t<n;t++)s+=i[t]>>16&255,h+=i[t]>>8&255,e+=255&i[t];let r=(s/n<<16)+(h/n<<8)+(e/n|0);return r=this.us(r,1.4),0===r&&(r=1),this.es[t]=r,r};static ds=t=>{const i=t+.03*Math.random()-.015;let s=0;for(let t=0;t<512;t++){const h=(t/8|0)/64+.0078125,e=(7&t)/8+.0625;for(let t=0;t<128;t++){const n=t/128;let r=n,o=n,l=n;if(0!==e){let t;t=n<.5?n*(e+1):n+e-n*e;const i=2*n-t;let s=h+.3333333333333333;s>1&&s--;let a=h-.3333333333333333;a<0&&a++,r=6*s<1?i+6*(t-i)*s:2*s<1?t:3*s<2?i+(t-i)*(.6666666666666666-s)*6:i,o=6*h<1?i+6*(t-i)*h:2*h<1?t:3*h<2?i+(t-i)*(.6666666666666666-h)*6:i,l=6*a<1?i+6*(t-i)*a:2*a<1?t:3*a<2?i+(t-i)*(.6666666666666666-a)*6:i}const a=((256*r|0)<<16)+((256*o|0)<<8)+(256*l|0);this.palette[s++]=this.us(a,i)}}for(let t=0;t<50;t++){const s=this.Wi[t];if(!s)continue;const h=s.palette;this.ts[t]=new Int32Array(h.length);for(let s=0;s<h.length;s++){const e=this.ts[t];e&&(e[s]=this.us(h[s],i))}}for(let t=0;t<50;t++)this.ws(t)};static us=(t,i)=>{const s=(t>>16)/256,h=(t>>8&255)/256,e=(255&t)/256;return((256*Math.pow(s,i)|0)<<16)+((256*Math.pow(h,i)|0)<<8)+(256*Math.pow(e,i)|0)};static ys=t=>{this.Zi||(this.$i=t,this.Bi?this.Zi=new y(t,16384):this.Zi=new y(t,65536),this.qi.fill(null))};static As=(t,i,s,h,e,n,r,o,l)=>{let a=0,c=0;e!==h&&(a=(i-t<<16)/(e-h)|0,c=(o-r<<15)/(e-h)|0);let f=0,u=0;n!==e&&(f=(s-i<<16)/(n-e)|0,u=(l-o<<15)/(n-e)|0);let d=0,w=0;if(n!==h&&(d=(t-s<<16)/(h-n)|0,w=(r-l<<15)/(h-n)|0),h<=e&&h<=n){if(h<C.bottom)if(e>C.bottom&&(e=C.bottom),n>C.bottom&&(n=C.bottom),e<n)if(s=t<<=16,l=r<<=15,h<0&&(s-=d*h,t-=a*h,l-=w*h,r-=c*h,h=0),i<<=16,o<<=15,e<0&&(i-=f*e,o-=u*e,e=0),h!==e&&d<a||h===e&&d>f)for(n-=e,e-=h,h=O.Vi[h];;){if(--e<0)for(;;){if(--n<0)return;this.ps(s>>16,i>>16,l>>7,o>>7,C.di,h,0),s+=d,i+=f,l+=w,o+=u,h+=C.wi}this.ps(s>>16,t>>16,l>>7,r>>7,C.di,h,0),s+=d,t+=a,l+=w,r+=c,h+=C.wi}else for(n-=e,e-=h,h=O.Vi[h];;){if(--e<0)for(;;){if(--n<0)return;this.ps(i>>16,s>>16,o>>7,l>>7,C.di,h,0),s+=d,i+=f,l+=w,o+=u,h+=C.wi}this.ps(t>>16,s>>16,r>>7,l>>7,C.di,h,0),s+=d,t+=a,l+=w,r+=c,h+=C.wi}else if(i=t<<=16,o=r<<=15,h<0&&(i-=d*h,t-=a*h,o-=w*h,r-=c*h,h=0),s<<=16,l<<=15,n<0&&(s-=f*n,l-=u*n,n=0),h!==n&&d<a||h===n&&f>a)for(e-=n,n-=h,h=O.Vi[h];;){if(--n<0)for(;;){if(--e<0)return;this.ps(s>>16,t>>16,l>>7,r>>7,C.di,h,0),s+=f,t+=a,l+=u,r+=c,h+=C.wi}this.ps(i>>16,t>>16,o>>7,r>>7,C.di,h,0),i+=d,t+=a,o+=w,r+=c,h+=C.wi}else for(e-=n,n-=h,h=O.Vi[h];;){if(--n<0)for(;;){if(--e<0)return;this.ps(t>>16,s>>16,r>>7,l>>7,C.di,h,0),s+=f,t+=a,l+=u,r+=c,h+=C.wi}this.ps(t>>16,i>>16,r>>7,o>>7,C.di,h,0),i+=d,t+=a,o+=w,r+=c,h+=C.wi}}else if(e<=n){if(e<C.bottom)if(n>C.bottom&&(n=C.bottom),h>C.bottom&&(h=C.bottom),n<h)if(t=i<<=16,r=o<<=15,e<0&&(t-=a*e,i-=f*e,r-=c*e,o-=u*e,e=0),s<<=16,l<<=15,n<0&&(s-=d*n,l-=w*n,n=0),e!==n&&a<f||e===n&&a>d)for(h-=n,n-=e,e=O.Vi[e];;){if(--n<0)for(;;){if(--h<0)return;this.ps(t>>16,s>>16,r>>7,l>>7,C.di,e,0),t+=a,s+=d,r+=c,l+=w,e+=C.wi}this.ps(t>>16,i>>16,r>>7,o>>7,C.di,e,0),t+=a,i+=f,r+=c,o+=u,e+=C.wi}else for(h-=n,n-=e,e=O.Vi[e];;){if(--n<0)for(;;){if(--h<0)return;this.ps(s>>16,t>>16,l>>7,r>>7,C.di,e,0),t+=a,s+=d,r+=c,l+=w,e+=C.wi}this.ps(i>>16,t>>16,o>>7,r>>7,C.di,e,0),t+=a,i+=f,r+=c,o+=u,e+=C.wi}else if(s=i<<=16,l=o<<=15,e<0&&(s-=a*e,i-=f*e,l-=c*e,o-=u*e,e=0),t<<=16,r<<=15,h<0&&(t-=d*h,r-=w*h,h=0),n-=h,h-=e,e=O.Vi[e],a<f)for(;;){if(--h<0)for(;;){if(--n<0)return;this.ps(t>>16,i>>16,r>>7,o>>7,C.di,e,0),t+=d,i+=f,r+=w,o+=u,e+=C.wi}this.ps(s>>16,i>>16,l>>7,o>>7,C.di,e,0),s+=a,i+=f,l+=c,o+=u,e+=C.wi}else for(;;){if(--h<0)for(;;){if(--n<0)return;this.ps(i>>16,t>>16,o>>7,r>>7,C.di,e,0),t+=d,i+=f,r+=w,o+=u,e+=C.wi}this.ps(i>>16,s>>16,o>>7,l>>7,C.di,e,0),s+=a,i+=f,l+=c,o+=u,e+=C.wi}}else if(n<C.bottom)if(h>C.bottom&&(h=C.bottom),e>C.bottom&&(e=C.bottom),h<e)if(i=s<<=16,o=l<<=15,n<0&&(i-=f*n,s-=d*n,o-=u*n,l-=w*n,n=0),t<<=16,r<<=15,h<0&&(t-=a*h,r-=c*h,h=0),e-=h,h-=n,n=O.Vi[n],f<d)for(;;){if(--h<0)for(;;){if(--e<0)return;this.ps(i>>16,t>>16,o>>7,r>>7,C.di,n,0),i+=f,t+=a,o+=u,r+=c,n+=C.wi}this.ps(i>>16,s>>16,o>>7,l>>7,C.di,n,0),i+=f,s+=d,o+=u,l+=w,n+=C.wi}else for(;;){if(--h<0)for(;;){if(--e<0)return;this.ps(t>>16,i>>16,r>>7,o>>7,C.di,n,0),i+=f,t+=a,o+=u,r+=c,n+=C.wi}this.ps(s>>16,i>>16,l>>7,o>>7,C.di,n,0),i+=f,s+=d,o+=u,l+=w,n+=C.wi}else if(t=s<<=16,r=l<<=15,n<0&&(t-=f*n,s-=d*n,r-=u*n,l-=w*n,n=0),i<<=16,o<<=15,e<0&&(i-=a*e,o-=c*e,e=0),h-=e,e-=n,n=O.Vi[n],f<d)for(;;){if(--e<0)for(;;){if(--h<0)return;this.ps(i>>16,s>>16,o>>7,l>>7,C.di,n,0),i+=a,s+=d,o+=c,l+=w,n+=C.wi}this.ps(t>>16,s>>16,r>>7,l>>7,C.di,n,0),t+=f,s+=d,r+=u,l+=w,n+=C.wi}else for(;;){if(--e<0)for(;;){if(--h<0)return;this.ps(s>>16,i>>16,l>>7,o>>7,C.di,n,0),i+=a,s+=d,o+=c,l+=w,n+=C.wi}this.ps(s>>16,t>>16,l>>7,r>>7,C.di,n,0),t+=f,s+=d,r+=u,l+=w,n+=C.wi}};static ps=(t,i,s,h,e,n,r)=>{let o;if(O.ji){let l;if(O.zi){if(l=i-t>3?(h-s)/(i-t)|0:0,i>C.Ai&&(i=C.Ai),t<0&&(s-=t*l,t=0),t>=i)return;n+=t,r=i-t>>2,l<<=2}else{if(!(t<i))return;n+=t,l=(r=i-t>>2)>0?(h-s)*O.Gi[r]>>15:0}if(0===O.alpha)for(;;){if(--r<0){if((r=i-t&3)>0){o=O.palette[s>>8];do{e[n++]=o,r--}while(r>0);return}break}o=O.palette[s>>8],s+=l,e[n++]=o,e[n++]=o,e[n++]=o,e[n++]=o}else{const h=O.alpha,a=256-O.alpha;for(;;){if(--r<0){if((r=i-t&3)>0){o=O.palette[s>>8],o=((16711935&o)*a>>8&16711935)+((65280&o)*a>>8&65280);do{e[n++]=o+((16711935&e[n])*h>>8&16711935)+((65280&e[n])*h>>8&65280),r--}while(r>0)}break}o=O.palette[s>>8],s+=l,o=((16711935&o)*a>>8&16711935)+((65280&o)*a>>8&65280),e[n++]=o+((16711935&e[n])*h>>8&16711935)+((65280&e[n])*h>>8&65280),e[n++]=o+((16711935&e[n])*h>>8&16711935)+((65280&e[n])*h>>8&65280),e[n++]=o+((16711935&e[n])*h>>8&16711935)+((65280&e[n])*h>>8&65280),e[n++]=o+((16711935&e[n])*h>>8&16711935)+((65280&e[n])*h>>8&65280)}}}else if(t<i){const l=(h-s)/(i-t)|0;if(O.zi&&(i>C.Ai&&(i=C.Ai),t<0&&(s-=t*l,t=0),t>=i))return;if(n+=t,r=i-t,0===O.alpha)do{e[n++]=O.palette[s>>8],s+=l,r--}while(r>0);else{const t=O.alpha,i=256-O.alpha;do{o=O.palette[s>>8],s+=l,o=((16711935&o)*i>>8&16711935)+((65280&o)*i>>8&65280),e[n++]=o+((16711935&e[n])*t>>8&16711935)+((65280&e[n])*t>>8&65280),r--}while(r>0)}}};static Is=(t,i,s,h,e,n,r)=>{let o=0;e!==h&&(o=(i-t<<16)/(e-h)|0);let l=0;n!==e&&(l=(s-i<<16)/(n-e)|0);let a=0;if(n!==h&&(a=(t-s<<16)/(h-n)|0),h<=e&&h<=n){if(h<C.bottom)if(e>C.bottom&&(e=C.bottom),n>C.bottom&&(n=C.bottom),e<n)if(s=t<<=16,h<0&&(s-=a*h,t-=o*h,h=0),i<<=16,e<0&&(i-=l*e,e=0),h!==e&&a<o||h===e&&a>l)for(n-=e,e-=h,h=this.Vi[h];;){if(--e<0)for(;;){if(--n<0)return;this.Es(s>>16,i>>16,C.di,h,r),s+=a,i+=l,h+=C.wi}this.Es(s>>16,t>>16,C.di,h,r),s+=a,t+=o,h+=C.wi}else for(n-=e,e-=h,h=this.Vi[h];;){if(--e<0)for(;;){if(--n<0)return;this.Es(i>>16,s>>16,C.di,h,r),s+=a,i+=l,h+=C.wi}this.Es(t>>16,s>>16,C.di,h,r),s+=a,t+=o,h+=C.wi}else if(i=t<<=16,h<0&&(i-=a*h,t-=o*h,h=0),s<<=16,n<0&&(s-=l*n,n=0),h!==n&&a<o||h===n&&l>o)for(e-=n,n-=h,h=this.Vi[h];;){if(--n<0)for(;;){if(--e<0)return;this.Es(s>>16,t>>16,C.di,h,r),s+=l,t+=o,h+=C.wi}this.Es(i>>16,t>>16,C.di,h,r),i+=a,t+=o,h+=C.wi}else for(e-=n,n-=h,h=this.Vi[h];;){if(--n<0)for(;;){if(--e<0)return;this.Es(t>>16,s>>16,C.di,h,r),s+=l,t+=o,h+=C.wi}this.Es(t>>16,i>>16,C.di,h,r),i+=a,t+=o,h+=C.wi}}else if(e<=n){if(e<C.bottom)if(n>C.bottom&&(n=C.bottom),h>C.bottom&&(h=C.bottom),n<h)if(t=i<<=16,e<0&&(t-=o*e,i-=l*e,e=0),s<<=16,n<0&&(s-=a*n,n=0),e!==n&&o<l||e===n&&o>a)for(h-=n,n-=e,e=this.Vi[e];;){if(--n<0)for(;;){if(--h<0)return;this.Es(t>>16,s>>16,C.di,e,r),t+=o,s+=a,e+=C.wi}this.Es(t>>16,i>>16,C.di,e,r),t+=o,i+=l,e+=C.wi}else for(h-=n,n-=e,e=this.Vi[e];;){if(--n<0)for(;;){if(--h<0)return;this.Es(s>>16,t>>16,C.di,e,r),t+=o,s+=a,e+=C.wi}this.Es(i>>16,t>>16,C.di,e,r),t+=o,i+=l,e+=C.wi}else if(s=i<<=16,e<0&&(s-=o*e,i-=l*e,e=0),t<<=16,h<0&&(t-=a*h,h=0),o<l)for(n-=h,h-=e,e=this.Vi[e];;){if(--h<0)for(;;){if(--n<0)return;this.Es(t>>16,i>>16,C.di,e,r),t+=a,i+=l,e+=C.wi}this.Es(s>>16,i>>16,C.di,e,r),s+=o,i+=l,e+=C.wi}else for(n-=h,h-=e,e=this.Vi[e];;){if(--h<0)for(;;){if(--n<0)return;this.Es(i>>16,t>>16,C.di,e,r),t+=a,i+=l,e+=C.wi}this.Es(i>>16,s>>16,C.di,e,r),s+=o,i+=l,e+=C.wi}}else if(n<C.bottom)if(h>C.bottom&&(h=C.bottom),e>C.bottom&&(e=C.bottom),h<e)if(i=s<<=16,n<0&&(i-=l*n,s-=a*n,n=0),t<<=16,h<0&&(t-=o*h,h=0),l<a)for(e-=h,h-=n,n=this.Vi[n];;){if(--h<0)for(;;){if(--e<0)return;this.Es(i>>16,t>>16,C.di,n,r),i+=l,t+=o,n+=C.wi}this.Es(i>>16,s>>16,C.di,n,r),i+=l,s+=a,n+=C.wi}else for(e-=h,h-=n,n=this.Vi[n];;){if(--h<0)for(;;){if(--e<0)return;this.Es(t>>16,i>>16,C.di,n,r),i+=l,t+=o,n+=C.wi}this.Es(s>>16,i>>16,C.di,n,r),i+=l,s+=a,n+=C.wi}else if(t=s<<=16,n<0&&(t-=l*n,s-=a*n,n=0),i<<=16,e<0&&(i-=o*e,e=0),l<a)for(h-=e,e-=n,n=this.Vi[n];;){if(--e<0)for(;;){if(--h<0)return;this.Es(i>>16,s>>16,C.di,n,r),i+=o,s+=a,n+=C.wi}this.Es(t>>16,s>>16,C.di,n,r),t+=l,s+=a,n+=C.wi}else for(h-=e,e-=n,n=this.Vi[n];;){if(--e<0)for(;;){if(--h<0)return;this.Es(s>>16,i>>16,C.di,n,r),i+=o,s+=a,n+=C.wi}this.Es(s>>16,t>>16,C.di,n,r),t+=l,s+=a,n+=C.wi}};static gs=(t,i,s,h,e,n,r,o,l,a,c,f,u,d,w,y,A,p,m)=>{const I=this._s(m);this.ss=!this.hs[m];const E=a-u,g=c-w,_=f-A,T=d-a,O=y-c,b=p-f;let L=T*c-O*a<<14;const v=O*f-b*c<<8,R=b*a-T*f<<5;let S=E*c-g*a<<14;const M=g*f-_*c<<8,x=_*a-E*f<<5;let k=g*T-E*O<<14;const D=_*O-g*b<<8,N=E*b-_*T<<5;let P=0,F=0;e!==h&&(P=(i-t<<16)/(e-h)|0,F=(o-r<<16)/(e-h)|0);let U=0,B=0;n!==e&&(U=(s-i<<16)/(n-e)|0,B=(l-o<<16)/(n-e)|0);let G=0,H=0;if(n!==h&&(G=(t-s<<16)/(h-n)|0,H=(r-l<<16)/(h-n)|0),h<=e&&h<=n){if(h<C.bottom)if(e>C.bottom&&(e=C.bottom),n>C.bottom&&(n=C.bottom),e<n){s=t<<=16,l=r<<=16,h<0&&(s-=G*h,t-=P*h,l-=H*h,r-=F*h,h=0),i<<=16,o<<=16,e<0&&(i-=U*e,o-=B*e,e=0);const a=h-this.Xi;if(L+=R*a,S+=x*a,k+=N*a,L|=0,S|=0,k|=0,h!==e&&G<P||h===e&&G>U)for(n-=e,e-=h,h=this.Vi[h];;){if(--e<0)for(;;){if(--n<0)return;this.Cs(s>>16,i>>16,C.di,h,I,0,0,L,S,k,v,M,D,l>>8,o>>8),s+=G,i+=U,l+=H,o+=B,h+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}this.Cs(s>>16,t>>16,C.di,h,I,0,0,L,S,k,v,M,D,l>>8,r>>8),s+=G,t+=P,l+=H,r+=F,h+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}else for(n-=e,e-=h,h=this.Vi[h];;){if(--e<0)for(;;){if(--n<0)return;this.Cs(i>>16,s>>16,C.di,h,I,0,0,L,S,k,v,M,D,o>>8,l>>8),s+=G,i+=U,l+=H,o+=B,h+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}this.Cs(t>>16,s>>16,C.di,h,I,0,0,L,S,k,v,M,D,r>>8,l>>8),s+=G,t+=P,l+=H,r+=F,h+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}}else{i=t<<=16,o=r<<=16,h<0&&(i-=G*h,t-=P*h,o-=H*h,r-=F*h,h=0),s<<=16,l<<=16,n<0&&(s-=U*n,l-=B*n,n=0);const a=h-this.Xi;if(L+=R*a,S+=x*a,k+=N*a,L|=0,S|=0,k|=0,(h===n||G>=P)&&(h!==n||U<=P))for(e-=n,n-=h,h=this.Vi[h];;){if(--n<0)for(;;){if(--e<0)return;this.Cs(t>>16,s>>16,C.di,h,I,0,0,L,S,k,v,M,D,r>>8,l>>8),s+=U,t+=P,l+=B,r+=F,h+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}this.Cs(t>>16,i>>16,C.di,h,I,0,0,L,S,k,v,M,D,r>>8,o>>8),i+=G,t+=P,o+=H,r+=F,h+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}else for(e-=n,n-=h,h=this.Vi[h];;){if(--n<0)for(;;){if(--e<0)return;this.Cs(s>>16,t>>16,C.di,h,I,0,0,L,S,k,v,M,D,l>>8,r>>8),s+=U,t+=P,l+=B,r+=F,h+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}this.Cs(i>>16,t>>16,C.di,h,I,0,0,L,S,k,v,M,D,o>>8,r>>8),i+=G,t+=P,o+=H,r+=F,h+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}}}else if(e<=n){if(e<C.bottom)if(n>C.bottom&&(n=C.bottom),h>C.bottom&&(h=C.bottom),n<h){t=i<<=16,r=o<<=16,e<0&&(t-=P*e,i-=U*e,r-=F*e,o-=B*e,e=0),s<<=16,l<<=16,n<0&&(s-=G*n,l-=H*n,n=0);const a=e-this.Xi;if(L+=R*a,S+=x*a,k+=N*a,L|=0,S|=0,k|=0,e!==n&&P<U||e===n&&P>G)for(h-=n,n-=e,e=this.Vi[e];;){if(--n<0)for(;;){if(--h<0)return;this.Cs(t>>16,s>>16,C.di,e,I,0,0,L,S,k,v,M,D,r>>8,l>>8),t+=P,s+=G,r+=F,l+=H,e+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}this.Cs(t>>16,i>>16,C.di,e,I,0,0,L,S,k,v,M,D,r>>8,o>>8),t+=P,i+=U,r+=F,o+=B,e+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}else for(h-=n,n-=e,e=this.Vi[e];;){if(--n<0)for(;;){if(--h<0)return;this.Cs(s>>16,t>>16,C.di,e,I,0,0,L,S,k,v,M,D,l>>8,r>>8),t+=P,s+=G,r+=F,l+=H,e+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}this.Cs(i>>16,t>>16,C.di,e,I,0,0,L,S,k,v,M,D,o>>8,r>>8),t+=P,i+=U,r+=F,o+=B,e+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}}else{s=i<<=16,l=o<<=16,e<0&&(s-=P*e,i-=U*e,l-=F*e,o-=B*e,e=0),t<<=16,r<<=16,h<0&&(t-=G*h,r-=H*h,h=0);const a=e-this.Xi;if(L+=R*a,S+=x*a,k+=N*a,L|=0,S|=0,k|=0,n-=h,h-=e,e=this.Vi[e],P<U)for(;;){if(--h<0)for(;;){if(--n<0)return;this.Cs(t>>16,i>>16,C.di,e,I,0,0,L,S,k,v,M,D,r>>8,o>>8),t+=G,i+=U,r+=H,o+=B,e+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}this.Cs(s>>16,i>>16,C.di,e,I,0,0,L,S,k,v,M,D,l>>8,o>>8),s+=P,i+=U,l+=F,o+=B,e+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}else for(;;){if(--h<0)for(;;){if(--n<0)return;this.Cs(i>>16,t>>16,C.di,e,I,0,0,L,S,k,v,M,D,o>>8,r>>8),t+=G,i+=U,r+=H,o+=B,e+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}this.Cs(i>>16,s>>16,C.di,e,I,0,0,L,S,k,v,M,D,o>>8,l>>8),s+=P,i+=U,l+=F,o+=B,e+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}}}else if(n<C.bottom)if(h>C.bottom&&(h=C.bottom),e>C.bottom&&(e=C.bottom),h<e){i=s<<=16,o=l<<=16,n<0&&(i-=U*n,s-=G*n,o-=B*n,l-=H*n,n=0),t<<=16,r<<=16,h<0&&(t-=P*h,r-=F*h,h=0);const a=n-this.Xi;if(L+=R*a,S+=x*a,k+=N*a,L|=0,S|=0,k|=0,e-=h,h-=n,n=this.Vi[n],U<G)for(;;){if(--h<0)for(;;){if(--e<0)return;this.Cs(i>>16,t>>16,C.di,n,I,0,0,L,S,k,v,M,D,o>>8,r>>8),i+=U,t+=P,o+=B,r+=F,n+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}this.Cs(i>>16,s>>16,C.di,n,I,0,0,L,S,k,v,M,D,o>>8,l>>8),i+=U,s+=G,o+=B,l+=H,n+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}else for(;;){if(--h<0)for(;;){if(--e<0)return;this.Cs(t>>16,i>>16,C.di,n,I,0,0,L,S,k,v,M,D,r>>8,o>>8),i+=U,t+=P,o+=B,r+=F,n+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}this.Cs(s>>16,i>>16,C.di,n,I,0,0,L,S,k,v,M,D,l>>8,o>>8),i+=U,s+=G,o+=B,l+=H,n+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}}else{t=s<<=16,r=l<<=16,n<0&&(t-=U*n,s-=G*n,r-=B*n,l-=H*n,n=0),i<<=16,o<<=16,e<0&&(i-=P*e,o-=F*e,e=0);const a=n-this.Xi;if(L+=R*a,S+=x*a,k+=N*a,L|=0,S|=0,k|=0,h-=e,e-=n,n=this.Vi[n],U<G)for(;;){if(--e<0)for(;;){if(--h<0)return;this.Cs(i>>16,s>>16,C.di,n,I,0,0,L,S,k,v,M,D,o>>8,l>>8),i+=P,s+=G,o+=F,l+=H,n+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}this.Cs(t>>16,s>>16,C.di,n,I,0,0,L,S,k,v,M,D,r>>8,l>>8),t+=U,s+=G,r+=B,l+=H,n+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}else for(;;){if(--e<0)for(;;){if(--h<0)return;this.Cs(s>>16,i>>16,C.di,n,I,0,0,L,S,k,v,M,D,l>>8,o>>8),i+=P,s+=G,o+=F,l+=H,n+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}this.Cs(s>>16,t>>16,C.di,n,I,0,0,L,S,k,v,M,D,l>>8,r>>8),t+=U,s+=G,r+=B,l+=H,n+=C.wi,L+=R,S+=x,k+=N,L|=0,S|=0,k|=0}}};static Cs=(t,i,s,h,e,n,r,o,l,a,c,f,u,d,w)=>{if(t>=i)return;let y,A,p,m,I,E,g,_,T;if(this.zi){if(y=(w-d)/(i-t)|0,i>C.Ai&&(i=C.Ai),t<0&&(d-=t*y,t=0),t>=i)return;A=i-t>>3,y<<=12}else i-t>7?(A=i-t>>3,y=(w-d)*this.Gi[A]>>6):(A=0,y=0);if(d<<=9,h+=t,this.Bi&&e)if(p=0,m=0,E=t-this.Ki,o+=(c>>3)*E,l+=(f>>3)*E,a+=(u>>3)*E,o|=0,l|=0,I=(a|=0)>>12,0!==I&&(r=l/I|0,(n=o/I|0)<0?n=0:n>4032&&(n=4032)),o+=c,l+=f,a+=u,o|=0,l|=0,I=(a|=0)>>12,0!==I&&(p=o/I|0,m=l/I|0,p<7?p=7:p>4032&&(p=4032)),g=p-n>>3,_=m-r>>3,n+=d>>3&786432,T=d>>23,this.ss){for(;A-- >0;)s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_,s[h++]=e[(4032&r)+(n>>6)]>>>T,n=p,r=m,o+=c,l+=f,I=(a+=u)>>12,0!==I&&(p=o/I|0,m=l/I|0,p<7?p=7:p>4032&&(p=4032)),g=p-n>>3,_=m-r>>3,n+=(d+=y)>>3&786432,T=d>>23;for(A=i-t&7;A-- >0;)s[h++]=e[(4032&r)+(n>>6)]>>>T,n+=g,r+=_}else{for(;A-- >0;){let t;0!=(t=e[(4032&r)+(n>>6)]>>>T)&&(s[h]=t),h+=1,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h++,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h++,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h++,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h++,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h++,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h++,0!=(t=e[(4032&(r+=_))+((n+=g)>>6)]>>>T)&&(s[h]=t),h+=1,n=p,r=m,o+=c,l+=f,a+=u,o|=0,l|=0,I=(a|=0)>>12,0!==I&&(p=o/I|0,m=l/I|0,p<7?p=7:p>4032&&(p=4032)),g=p-n>>3,_=m-r>>3,n+=(d+=y)>>3&786432,T=d>>23}for(A=i-t&7;A-- >0;){let t;0!=(t=e[(4032&r)+(n>>6)]>>>T)&&(s[h]=t),h++,n+=g,r+=_}}else if(p=0,m=0,E=t-this.Ki,o+=(c>>3)*E,l+=(f>>3)*E,a+=(u>>3)*E,o|=0,l|=0,I=(a|=0)>>14,0!==I&&(r=l/I|0,(n=o/I|0)<0?n=0:n>16256&&(n=16256)),o+=c,l+=f,a+=u,o|=0,l|=0,I=(a|=0)>>14,0!==I&&(p=o/I|0,m=l/I|0,p<7?p=7:p>16256&&(p=16256)),g=p-n>>3,_=m-r>>3,n+=6291456&d,T=d>>23,this.ss&&e){for(;A-- >0;)s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_,s[h++]=e[(16256&r)+(n>>7)]>>>T,n=p,r=m,o+=c,l+=f,a+=u,o|=0,l|=0,I=(a|=0)>>14,0!==I&&(p=o/I|0,m=l/I|0,p<7?p=7:p>16256&&(p=16256)),g=p-n>>3,_=m-r>>3,n+=6291456&(d+=y),T=d>>23;for(A=i-t&7;A-- >0;)s[h++]=e[(16256&r)+(n>>7)]>>>T,n+=g,r+=_}else{for(;A-- >0&&e;){let t;0!=(t=e[(16256&r)+(n>>7)]>>>T)&&(s[h]=t),h+=1,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,0!=(t=e[(16256&(r+=_))+((n+=g)>>7)]>>>T)&&(s[h]=t),h++,n=p,r=m,o+=c,l+=f,a+=u,o|=0,l|=0,I=(a|=0)>>14,0!==I&&(p=o/I|0,m=l/I|0,p<7?p=7:p>16256&&(p=16256)),g=p-n>>3,_=m-r>>3,n+=6291456&(d+=y),T=d>>23}for(A=i-t&7;A-- >0&&e;){let t;0!=(t=e[(16256&r)+(n>>7)]>>>T)&&(s[h]=t),h++,n+=g,r+=_}}};static Es=(t,i,s,h,e)=>{if(this.zi&&(i>C.Ai&&(i=C.Ai),t<0&&(t=0)),t>=i)return;h+=t;let n=i-t>>2;if(0===this.alpha)for(;;){if(n--,n<0)for(n=i-t&3;;){if(n--,n<0)return;s[h++]=e}s[h++]=e,s[h++]=e,s[h++]=e,s[h++]=e}const r=this.alpha,o=256-this.alpha;for(e=((16711935&e)*o>>8&16711935)+((65280&e)*o>>8&65280);;){if(n--,n<0)for(n=i-t&3;;){if(n--,n<0)return;s[h++]=e+((16711935&s[h])*r>>8&16711935)+((65280&s[h])*r>>8&65280)}s[h++]=e+((16711935&s[h])*r>>8&16711935)+((65280&s[h])*r>>8&65280),s[h++]=e+((16711935&s[h])*r>>8&16711935)+((65280&s[h])*r>>8&65280),s[h++]=e+((16711935&s[h])*r>>8&16711935)+((65280&s[h])*r>>8&65280),s[h++]=e+((16711935&s[h])*r>>8&16711935)+((65280&s[h])*r>>8&65280)}};static ws=t=>{this.qi[t]&&this.Zi&&(this.Zi[this.$i++]=this.qi[t],this.qi[t]=null)};static _s=t=>{if(this.Qi[t]=this.Ji++,this.qi[t])return this.qi[t];let i;if(this.$i>0&&this.Zi)i=this.Zi[--this.$i],this.Zi[this.$i]=null;else{let t=0,s=-1;for(let i=0;i<this.Yi;i++)this.qi[i]&&(this.Qi[i]<t||-1===s)&&(t=this.Qi[i],s=i);i=this.qi[s],this.qi[s]=null}this.qi[t]=i;const s=this.Wi[t],h=this.ts[t];if(!i||!s||!h)return null;if(this.Bi){this.hs[t]=!1;for(let e=0;e<4096;e++){const n=i[e]=16316671&h[s.di[e]];0===n&&(this.hs[t]=!0),i[e+4096]=n-(n>>>3)&16316671,i[e+8192]=n-(n>>>2)&16316671,i[e+12288]=n-(n>>>2)-(n>>>3)&16316671}}else{if(64===s.width)for(let t=0;t<128;t++)for(let e=0;e<128;e++)i[e+(t<<7)]=h[s.di[(e>>1)+(t>>1<<6)]];else for(let t=0;t<16384;t++)i[t]=h[s.di[t]];this.hs[t]=!1;for(let s=0;s<16384;s++){i[s]&=16316671;const h=i[s];0===h&&(this.hs[t]=!0),i[s+16384]=h-(h>>>3)&16316671,i[s+32768]=h-(h>>>2)&16316671,i[s+49152]=h-(h>>>2)-(h>>>3)&16316671}}return i}}class b{Ts=0;Os=0;bs=0;Ls=-1;vs=-1;Rs=-1;Ss=-1;Ms=-1;xs=-1;ks=-1;Ds=-1;Ns=-1;Ps=0;Fs=-1;Us=-1;Bs=-1;data=null}class L{x=0;y=0;z=0;w=0}class v extends l{static metadata=null;static head=null;static Gs=null;static Hs=null;static Ws=null;static Ys=null;static Vs=null;static Ks=null;static Xs=null;static js=null;static zs=null;static Zs=null;static qs=null;static $s=null;static axis=null;static Js=new c(4096,!1);static Qs=new c(4096,!1);static th=new Int32Array(4096);static ih=new Int32Array(4096);static sh=new Int32Array(4096);static hh=new Int32Array(4096);static eh=new Int32Array(4096);static nh=new Int32Array(4096);static rh=new Int32Array(1500);static oh=new y(1500,512);static lh=new Int32Array(12);static ah=new y(12,2e3);static fh=new Int32Array(2e3);static uh=new Int32Array(2e3);static dh=new Int32Array(12);static wh=new Int32Array(10);static yh=new Int32Array(10);static Ah=new Int32Array(10);static ph=0;static mh=0;static Ih=0;static Eh=!1;static gh=0;static _h=0;static Ch=0;static Th=new Int32Array(1e3);static Oh=!1;static Jt(t){try{v.head=new a(t.read('ob_head.dat')),v.Gs=new a(t.read('ob_face1.dat')),v.Hs=new a(t.read('ob_face2.dat')),v.Ws=new a(t.read('ob_face3.dat')),v.Ys=new a(t.read('ob_face4.dat')),v.Vs=new a(t.read('ob_face5.dat')),v.Ks=new a(t.read('ob_point1.dat')),v.Xs=new a(t.read('ob_point2.dat')),v.js=new a(t.read('ob_point3.dat')),v.zs=new a(t.read('ob_point4.dat')),v.Zs=new a(t.read('ob_point5.dat')),v.qs=new a(t.read('ob_vertex1.dat')),v.$s=new a(t.read('ob_vertex2.dat')),v.axis=new a(t.read('ob_axis.dat')),v.head.bt=0,v.Ks.bt=0,v.Xs.bt=0,v.js.bt=0,v.zs.bt=0,v.qs.bt=0,v.$s.bt=0;const i=v.head.St;v.metadata=new c(i+100,null);let s=0,h=0,e=0,n=0,r=0,o=0,l=0;for(let t=0;t<i;t++){const t=v.head.St,i=new b;i.Ts=v.head.St,i.Os=v.head.St,i.bs=v.head.st,i.Ls=v.Ks.bt,i.vs=v.Xs.bt,i.Rs=v.js.bt,i.Ss=v.zs.bt,i.xs=v.qs.bt,i.ks=v.$s.bt;const a=v.head.st,c=v.head.st,f=v.head.st,u=v.head.st,d=v.head.st;for(let t=0;t<i.Ts;t++){const t=v.Ks.st;1&t&&v.Xs.Nt,2&t&&v.js.Nt,4&t&&v.zs.Nt}for(let t=0;t<i.Os;t++){1===v.$s.st&&(v.qs.Nt,v.qs.Nt),v.qs.Nt}i.Ds=e,e+=2*i.Os,1===a&&(i.Ns=n,n+=i.Os),255===c?(i.Ps=r,r+=i.Os):i.Ps=-c-1,1===f&&(i.Fs=o,o+=i.Os),1===u&&(i.Us=l,l+=i.Os),1===d&&(i.Ms=h,h+=i.Ts),i.Bs=s,s+=i.bs,v.metadata[t]=i}}catch(t){console.log('Error loading model index'),console.error(t)}}static bh(t,i){if(null===v.metadata&&(v.metadata=[]),null===t){const t=new b;return t.Ts=0,t.Os=0,t.bs=0,void(v.metadata[i]=t)}const s=new a(t);s.bt=s.length-18;const h=new b;h.data=t,h.Ts=s.St,h.Os=s.St,h.bs=s.st,v.metadata[i]=h;const e=s.st,n=s.st,r=s.st,o=s.st,l=s.st,c=s.St,f=s.St,u=s.St,d=s.St;let w=0;h.Ls=w,w+=h.Ts,h.ks=w,w+=h.Os,h.Ps=w,255===n?w+=h.Os:h.Ps=-n-1,h.Us=w,1===o?w+=h.Os:h.Us=-1,h.Ns=w,1===e?w+=h.Os:h.Ns=-1,h.Ms=w,1===l?w+=h.Ts:h.Ms=-1,h.Fs=w,1===r?w+=h.Os:h.Fs=-1,h.xs=w,w+=d,h.Ds=w,w+=2*h.Os,h.Bs=w,w+=6*h.bs,h.vs=w,w+=c,h.Rs=w,w+=f,h.Ss=w,w+=u}static ns(){v.metadata=null,v.head=null,v.Gs=null,v.Hs=null,v.Ws=null,v.Ys=null,v.Vs=null,v.Ks=null,v.Xs=null,v.js=null,v.zs=null,v.Zs=null,v.qs=null,v.$s=null,v.axis=null,v.Js=null,v.Qs=null,v.th=null,v.ih=null,v.sh=null,v.hh=null,v.eh=null,v.nh=null,v.rh=null,v.oh=null,v.lh=null,v.ah=null,v.fh=null,v.uh=null,v.dh=null}static Lh(t,i,s){return 2&~s?((i=i*(127&t)>>7)<2?i=2:i>126&&(i=126),(65408&t)+i):(i<0?i=0:i>127&&(i=127),127-i)}static Rh=(t,i,s)=>{const h=t.Ts,e=t.Os,n=t.bs;let r,o,l,a,f;if(i){r=new Int32Array(h);for(let i=0;i<h;i++)r[i]=t.Sh[i]}else r=t.Sh;let u=null,d=null;if(s){o=new Int32Array(e),l=new Int32Array(e),a=new Int32Array(e);for(let i=0;i<e;i++)t.Mh&&(o[i]=t.Mh[i]),t.xh&&(l[i]=t.xh[i]),t.kh&&(a[i]=t.kh[i]);if(f=new Int32Array(e),t.Dh)for(let i=0;i<e;i++)f[i]=t.Dh[i];else for(let t=0;t<e;t++)f[t]=0;u=new c(h,null);for(let i=0;i<h;i++){const s=u[i]=new L;if(t.Nh){const h=t.Nh[i];h&&(s.x=h.x,s.y=h.y,s.z=h.z,s.w=h.w)}}d=t.Ph}else o=t.Mh,l=t.xh,a=t.kh,f=t.Dh;return new v({Ts:h,Fh:t.Fh,Sh:r,Uh:t.Uh,Os:e,Bh:t.Bh,Gh:t.Gh,Hh:t.Hh,Mh:o,xh:l,kh:a,Dh:f,Wh:t.Wh,Yh:t.Yh,Vh:t.Vh,priority:t.priority,bs:n,Kh:t.Kh,Xh:t.Xh,jh:t.jh,zh:t.zh,Zh:t.Zh,qh:t.qh,$h:t.$h,Jh:t.Jh,Qh:t.Qh,te:t.te,ie:t.ie,se:t.se,Nh:u,Ph:d})};static he=(t,i,s,h)=>{const e=t.Ts,n=t.Os,r=t.bs;let o,l,a,c,f;if(h)o=t.Fh,l=t.Sh,a=t.Uh;else{o=new Int32Array(e),l=new Int32Array(e),a=new Int32Array(e);for(let i=0;i<e;i++)o[i]=t.Fh[i],l[i]=t.Sh[i],a[i]=t.Uh[i]}if(i)c=t.Vh;else{c=new Int32Array(n);for(let i=0;i<n;i++)t.Vh&&(c[i]=t.Vh[i])}if(s)f=t.Yh;else if(f=new Int32Array(n),t.Yh)for(let i=0;i<n;i++)f[i]=t.Yh[i];else for(let t=0;t<n;t++)f[t]=0;return new v({Ts:e,Fh:o,Sh:l,Uh:a,Os:n,Bh:t.Bh,Gh:t.Gh,Hh:t.Hh,Mh:null,xh:null,kh:null,Dh:t.Dh,Wh:t.Wh,Yh:f,Vh:c,priority:t.priority,bs:r,Kh:t.Kh,Xh:t.Xh,jh:t.jh,ee:t.ee,ne:t.ne})};static re=(t,i)=>{const s=t.Ts,h=t.Os,e=t.bs,n=new Int32Array(s),r=new Int32Array(s),o=new Int32Array(s);for(let i=0;i<s;i++)n[i]=t.Fh[i],r[i]=t.Sh[i],o[i]=t.Uh[i];let l;if(i)l=t.Yh;else if(l=new Int32Array(h),t.Yh)for(let i=0;i<h;i++)l[i]=t.Yh[i];else for(let t=0;t<h;t++)l[t]=0;return new v({Ts:s,Fh:n,Sh:r,Uh:o,Os:h,Bh:t.Bh,Gh:t.Gh,Hh:t.Hh,Mh:t.Mh,xh:t.xh,kh:t.kh,Dh:t.Dh,Wh:t.Wh,Yh:l,Vh:t.Vh,priority:t.priority,bs:e,Kh:t.Kh,Xh:t.Xh,jh:t.jh,oe:t.oe,le:t.le})};static ae=(t,i)=>{let s=!1,h=!1,e=!1,n=!1,r=0,o=0,l=0,a=-1;for(let c=0;c<i;c++){const i=t[c];i&&(r+=i.Ts,o+=i.Os,l+=i.bs,s||=null!==i.Dh,i.Wh?h=!0:(-1===a&&(a=i.priority),a!==i.priority&&(h=!0)),e||=null!==i.Yh,n||=null!==i.Vh)}const c=new Int32Array(r),f=new Int32Array(r),u=new Int32Array(r),d=new Int32Array(o),w=new Int32Array(o),y=new Int32Array(o),A=new Int32Array(o),p=new Int32Array(o),m=new Int32Array(o),I=new Int32Array(l),E=new Int32Array(l),g=new Int32Array(l);let _=null;s&&(_=new Int32Array(o));let C=null;h&&(C=new Int32Array(o));let T=null;e&&(T=new Int32Array(o));let O=null;n&&(O=new Int32Array(o)),r=0,o=0,l=0;for(let a=0;a<i;a++){const i=t[a];if(i){const t=r;for(let t=0;t<i.Ts;t++)c[r]=i.Fh[t],f[r]=i.Sh[t],u[r]=i.Uh[t],r++;for(let r=0;r<i.Os;r++)d[o]=i.Bh[r]+t,w[o]=i.Gh[r]+t,y[o]=i.Hh[r]+t,i.Mh&&(A[o]=i.Mh[r]),i.xh&&(p[o]=i.xh[r]),i.kh&&(m[o]=i.kh[r]),s&&(i.Dh?_&&(_[o]=i.Dh[r]):_&&(_[o]=0)),h&&(i.Wh?C&&(C[o]=i.Wh[r]):C&&(C[o]=i.priority)),e&&(i.Yh?T&&(T[o]=i.Yh[r]):T&&(T[o]=0)),n&&i.Vh&&O&&(O[o]=i.Vh[r]),o++;for(let s=0;s<i.bs;s++)I[l]=i.Kh[s]+t,E[l]=i.Xh[s]+t,g[l]=i.jh[s]+t,l++}}const b=new v({Ts:r,Fh:c,Sh:f,Uh:u,Os:o,Bh:d,Gh:w,Hh:y,Mh:A,xh:p,kh:m,Dh:_,Wh:C,Yh:T,Vh:O,priority:a,bs:l,Kh:I,Xh:E,jh:g});return b.ce(),b};static fe=(t,i)=>{let s=!1,h=!1,e=!1,n=!1,r=0,o=0,l=0,a=-1;for(let c=0;c<i;c++){const i=t[c];i&&(r+=i.Ts,o+=i.Os,l+=i.bs,s||=null!==i.Dh,i.Wh?h=!0:(-1===a&&(a=i.priority),a!==i.priority&&(h=!0)),e||=null!==i.Yh,n||=null!==i.ne)}const c=new Int32Array(r),f=new Int32Array(r),u=new Int32Array(r),d=new Int32Array(r),w=new Int32Array(o),y=new Int32Array(o),A=new Int32Array(o),p=new Int32Array(l),m=new Int32Array(l),I=new Int32Array(l);let E=null;s&&(E=new Int32Array(o));let g=null;h&&(g=new Int32Array(o));let _=null;e&&(_=new Int32Array(o));let C=null;n&&(C=new Int32Array(o));const T=new Int32Array(o);r=0,o=0,l=0;const O=(t,i,s,h,e,n,r)=>{let o=-1;const l=t.Fh[i],a=t.Sh[i],c=t.Uh[i];for(let t=0;t<r;t++)if(l===s[t]&&a===h[t]&&c===e[t]){o=t;break}return-1===o&&(s[r]=l,h[r]=a,e[r]=c,n&&t.ee&&(n[r]=t.ee[i]),o=r++),{vertex:o,Ts:r}};for(let a=0;a<i;a++){const i=t[a];if(i){for(let t=0;t<i.Os;t++){s&&(i.Dh?E&&(E[o]=i.Dh[t]):E&&(E[o]=0)),h&&(i.Wh?g&&(g[o]=i.Wh[t]):g&&(g[o]=i.priority)),e&&(i.Yh?_&&(_[o]=i.Yh[t]):_&&(_[o]=0)),n&&i.ne&&C&&(C[o]=i.ne[t]),i.Vh&&(T[o]=i.Vh[t]);const l=O(i,i.Bh[t],c,f,u,d,r);r=l.Ts;const a=O(i,i.Gh[t],c,f,u,d,r);r=a.Ts;const p=O(i,i.Hh[t],c,f,u,d,r);r=p.Ts,w[o]=l.vertex,y[o]=a.vertex,A[o]=p.vertex,o++}for(let t=0;t<i.bs;t++){const s=O(i,i.Kh[t],c,f,u,d,r);r=s.Ts;const h=O(i,i.Xh[t],c,f,u,d,r);r=h.Ts;const e=O(i,i.jh[t],c,f,u,d,r);r=e.Ts,p[l]=s.vertex,m[l]=h.vertex,I[l]=e.vertex,l++}}}return new v({Ts:r,Fh:c,Sh:f,Uh:u,Os:o,Bh:w,Gh:y,Hh:A,Mh:null,xh:null,kh:null,Dh:E,Wh:g,Yh:_,Vh:T,priority:a,bs:l,Kh:p,Xh:m,jh:I,ee:d,ne:C})};static model=t=>{if(!v.metadata)throw new Error('cant loading model metadata!!!!!');const i=v.metadata[t];if(!i)throw console.log(`Error model:${t} not found!`),new Error('cant loading model metadata!!!!!');if(!(v.head&&v.Gs&&v.Hs&&v.Ws&&v.Ys&&v.Vs&&v.Ks&&v.Xs&&v.js&&v.zs&&v.Zs&&v.qs&&v.$s&&v.axis))throw new Error('cant loading model!!!!!');const s=i.Ts,h=i.Os,e=i.bs,n=new Int32Array(s),r=new Int32Array(s),o=new Int32Array(s),l=new Int32Array(h),a=new Int32Array(h),c=new Int32Array(h),f=new Int32Array(e),u=new Int32Array(e),d=new Int32Array(e);let w=null;i.Ms>=0&&(w=new Int32Array(s));let y=null;i.Ns>=0&&(y=new Int32Array(h));let A=null,p=0;i.Ps>=0?A=new Int32Array(h):p=-i.Ps-1;let m=null;i.Fs>=0&&(m=new Int32Array(h));let I=null;i.Us>=0&&(I=new Int32Array(h));const E=new Int32Array(h);v.Ks.bt=i.Ls,v.Xs.bt=i.vs,v.js.bt=i.Rs,v.zs.bt=i.Ss,v.Zs.bt=i.Ms;let g,_,C,T=0,O=0,b=0;for(let t=0;t<s;t++){const i=v.Ks.st;g=0,1&i&&(g=v.Xs.Nt),_=0,2&i&&(_=v.js.Nt),C=0,4&i&&(C=v.zs.Nt),n[t]=T+g,r[t]=O+_,o[t]=b+C,T=n[t],O=r[t],b=o[t],w&&(w[t]=v.Zs.st)}v.Gs.bt=i.Ds,v.Hs.bt=i.Ns,v.Ws.bt=i.Ps,v.Ys.bt=i.Fs,v.Vs.bt=i.Us;for(let t=0;t<h;t++)E[t]=v.Gs.St,y&&(y[t]=v.Hs.st),A&&(A[t]=v.Ws.st),m&&(m[t]=v.Ys.st),I&&(I[t]=v.Vs.st);v.qs.bt=i.xs,v.$s.bt=i.ks,g=0,_=0,C=0;let L=0;for(let t=0;t<h;t++){const i=v.$s.st;if(1===i)g=v.qs.Nt+L,L=g,_=v.qs.Nt+L,L=_,C=v.qs.Nt+L,L=C;else if(2===i)_=C,C=v.qs.Nt+L,L=C;else if(3===i)g=C,C=v.qs.Nt+L,L=C;else if(4===i){const t=g;g=_,_=t,C=v.qs.Nt+L,L=C}l[t]=g,a[t]=_,c[t]=C}v.axis.bt=6*i.Bs;for(let t=0;t<e;t++)f[t]=v.axis.St,u[t]=v.axis.St,d[t]=v.axis.St;return new v({Ts:s,Fh:n,Sh:r,Uh:o,Os:h,Bh:l,Gh:a,Hh:c,Mh:null,xh:null,kh:null,Dh:y,Wh:A,Yh:m,Vh:E,priority:p,bs:e,Kh:f,Xh:u,jh:d,ee:w,ne:I})};static ue=(t,i)=>{if(!v.metadata||!v.metadata[i])throw new Error('No model metadata');const s=v.metadata[i];if(s.data=t,!s.data.length)throw new Error('No model data');const h=s.Ts,e=s.Os,n=s.bs,r=new Int32Array(h),o=new Int32Array(h),l=new Int32Array(h),c=new Int32Array(e),f=new Int32Array(e),u=new Int32Array(e),d=new Int32Array(n),w=new Int32Array(n),y=new Int32Array(n);let A=null;s.Ms>=0&&(A=new Int32Array(h));let p=null;s.Ns>=0&&(p=new Int32Array(e));let m=null,I=0;s.Ps>=0?m=new Int32Array(e):I=-s.Ps-1;let E=null;s.Fs>=0&&(E=new Int32Array(e));let g=null;s.Us>=0&&(g=new Int32Array(e));const _=new Int32Array(e),C=new a(s.data);C.bt=s.Ls;const T=new a(s.data);T.bt=s.vs;const O=new a(s.data);O.bt=s.Rs;const b=new a(s.data);b.bt=s.Ss;const L=new a(s.data);L.bt=s.Ms;let R,S,M,x=0,k=0,D=0;for(let t=0;t<h;t++){const i=C.st;R=0,1&i&&(R=T.Nt),S=0,2&i&&(S=O.Nt),M=0,4&i&&(M=b.Nt),r[t]=x+R,o[t]=k+S,l[t]=D+M,x=r[t],k=o[t],D=l[t],A&&(A[t]=L.st)}const N=new a(s.data);N.bt=s.Ds;const P=new a(s.data);P.bt=s.Ns;const F=new a(s.data);F.bt=s.Ps;const U=new a(s.data);U.bt=s.Fs;const B=new a(s.data);B.bt=s.Us;for(let t=0;t<e;t++)_[t]=N.St,p&&(p[t]=P.st),m&&(m[t]=F.st),E&&(E[t]=U.st),g&&(g[t]=B.st);const G=new a(s.data);G.bt=s.xs;const H=new a(s.data);H.bt=s.ks,R=0,S=0,M=0;let W=0;for(let t=0;t<e;t++){const i=H.st;if(1===i)R=G.Nt+W,W=R,S=G.Nt+W,W=S,M=G.Nt+W,W=M;else if(2===i)S=M,M=G.Nt+W,W=M;else if(3===i)R=M,M=G.Nt+W,W=M;else if(4===i){const t=R;R=S,S=t,M=G.Nt+W,W=M}c[t]=R,f[t]=S,u[t]=M}const Y=new a(s.data);Y.bt=6*s.Bs;for(let t=0;t<n;t++)d[t]=Y.St,w[t]=Y.St,y[t]=Y.St;return new v({Ts:h,Fh:r,Sh:o,Uh:l,Os:e,Bh:c,Gh:f,Hh:u,Mh:null,xh:null,kh:null,Dh:p,Wh:m,Yh:E,Vh:_,priority:I,bs:n,Kh:d,Xh:w,jh:y,ee:A,ne:g})};Ts;Fh;Sh;Uh;Os;Bh;Gh;Hh;Mh;xh;kh;Dh;Wh;Yh;Vh;priority;bs;Kh;Xh;jh;zh;Zh;qh;$h;Jh;Qh;te;ie;se;ee;ne;oe;le;Nh;Ph;de=0;we=!1;ye=-1;Ae=-1;constructor(t){super(),this.Ts=t.Ts,this.Fh=t.Fh,this.Sh=t.Sh,this.Uh=t.Uh,this.Os=t.Os,this.Bh=t.Bh,this.Gh=t.Gh,this.Hh=t.Hh,this.Mh=t.Mh,this.xh=t.xh,this.kh=t.kh,this.Dh=t.Dh,this.Wh=t.Wh,this.Yh=t.Yh,this.Vh=t.Vh,this.priority=t.priority,this.bs=t.bs,this.Kh=t.Kh,this.Xh=t.Xh,this.jh=t.jh,this.zh=t.zh??0,this.Zh=t.Zh??0,this.qh=t.qh??0,this.$h=t.$h??0,this.Jh=t.Jh??0,this.Qh=t.Qh??0,this.te=t.te??0,this.ie=t.ie??0,this.se=t.se??0,this.ee=t.ee??null,this.ne=t.ne??null,this.oe=t.oe??null,this.le=t.le??null,this.Nh=t.Nh??null,this.Ph=t.Ph??null}ce(){this.te=0,this.Jh=0,this.Qh=0;for(let t=0;t<this.Ts;t++){const i=this.Fh[t],s=this.Sh[t],h=this.Uh[t];-s>this.te&&(this.te=-s),s>this.Qh&&(this.Qh=s);const e=i*i+h*h;e>this.Jh&&(this.Jh=e)}this.Jh=Math.sqrt(this.Jh)+.99|0,this.se=Math.sqrt(this.Jh*this.Jh+this.te*this.te)+.99|0,this.ie=this.se+(Math.sqrt(this.Jh*this.Jh+this.Qh*this.Qh)+.99|0)}pe(){this.te=0,this.Qh=0;for(let t=0;t<this.Ts;t++){const i=this.Sh[t];-i>this.te&&(this.te=-i),i>this.Qh&&(this.Qh=i)}this.se=Math.sqrt(this.Jh*this.Jh+this.te*this.te)+.99|0,this.ie=this.se+(Math.sqrt(this.Jh*this.Jh+this.Qh*this.Qh)+.99|0)}me(){if(this.ee){const t=new Int32Array(256);let i=0;for(let s=0;s<this.Ts;s++){const h=this.ee[s];t[h]++,h>i&&(i=h)}this.oe=new c(i+1,null);for(let s=0;s<=i;s++)this.oe[s]=new Int32Array(t[s]),t[s]=0;let s=0;for(;s<this.Ts;){const i=this.ee[s],h=this.oe[i];h&&(h[t[i]++]=s++)}this.ee=null}if(this.ne){const t=new Int32Array(256);let i=0;for(let s=0;s<this.Os;s++){const h=this.ne[s];t[h]++,h>i&&(i=h)}this.le=new c(i+1,null);for(let s=0;s<=i;s++)this.le[s]=new Int32Array(t[s]),t[s]=0;let s=0;for(;s<this.Os;){const i=this.ne[s],h=this.le[i];h&&(h[t[i]++]=s++)}this.ne=null}}Ie(t,i,s){if(-1!==t)if(s&&-1!==i){const h=m.$t[t],e=m.$t[i],n=h.Qt;v.ph=0,v.mh=0,v.Ih=0;let r=0,o=s[r++];for(let t=0;t<h.length;t++){if(!h.ti)continue;const i=h.ti[t];for(;i>o;)o=s[r++];n&&n.types&&h.x&&h.y&&h.z&&n.labels&&(i!==o||0===n.types[i])&&this.Ee(h.x[t],h.y[t],h.z[t],n.labels[i],n.types[i])}v.ph=0,v.mh=0,v.Ih=0,r=0,o=s[r++];for(let t=0;t<e.length;t++){if(!e.ti)continue;const i=e.ti[t];for(;i>o;)o=s[r++];n&&n.types&&e.x&&e.y&&e.z&&n.labels&&(i===o||0===n.types[i])&&this.Ee(e.x[t],e.y[t],e.z[t],n.labels[i],n.types[i])}}else this.ge(t)}ge(t){if(!this.oe||-1===t||!m.$t[t])return;const i=m.$t[t],s=i.Qt;v.ph=0,v.mh=0,v.Ih=0;for(let t=0;t<i.length;t++){if(!(i.ti&&i.x&&i.y&&i.z&&s&&s.labels&&s.types))continue;const h=i.ti[t];this.Ee(i.x[t],i.y[t],i.z[t],s.labels[h],s.types[h])}}_e(){for(let t=0;t<this.Ts;t++){const i=this.Fh[t];this.Fh[t]=this.Uh[t],this.Uh[t]=-i}}Ce(t){const i=O.sin[t],s=O.cos[t];for(let t=0;t<this.Ts;t++){const h=this.Sh[t]*s-this.Uh[t]*i>>16;this.Uh[t]=this.Sh[t]*i+this.Uh[t]*s>>16,this.Sh[t]=h}}translate(t,i,s){for(let h=0;h<this.Ts;h++)this.Fh[h]+=i,this.Sh[h]+=t,this.Uh[h]+=s}Te(t,i){if(this.Vh)for(let s=0;s<this.Os;s++)this.Vh[s]===t&&(this.Vh[s]=i)}Oe(){for(let t=0;t<this.Ts;t++)this.Uh[t]=-this.Uh[t];for(let t=0;t<this.Os;t++){const i=this.Bh[t];this.Bh[t]=this.Hh[t],this.Hh[t]=i}}scale(t,i,s){for(let h=0;h<this.Ts;h++)this.Fh[h]=this.Fh[h]*t/128|0,this.Sh[h]=this.Sh[h]*i/128|0,this.Uh[h]=this.Uh[h]*s/128|0}be(t,i,s,h,e,n){const r=i*(0|Math.sqrt(s*s+h*h+e*e))>>8;if(this.Mh&&this.xh&&this.kh||(this.Mh=new Int32Array(this.Os),this.xh=new Int32Array(this.Os),this.kh=new Int32Array(this.Os)),!this.Nh){this.Nh=new c(this.Ts,null);for(let t=0;t<this.Ts;t++)this.Nh[t]=new L}for(let i=0;i<this.Os;i++){const n=this.Bh[i],o=this.Gh[i],l=this.Hh[i],a=this.Fh[o]-this.Fh[n],c=this.Sh[o]-this.Sh[n],f=this.Uh[o]-this.Uh[n],u=this.Fh[l]-this.Fh[n],d=this.Sh[l]-this.Sh[n],w=this.Uh[l]-this.Uh[n];let y=c*w-d*f,A=f*u-w*a,p=a*d-u*c;for(;y>8192||A>8192||p>8192||y<-8192||A<-8192||p<-8192;)y>>=1,A>>=1,p>>=1;let m=0|Math.sqrt(y*y+A*A+p*p);if(m<=0&&(m=1),y=256*y/m|0,A=256*A/m|0,p=256*p/m|0,this.Dh&&1&this.Dh[i]){const n=t+((s*y+h*A+e*p)/(r+(r/2|0))|0);this.Vh&&(this.Mh[i]=v.Lh(this.Vh[i],n,this.Dh[i]))}else{let t=this.Nh[n];t&&(t.x+=y,t.y+=A,t.z+=p,t.w++),t=this.Nh[o],t&&(t.x+=y,t.y+=A,t.z+=p,t.w++),t=this.Nh[l],t&&(t.x+=y,t.y+=A,t.z+=p,t.w++)}}if(n)this.Le(t,r,s,h,e);else{this.Ph=new c(this.Ts,null);for(let t=0;t<this.Ts;t++){const i=this.Nh[t],s=new L;i&&(s.x=i.x,s.y=i.y,s.z=i.z,s.w=i.w),this.Ph[t]=s}}n?this.ce():this.ve()}Le(t,i,s,h,e){for(let n=0;n<this.Os;n++){const r=this.Bh[n],o=this.Gh[n],l=this.Hh[n];if(!this.Dh&&this.Vh&&this.Nh&&this.Mh&&this.xh&&this.kh){const a=this.Vh[n],c=this.Nh[r];c&&(this.Mh[n]=v.Lh(a,t+((s*c.x+h*c.y+e*c.z)/(i*c.w)|0),0));const f=this.Nh[o];f&&(this.xh[n]=v.Lh(a,t+((s*f.x+h*f.y+e*f.z)/(i*f.w)|0),0));const u=this.Nh[l];u&&(this.kh[n]=v.Lh(a,t+((s*u.x+h*u.y+e*u.z)/(i*u.w)|0),0))}else if(this.Dh&&!(1&this.Dh[n])&&this.Vh&&this.Nh&&this.Mh&&this.xh&&this.kh){const a=this.Vh[n],c=this.Dh[n],f=this.Nh[r];f&&(this.Mh[n]=v.Lh(a,t+((s*f.x+h*f.y+e*f.z)/(i*f.w)|0),c));const u=this.Nh[o];u&&(this.xh[n]=v.Lh(a,t+((s*u.x+h*u.y+e*u.z)/(i*u.w)|0),c));const d=this.Nh[l];d&&(this.kh[n]=v.Lh(a,t+((s*d.x+h*d.y+e*d.z)/(i*d.w)|0),c))}}if(this.Nh=null,this.Ph=null,this.ee=null,this.ne=null,this.Dh)for(let t=0;t<this.Os;t++)if(!(2&~this.Dh[t]))return;this.Vh=null}Re(t,i,s,h,e,n,r){const o=O.sin[t],l=O.cos[t],a=O.sin[i],c=O.cos[i],f=O.sin[s],u=O.cos[s],d=O.sin[h],w=O.cos[h],y=n*d+r*w>>16;for(let h=0;h<this.Ts;h++){let A,p=this.Fh[h],m=this.Sh[h],I=this.Uh[h];0!==s&&(A=m*f+p*u>>16,m=m*u-p*f>>16,p=A),0!==t&&(A=m*l-I*o>>16,I=m*o+I*l>>16,m=A),0!==i&&(A=I*a+p*c>>16,I=I*c-p*a>>16,p=A),p+=e,m+=n,I+=r,A=m*w-I*d>>16,I=m*d+I*w>>16,m=A,v.th&&v.ih&&v.sh&&(v.sh[h]=I-y,v.th[h]=O.Ki+((p<<9)/I|0),v.ih[h]=O.Xi+((m<<9)/I|0)),this.bs>0&&v.hh&&v.eh&&v.nh&&(v.hh[h]=p,v.eh[h]=m,v.nh[h]=I)}try{this.Se(!1,!1,0)}catch(t){}}draw(t,i,s,h,e,n,r,o,l){const a=o*e-n*h>>16,c=r*i+a*s>>16,f=this.Jh*s>>16,u=c+f;if(u<=50||c>=3500)return;const d=o*h+n*e>>16;let w=d-this.Jh<<9;if((w/u|0)>=C.pi)return;let y=d+this.Jh<<9;if((y/u|0)<=-C.pi)return;const A=r*s-a*i>>16,p=this.Jh*i>>16;let m=A+p<<9;if((m/u|0)<=-C.mi)return;let I=A-(p+(this.te*s>>16))<<9;if((I/u|0)>=C.mi)return;let E=c-(f+(this.te*i>>16))<=50,g=!1;if(l>0&&v.Eh){let t=c-f;t<=50&&(t=50),d>0?(w=w/u|0,y=y/t|0):(y=y/u|0,w=w/t|0),A>0?(I=I/u|0,m=m/t|0):(m=m/u|0,I=I/t|0);const i=v.gh-O.Ki,s=v._h-O.Xi;i>w&&i<y&&s>I&&s<m&&(this.we?v.Th[v.Ch++]=l:g=!0)}const _=O.Ki,T=O.Xi;let b=0,L=0;0!==t&&(b=O.sin[t],L=O.cos[t]);for(let l=0;l<this.Ts;l++){let a,f=this.Fh[l],u=this.Sh[l],d=this.Uh[l];0!==t&&(a=d*b+f*L>>16,d=d*L-f*b>>16,f=a),f+=n,u+=r,d+=o,a=d*h+f*e>>16,d=d*e-f*h>>16,f=a,a=u*s-d*i>>16,d=u*i+d*s>>16,u=a,v.sh&&(v.sh[l]=d-c),d>=50&&v.th&&v.ih?(v.th[l]=_+((f<<9)/d|0),v.ih[l]=T+((u<<9)/d|0)):v.th&&(v.th[l]=-5e3,E=!0),(E||this.bs>0)&&v.hh&&v.eh&&v.nh&&(v.hh[l]=f,v.eh[l]=u,v.nh[l]=d)}try{this.Se(E,g,l)}catch(t){}}Se(t,i,s,h=!1){v.Oh&&(this.ye=-1,this.Ae=-1);for(let t=0;t<this.ie;t++)v.rh&&(v.rh[t]=0);for(let h=0;h<this.Os;h++)if((!this.Dh||-1!==this.Dh[h])&&v.th&&v.ih&&v.sh&&v.oh&&v.rh){const e=this.Bh[h],n=this.Gh[h],r=this.Hh[h],o=v.th[e],l=v.th[n],a=v.th[r],c=v.ih[e],f=v.ih[n],u=v.ih[r],d=v.sh[e],w=v.sh[n],y=v.sh[r];if(!t||-5e3!==o&&-5e3!==l&&-5e3!==a){i&&this.Me(v.gh,v._h,c,f,u,o,l,a)&&(v.Th[v.Ch++]=s,i=!1);if((o-l)*(u-f)-(c-f)*(a-l)<=0)continue;if(v.Qs&&(v.Qs[h]=!1),v.Js&&(v.Js[h]=o<0||l<0||a<0||o>C.Ai||l>C.Ai||a>C.Ai),v.oh&&v.rh){const t=((d+w+y)/3|0)+this.se;v.oh[t][v.rh[t]++]=h,v.Oh&&this.Me(v.gh,v._h,c,f,u,o,l,a)&&this.Ae<t&&(this.ye=h,this.Ae=t)}}else if(v.Qs&&(v.Qs[h]=!0),v.oh&&v.rh){const t=((d+w+y)/3|0)+this.se;v.oh[t][v.rh[t]++]=h}}if(!this.Wh&&v.rh){for(let t=this.ie-1;t>=0;t--){const i=v.rh[t];if(!(i<=0)&&v.oh){const s=v.oh[t];for(let t=0;t<i;t++)this.xe(s[t],h)}}return}for(let t=0;t<12;t++)v.lh&&v.dh&&(v.lh[t]=0,v.dh[t]=0);if(v.rh)for(let t=this.ie-1;t>=0;t--){const i=v.rh[t];if(i>0&&v.oh){const s=v.oh[t];for(let h=0;h<i;h++)if(this.Wh&&v.lh&&v.ah){const i=s[h],e=this.Wh[i],n=v.lh[e]++;v.ah[e][n]=i,e<10&&v.dh?v.dh[e]+=t:10===e&&v.fh?v.fh[n]=t:v.uh&&(v.uh[n]=t)}}}let e=0;v.lh&&v.dh&&(v.lh[1]>0||v.lh[2]>0)&&(e=(v.dh[1]+v.dh[2])/(v.lh[1]+v.lh[2])|0);let n=0;v.lh&&v.dh&&(v.lh[3]>0||v.lh[4]>0)&&(n=(v.dh[3]+v.dh[4])/(v.lh[3]+v.lh[4])|0);let r=0;if(v.lh&&v.dh&&(v.lh[6]>0||v.lh[8]>0)&&(r=(v.dh[6]+v.dh[8])/(v.lh[6]+v.lh[8])|0),v.lh&&v.ah){let t,i=0,s=v.lh[10],o=v.ah[10],l=v.fh;i===s&&(i=0,s=v.lh[11],o=v.ah[11],l=v.uh),t=i<s&&l?l[i]:-1e3;for(let a=0;a<10;a++){for(;0===a&&t>e;)try{this.xe(o[i++],h),i===s&&o!==v.ah[11]&&(i=0,s=v.lh[11],o=v.ah[11],l=v.uh),t=i<s&&l?l[i]:-1e3}catch(t){}for(;3===a&&t>n;)try{this.xe(o[i++],h),i===s&&o!==v.ah[11]&&(i=0,s=v.lh[11],o=v.ah[11],l=v.uh),t=i<s&&l?l[i]:-1e3}catch(t){}for(;5===a&&t>r;)try{this.xe(o[i++],h),i===s&&o!==v.ah[11]&&(i=0,s=v.lh[11],o=v.ah[11],l=v.uh),t=i<s&&l?l[i]:-1e3}catch(t){}const c=v.lh[a],f=v.ah[a];for(let t=0;t<c;t++)this.xe(f[t],h)}for(;-1e3!==t;)try{this.xe(o[i++],h),i===s&&o!==v.ah[11]&&(i=0,o=v.ah[11],s=v.lh[11],l=v.uh),t=i<s&&l?l[i]:-1e3}catch(t){}}}xe(t,i=!1){if(v.Qs&&v.Qs[t])return void this.ke(t,i);const s=this.Bh[t],h=this.Gh[t],e=this.Hh[t];let n;if(v.Js&&(O.zi=v.Js[t]),this.Yh?O.alpha=this.Yh[t]:O.alpha=0,n=this.Dh?3&this.Dh[t]:0,i&&v.th&&v.ih&&this.Mh&&this.xh&&this.kh)O.Ti(v.th[s],v.ih[s],v.th[h],v.ih[h],O.palette[this.Mh[t]]),O.Ti(v.th[h],v.ih[h],v.th[e],v.ih[e],O.palette[this.xh[t]]),O.Ti(v.th[e],v.ih[e],v.th[s],v.ih[s],O.palette[this.kh[t]]);else if(0===n&&this.Mh&&this.xh&&this.kh&&v.th&&v.ih)O.As(v.th[s],v.th[h],v.th[e],v.ih[s],v.ih[h],v.ih[e],this.Mh[t],this.xh[t],this.kh[t]);else if(1===n&&this.Mh&&v.th&&v.ih)O.Is(v.th[s],v.th[h],v.th[e],v.ih[s],v.ih[h],v.ih[e],O.palette[this.Mh[t]]);else if(2===n&&this.Dh&&this.Vh&&this.Mh&&this.xh&&this.kh&&v.th&&v.ih&&v.hh&&v.eh&&v.nh){const i=this.Dh[t]>>2,n=this.Kh[i],r=this.Xh[i],o=this.jh[i];O.gs(v.th[s],v.th[h],v.th[e],v.ih[s],v.ih[h],v.ih[e],this.Mh[t],this.xh[t],this.kh[t],v.hh[n],v.eh[n],v.nh[n],v.hh[r],v.hh[o],v.eh[r],v.eh[o],v.nh[r],v.nh[o],this.Vh[t])}else if(3===n&&this.Dh&&this.Vh&&this.Mh&&v.th&&v.ih&&v.hh&&v.eh&&v.nh){const i=this.Dh[t]>>2,n=this.Kh[i],r=this.Xh[i],o=this.jh[i];O.gs(v.th[s],v.th[h],v.th[e],v.ih[s],v.ih[h],v.ih[e],this.Mh[t],this.Mh[t],this.Mh[t],v.hh[n],v.eh[n],v.nh[n],v.hh[r],v.hh[o],v.eh[r],v.eh[o],v.nh[r],v.nh[o],this.Vh[t])}}ke(t,i=!1){let s=0;if(v.nh){const i=O.Ki,h=O.Xi,e=this.Bh[t],n=this.Gh[t],r=this.Hh[t],o=v.nh[e],l=v.nh[n],a=v.nh[r];if(o>=50&&v.th&&v.ih&&this.Mh)v.wh[s]=v.th[e],v.yh[s]=v.ih[e],v.Ah[s++]=this.Mh[t];else if(v.hh&&v.eh&&this.Mh){const c=v.hh[e],f=v.eh[e],u=this.Mh[t];if(a>=50&&this.kh){const e=(50-o)*O.Hi[a-o];v.wh[s]=i+((c+((v.hh[r]-c)*e>>16)<<9)/50|0),v.yh[s]=h+((f+((v.eh[r]-f)*e>>16)<<9)/50|0),v.Ah[s++]=u+((this.kh[t]-u)*e>>16)}if(l>=50&&this.xh){const e=(50-o)*O.Hi[l-o];v.wh[s]=i+((c+((v.hh[n]-c)*e>>16)<<9)/50|0),v.yh[s]=h+((f+((v.eh[n]-f)*e>>16)<<9)/50|0),v.Ah[s++]=u+((this.xh[t]-u)*e>>16)}}if(l>=50&&v.th&&v.ih&&this.xh)v.wh[s]=v.th[n],v.yh[s]=v.ih[n],v.Ah[s++]=this.xh[t];else if(v.hh&&v.eh&&this.xh){const c=v.hh[n],f=v.eh[n],u=this.xh[t];if(o>=50&&this.Mh){const n=(50-l)*O.Hi[o-l];v.wh[s]=i+((c+((v.hh[e]-c)*n>>16)<<9)/50|0),v.yh[s]=h+((f+((v.eh[e]-f)*n>>16)<<9)/50|0),v.Ah[s++]=u+((this.Mh[t]-u)*n>>16)}if(a>=50&&this.kh){const e=(50-l)*O.Hi[a-l];v.wh[s]=i+((c+((v.hh[r]-c)*e>>16)<<9)/50|0),v.yh[s]=h+((f+((v.eh[r]-f)*e>>16)<<9)/50|0),v.Ah[s++]=u+((this.kh[t]-u)*e>>16)}}if(a>=50&&v.th&&v.ih&&this.kh)v.wh[s]=v.th[r],v.yh[s]=v.ih[r],v.Ah[s++]=this.kh[t];else if(v.hh&&v.eh&&this.kh){const c=v.hh[r],f=v.eh[r],u=this.kh[t];if(l>=50&&this.xh){const e=(50-a)*O.Hi[l-a];v.wh[s]=i+((c+((v.hh[n]-c)*e>>16)<<9)/50|0),v.yh[s]=h+((f+((v.eh[n]-f)*e>>16)<<9)/50|0),v.Ah[s++]=u+((this.xh[t]-u)*e>>16)}if(o>=50&&this.Mh){const n=(50-a)*O.Hi[o-a];v.wh[s]=i+((c+((v.hh[e]-c)*n>>16)<<9)/50|0),v.yh[s]=h+((f+((v.eh[e]-f)*n>>16)<<9)/50|0),v.Ah[s++]=u+((this.Mh[t]-u)*n>>16)}}}const h=v.wh[0],e=v.wh[1],n=v.wh[2],r=v.yh[0],o=v.yh[1],l=v.yh[2];if(!((h-e)*(l-o)-(r-o)*(n-e)<=0))if(O.zi=!1,3===s){let s;if((h<0||e<0||n<0||h>C.Ai||e>C.Ai||n>C.Ai)&&(O.zi=!0),s=this.Dh?3&this.Dh[t]:0,i)O.Ti(h,e,r,o,v.Ah[0]),O.Ti(e,n,o,l,v.Ah[1]),O.Ti(n,h,l,r,v.Ah[2]);else if(0===s)O.As(h,e,n,r,o,l,v.Ah[0],v.Ah[1],v.Ah[2]);else if(1===s&&this.Mh)O.Is(h,e,n,r,o,l,O.palette[this.Mh[t]]);else if(2===s&&this.Dh&&this.Vh&&v.hh&&v.eh&&v.nh){const i=this.Dh[t]>>2,s=this.Kh[i],a=this.Xh[i],c=this.jh[i];O.gs(h,e,n,r,o,l,v.Ah[0],v.Ah[1],v.Ah[2],v.hh[s],v.eh[s],v.nh[s],v.hh[a],v.hh[c],v.eh[a],v.eh[c],v.nh[a],v.nh[c],this.Vh[t])}else if(3===s&&this.Dh&&this.Vh&&this.Mh&&v.hh&&v.eh&&v.nh){const i=this.Dh[t]>>2,s=this.Kh[i],a=this.Xh[i],c=this.jh[i];O.gs(h,e,n,r,o,l,this.Mh[t],this.Mh[t],this.Mh[t],v.hh[s],v.eh[s],v.nh[s],v.hh[a],v.hh[c],v.eh[a],v.eh[c],v.nh[a],v.nh[c],this.Vh[t])}}else if(4===s){let s;if((h<0||e<0||n<0||h>C.Ai||e>C.Ai||n>C.Ai||v.wh[3]<0||v.wh[3]>C.Ai)&&(O.zi=!0),s=this.Dh?3&this.Dh[t]:0,i)O.Ti(h,e,r,o,v.Ah[0]),O.Ti(e,n,o,l,v.Ah[1]),O.Ti(n,v.wh[3],l,v.yh[3],v.Ah[2]),O.Ti(v.wh[3],h,v.yh[3],r,v.Ah[3]);else if(0===s)O.As(h,e,n,r,o,l,v.Ah[0],v.Ah[1],v.Ah[2]),O.As(h,n,v.wh[3],r,l,v.yh[3],v.Ah[0],v.Ah[2],v.Ah[3]);else if(1===s){if(this.Mh){const i=O.palette[this.Mh[t]];O.Is(h,e,n,r,o,l,i),O.Is(h,n,v.wh[3],r,l,v.yh[3],i)}}else if(2===s&&this.Dh&&this.Vh&&v.hh&&v.eh&&v.nh){const i=this.Dh[t]>>2,s=this.Kh[i],a=this.Xh[i],c=this.jh[i];O.gs(h,e,n,r,o,l,v.Ah[0],v.Ah[1],v.Ah[2],v.hh[s],v.eh[s],v.nh[s],v.hh[a],v.hh[c],v.eh[a],v.eh[c],v.nh[a],v.nh[c],this.Vh[t]),O.gs(h,n,v.wh[3],r,l,v.yh[3],v.Ah[0],v.Ah[2],v.Ah[3],v.hh[s],v.eh[s],v.nh[s],v.hh[a],v.hh[c],v.eh[a],v.eh[c],v.nh[a],v.nh[c],this.Vh[t])}else if(3===s&&this.Dh&&this.Vh&&this.Mh&&v.hh&&v.eh&&v.nh){const i=this.Dh[t]>>2,s=this.Kh[i],a=this.Xh[i],c=this.jh[i];O.gs(h,e,n,r,o,l,this.Mh[t],this.Mh[t],this.Mh[t],v.hh[s],v.eh[s],v.nh[s],v.hh[a],v.hh[c],v.eh[a],v.eh[c],v.nh[a],v.nh[c],this.Vh[t]),O.gs(h,n,v.wh[3],r,l,v.yh[3],this.Mh[t],this.Mh[t],this.Mh[t],v.hh[s],v.eh[s],v.nh[s],v.hh[a],v.hh[c],v.eh[a],v.eh[c],v.nh[a],v.nh[c],this.Vh[t])}}}Ee(t,i,s,h,e){if(!h)return;const n=h.length;if(0===e){let e=0;v.ph=0,v.mh=0,v.Ih=0;for(let t=0;t<n;t++){if(!this.oe)continue;const i=h[t];if(i<this.oe.length){const t=this.oe[i];if(t)for(let i=0;i<t.length;i++){const s=t[i];v.ph+=this.Fh[s],v.mh+=this.Sh[s],v.Ih+=this.Uh[s],e++}}}e>0?(v.ph=(v.ph/e|0)+t,v.mh=(v.mh/e|0)+i,v.Ih=(v.Ih/e|0)+s):(v.ph=t,v.mh=i,v.Ih=s)}else if(1===e)for(let e=0;e<n;e++){const n=h[e];if(!this.oe||n>=this.oe.length)continue;const r=this.oe[n];if(r)for(let h=0;h<r.length;h++){const e=r[h];this.Fh[e]+=t,this.Sh[e]+=i,this.Uh[e]+=s}}else if(2===e)for(let e=0;e<n;e++){const n=h[e];if(!this.oe||n>=this.oe.length)continue;const r=this.oe[n];if(r)for(let h=0;h<r.length;h++){const e=r[h];this.Fh[e]-=v.ph,this.Sh[e]-=v.mh,this.Uh[e]-=v.Ih;const n=8*(255&t),o=8*(255&i),l=8*(255&s);let a,c;if(0!==l){a=O.sin[l],c=O.cos[l];const t=this.Sh[e]*a+this.Fh[e]*c>>16;this.Sh[e]=this.Sh[e]*c-this.Fh[e]*a>>16,this.Fh[e]=t}if(0!==n){a=O.sin[n],c=O.cos[n];const t=this.Sh[e]*c-this.Uh[e]*a>>16;this.Uh[e]=this.Sh[e]*a+this.Uh[e]*c>>16,this.Sh[e]=t}if(0!==o){a=O.sin[o],c=O.cos[o];const t=this.Uh[e]*a+this.Fh[e]*c>>16;this.Uh[e]=this.Uh[e]*c-this.Fh[e]*a>>16,this.Fh[e]=t}this.Fh[e]+=v.ph,this.Sh[e]+=v.mh,this.Uh[e]+=v.Ih}}else if(3===e)for(let e=0;e<n;e++){const n=h[e];if(!this.oe||n>=this.oe.length)continue;const r=this.oe[n];if(r)for(let h=0;h<r.length;h++){const e=r[h];this.Fh[e]-=v.ph,this.Sh[e]-=v.mh,this.Uh[e]-=v.Ih,this.Fh[e]=this.Fh[e]*t/128|0,this.Sh[e]=this.Sh[e]*i/128|0,this.Uh[e]=this.Uh[e]*s/128|0,this.Fh[e]+=v.ph,this.Sh[e]+=v.mh,this.Uh[e]+=v.Ih}}else if(5===e&&this.le&&this.Yh)for(let i=0;i<n;i++){const s=h[i];if(s>=this.le.length)continue;const e=this.le[s];if(e)for(let i=0;i<e.length;i++){const s=e[i];this.Yh[s]+=8*t,this.Yh[s]<0&&(this.Yh[s]=0),this.Yh[s]>255&&(this.Yh[s]=255)}}}ve(){this.te=0,this.Jh=0,this.Qh=0,this.zh=999999,this.Zh=-999999,this.$h=-99999,this.qh=99999;for(let t=0;t<this.Ts;t++){const i=this.Fh[t],s=this.Sh[t],h=this.Uh[t];i<this.zh&&(this.zh=i),i>this.Zh&&(this.Zh=i),h<this.qh&&(this.qh=h),h>this.$h&&(this.$h=h),-s>this.te&&(this.te=-s),s>this.Qh&&(this.Qh=s);const e=i*i+h*h;e>this.Jh&&(this.Jh=e)}this.Jh=0|Math.sqrt(this.Jh),this.se=0|Math.sqrt(this.Jh*this.Jh+this.te*this.te),this.ie=this.se+(0|Math.sqrt(this.Jh*this.Jh+this.Qh*this.Qh))}Me(t,i,s,h,e,n,r,o){return!(i<s&&i<h&&i<e)&&(!(i>s&&i>h&&i>e)&&(!(t<n&&t<r&&t<o)&&(t<=n||t<=r||t<=o)))}De(t){if(!(v.th&&v.ih&&this.Mh&&this.xh&&this.kh))return;const i=this.Bh[t],s=this.Gh[t],h=this.Hh[t];O.Ti(v.th[i],v.ih[i],v.th[s],v.ih[s],O.palette[1e3]),O.Ti(v.th[s],v.ih[s],v.th[h],v.ih[h],O.palette[1e3]),O.Ti(v.th[h],v.ih[h],v.th[i],v.ih[i],O.palette[1e3])}}class R{static Ne=0;static Pe=1;static Fe=2;static Ue=3}class S{static Be=new S(0,R.Ne);static Ge=new S(1,R.Ne);static He=new S(2,R.Ne);static We=new S(3,R.Ne);static Ye=new S(4,R.Pe);static Ve=new S(5,R.Pe);static Ke=new S(6,R.Pe);static Xe=new S(7,R.Pe);static je=new S(8,R.Pe);static ze=new S(9,R.Fe);static Ze=new S(10,R.Fe);static qe=new S(11,R.Fe);static $e=new S(12,R.Fe);static Je=new S(13,R.Fe);static Qe=new S(14,R.Fe);static tn=new S(15,R.Fe);static sn=new S(16,R.Fe);static hn=new S(17,R.Fe);static en=new S(18,R.Fe);static nn=new S(19,R.Fe);static rn=new S(20,R.Fe);static ln=new S(21,R.Fe);static Ue=new S(22,R.Ue);static values(){return[this.Be,this.Ge,this.hn,this.tn,this.He,this.Qe,this.ze,this.We,this.Ue,this.$e,this.qe,this.Ke,this.rn,this.Ze,this.Ve,this.Je,this.Xe,this.Ye,this.sn,this.je,this.nn,this.ln,this.en]}static of(t){const i=this.values();for(let s=0;s<i.length;s++){const h=i[s];if(h.id===t)return h}throw Error('shape not found')}id;an;constructor(t,i){this.id=t,this.an=i}}class M{static cn=0;static fn=1;static un=2;static dn=3}class x extends t{static count=0;static cache=null;static wn=null;static yn=null;static An=0;static pn=new _(500);static mn=new _(30);static Jt=t=>{this.wn=new a(t.read('loc.dat'));const i=new a(t.read('loc.idx'));this.count=i.St,this.yn=new Int32Array(this.count);let s=2;for(let t=0;t<this.count;t++)this.yn[t]=s,s+=i.St;this.cache=new c(10,null);for(let t=0;t<10;t++)this.cache[t]=new x(-1)};static get=t=>{if(!this.cache||!this.yn||!this.wn)throw new Error('LocType not loaded!!!');for(let i=0;i<10;i++){const s=this.cache[i];if(s&&s.id===t)return s}this.An=(this.An+1)%10;const i=this.cache[this.An];return this.wn.bt=this.yn[t],i.id=t,i.reset(),i.it(this.wn),i.In||(i.In=new Int32Array(1)),-1===i.En&&i.In&&(i.active=i.In.length>0&&i.In[0]===S.Ze.id,i.gn&&(i.active=!0)),i};static ns=()=>{this.pn=null,this.mn=null,this.yn=null,this.cache=null,this.wn=null};_n=null;In=null;name=null;Cn=null;Tn=null;On=null;width=1;length=1;bn=!0;Ln=!0;active=!1;En=-1;vn=!1;Rn=!1;Sn=!1;Mn=-1;xn=!1;kn=16;Dn=0;Nn=0;gn=null;Pn=-1;Fn=-1;Un=!1;Bn=!0;Gn=128;Hn=128;Wn=128;Yn=0;Vn=0;Kn=0;Xn=0;jn=!1;decode(t,i){if(1===t){const t=i.st;this._n=new Int32Array(t),this.In=new Int32Array(t);for(let s=0;s<t;s++)this._n[s]=i.St,this.In[s]=i.st}else if(2===t)this.name=i.Ft;else if(3===t)this.Cn=i.Ft;else if(14===t)this.width=i.st;else if(15===t)this.length=i.st;else if(17===t)this.bn=!1;else if(18===t)this.Ln=!1;else if(19===t)this.En=i.st,1===this.En&&(this.active=!0);else if(21===t)this.vn=!0;else if(22===t)this.Rn=!0;else if(23===t)this.Sn=!0;else if(24===t)this.Mn=i.St,65535===this.Mn&&(this.Mn=-1);else if(25===t)this.xn=!0;else if(28===t)this.kn=i.st;else if(29===t)this.Dn=i.Rt;else if(39===t)this.Nn=i.Rt;else if(t>=30&&t<39)this.gn||(this.gn=new c(5,null)),this.gn[t-30]=i.Ft,'hidden'===this.gn[t-30]?.toLowerCase()&&(this.gn[t-30]=null);else if(40===t){const t=i.st;this.Tn=new Uint16Array(t),this.On=new Uint16Array(t);for(let s=0;s<t;s++)this.Tn[s]=i.St,this.On[s]=i.St}else 60===t?this.Pn=i.St:62===t?this.Un=!0:64===t?this.Bn=!1:65===t?this.Gn=i.St:66===t?this.Hn=i.St:67===t?this.Wn=i.St:68===t?this.Fn=i.St:69===t?this.Yn=i.st:70===t?this.Vn=i.Mt:71===t?this.Kn=i.Mt:72===t?this.Xn=i.Mt:73===t&&(this.jn=!0)}zn(t,i,s,h,e,n,r){if(!this.In)return null;let o=-1;for(let i=0;i<this.In.length;i++)if(this.In[i]===t){o=i;break}if(-1===o)return null;const l=BigInt(BigInt(this.id)<<6n)+BigInt(BigInt(o)<<3n)+BigInt(i)+BigInt(BigInt(r)+1n<<32n);let a=x.mn?.get(l);if(a){if((this.vn||this.Rn)&&(a=v.Rh(a,this.vn,this.Rn)),this.vn){const t=(s+h+e+n)/4|0;for(let i=0;i<a.Ts;i++){const r=a.Fh[i],o=s+((h-s)*(r+64)/128|0),l=o+((n+((e-n)*(r+64)/128|0)-o)*(a.Uh[i]+64)/128|0);a.Sh[i]+=l-t}a.pe()}return a}if(!this._n)return null;if(o>=this._n.length)return null;let c=this._n[o];if(-1===c)return null;const f=this.Un!==i>3;f&&(c+=65536);let u=x.pn?.get(BigInt(c));u||(u=v.model(65535&c),f&&u.Oe(),x.pn?.put(BigInt(c),u));const d=128!==this.Gn||128!==this.Hn||128!==this.Wn,w=0!==this.Vn||0!==this.Kn||0!==this.Xn;let y=v.he(u,!this.Tn,!this.xn,i===M.cn&&-1===r&&!d&&!w);for(-1!==r&&(y.me(),y.ge(r),y.le=null,y.oe=null);i-- >0;)y._e();if(this.Tn&&this.On)for(let t=0;t<this.Tn.length;t++)y.Te(this.Tn[t],this.On[t]);if(d&&y.scale(this.Gn,this.Hn,this.Wn),w&&y.translate(this.Kn,this.Vn,this.Xn),y.be(64+(255&this.Dn),5*(255&this.Nn)+768,-50,-10,-50,!this.Rn),this.bn&&(y.de=y.te),x.mn?.put(l,y),(this.vn||this.Rn)&&(y=v.Rh(y,this.vn,this.Rn)),this.vn){const t=(s+h+e+n)/4|0;for(let i=0;i<y.Ts;i++){const r=y.Fh[i],o=s+((h-s)*(r+64)/128|0),l=o+((n+((e-n)*(r+64)/128|0)-o)*(y.Uh[i]+64)/128|0);y.Sh[i]+=l-t}y.pe()}return y}reset(){this._n=null,this.In=null,this.name=null,this.Cn=null,this.Tn=null,this.On=null,this.width=1,this.length=1,this.bn=!0,this.Ln=!0,this.active=!1,this.En=-1,this.vn=!1,this.Rn=!1,this.Sn=!1,this.Mn=-1,this.kn=16,this.Dn=0,this.Nn=0,this.gn=null,this.xn=!1,this.Pn=-1,this.Fn=-1,this.Un=!1,this.Bn=!0,this.Gn=128,this.Hn=128,this.Wn=128,this.Yn=0,this.Vn=0,this.Kn=0,this.Xn=0,this.jn=!1}}const k=document.getElementById('canvas'),D=k.getContext('2d',{willReadFrequently:!0}),N=document.createElement('canvas'),P=document.createElement('img'),F=N.getContext('2d',{willReadFrequently:!0});class U extends l{di;width;height;vi;Ri;Si;Mi;constructor(t,i){super(),this.di=new Int32Array(t*i),this.width=this.Si=t,this.height=this.Mi=i,this.vi=this.Ri=0}static Zn=async(t,i)=>{const s=t.read(i+'.dat');if(!s)throw new Error(`${i} jpeg not found!`);const h=await(async t=>{255!==t[0]&&(t[0]=255),URL.revokeObjectURL(P.src),P.src=URL.createObjectURL(new Blob([t],{type:'image/jpeg'})),await new Promise((t=>P.onload=()=>t())),F.clearRect(0,0,N.width,N.height);const i=P.naturalWidth,s=P.naturalHeight;return N.width=i,N.height=s,F.drawImage(P,0,0),F.getImageData(0,0,i,s)})(s),e=new U(h.width,h.height),n=new Uint32Array(h.data.buffer),r=e.di;for(let t=0;t<r.length;t++){const i=n[t];r[t]=(i>>24&255)<<24|(255&i)<<16|(i>>8&255)<<8|i>>16&255}return e};static xi=(t,i,s=0)=>{const h=new a(t.read(i+'.dat')),e=new a(t.read('index.dat'));e.bt=h.St;const n=e.St,r=e.St,o=[],l=e.st-1;for(let t=0;t<l;t++)o[t+1]=e.xt,0===o[t+1]&&(o[t+1]=1);for(let t=0;t<s;t++)e.bt+=2,h.bt+=e.St*e.St,e.bt+=1;if(h.bt>h.length||e.bt>e.length)throw new Error;const c=e.st,f=e.st,u=e.St,d=e.St,w=new U(u,d);w.vi=c,w.Ri=f,w.Si=n,w.Mi=r;const y=e.st;if(0===y){const t=w.width*w.height;for(let i=0;i<t;i++)w.di[i]=o[h.st]}else if(1===y){const t=w.width;for(let i=0;i<t;i++){const s=w.height;for(let e=0;e<s;e++)w.di[i+e*t]=o[h.st]}}return w};bind(){C.bind(this.di,this.width,this.height)}draw(t,i){t|=0,i|=0;let s=(t+=this.vi)+(i+=this.Ri)*C.wi,h=0,e=this.height,n=this.width,r=C.wi-n,o=0;if(i<C.top){const t=C.top-i;e-=t,i=C.top,h+=t*n,s+=t*C.wi}if(i+e>C.bottom&&(e-=i+e-C.bottom),t<C.left){const i=C.left-t;n-=i,t=C.left,h+=i,s+=i,o+=i,r+=i}if(t+n>C.right){const i=t+n-C.right;n-=i,o+=i,r+=i}n>0&&e>0&&this.qn(n,e,this.di,h,o,C.di,s,r)}$n(t,i,s){i|=0,s|=0;let h=(i+=this.vi)+(s+=this.Ri)*C.wi,e=0,n=this.height,r=this.width,o=C.wi-r,l=0;if(s<C.top){const t=C.top-s;n-=t,s=C.top,e+=t*r,h+=t*C.wi}if(s+n>C.bottom&&(n-=s+n-C.bottom),i<C.left){const t=C.left-i;r-=t,i=C.left,e+=t,h+=t,l+=t,o+=t}if(i+r>C.right){const t=i+r-C.right;r-=t,l+=t,o+=t}r>0&&n>0&&this.Jn(r,n,this.di,e,l,C.di,h,o,t)}Qn(t,i){t|=0,i|=0;let s=(t+=this.vi)+(i+=this.Ri)*C.wi,h=0,e=this.height,n=this.width,r=C.wi-n,o=0;if(i<C.top){const t=C.top-i;e-=t,i=C.top,h+=t*n,s+=t*C.wi}if(i+e>C.bottom&&(e-=i+e-C.bottom),t<C.left){const i=C.left-t;n-=i,t=C.left,h+=i,s+=i,o+=i,r+=i}if(t+n>C.right){const i=t+n-C.right;n-=i,o+=i,r+=i}n>0&&e>0&&this.tr(n,e,this.di,h,o,C.di,s,r)}Di(){const t=this.di,i=this.width,s=this.height;for(let h=0;h<s;h++){const s=i/2|0;for(let e=0;e<s;e++){const s=e+h*i,n=i-e-1+h*i,r=t[s];t[s]=t[n],t[n]=r}}}Ni(){const t=this.di,i=this.width,s=this.height;for(let h=0;h<(s/2|0);h++)for(let e=0;e<i;e++){const n=e+h*i,r=e+(s-h-1)*i,o=t[n];t[n]=t[r],t[r]=o}}translate(t,i,s){for(let h=0;h<this.di.length;h++){const e=this.di[h];if(0!==e){let n=e>>16&255;n+=t,n<1?n=1:n>255&&(n=255);let r=e>>8&255;r+=i,r<1?r=1:r>255&&(r=255);let o=255&e;o+=s,o<1?o=1:o>255&&(o=255),this.di[h]=(n<<16)+(r<<8)+o}}}Fi(t,i,s,h){t|=0,i|=0,s|=0,h|=0;try{const e=this.width;let n=0,r=0;const o=this.Si,l=this.Mi,a=(o<<16)/s|0,c=(l<<16)/h|0;t+=(this.vi*s+o-1)/o|0,i+=(this.Ri*h+l-1)/l|0,this.vi*s%o!=0&&(n=(o-this.vi*s%o<<16)/s|0),this.Ri*h%l!=0&&(r=(l-this.Ri*h%l<<16)/h|0),s=s*(this.width-(n>>16))/o|0,h=h*(this.height-(r>>16))/l|0;let f=t+i*C.wi,u=C.wi-s;if(i<C.top){const t=C.top-i;h-=t,i=0,f+=t*C.wi,r+=c*t}if(i+h>C.bottom&&(h-=i+h-C.bottom),t<C.left){const i=C.left-t;s-=i,t=0,f+=i,n+=a*i,u+=i}if(t+s>C.right){const i=t+s-C.right;s-=i,u+=i}this.scale(s,h,this.di,n,r,C.di,u,f,e,a,c)}catch(t){console.error('error in sprite clipping routine')}}ir(t,i,s,h,e,n,r,o,l,a){t|=0,i|=0,s|=0,h|=0;try{const c=-s/2|0,f=-h/2|0,u=65536*Math.sin(l/326.11)|0,d=65536*Math.cos(l/326.11)|0,w=u*a>>8,y=d*a>>8;let A=(r<<16)+f*w+c*y,p=f*y-c*w+(o<<16),m=t+i*C.wi;for(let t=0;t<h;t++){const i=e[t];let s=m+i,h=A+y*i,r=p-w*i;for(let i=-n[t];i<0;i++)C.di[s++]=this.di[(h>>16)+(r>>16)*this.width],h+=y,r-=w;A+=w,p+=y,m+=C.wi}}catch(t){}}sr(t,i,s){t|=0,i|=0;let h=(t+=this.vi)+(i+=this.Ri)*C.wi,e=0,n=this.height,r=this.width,o=C.wi-r,l=0;if(i<C.top){const t=C.top-i;n-=t,i=C.top,e+=t*r,h+=t*C.wi}if(i+n>C.bottom&&(n-=i+n-C.bottom),t<C.left){const i=C.left-t;r-=i,t=C.left,e+=i,h+=i,l+=i,o+=i}if(t+r>C.right){const i=t+r-C.right;r-=i,l+=i,o+=i}r>0&&n>0&&this.hr(r,n,this.di,l,e,C.di,h,o,s.di)}scale(t,i,s,h,e,n,r,o,l,a,c){try{const f=h;for(let u=-i;u<0;u++){const i=(e>>16)*l;for(let e=-t;e<0;e++){const t=s[(h>>16)+i];0===t?o++:n[o++]=t,h+=a}e+=c,h=f,o+=r}}catch(t){console.error('error in plot_scale')}}tr(t,i,s,h,e,n,r,o){const l=-(t>>2);t=-(3&t);for(let a=-i;a<0;a++){for(let t=l;t<0;t++)n[r++]=s[h++],n[r++]=s[h++],n[r++]=s[h++],n[r++]=s[h++];for(let i=t;i<0;i++)n[r++]=s[h++];r+=o,h+=e}}Jn(t,i,s,h,e,n,r,o,l){const a=256-l;for(let c=-i;c<0;c++){for(let i=-t;i<0;i++){const t=s[h++];if(0===t)r++;else{const i=n[r];n[r++]=((16711935&t)*l+(16711935&i)*a&4278255360)+((65280&t)*l+(65280&i)*a&16711680)>>8}}r+=o,h+=e}}qn(t,i,s,h,e,n,r,o){const l=-(t>>2);t=-(3&t);for(let a=-i;a<0;a++){for(let t=l;t<0;t++){let t=s[h++];0===t?r++:n[r++]=t,t=s[h++],0===t?r++:n[r++]=t,t=s[h++],0===t?r++:n[r++]=t,t=s[h++],0===t?r++:n[r++]=t}for(let i=t;i<0;i++){const t=s[h++];0===t?r++:n[r++]=t}r+=o,h+=e}}hr(t,i,s,h,e,n,r,o,l){const a=-(t>>2);t=-(3&t);for(let c=-i;c<0;c++){for(let t=a;t<0;t++){let t=s[e++];0!==t&&0===l[r]?n[r++]=t:r++,t=s[e++],0!==t&&0===l[r]?n[r++]=t:r++,t=s[e++],0!==t&&0===l[r]?n[r++]=t:r++,t=s[e++],0!==t&&0===l[r]?n[r++]=t:r++}for(let i=t;i<0;i++){const t=s[e++];0!==t&&0===l[r]?n[r++]=t:r++}r+=o,e+=h}}}class B{static RED=16711680;static GREEN=65280;static BLUE=255;static er=16776960;static nr=65535;static rr=16711935;static lr=16777215;static ar=0;static cr=16748608;static ur=8388608;static dr=128;static wr=16756736;static yr=16740352;static Ar=16723968;static pr=12648192;static mr=8453888;static Ir=4259584;static Er=9179409;static gr=6116423;static _r=2301979;static Cr=5063219;static Tr=7759444;static Or=3353893;static br=8388736;static Lr=13350793;static vr=Int32Array.of(B.er,B.RED,B.GREEN,B.nr,B.rr,B.lr);static Rr=6798;static Sr=107;static Mr=10283;static kr=16;static Dr=4797;static Nr=7744;static Pr=5799;static Fr=4634;static Ur=33697;static Br=22433;static Gr=2983;static Hr=54193;static Wr=8741;static Yr=12;static Vr=64030;static Kr=43162;static Xr=7735;static jr=8404;static zr=1701;static Zr=38430;static qr=24094;static $r=10153;static Jr=56621;static Qr=4783;static io=1341;static so=16578;static ho=35003;static eo=25239;static no=9104;static ro=10275;static oo=7595;static lo=3610;static ao=7975;static co=8526;static fo=918;static uo=38802;static do=24466;static wo=10145;static yo=58654;static Ao=5027;static po=1457;static mo=16565;static Io=34991;static Eo=25486;static _o=4626;static Co=11146;static To=6439;static Oo=12;static bo=4758;static Lo=10270;static vo=4574;static Ro=4550;static So=4537;static Mo=5681;static xo=5673;static ko=5790;static Do=6806;static No=8076}class G extends t{static count=0;static cache=null;static wn=null;static yn=null;static An=0;static Po=!0;static Fo=new _(50);static Uo=new _(200);static Jt=(t,i)=>{this.Po=i,this.wn=new a(t.read('obj.dat'));const s=new a(t.read('obj.idx'));this.count=s.St,this.yn=new Int32Array(this.count);let h=2;for(let t=0;t<this.count;t++)this.yn[t]=h,h+=s.St;this.cache=new c(10,null);for(let t=0;t<10;t++)this.cache[t]=new G(-1)};static get=t=>{if(!this.cache||!this.yn||!this.wn)throw new Error('ObjType not loaded!!!');for(let i=0;i<10;i++){const s=this.cache[i];if(s&&s.id===t)return s}this.An=(this.An+1)%10;const i=this.cache[this.An];return this.wn.bt=this.yn[t],i.id=t,i.reset(),i.it(this.wn),-1!==i.Bo&&i.Go(),!this.Po&&i.members&&(i.name='Members Object',i.Cn="Login to a members' server to use this object.",i.gn=null,i.Ho=null),i};static ns=()=>{this.Fo=null,this.Uo=null,this.yn=null,this.cache=null,this.wn=null};static Wo=(t,i)=>{if(G.Uo){let s=G.Uo.get(BigInt(t));if(s&&s.Mi!==i&&-1!==s.Mi&&(s.et(),s=null),s)return s}let s=G.get(t);if(s.Yo||(i=-1),s.Yo&&s.Vo&&i>1){let t=-1;for(let h=0;h<10;h++)i>=s.Vo[h]&&0!==s.Vo[h]&&(t=s.Yo[h]);-1!==t&&(s=G.get(t))}const h=new U(32,32),e=O.Ki,n=O.Xi,r=O.Vi,o=C.di,l=C.wi,a=C.yi,c=C.left,f=C.right,u=C.top,d=C.bottom;O.ji=!1,C.bind(h.di,32,32),C.fillRect(0,0,32,32,B.ar),O.rs();const w=s.Ko(1),y=O.sin[s.Xo]*s.jo>>16,A=O.cos[s.Xo]*s.jo>>16;w.Re(0,s.zo,s.Zo,s.Xo,s.qo,y+(w.te/2|0)+s.$o,A+s.$o);for(let t=31;t>=0;t--)for(let i=31;i>=0;i--)0===h.di[t+32*i]&&(t>0&&h.di[t+32*i-1]>1||i>0&&h.di[t+32*(i-1)]>1||t<31&&h.di[t+32*i+1]>1||i<31&&h.di[t+32*(i+1)]>1)&&(h.di[t+32*i]=1);for(let t=31;t>=0;t--)for(let i=31;i>=0;i--)0===h.di[t+32*i]&&t>0&&i>0&&h.di[t+32*(i-1)-1]>0&&(h.di[t+32*i]=3153952);if(-1!==s.Bo){const t=this.Wo(s.Jo,10),i=t.Si,h=t.Mi;t.Si=32,t.Mi=32,t.Fi(5,5,22,22),t.Si=i,t.Mi=h}return G.Uo?.put(BigInt(t),h),C.bind(o,l,a),C.Ii(c,u,f,d),O.Ki=e,O.Xi=n,O.Vi=r,O.ji=!0,s.Qo?h.Si=33:h.Si=32,h.Mi=i,h};model=0;name=null;Cn=null;Tn=null;On=null;jo=2e3;Xo=0;zo=0;Zo=0;qo=0;$o=0;tl=!1;il=-1;Qo=!1;sl=1;members=!1;gn=null;Ho=null;hl=-1;el=-1;nl=0;rl=-1;ol=-1;ll=0;al=-1;cl=-1;fl=-1;ul=-1;dl=-1;wl=-1;Yo=null;Vo=null;Jo=-1;Bo=-1;decode(t,i){if(1===t)this.model=i.St;else if(2===t)this.name=i.Ft;else if(3===t)this.Cn=i.Ft;else if(4===t)this.jo=i.St;else if(5===t)this.Xo=i.St;else if(6===t)this.zo=i.St;else if(7===t)this.qo=i.Mt,this.qo>32767&&(this.qo-=65536);else if(8===t)this.$o=i.Mt,this.$o>32767&&(this.$o-=65536);else if(9===t)this.tl=!0;else if(10===t)this.il=i.St;else if(11===t)this.Qo=!0;else if(12===t)this.sl=i.kt;else if(16===t)this.members=!0;else if(23===t)this.hl=i.St,this.nl=i.Rt;else if(24===t)this.el=i.St;else if(25===t)this.rl=i.St,this.ll=i.Rt;else if(26===t)this.ol=i.St;else if(t>=30&&t<35)this.gn||(this.gn=new c(5,null)),this.gn[t-30]=i.Ft,'hidden'===this.gn[t-30]?.toLowerCase()&&(this.gn[t-30]=null);else if(t>=35&&t<40)this.Ho||(this.Ho=new c(5,null)),this.Ho[t-35]=i.Ft;else if(40===t){const t=i.st;this.Tn=new Uint16Array(t),this.On=new Uint16Array(t);for(let s=0;s<t;s++)this.Tn[s]=i.St,this.On[s]=i.St}else 78===t?this.al=i.St:79===t?this.cl=i.St:90===t?this.fl=i.St:91===t?this.dl=i.St:92===t?this.ul=i.St:93===t?this.wl=i.St:95===t?this.Zo=i.St:97===t?this.Jo=i.St:98===t?this.Bo=i.St:t>=100&&t<110&&(this.Yo&&this.Vo||(this.Yo=new Uint16Array(10),this.Vo=new Uint16Array(10)),this.Yo[t-100]=i.St,this.Vo[t-100]=i.St)}yl(t){let i=this.hl;if(1===t&&(i=this.rl),-1===i)return null;let s=this.el,h=this.al;1===t&&(s=this.ol,h=this.cl);let e=v.model(i);if(-1!==s){const t=v.model(s);if(-1===h){const i=[e,t];e=v.fe(i,2)}else{const i=[e,t,v.model(h)];e=v.fe(i,3)}}if(0===t&&0!==this.nl&&e.translate(this.nl,0,0),1===t&&0!==this.ll&&e.translate(this.ll,0,0),this.Tn&&this.On)for(let t=0;t<this.Tn.length;t++)e.Te(this.Tn[t],this.On[t]);return e}Al(t){let i=this.fl;if(1===t&&(i=this.dl),-1===i)return null;let s=this.ul;1===t&&(s=this.wl);let h=v.model(i);if(-1!==s){const t=[h,v.model(s)];h=v.fe(t,2)}if(this.Tn&&this.On)for(let t=0;t<this.Tn.length;t++)h.Te(this.Tn[t],this.On[t]);return h}Ko(t){if(this.Yo&&this.Vo&&t>1){let i=-1;for(let s=0;s<10;s++)t>=this.Vo[s]&&0!==this.Vo[s]&&(i=this.Yo[s]);if(-1!==i)return G.get(i).Ko(1)}if(G.Fo){const t=G.Fo.get(BigInt(this.id));if(t)return t}const i=v.model(this.model);if(this.Tn&&this.On)for(let t=0;t<this.Tn.length;t++)i.Te(this.Tn[t],this.On[t]);return i.be(64,768,-50,-10,-50,!0),i.we=!0,G.Fo?.put(BigInt(this.id),i),i}Go(){const t=G.get(this.Bo);this.model=t.model,this.jo=t.jo,this.Xo=t.Xo,this.zo=t.zo,this.Zo=t.Zo,this.qo=t.qo,this.$o=t.$o,this.Tn=t.Tn,this.On=t.On;const i=G.get(this.Jo);this.name=i.name,this.members=i.members,this.sl=i.sl;let s='a';const h=(i.name||'').toLowerCase().charAt(0);'a'!==h&&'e'!==h&&'i'!==h&&'o'!==h&&'u'!==h||(s='an'),this.Cn=`Swap this note at any bank for ${s} ${i.name}.`,this.Qo=!0}reset(){this.model=0,this.name=null,this.Cn=null,this.Tn=null,this.On=null,this.jo=2e3,this.Xo=0,this.zo=0,this.Zo=0,this.qo=0,this.$o=0,this.tl=!1,this.il=-1,this.Qo=!1,this.sl=1,this.members=!1,this.gn=null,this.Ho=null,this.hl=-1,this.el=-1,this.nl=0,this.rl=-1,this.ol=-1,this.ll=0,this.al=-1,this.cl=-1,this.fl=-1,this.ul=-1,this.dl=-1,this.wl=-1,this.Yo=null,this.Vo=null,this.Jo=-1,this.Bo=-1}}class H extends t{static count=0;static cache=null;static wn=null;static yn=null;static An=0;static Fo=new _(30);static Jt=t=>{this.wn=new a(t.read('npc.dat'));const i=new a(t.read('npc.idx'));this.count=i.St,this.yn=new Int32Array(this.count);let s=2;for(let t=0;t<this.count;t++)this.yn[t]=s,s+=i.St;this.cache=new c(20,null);for(let t=0;t<20;t++)this.cache[t]=new H(-1)};static get=t=>{if(!this.cache||!this.yn||!this.wn)throw new Error('NpcType not loaded!!!');for(let i=0;i<20;i++){const s=this.cache[i];if(s&&s.id===t)return s}this.An=(this.An+1)%20;const i=this.cache[this.An]=new H(t);return this.wn.bt=this.yn[t],i.it(this.wn),i};static ns=()=>{this.Fo=null,this.yn=null,this.cache=null,this.wn=null};name=null;Cn=null;size=1;_n=null;pl=null;xn=!1;ml=-1;Il=-1;El=-1;gl=-1;_l=-1;Tn=null;On=null;gn=null;Gn=-1;Hn=-1;Wn=-1;Cl=!0;Tl=-1;Ol=128;bl=128;decode(t,i){if(1===t){const t=i.st;this._n=new Uint16Array(t);for(let s=0;s<t;s++)this._n[s]=i.St}else if(2===t)this.name=i.Ft;else if(3===t)this.Cn=i.Ft;else if(12===t)this.size=i.Rt;else if(13===t)this.ml=i.St;else if(14===t)this.Il=i.St;else if(16===t)this.xn=!0;else if(17===t)this.Il=i.St,this.El=i.St,this.gl=i.St,this._l=i.St;else if(t>=30&&t<40)this.gn||(this.gn=new c(5,null)),this.gn[t-30]=i.Ft,'hidden'===this.gn[t-30]?.toLowerCase()&&(this.gn[t-30]=null);else if(40===t){const t=i.st;this.Tn=new Uint16Array(t),this.On=new Uint16Array(t);for(let s=0;s<t;s++)this.Tn[s]=i.St,this.On[s]=i.St}else if(60===t){const t=i.st;this.pl=new Uint16Array(t);for(let s=0;s<t;s++)this.pl[s]=i.St}else 90===t?this.Gn=i.St:91===t?this.Hn=i.St:92===t?this.Wn=i.St:93===t?this.Cl=!1:95===t?this.Tl=i.St:97===t?this.Ol=i.St:98===t&&(this.bl=i.St)}Ll(t,i,s){let h=null,e=null;if(H.Fo&&(e=H.Fo.get(BigInt(this.id)),!e&&this._n)){const t=new c(this._n.length,null);for(let i=0;i<this._n.length;i++)t[i]=v.model(this._n[i]);if(e=1===t.length?t[0]:v.fe(t,t.length),this.Tn&&this.On)for(let t=0;t<this.Tn.length;t++)e?.Te(this.Tn[t],this.On[t]);e?.me(),e?.be(64,850,-30,-50,-30,!0),e&&H.Fo.put(BigInt(this.id),e)}return e?(h=v.re(e,!this.xn),-1!==t&&-1!==i?h.Ie(t,i,s):-1!==t&&h.ge(t),128===this.Ol&&128===this.bl||h.scale(this.Ol,this.bl,this.Ol),h.ce(),h.le=null,h.oe=null,1===this.size&&(h.we=!0),h):null}Al(){if(!this.pl)return null;const t=new c(this.pl.length,null);for(let i=0;i<this.pl.length;i++)t[i]=v.model(this.pl[i]);let i;if(i=1===t.length?t[0]:v.fe(t,t.length),this.Tn&&this.On)for(let t=0;t<this.Tn.length;t++)i?.Te(this.Tn[t],this.On[t]);return i}}class W extends t{static count=0;static $t=[];static Jt=t=>{const i=new a(t.read('idk.dat'));this.count=i.St;for(let t=0;t<this.count;t++)this.$t[t]=new W(t).it(i)};type=-1;_n=null;pl=new Int32Array(5).fill(-1);Tn=new Int32Array(6);On=new Int32Array(6);disable=!1;decode(t,i){if(1===t)this.type=i.st;else if(2===t){const t=i.st;this._n=new Int32Array(t);for(let s=0;s<t;s++)this._n[s]=i.St}else if(3===t)this.disable=!0;else if(t>=40&&t<50)this.Tn[t-40]=i.St;else if(t>=50&&t<60)this.On[t-50]=i.St;else{if(!(t>=60&&t<70))throw new Error(`Unrecognized idk config code: ${t}`);this.pl[t-60]=i.St}}zn(){if(!this._n)return null;const t=new c(this._n.length,null);for(let i=0;i<this._n.length;i++)t[i]=v.model(this._n[i]);let i;i=1===t.length?t[0]:v.fe(t,t.length);for(let t=0;t<6&&0!==this.Tn[t];t++)i?.Te(this.Tn[t],this.On[t]);return i}Al(){let t=0;const i=new c(5,null);for(let s=0;s<5;s++)-1!==this.pl[s]&&(i[t++]=v.model(this.pl[s]));const s=v.fe(i,t);for(let t=0;t<6&&0!==this.Tn[t];t++)s.Te(this.Tn[t],this.On[t]);return s}}class Y extends t{static count=0;static $t=[];static Fo=new _(30);static Jt=t=>{const i=new a(t.read('spotanim.dat'));this.count=i.St;for(let t=0;t<this.count;t++)this.$t[t]=new Y(t).it(i)};model=0;Mn=-1;vl=null;xn=!1;Tn=new Uint16Array(6);On=new Uint16Array(6);Ol=128;bl=128;orientation=0;Dn=0;Nn=0;decode(t,i){if(1===t)this.model=i.St;else if(2===t)this.Mn=i.St,I.$t&&(this.vl=I.$t[this.Mn]);else if(3===t)this.xn=!0;else if(4===t)this.Ol=i.St;else if(5===t)this.bl=i.St;else if(6===t)this.orientation=i.St;else if(7===t)this.Dn=i.st;else if(8===t)this.Nn=i.st;else if(t>=40&&t<50)this.Tn[t-40]=i.St;else{if(!(t>=50&&t<60))throw new Error(`Unrecognized spotanim config code: ${t}`);this.On[t-50]=i.St}}zn(){let t=Y.Fo?.get(BigInt(this.id));if(t)return t;t=v.model(this.model);for(let i=0;i<6;i++)0!==this.Tn[0]&&t.Te(this.Tn[i],this.On[i]);return Y.Fo?.put(BigInt(this.id),t),t}}class V extends t{static count=0;static $t=[];static Rl=[];static Sl=0;static Jt=t=>{const i=new a(t.read('varp.dat'));this.count=i.St;for(let t=0;t<this.count;t++)this.$t[t]=new V(t).it(i)};scope=0;type=0;Rl=!1;Ml=!0;xl=0;kl=0;Dl=!1;Nl=!1;decode(t,i){if(1===t)this.scope=i.st;else if(2===t)this.type=i.st;else if(3===t)this.Rl=!0,V.Rl[V.Sl++]=this.id;else if(4===t)this.Ml=!1;else if(5===t)this.xl=i.St;else if(6===t)this.Dl=!0;else if(7===t)this.kl=i.kt;else if(8===t)this.Nl=!0;else{if(10!==t)throw new Error(`Error unrecognised config code: ${t}`);this.tt=i.Ft}}}class K{static Pl=['_','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','0','1','2','3','4','5','6','7','8','9'];static Fl=t=>{t=t.trim();let i=0n;for(let s=0;s<t.length&&s<12;s++){const h=t.charCodeAt(s);i*=37n,h>=65&&h<=90?i+=BigInt(h+1-65):h>=97&&h<=122?i+=BigInt(h+1-97):h>=48&&h<=57&&(i+=BigInt(h+27-48))}return i};static Ul=t=>{if(t<0n||t>=6582952005840035281n)return'invalid_name';if(t%37n===0n)return'invalid_name';let i=0;const s=Array(12);for(;0n!==t;){const h=t;t/=37n,s[11-i++]=this.Pl[Number(h-37n*t)]}return s.slice(12-i).join('')};static Bl=t=>{const i=[...t.toLowerCase()];let s=!0;for(let t=0;t<i.length;t++){const h=i[t];s&&h>='a'&&h<='z'&&(i[t]=h.toUpperCase(),s=!1),'.'!==h&&'!'!==h||(s=!0)}return i.join('')};static Gl=t=>{let i='';for(let s=0;s<t.length;s++)i+='*';return i};static Hl=t=>(t>>24&255)+'.'+(t>>16&255)+'.'+(t>>8&255)+'.'+(255&t);static Wl=t=>{if(0===t.length)return t;const i=[...t];for(let t=0;t<i.length;t++)'_'===i[t]&&(i[t]=' ',t+1<i.length&&i[t+1]>='a'&&i[t+1]<='z'&&(i[t+1]=String.fromCharCode(i[t+1].charCodeAt(0)+'A'.charCodeAt(0)-97)));return i[0]>='a'&&i[0]<='z'&&(i[0]=String.fromCharCode(i[0].charCodeAt(0)+'A'.charCodeAt(0)-97)),i.join('')};static Yl=t=>{const i=t.toUpperCase();let s=0n;for(let t=0;t<i.length;t++)s=61n*s+BigInt(i.charCodeAt(t))-32n,s=s+(s>>56n)&0xffffffffffffffn;return s}}class X{static $t=[];static Vl=null;static Fo=null;static Kl=0;static Xl=1;static jl=2;static zl=3;static Zl=4;static ql=5;static $l=6;static Jl=7;static Ql=1;static ta=2;static ia=3;static sa=4;static ha=5;static ea=6;static na=1;static ra=100;static oa=101;static la=200;static aa=201;static ca=202;static fa=203;static ua=205;static da=300;static wa=301;static ya=302;static Aa=303;static pa=304;static ma=305;static Ia=306;static Ea=307;static ga=308;static _a=309;static Ca=310;static Ta=311;static Oa=312;static ba=313;static La=314;static va=315;static Ra=316;static Sa=317;static Ma=318;static xa=319;static ka=320;static Da=321;static Na=322;static Pa=323;static Fa=324;static Ua=325;static Ba=326;static Ga=327;static Ha=401;static Wa=500;static Ya=501;static Va=502;static Ka=503;static Xa=600;static ja=601;static za=602;static Za=603;static qa=604;static $a=605;static Ja=606;static Qa=607;static tc=608;static ic=609;static sc=610;static hc=611;static ec=612;static nc=613;static rc=650;static oc=651;static lc=652;static ac=653;static cc=654;static fc=655;static Jt=(t,i,s)=>{this.Vl=new _(5e4),this.Fo=new _(5e4);const h=new a(t.read('data'));let e=-1;for(h.bt+=2;h.bt<h.length;){let t=h.St;65535===t&&(e=h.St,t=h.St);const n=this.$t[t]=new X;n.id=t,n.an=e,n.type=h.st,n.uc=h.st,n.dc=h.St,n.width=h.St,n.height=h.St,n.wc=h.st,0===n.wc?n.wc=-1:n.wc=(n.wc-1<<8)+h.st;const r=h.st;if(r>0){n.yc=new Uint8Array(r),n.Ac=new Uint16Array(r);for(let t=0;t<r;t++)n.yc[t]=h.st,n.Ac[t]=h.St}const o=h.st;if(o>0){n.scripts=new c(o,null);for(let t=0;t<o;t++){const i=h.St,s=new Uint16Array(i);n.scripts[t]=s;for(let t=0;t<i;t++)s[t]=h.St}}if(n.type===X.Kl){n.scroll=h.St,n.hide=1===h.st;const t=h.st;n.mc=new Array(t),n.Ic=new Array(t),n.Ec=new Array(t);for(let i=0;i<t;i++)n.mc[i]=h.St,n.Ic[i]=h.Mt,n.Ec[i]=h.Mt}if(n.type===X.Xl&&(h.bt+=3),n.type===X.jl){n.gc=new Int32Array(n.width*n.height),n._c=new Int32Array(n.width*n.height),n.draggable=1===h.st,n.Cc=1===h.st,n.Tc=1===h.st,n.Oc=h.st,n.bc=h.st,n.Lc=new Int16Array(20),n.vc=new Int16Array(20),n.Rc=new c(20,null);for(let t=0;t<20;t++)if(1===h.st){n.Lc[t]=h.Mt,n.vc[t]=h.Mt;const s=h.Ft;if(s.length>0){const h=s.lastIndexOf(',');n.Rc[t]=this.Sc(i,s.substring(0,h),parseInt(s.substring(h+1),10))}}n.Mc=new c(5,null);for(let t=0;t<5;t++){const i=h.Ft;n.Mc[t]=i,0===i.length&&(n.Mc[t]=null)}}if(n.type===X.zl&&(n.fill=1===h.st),n.type===X.Zl||n.type===X.Xl){n.xc=1===h.st;const t=h.st;s&&(n.font=s[t]),n.kc=1===h.st}if(n.type===X.Zl&&(n.text=h.Ft,n.Dc=h.Ft),n.type!==X.Xl&&n.type!==X.zl&&n.type!==X.Zl||(n.Nc=h.kt),n.type!==X.zl&&n.type!==X.Zl||(n.Pc=h.kt,n.Fc=h.kt),n.type===X.ql){const t=h.Ft;if(t.length>0){const s=t.lastIndexOf(',');n.Uc=this.Sc(i,t.substring(0,s),parseInt(t.substring(s+1),10))}const s=h.Ft;if(s.length>0){const t=s.lastIndexOf(',');n.Bc=this.Sc(i,s.substring(0,t),parseInt(s.substring(t+1),10))}}if(n.type===X.$l){const t=h.st;0!==t&&(n.model=this.zn((t-1<<8)+h.st));const i=h.st;0!==i&&(n.Gc=this.zn((i-1<<8)+h.st)),n.Mn=h.st,0===n.Mn?n.Mn=-1:n.Mn=(n.Mn-1<<8)+h.st,n.Hc=h.st,0===n.Hc?n.Hc=-1:n.Hc=(n.Hc-1<<8)+h.st,n.zoom=h.St,n.Wc=h.St,n.Yc=h.St}if(n.type===X.Jl){n.gc=new Int32Array(n.width*n.height),n._c=new Int32Array(n.width*n.height),n.xc=1===h.st;const t=h.st;s&&(n.font=s[t]),n.kc=1===h.st,n.Nc=h.kt,n.Oc=h.Mt,n.bc=h.Mt,n.Cc=1===h.st,n.Mc=new c(5,null);for(let t=0;t<5;t++){const i=h.Ft;n.Mc[t]=i,0===i.length&&(n.Mc[t]=null)}}n.uc!==X.ta&&n.type!==X.jl||(n.Vc=h.Ft,n.action=h.Ft,n.Kc=h.St),n.uc!==X.Ql&&n.uc!==X.sa&&n.uc!==X.ha&&n.uc!==X.ea||(n.Xc=h.Ft,0===n.Xc.length&&(n.uc===X.Ql?n.Xc='Ok':n.uc===X.sa||n.uc===X.ha?n.Xc='Select':n.uc===X.ea&&(n.Xc='Continue')))}this.Vl=null,this.Fo=null};static Sc=(t,i,s)=>{const h=K.Yl(i)<<8n|BigInt(s);if(this.Vl){const t=this.Vl.get(h);if(t)return t}let e;try{e=U.xi(t,i,s),this.Vl?.put(h,e)}catch(t){return null}return e};static zn=t=>{if(this.Fo){const i=this.Fo.get(BigInt(t));if(i)return i}const i=v.model(t);return this.Fo?.put(BigInt(t),i),i};id=-1;an=-1;type=-1;uc=-1;dc=0;width=0;height=0;wc=-1;yc=null;Ac=null;scripts=null;scroll=0;hide=!1;draggable=!1;Cc=!1;Tc=!1;Oc=0;bc=0;Lc=null;vc=null;Rc=null;Mc=null;fill=!1;xc=!1;font=null;kc=!1;text=null;Dc=null;Nc=0;Pc=0;Fc=0;Uc=null;Bc=null;model=null;Gc=null;Mn=-1;Hc=-1;zoom=0;Wc=0;Yc=0;Vc=null;action=null;Kc=-1;Xc=null;mc=null;Ic=null;Ec=null;x=0;y=0;jc=0;gc=null;_c=null;zc=0;Zc=0;zn(t,i,s){let h=this.model;if(s&&(h=this.Gc),!h)return null;if(-1===t&&-1===i&&!h.Vh)return h;const e=v.he(h,!0,!0,!1);return-1===t&&-1===i||e.me(),-1!==t&&e.ge(t),-1!==i&&e.ge(i),e.be(64,768,-50,-10,-50,!0),e}qc(){if(this.an===this.id)return this.x;let t=X.$t[this.an];if(!t.mc||!t.Ic||!t.Ec)return this.x;let i=t.mc.indexOf(this.id);if(-1===i)return this.x;let s=t.Ic[i];for(;t.an!==t.id;){const h=X.$t[t.an];h.mc&&h.Ic&&h.Ec&&(i=h.mc.indexOf(t.id),-1!==i&&(s+=h.Ic[i])),t=h}return s}$c(){if(this.an===this.id)return this.y;let t=X.$t[this.an];if(!t.mc||!t.Ic||!t.Ec)return this.y;let i=t.mc.indexOf(this.id);if(-1===i)return this.y;let s=t.Ec[i];for(;t.an!==t.id;){const h=X.$t[t.an];h.mc&&h.Ic&&h.Ec&&(i=h.mc.indexOf(t.id),-1!==i&&(s+=h.Ec[i])),t=h}return s}outline(t){const i=this.qc(),s=this.$c();C.gi(i,s,this.width,this.height,t)}move(t,i){if(this.an===this.id)return;this.x=0,this.y=0;const s=X.$t[this.an];if(s.mc&&s.Ic&&s.Ec){const h=s.mc.indexOf(this.id);-1!==h&&(s.Ic[h]=t,s.Ec[h]=i)}}delete(){if(this.an===this.id)return;const t=X.$t[this.an];if(t.mc&&t.Ic&&t.Ec){const i=t.mc.indexOf(this.id);-1!==i&&(t.mc.splice(i,1),t.Ic.splice(i,1),t.Ec.splice(i,1))}}}class j{Jc;width;height;Qc;tf;di;constructor(t,i,s=D){this.Qc=s,this.Jc=this.Qc.getImageData(0,0,t,i),this.tf=new Uint32Array(this.Jc.data.buffer),this.di=new Int32Array(t*i),this.width=t,this.height=i,this.bind()}clear(){this.di.fill(0)}bind(){C.bind(this.di,this.width,this.height)}draw(t,i){this.#t(),this.Qc.putImageData(this.Jc,t,i)}#t(){const t=this.di.length,i=this.di,s=this.tf;for(let h=0;h<t;h++){const t=i[h];s[h]=t>>16&255|(t>>8&255)<<8|(255&t)<<16|4278190080}}}class z{seed;constructor(t){this.seed=(0x5deece66dn^t)&(1n<<48n)-1n}if(t){this.seed=(0x5deece66dn^t)&(1n<<48n)-1n}Gt(){return this.next(32)}next(t){return this.seed=0x5deece66dn*this.seed+0xbn&(1n<<48n)-1n,Number(this.seed)>>>48-t}}class Z extends l{static sf='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!"$%^&*()-_=+[{]};:\'@#~,<.>/?\\| ';static hf=[];static{const t=navigator.userAgent.includes('Capacitor');for(let i=0;i<256;i++){let s=Z.sf.indexOf(String.fromCharCode(i));t&&s>=63&&s--,-1===s&&(s=74),Z.hf[i]=s}}ef=[];nf=new Int32Array(94);rf=new Int32Array(94);lf=new Int32Array(94);af=new Int32Array(94);cf=new Int32Array(95);ff=new Int32Array(256);random=new z(BigInt(Date.now()));height=0;static xi=(t,i)=>{const s=new a(t.read(i+'.dat')),h=new a(t.read('index.dat'));h.bt=s.St+4;const e=h.st;e>0&&(h.bt+=3*(e-1));const n=new Z;for(let t=0;t<94;t++){n.lf[t]=h.st,n.af[t]=h.st;const i=n.nf[t]=h.St,e=n.rf[t]=h.St,r=h.st,o=i*e;if(n.ef[t]=new Int8Array(o),0===r)for(let h=0;h<i*e;h++)n.ef[t][h]=s.Rt;else if(1===r)for(let h=0;h<i;h++)for(let r=0;r<e;r++)n.ef[t][h+r*i]=s.Rt;e>n.height&&(n.height=e),n.lf[t]=1,n.cf[t]=i+2;{let s=0;for(let h=e/7|0;h<e;h++)s+=n.ef[t][h*i];s<=(e/7|0)&&(n.cf[t]--,n.lf[t]=0)}{let s=0;for(let h=e/7|0;h<e;h++)s+=n.ef[t][i+h*i-1];s<=(e/7|0)&&n.cf[t]--}}n.cf[94]=n.cf[8];for(let t=0;t<256;t++)n.ff[t]=n.cf[Z.hf[t]];return n};uf(t,i,s,h){if(!s)return;t|=0,i|=0;const e=s.length;i-=this.height;for(let n=0;n<e;n++){const e=Z.hf[s.charCodeAt(n)];94!==e&&this.df(this.ef[e],t+this.lf[e],i+this.af[e],this.nf[e],this.rf[e],h),t+=this.cf[e]}}wf(t,i,s,h,e){t|=0,i|=0;const n=s.length;i-=this.height;for(let r=0;r<n;r++)if('@'===s.charAt(r)&&r+4<n&&'@'===s.charAt(r+4))h=this.yf(s.substring(r+1,r+4)),r+=4;else{const n=Z.hf[s.charCodeAt(r)];94!==n&&(e&&this.df(this.ef[n],t+this.lf[n]+1,i+this.af[n]+1,this.nf[n],this.rf[n],B.ar),this.df(this.ef[n],t+this.lf[n],i+this.af[n],this.nf[n],this.rf[n],h)),t+=this.cf[n]}}Af(t){if(!t)return 0;const i=t.length;let s=0;for(let h=0;h<i;h++)'@'===t.charAt(h)&&h+4<i&&'@'===t.charAt(h+4)?h+=4:s+=this.ff[t.charCodeAt(h)];return s}pf(t,i,s,h,e){t|=0,i|=0,this.wf(t-this.Af(s)/2,i,s,h,e)}mf(t,i,s,h){s&&(t|=0,i|=0,this.uf(t-this.Af(s)/2,i,s,h))}If(t,i,s,h,e,n){t|=0,i|=0,this.random.if(BigInt(n));const r=192+(31&this.random.Gt()),o=i-this.height;for(let i=0;i<s.length;i++)if('@'===s.charAt(i)&&i+4<s.length&&'@'===s.charAt(i+4))h=this.yf(s.substring(i+1,i+4)),i+=4;else{const n=Z.hf[s.charCodeAt(i)];94!==n&&(e&&this.Ef(t+this.lf[n]+1,o+this.af[n]+1,this.nf[n],this.rf[n],B.ar,192,this.ef[n]),this.Ef(t+this.lf[n],o+this.af[n],this.nf[n],this.rf[n],h,r,this.ef[n])),t+=this.cf[n],3&this.random.Gt()||t++}}gf(t,i,s,h,e=!0){t|=0,i|=0,e&&this.uf(t-this.Af(s)+1,i+1,s,B.ar),this.uf(t-this.Af(s),i,s,h)}_f(t,i,s,h,e){if(!s)return;t|=0,i|=0,t-=this.Af(s)/2|0;const n=i-this.height;for(let i=0;i<s.length;i++){const r=Z.hf[s.charCodeAt(i)];94!=r&&this.df(this.ef[r],t+this.lf[r],n+this.af[r]+(5*Math.sin(i/2+e/5)|0),this.nf[r],this.rf[r],h),t+=this.cf[r]}}df(t,i,s,h,e,n){h|=0,e|=0;let r=(i|=0)+(s|=0)*C.wi,o=C.wi-h,l=0,a=0;if(s<C.top){const t=C.top-s;e-=t,s=C.top,a+=t*h,r+=t*C.wi}if(s+e>=C.bottom&&(e-=s+e+1-C.bottom),i<C.left){const t=C.left-i;h-=t,i=C.left,a+=t,r+=t,l+=t,o+=t}if(i+h>=C.right){const t=i+h+1-C.right;h-=t,l+=t,o+=t}h>0&&e>0&&this.Cf(h,e,t,a,l,C.di,r,o,n)}Ef(t,i,s,h,e,n,r){s|=0,h|=0;let o=(t|=0)+(i|=0)*C.wi,l=C.wi-s,a=0,c=0;if(i<C.top){const t=C.top-i;h-=t,i=C.top,c+=t*s,o+=t*C.wi}if(i+h>=C.bottom&&(h-=i+h+1-C.bottom),t<C.left){const i=C.left-t;s-=i,t=C.left,c+=i,o+=i,a+=i,l+=i}if(t+s>=C.right){const i=t+s+1-C.right;s-=i,a+=i,l+=i}s>0&&h>0&&this.Tf(s,h,C.di,o,l,r,c,a,e,n)}Cf(t,i,s,h,e,n,r,o,l){const a=-((t|=0)>>2);t=-(3&t);for(let c=-(i|=0);c<0;c++){for(let t=a;t<0;t++)0===s[h++]?r++:n[r++]=l,0===s[h++]?r++:n[r++]=l,0===s[h++]?r++:n[r++]=l,0===s[h++]?r++:n[r++]=l;for(let i=t;i<0;i++)0===s[h++]?r++:n[r++]=l;r+=o,h+=e}}Tf(t,i,s,h,e,n,r,o,l,a){t|=0;const c=((16711935&l)*a&4278255360)+((65280&l)*a&16711680)>>8,f=256-a;for(let l=-(i|=0);l<0;l++){for(let i=-t;i<0;i++)if(0===n[r++])h++;else{const t=s[h];s[h++]=(((16711935&t)*f&4278255360)+((65280&t)*f&16711680)>>8)+c}h+=e,r+=o}}yf(t){return'red'===t?B.RED:'gre'===t?B.GREEN:'blu'===t?B.BLUE:'yel'===t?B.er:'cya'===t?B.nr:'mag'===t?B.rr:'whi'===t?B.lr:'bla'===t?B.ar:'lre'===t?B.cr:'dre'===t?B.ur:'dbl'===t?B.dr:'or1'===t?B.wr:'or2'===t?B.yr:'or3'===t?B.Ar:'gr1'===t?B.pr:'gr2'===t?B.mr:'gr3'===t?B.Ir:B.ar}split(t,i){if(0===t.length)return[t];const s=[];for(;t.length>0;){if(this.Af(t)<=i&&-1===t.indexOf('|')){s.push(t);break}let h=t.length;for(let s=0;s<t.length;s++)if(' '===t[s]){if(this.Af(t.substring(0,s))>i)break;h=s}else if('|'===t[s]){h=s;break}s.push(t.substring(0,h)),t=t.substring(h+1)}return s}}class q{Of;bf;Lf;closed=!1;vf=!1;static Rf=async t=>await new Promise(((i,s)=>{const h=t.host.startsWith('https'),e=h?'wss':'ws',n=t.host.substring(t.host.indexOf('//')+2),r=h?t.port+2:t.port+1,o=new WebSocket(`${e}://${n}:${r}`,'binary');o.addEventListener('open',(()=>{console.log('connection open!'),i(o)})),o.addEventListener('error',(()=>{console.log('connection error!'),s(o)}))}));constructor(t){t.onclose=this.onclose,t.onerror=this.onerror,this.bf=new Q(t,5e3),this.Lf=new $(t,5e3),this.Of=t}get host(){return this.Of.url.split('/')[2]}get port(){return parseInt(this.Of.url.split(':')[2],10)}get available(){return this.closed?0:this.bf.available}write(t,i){this.Lf.write(t,i)}async read(){return this.closed?0:this.bf.Sf()??await this.bf.Mf()}async xf(t,i,s){if(!this.closed)for(;s>0;){const h=this.bf.kf(t,i,s)??await this.bf.Df(t,i,s);if(h.length<=0)throw new Error('EOF');i+=h.length,s-=h.length}}close(){this.closed=!0,this.Of.close(),this.bf.close(),this.Lf.close(),console.log('connection close!'),this.vf&&console.log('connection error!')}onclose=t=>{this.closed||this.close()};onerror=t=>{this.closed||(this.vf=!0,this.close())}}class ${Of;Nf;closed=!1;vf=!1;constructor(t,i){this.Of=t,this.Nf=i}write(t,i){if(!this.closed){if(this.vf)throw this.vf=!1,new Error('Error in writer thread');if(i>this.Nf||t.length>this.Nf)throw new Error('buffer overflow');try{this.Of.send(t.subarray(0,i))}catch(t){this.vf=!0}}}close(){this.closed=!0}}class J extends r{zt;position;constructor(t){super(),this.zt=t,this.position=0}get available(){return this.zt.length-this.position}get read(){return this.zt[this.position++]}get Pf(){return this.zt.length}}class Q{Nf;queue=new o;event=null;Ff=null;total=0;closed=!1;constructor(t,i){this.Nf=i,t.binaryType='arraybuffer',t.onmessage=this.onmessage}get available(){return this.total}onmessage=t=>{if(this.closed)throw new Error('WebSocketReader is closed!');const i=new J(new Uint8Array(t.data));if(this.event?this.queue.rt(i):this.event=i,this.total+=i.Pf,this.Ff&&(this.Ff(this.event),this.Ff=null,this.total>this.Nf))throw new Error('buffer overflow')};Uf(){return this.event&&this.event.available>0?this.event.read:null}async Bf(t){for(this.event=this.queue.lt();this.total<t;)await Promise.race([new Promise((t=>this.Ff=t)),i(2e3).then((()=>{throw new Error('WebSocketReader timed out or closed while reading.')}))]);return this.event?this.event.read:this.Bf(t)}kf(t,i,s){if(this.closed)throw new Error('WebSocketReader is closed!');if(!(this.event&&this.event.available>=s))return null;for(;s>0;){const h=this.Uf();if(null===h)throw new Error('EOF - tried to read a fast byte when there was not enough immediate bytes.');t[i++]=h,this.total--,s--}return t}async Df(t,i,s){if(this.closed)throw new Error('WebSocketReader is closed!');for(;s>0;)t[i++]=this.Uf()??await this.Bf(s),this.total--,s--;return t}Sf(){if(this.closed)throw new Error('WebSocketReader is closed!');const t=this.Uf();return null===t?null:(this.total--,t)}async Mf(){if(this.closed)throw new Error('WebSocketReader is closed!');const t=await this.Bf(1);return this.total--,t}close(){this.closed=!0,this.Ff=null,this.total=0,this.event=null,this.queue.clear()}}class tt{static Gf=[95,218,67,50,253,222,194,60,101,128,8,251,92,111,24,33,223,66,232,59,227,113,153,105,126,98,167,102,177,238,62,190,147,23,150,151,156,144,193,155,81,0,198,22,137,210,179,16,168,170,32,181,248,141,58,87,208,106,180,191,221,241,40,176,196,154,65,145,230,78,30,161,188,41,14,129,18,199,47,247,225,34,51,10,159,75,12,56,61,31,39,91,46,242,134,5,122,123,209,228,104,195,21,3,11,44,107,172,6,186,110,215,205,103,27,185,124,77,252,117,86,115,127,207,52,79,43,97,219,116,169,7,118,162,108,36,20,233,88,135,80,19,42,237,57,152,71,9,250,17,4,119,234,130,26,200,189,163,254,245,197,171,220,235,140,244,184,94,211,231,99,246,121,212,112,204,63,148,83,178,1,255,131,13,183,142,236,45,55,35,243,136,37,85,100,160,38,224,146,174,82,48,109,132,125,90,143,138,240,173,165,164,192,175,29,74,28,114,213,73,64,206,76,139,96,2,229,15,93,25,239,202,49,70,214,201,72,203,68,89,69,157,216,217,249,120,226,84,149,187,54,53,158,166,182,133,0];static Hf=[0,-2,4,6,-1,0,0,2,0,0,0,0,5,4,2,2,0,0,0,0,2,-2,2,14,0,6,3,0,4,0,0,0,3,0,0,0,0,0,0,0,0,-1,4,2,6,0,6,0,0,3,7,0,0,0,-1,0,0,0,0,4,0,0,0,0,0,0,0,0,1,15,0,0,0,0,6,0,2,0,0,0,2,0,0,0,1,0,0,4,0,0,0,0,0,0,0,0,0,0,-2,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,-2,0,0,2,0,0,0,2,9,0,0,0,0,0,4,0,0,0,3,7,9,0,0,0,0,0,0,0,0,0,-2,0,0,0,0,3,2,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,-2,2,0,0,0,0,0,6,0,0,0,2,0,2,0,0,0,-2,0,0,4,0,0,0,0,6,0,0,-2,-2,0,0,0,0,0,0,-2,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,-2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0]}class it{count=0;Wf=new Int32Array(256);Yf=new Int32Array(256);a=0;b=0;c=0;constructor(t){for(let i=0;i<t.length;i++)this.Wf[i]=t[i];this.init()}get Gt(){return 0==this.count--&&(this.Vf(),this.count=255),this.Wf[this.count]}init(){let t=2654435769,i=2654435769,s=2654435769,h=2654435769,e=2654435769,n=2654435769,r=2654435769,o=2654435769;for(let l=0;l<4;l++)t^=i<<11,h+=t,i+=s,i^=s>>>2,e+=i,s+=h,s^=h<<8,n+=s,h+=e,h^=e>>>16,r+=h,e+=n,e^=n<<10,o+=e,n+=r,n^=r>>>4,t+=n,r+=o,r^=o<<8,i+=r,o+=t,o^=t>>>9,s+=o,t+=i;for(let l=0;l<256;l+=8)t+=this.Wf[l],i+=this.Wf[l+1],s+=this.Wf[l+2],h+=this.Wf[l+3],e+=this.Wf[l+4],n+=this.Wf[l+5],r+=this.Wf[l+6],o+=this.Wf[l+7],t^=i<<11,h+=t,i+=s,i^=s>>>2,e+=i,s+=h,s^=h<<8,n+=s,h+=e,h^=e>>>16,r+=h,e+=n,e^=n<<10,o+=e,n+=r,n^=r>>>4,t+=n,r+=o,r^=o<<8,i+=r,o+=t,o^=t>>>9,s+=o,t+=i,this.Yf[l]=t,this.Yf[l+1]=i,this.Yf[l+2]=s,this.Yf[l+3]=h,this.Yf[l+4]=e,this.Yf[l+5]=n,this.Yf[l+6]=r,this.Yf[l+7]=o;for(let l=0;l<256;l+=8)t+=this.Yf[l],i+=this.Yf[l+1],s+=this.Yf[l+2],h+=this.Yf[l+3],e+=this.Yf[l+4],n+=this.Yf[l+5],r+=this.Yf[l+6],o+=this.Yf[l+7],t^=i<<11,h+=t,i+=s,i^=s>>>2,e+=i,s+=h,s^=h<<8,n+=s,h+=e,h^=e>>>16,r+=h,e+=n,e^=n<<10,o+=e,n+=r,n^=r>>>4,t+=n,r+=o,r^=o<<8,i+=r,o+=t,o^=t>>>9,s+=o,t+=i,this.Yf[l]=t,this.Yf[l+1]=i,this.Yf[l+2]=s,this.Yf[l+3]=h,this.Yf[l+4]=e,this.Yf[l+5]=n,this.Yf[l+6]=r,this.Yf[l+7]=o;this.Vf(),this.count=256}Vf(){this.c++,this.b+=this.c;for(let t=0;t<256;t++){const i=this.Yf[t],s=3&t;let h;0===s?this.a^=this.a<<13:1===s?this.a^=this.a>>>6:2===s?this.a^=this.a<<2:3===s&&(this.a^=this.a>>>16),this.a+=this.Yf[t+128&255],this.Yf[t]=h=this.Yf[i>>>2&255]+this.a+this.b,this.Wf[t]=this.b=this.Yf[h>>>8>>>2&255]+i}}}class st{db;constructor(t){t.onerror=this.onerror,t.onclose=this.onclose,this.db=t}static openDatabase=async()=>await new Promise(((t,i)=>{const s=indexedDB.open('lostcity',1);s.onsuccess=i=>{const s=i.target;console.log('database success!'),t(s.result)},s.onupgradeneeded=t=>{t.target.result.createObjectStore('cache')},s.onerror=t=>{const s=t.target;console.error('database error!: ',s.error),i(s.result)}}));Kf=async t=>await new Promise((i=>{const s=this.db.transaction('cache','readonly').objectStore('cache').get(t);s.onsuccess=()=>{i(s.result)},s.onerror=t=>{i(void 0)}}));Xf=async(t,i)=>await new Promise(((s,h)=>{const e=this.db.transaction('cache','readwrite').objectStore('cache').put(i,t);e.onsuccess=()=>{s()},e.onerror=t=>{h()}}));onclose=t=>{console.log('database close!')};onerror=t=>{console.log('database error!')};jf=t=>{const i=t.trim();let s=0;for(let t=0;t<i.length&&t<12;t++){const h=i.charAt(t);s*=37,h>='A'&&h<='Z'?s+=h.charCodeAt(0)+1-65:h>='a'&&h<='z'?s+=h.charCodeAt(0)+1-97:h>='0'&&h<='9'&&(s+=h.charCodeAt(0)+27-48)}return s}}class ht{static zf=14;static Zf=28;static qf=129;static $f=167;static Jf=168;static Qf=195;static tu=2;static iu=26;static su=46;static hu=84;static eu=87;static nu=103;static ru=146;static ou=197;static lu=201;static au=204;static cu=209;static fu=126;static uu=185;static du=15;static wu=98;static yu=213;static Au=74;static pu=13;static mu=3;static Iu=239;static Eu=1;static gu=184;static _u=133;static Cu=226;static Tu=4;static Ou=21;static bu=32;static Lu=41;static vu=152;static Ru=19;static Su=22;static Mu=25;static xu=43;static ku=44;static Du=68;static Nu=136;static Pu=139;static Fu=140;static Uu=142;static Bu=243;static Gu=254;static Hu=20;static Wu=80;static Yu=132;static Vu=220;static Ku=237;static Xu=150;static ju=175;static zu=193;static Zu=12;static qu=54;static $u=212;static Ju=7;static Qu=135;static td=162;static sd=23;static hd=42;static ed=49;static nd=50;static rd=59;static od=69;static ld=76;static ad=151;static fd=191;static ud=223}class et{static dd=150;static wd=108;static yd=70;static Ad=81;static pd=189;static md=7;static Id=88;static Ed=30;static gd=176;static _d=220;static Cd=66;static Td=17;static Od=2;static bd=238;static Ld=233;static vd=146;static Rd=215;static Sd=236;static Md=85;static xd=219;static kd=140;static Dd=40;static Nd=200;static Pd=178;static Fd=247;static Ud=138;static Bd=239;static Gd=194;static Hd=8;static Wd=27;static Yd=113;static Vd=100;static Kd=134;static Xd=202;static jd=245;static zd=172;static Zd=96;static qd=97;static $d=116;static Jd=9;static Qd=75;static tw=164;static iw=53;static sw=185;static hw=206;static ew=177;static nw=248;static rw=195;static ow=71;static lw=133;static aw=157;static cw=211;static fw=48;static uw=130;static dw=31;static ww=59;static yw=212;static Aw=38;static pw=6;static mw=155;static Iw=235;static Ew=231;static gw=237;static _w=175;static Cw=93;static Tw=190;static Ow=165;static bw=159;static Lw=171;static Rw=79;static Sw=52;static Mw=244;static Lu=148;static xw=11;static kw=118;static Dw=4;static Nw=158;static Pw=181}class nt{static Fw=new Uint16Array(['d','o','t'].join('').split('').map((t=>t.charCodeAt(0))));static Uw=new Uint16Array(['(','a',')'].join('').split('').map((t=>t.charCodeAt(0))));static Bw=new Uint16Array(['s','l','a','s','h'].join('').split('').map((t=>t.charCodeAt(0))));static Gw=['cook',"cook's",'cooks','seeks','sheet'];static Hw=[];static Ww=[];static Yw=[];static Vw=[];static Kw=[];static Xw=[];static Jt=t=>{const i=new a(t.read('fragmentsenc.txt')),s=new a(t.read('badenc.txt')),h=new a(t.read('domainenc.txt')),e=new a(t.read('tldlist.txt'));this.read(s,h,i,e)};static filter=t=>{const i=[...t];this.format(i);const s=i.join('').trim(),h=s.toLowerCase(),e=[...h];this.jw(e),this.zw(e),this.Zw(e),this.qw(e);for(let t=0;t<this.Gw.length;t++){let i=-1;for(;-1!==(i=h.indexOf(this.Gw[t],i+1));){const s=[...this.Gw[t]];for(let t=0;t<s.length;t++)e[t+i]=s[t]}}return this.$w(e,[...s]),this.Jw(e),e.join('').trim()};static read=(t,i,s,h)=>{this.Qw(t),this.ty(i),this.iy(s),this.sy(h)};static sy=t=>{const i=t.kt;for(let s=0;s<i;s++)this.Ww[s]=t.st,this.Hw[s]=new Uint16Array(t.st).map((()=>t.st))};static Qw=t=>{const i=t.kt;for(let s=0;s<i;s++){this.Yw[s]=new Uint16Array(t.st).map((()=>t.st));const i=new Array(t.st).fill([]).map((()=>[t.Rt,t.Rt]));i.length>0&&(this.Vw[s]=i)}};static ty=t=>{const i=t.kt;for(let s=0;s<i;s++)this.Kw[s]=new Uint16Array(t.st).map((()=>t.st))};static iy=t=>{const i=t.kt;for(let s=0;s<i;s++)this.Xw[s]=t.St};static jw=t=>{const i=[...t],s=[...t];this.hy(null,i,this.Fw),this.hy(null,s,this.Bw);for(let h=0;h<this.Hw.length;h++)this.ey(s,this.Ww[h],t,this.Hw[h],i)};static zw=t=>{for(let i=0;i<2;i++)for(let i=this.Yw.length-1;i>=0;i--)this.hy(this.Vw[i],t,this.Yw[i])};static Zw=t=>{const i=[...t],s=[...t];this.hy(null,i,this.Uw),this.hy(null,s,this.Fw);for(let h=this.Kw.length-1;h>=0;h--)this.ny(s,i,this.Kw[h],t)};static qw=t=>{for(let i=0;i<t.length;){const s=this.oy(t,i);if(-1===s)return;let h=!1;for(let e=i;e>=0&&e<s&&!h;e++)this.ly(t[e])||this.uy(t[e])||(h=!0);let e=0;h&&(e=0),0===e&&(e=1,i=s);let n=0;for(let h=s;h<t.length&&h<i;h++)n=10*n+t[h].charCodeAt(0)-48;n<=255&&i-s<=8?e++:e=0,4===e&&(this.wy(s,i,t),e=0),i=this.yy(i,t)}};static Ay=t=>{if(this.py(t))return!0;const i=this.my(t),s=this.Xw,h=s.length;if(i===s[0]||i===s[h-1])return!0;let e=0,n=h-1;for(;e<=n;){const t=(e+n)/2|0;if(i===s[t])return!0;i<s[t]?n=t-1:e=t+1}return!1};static my=t=>{if(t.length>6)return 0;let i=0;for(let s=0;s<t.length;s++){const h=t[t.length-s-1];if(this.Iy(h))i=38*i+h.charCodeAt(0)+1-'a'.charCodeAt(0);else if("'"===h)i=38*i+27;else if(this.Ey(h))i=38*i+h.charCodeAt(0)+28-'0'.charCodeAt(0);else if('\0'!==h)return 0}return i};static oy=(t,i)=>{for(let s=i;s<t.length&&s>=0;s++)if(this.Ey(t[s]))return s;return-1};static yy=(t,i)=>{for(let s=t;s<i.length&&s>=0;s++)if(!this.Ey(i[s]))return s;return i.length};static gy=(t,i,s)=>i===s||'o'===i&&'0'===s?1:'o'===i&&'('===s&&')'===t?2:'c'!==i||'('!==s&&'<'!==s&&'['!==s?'e'===i&&''===s||'s'===i&&'$'===s||'l'===i&&'i'===s?1:0:1;static ny=(t,i,s,h)=>{const e=s.length,n=h.length;for(let r=0;r<=n-e;r++){const{_y:e,Cy:n}=this.Ty(r,s,h);if(!e)continue;const o=this.Oy(r,h,3,i,['@']),l=this.by(n-1,h,3,t,['.',',']);(o>2||l>2)&&this.wy(r,n,h)}};static Ty=(t,i,s)=>{const h=i.length;let e=t,n=0;for(;e<s.length&&n<h;){const r=s[e],o=e+1<s.length?s[e+1]:'\0',l=this.gy(o,String.fromCharCode(i[n]),r);if(l>0)e+=l,n++;else{if(0===n)break;const s=this.gy(o,String.fromCharCode(i[n-1]),r);if(s>0)e+=s,1===n&&t++;else{if(n>=h||!this.ly(r))break;e++}}}return{_y:n>=h,Cy:e}};static hy=(t,i,s)=>{if(!(s.length>i.length))for(let h=0;h<=i.length-s.length;h++){let e=h;const{Cy:n,Ly:r,vy:o,Ry:l,Sy:a}=this.My(i,s,e);e=n;let c=i[e],f=e+1<i.length?i[e+1]:'\0';if(!(r>=s.length)||l&&a)continue;let u,d=!0;if(o){let t=!1,s=!1;if((h-1<0||this.ly(i[h-1])&&"'"!==i[h-1])&&(t=!0),(e>=i.length||this.ly(i[e])&&"'"!==i[e])&&(s=!0),!t||!s){let s=!1;for(u=h-2,t&&(u=h);!s&&u<e;){if(u>=0&&(!this.ly(i[u])||"'"===i[u])){const t=[];let h;for(h=0;h<3&&u+h<i.length&&(!this.ly(i[u+h])||"'"===i[u+h]);h++)t[h]=i[u+h];let e=!0;0===h&&(e=!1),h<3&&u-1>=0&&(!this.ly(i[u-1])||"'"===i[u-1])&&(e=!1),e&&!this.Ay(t)&&(s=!0)}u++}s||(d=!1)}}else{c=' ',h-1>=0&&(c=i[h-1]),f=' ',e<i.length&&(f=i[e]);const s=this.xy(c),n=this.xy(f);t&&this.ky(s,t,n)&&(d=!1)}if(!d)continue;let w=0,y=0;for(let t=h;t<e;t++)this.Ey(i[t])?w++:this.Dy(i[t])&&y++;w<=y&&this.wy(h,e,i)}};static My=(t,i,s)=>{let h=s,e=0,n=0,r=!1,o=!1,l=!1;for(;h<t.length&&(!o||!l)&&!(h>=t.length||o&&l);){const a=t[h],c=h+1<t.length?t[h+1]:'\0';let f;if(e<i.length&&(f=this.Ny(c,String.fromCharCode(i[e]),a))>0)1===f&&this.Ey(a)&&(o=!0),2===f&&(this.Ey(a)||this.Ey(c))&&(o=!0),h+=f,e++;else{if(0===e)break;let t;if((t=this.Ny(c,String.fromCharCode(i[e-1]),a))>0)h+=t;else{if(e>=i.length||!this.uy(a))break;if(this.ly(a)&&"'"!==a&&(r=!0),this.Ey(a)&&(l=!0),h++,n++,(100*n/(h-s)|0)>90)break}}}return{Cy:h,Ly:e,vy:r,Ry:o,Sy:l}};static Ny=(t,i,s)=>{if(i===s)return 1;if(i>='a'&&i<='m'){if('a'===i)return'4'!==s&&'@'!==s&&'^'!==s?'/'===s&&'\\'===t?2:0:1;if('b'===i)return'6'!==s&&'8'!==s?'1'===s&&'3'===t?2:0:1;if('c'===i)return'('!==s&&'<'!==s&&'{'!==s&&'['!==s?0:1;if('d'===i)return'['===s&&')'===t?2:0;if('e'===i)return'3'!==s&&''!==s?0:1;if('f'===i)return'p'===s&&'h'===t?2:''===s?1:0;if('g'===i)return'9'!==s&&'6'!==s?0:1;if('h'===i)return'#'===s?1:0;if('i'===i)return'y'!==s&&'l'!==s&&'j'!==s&&'1'!==s&&'!'!==s&&':'!==s&&';'!==s&&'|'!==s?0:1;if('j'===i)return 0;if('k'===i)return 0;if('l'===i)return'1'!==s&&'|'!==s&&'i'!==s?0:1;if('m'===i)return 0}if(i>='n'&&i<='z'){if('n'===i)return 0;if('o'===i)return'0'!==s&&'*'!==s?'('===s&&')'===t||'['===s&&']'===t||'{'===s&&'}'===t||'<'===s&&'>'===t?2:0:1;if('p'===i)return 0;if('q'===i)return 0;if('r'===i)return 0;if('s'===i)return'5'!==s&&'z'!==s&&'$'!==s&&'2'!==s?0:1;if('t'===i)return'7'!==s&&'+'!==s?0:1;if('u'===i)return'v'===s?1:'\\'===s&&'/'===t||'\\'===s&&'|'===t||'|'===s&&'/'===t?2:0;if('v'===i)return'\\'===s&&'/'===t||'\\'===s&&'|'===t||'|'===s&&'/'===t?2:0;if('w'===i)return'v'===s&&'v'===t?2:0;if('x'===i)return')'===s&&'('===t||'}'===s&&'{'===t||']'===s&&'['===t||'>'===s&&'<'===t?2:0;if('y'===i)return 0;if('z'===i)return 0}return i>='0'&&i<='9'?'0'===i?'o'===s||'O'===s?1:'('===s&&')'===t||'{'===s&&'}'===t||'['===s&&']'===t?2:0:'1'===i&&'l'===s?1:0:','===i?'.'===s?1:0:'.'===i?','===s?1:0:'!'===i&&'i'===s?1:0};static ky=(t,i,s)=>{let h=0,e=i.length-1;for(;h<=e;){const n=(h+e)/2|0;if(i[n][0]===t&&i[n][1]===s)return!0;t<i[n][0]||t===i[n][0]&&s<i[n][1]?e=n-1:h=n+1}return!1};static xy=t=>this.Iy(t)?t.charCodeAt(0)+1-'a'.charCodeAt(0):"'"===t?28:this.Ey(t)?t.charCodeAt(0)+29-'0'.charCodeAt(0):27;static ey=(t,i,s,h,e)=>{if(!(h.length>s.length))for(let n=0;n<=s.length-h.length;n++){const{Cy:r,Py:o}=this.Fy(s,h,n);if(o<h.length)continue;let l=!1;const a=this.Oy(n,s,3,e,[',','.']),c=this.by(r-1,s,5,t,['\\','/']);if(1===i&&a>0&&c>0&&(l=!0),2===i&&(a>2&&c>0||a>0&&c>2)&&(l=!0),3===i&&a>0&&c>2&&(l=!0),!l)continue;let f,u=n,d=r-1,w=!1;if(a>2){if(4===a)for(w=!1,f=n-1;f>=0;f--)if(w){if('*'!==e[f])break;u=f}else'*'===e[f]&&(u=f,w=!0);for(w=!1,f=u-1;f>=0;f--)if(w){if(this.ly(s[f]))break;u=f}else this.ly(s[f])||(w=!0,u=f)}if(c>2){if(4===c)for(w=!1,f=d+1;f<s.length;f++)if(w){if('*'!==t[f])break;d=f}else'*'===t[f]&&(d=f,w=!0);for(w=!1,f=d+1;f<s.length;f++)if(w){if(this.ly(s[f]))break;d=f}else this.ly(s[f])||(w=!0,d=f)}this.wy(u,d+1,s)}};static Fy=(t,i,s)=>{let h=0;for(;s<t.length&&h<i.length;){const e=t[s],n=s+1<t.length?t[s+1]:'\0';let r;if((r=this.gy(n,String.fromCharCode(i[h]),e))>0)s+=r,h++;else{if(0===h)break;let t;if((t=this.gy(n,String.fromCharCode(i[h-1]),e))>0)s+=t;else{if(!this.ly(e))break;s++}}}return{Cy:s,Py:h}};static ly=t=>!this.Dy(t)&&!this.Ey(t);static uy=t=>!this.Iy(t)||('v'===t||'x'===t||'j'===t||'q'===t||'z'===t);static Dy=t=>this.Iy(t)||this.Uy(t);static Ey=t=>t>='0'&&t<='9';static Iy=t=>t>='a'&&t<='z';static Uy=t=>t>='A'&&t<='Z';static py=t=>{for(let i=0;i<t.length;i++)if(!this.Ey(t[i])&&'\0'!==t[i])return!1;return!0};static wy=(t,i,s)=>{for(let h=t;h<i;h++)s[h]='*'};static By=(t,i)=>{let s=0;for(let h=i-1;h>=0&&this.ly(t[h]);h--)'*'===t[h]&&s++;return s};static Gy=(t,i)=>{let s=0;for(let h=i+1;h<t.length&&this.ly(t[h]);h++)'*'===t[h]&&s++;return s};static Hy=(t,i,s,h,e)=>(e?this.By(i,s):this.Gy(i,s))>=h?4:this.ly(e?t[s-1]:t[s+1])?1:0;static Oy=(t,i,s,h,e)=>{if(0===t)return 2;for(let s=t-1;s>=0&&this.ly(i[s]);s--)if(e.includes(i[s]))return 3;return this.Hy(i,h,t,s,!0)};static by=(t,i,s,h,e)=>{if(t+1===i.length)return 2;for(let s=t+1;s<i.length&&this.ly(i[s]);s++)if(e.includes(i[s]))return 3;return this.Hy(i,h,t,s,!1)};static format=t=>{let i=0;for(let s=0;s<t.length;s++)this.Wy(t[s])?t[i]=t[s]:t[i]=' ',0!==i&&' '===t[i]&&' '===t[i-1]||i++;for(let s=i;s<t.length;s++)t[s]=' '};static Wy=t=>t>=' '&&t<=''||' '===t||'\n'===t||'\t'===t||''===t||''===t;static $w=(t,i)=>{for(let s=0;s<i.length;s++)'*'!==t[s]&&this.Uy(i[s])&&(t[s]=i[s])};static Jw=t=>{let i=!0;for(let s=0;s<t.length;s++){const h=t[s];this.Dy(h)?i?this.Iy(h)&&(i=!1):this.Uy(h)&&(t[s]=String.fromCharCode(h.charCodeAt(0)+'a'.charCodeAt(0)-65)):i=!0}}}class rt{static Yy=[' ','e','t','a','o','i','h','n','s','r','d','l','u','m','w','c','y','f','g','p','b','v','k','x','j','q','z','0','1','2','3','4','5','6','7','8','9',' ','!','?','.',',',':',';','(',')','-','&','*','\\','\'','@','#','+','=','','$','%','"','[',']'];static Vy=[];static Jt=(t,i)=>{let s,h=0,e=-1;for(let n=0;n<i&&h<100;n++){const i=t.st;s=i>>4&15,-1!==e?(this.Vy[h++]=this.Yy[(e<<4)+s-195],e=-1):s<13?this.Vy[h++]=this.Yy[s]:e=s,s=15&i,-1!==e?(this.Vy[h++]=this.Yy[(e<<4)+s-195],e=-1):s<13?this.Vy[h++]=this.Yy[s]:e=s}let n=!0;for(let t=0;t<h;t++){const i=this.Vy[t];n&&i>='a'&&i<='z'&&(this.Vy[t]=i.toUpperCase(),n=!1),'.'!==i&&'!'!==i||(n=!0)}return this.Vy.slice(0,h).join('')};static Ky=(t,i)=>{i.length>80&&(i=i.substring(0,80)),i=i.toLowerCase();let s=-1;for(let h=0;h<i.length;h++){const e=i.charAt(h);let n=0;for(let t=0;t<this.Yy.length;t++)if(e===this.Yy[t]){n=t;break}n>12&&(n+=195),-1===s?n<13?s=n:t.p1(n):n<13?(t.p1((s<<4)+n),s=-1):(t.p1((s<<4)+(n>>4)),s=15&n)}-1!==s&&t.p1(s<<4)}}class ot{start=0;end=0;form=0;length=0;Xy=null;jy=null;threshold=0;position=0;delta=0;amplitude=0;zy=0;read(t){this.form=t.st,this.start=t.kt,this.end=t.kt,this.length=t.st,this.Xy=new Int32Array(this.length),this.jy=new Int32Array(this.length);for(let i=0;i<this.length;i++)this.Xy[i]=t.St,this.jy[i]=t.St}reset(){this.threshold=0,this.position=0,this.delta=0,this.amplitude=0,this.zy=0}evaluate(t){return this.zy>=this.threshold&&this.jy&&this.Xy&&(this.amplitude=this.jy[this.position++]<<15,this.position>=this.length&&(this.position=this.length-1),this.threshold=this.Xy[this.position]/65536*t|0,this.threshold>this.zy&&(this.delta=((this.jy[this.position]<<15)-this.amplitude)/(this.threshold-this.zy)|0)),this.amplitude+=this.delta,this.zy++,this.amplitude-this.delta>>15}}class lt{static buffer=null;static Zy=null;static sin=null;static qy=new Int32Array(5);static $y=new Int32Array(5);static Jy=new Int32Array(5);static Qy=new Int32Array(5);static tA=new Int32Array(5);iA=null;sA=null;hA=null;eA=null;nA=null;rA=null;release=null;attack=null;oA=new Int32Array(5);lA=new Int32Array(5);aA=new Int32Array(5);start=0;length=500;cA=100;fA=0;static init=()=>{this.Zy=new Int32Array(32768);for(let t=0;t<32768;t++)Math.random()>.5?this.Zy[t]=1:this.Zy[t]=-1;this.sin=new Int32Array(32768);for(let t=0;t<32768;t++)this.sin[t]=16384*Math.sin(t/5215.1903)|0;this.buffer=new Int32Array(220500)};uA(t,i){for(let i=0;i<t;i++)lt.buffer[i]=0;if(i<10)return lt.buffer;const s=t/i|0;this.iA?.reset(),this.sA?.reset();let h=0,e=0,n=0;this.hA&&this.eA&&(this.hA.reset(),this.eA.reset(),h=32.768*(this.hA.end-this.hA.start)/s|0,e=32.768*this.hA.start/s|0);let r=0,o=0,l=0;this.nA&&this.rA&&(this.nA.reset(),this.rA.reset(),r=32.768*(this.nA.end-this.nA.start)/s|0,o=32.768*this.nA.start/s|0);for(let t=0;t<5;t++)this.iA&&0!==this.oA[t]&&(lt.qy[t]=0,lt.$y[t]=this.aA[t]*s,lt.Jy[t]=(this.oA[t]<<14)/100|0,lt.Qy[t]=32.768*(this.iA.end-this.iA.start)*Math.pow(1.0057929410678534,this.lA[t])/s|0,lt.tA[t]=32.768*this.iA.start/s|0);if(this.iA&&this.sA)for(let i=0;i<t;i++){let s=this.iA.evaluate(t),a=this.sA.evaluate(t);if(this.hA&&this.eA){const i=this.hA.evaluate(t),r=this.eA.evaluate(t);s+=this.dA(r,n,this.hA.form)>>1,n+=(i*h>>16)+e}if(this.nA&&this.rA){const i=this.nA.evaluate(t),s=this.rA.evaluate(t);a=a*(32768+(this.dA(s,l,this.nA.form)>>1))>>15,l+=(i*r>>16)+o}for(let h=0;h<5;h++)if(0!==this.oA[h]){const e=i+lt.$y[h];e<t&&(lt.buffer[e]+=this.dA(a*lt.Jy[h]>>15,lt.qy[h],this.iA.form),lt.qy[h]+=(s*lt.Qy[h]>>16)+lt.tA[h])}}if(this.release&&this.attack){this.release.reset(),this.attack.reset();let i=0,s=!0;for(let h=0;h<t;h++){const e=this.release.evaluate(t),n=this.attack.evaluate(t);let r;r=s?this.release.start+((this.release.end-this.release.start)*e>>8):this.release.start+((this.release.end-this.release.start)*n>>8),i+=256,i>=r&&(i=0,s=!s),s&&(lt.buffer[h]=0)}}if(this.fA>0&&this.cA>0){const i=this.fA*s;for(let s=i;s<t;s++)lt.buffer[s]+=lt.buffer[s-i]*this.cA/100|0,lt.buffer[s]|=0}for(let i=0;i<t;i++)lt.buffer[i]<-32768&&(lt.buffer[i]=-32768),lt.buffer[i]>32767&&(lt.buffer[i]=32767);return lt.buffer}dA(t,i,s){return 1===s?(32767&i)<16384?t:-t:2===s?lt.sin[32767&i]*t>>14:3===s?((32767&i)*t>>14)-t:4===s?lt.Zy[i/2607&32767]*t:0}read(t){this.iA=new ot,this.iA.read(t),this.sA=new ot,this.sA.read(t),0!==t.st&&(t.bt--,this.hA=new ot,this.hA.read(t),this.eA=new ot,this.eA.read(t)),0!==t.st&&(t.bt--,this.nA=new ot,this.nA.read(t),this.rA=new ot,this.rA.read(t)),0!==t.st&&(t.bt--,this.release=new ot,this.release.read(t),this.attack=new ot,this.attack.read(t));for(let i=0;i<10;i++){const s=t.Pt;if(0===s)break;this.oA[i]=s,this.lA[i]=t.Nt,this.aA[i]=t.Pt}this.fA=t.Pt,this.cA=t.Pt,this.length=t.St,this.start=t.St}}class at{static wA=new Int32Array(1e3);static yA=null;static AA=null;static pA=new c(1e3,null);mA=new c(10,null);IA=0;loopEnd=0;static Jt=t=>{const i=new a(t.read('sounds.dat'));for(this.yA=new Uint8Array(441e3),this.AA=new a(this.yA),lt.init();;){const t=i.St;if(65535===t)break;const s=new at;s.read(i),this.pA[t]=s,this.wA[t]=s.trim()}};static uA=(t,i)=>{if(!this.pA[t])return null;const s=this.pA[t];return s?.EA(i)??null};read(t){for(let i=0;i<10;i++)0!==t.st&&(t.bt--,this.mA[i]=new lt,this.mA[i]?.read(t));this.IA=t.St,this.loopEnd=t.St}trim(){let t=9999999;for(let i=0;i<10;i++)this.mA[i]&&(this.mA[i].start/20|0)<t&&(t=this.mA[i].start/20|0);if(this.IA<this.loopEnd&&(this.IA/20|0)<t&&(t=this.IA/20|0),9999999===t||0===t)return 0;for(let i=0;i<10;i++)this.mA[i]&&(this.mA[i].start-=20*t);return this.IA<this.loopEnd&&(this.IA-=20*t,this.loopEnd-=20*t),t}EA(t){const i=this.uA(t);return at.AA.bt=0,at.AA?.p4(1380533830),at.AA?.Wt(i+36),at.AA?.p4(1463899717),at.AA?.p4(1718449184),at.AA?.Wt(16),at.AA?.Ht(1),at.AA?.Ht(1),at.AA?.Wt(22050),at.AA?.Wt(22050),at.AA?.Ht(1),at.AA?.Ht(8),at.AA?.p4(1684108385),at.AA?.Wt(i),at.AA.bt+=i,at.AA}uA(t){let i=0;for(let t=0;t<10;t++)this.mA[t]&&this.mA[t].length+this.mA[t].start>i&&(i=this.mA[t].length+this.mA[t].start);if(0===i)return 0;let s=22050*i/1e3|0,h=22050*this.IA/1e3|0,e=22050*this.loopEnd/1e3|0;(h<0||e<0||e>s||h>=e)&&(t=0);let n=s+(e-h)*(t-1);for(let t=44;t<n+44;t++)at.yA&&(at.yA[t]=-128);for(let t=0;t<10;t++)if(this.mA[t]){const i=22050*this.mA[t].length/1e3|0,s=22050*this.mA[t].start/1e3|0,h=this.mA[t].uA(i,this.mA[t].length);for(let t=0;t<i;t++)at.yA&&(at.yA[t+s+44]+=h[t]>>8<<24>>24)}if(t>1){h+=44,e+=44,s+=44,n+=44;const i=n-s;for(let t=s-1;t>=e;t--)at.yA&&(at.yA[t+i]=at.yA[t]);for(let i=1;i<t;i++){const t=(e-h)*i;for(let i=h;i<e;i++)at.yA&&(at.yA[i+t]=at.yA[i])}n-=44}return n}}var ct;const ft=(ct="file:///C:/Projects/2004Scape/Client2-Release/src/js/vendor/tinymidipcm/tinymidipcm.mjs",function(t){var i,h,e=void 0!==(t=t||{})?t:{};e.ready=new Promise((function(t,s){i=t,h=s})),["_tsf_load_memory","_tsf_set_output","_tsf_channel_set_bank_preset","_tsf_set_max_voices","_tsf_channel_set_presetnumber","_tsf_reset","_tsf_close","_tml_load_memory","_midi_render","_malloc","_realloc","_free","_fflush","onRuntimeInitialized"].forEach((t=>{Object.getOwnPropertyDescriptor(e.ready,t)||Object.defineProperty(e.ready,t,{get:()=>X('You are getting '+t+' on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js'),set:()=>X('You are setting '+t+' on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js')})}));var n=Object.assign({},e),r=[],o='object'==typeof window,l='function'==typeof importScripts,a='object'==typeof process&&'object'==typeof process.versions&&'string'==typeof process.versions.node,c=!o&&!a&&!l;if(e.ENVIRONMENT)throw new Error('Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)');var f,u,d,w='';if(a){if('undefined'==typeof process||!process.release||'node'!==process.release.name)throw new Error('not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)');var y,A;w=l?require('path').gA(w)+'/':__dirname+'/';var p=()=>{A||(y=require('fs'),A=require('path'))};f=(t,i)=>(p(),t=A.normalize(t),y._A(t,i?void 0:'utf8')),d=t=>{var i=f(t,!0);return i.buffer||(i=new Uint8Array(i)),k(i.buffer),i},u=(t,i,s)=>{p(),t=A.normalize(t),y.CA(t,(function(t,h){t?s(t):i(h.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,'/'),r=process.argv.slice(2),process.on('uncaughtException',(function(t){if(!(t instanceof ht))throw t})),process.on('unhandledRejection',(function(t){throw t})),e.inspect=function(){return'[Emscripten Module object]'}}else if(c){if('object'==typeof process&&'function'==typeof require||'object'==typeof window||'function'==typeof importScripts)throw new Error('not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)');'undefined'!=typeof read&&(f=function(t){return read(t)}),d=function(t){let i;return'function'==typeof readbuffer?new Uint8Array(readbuffer(t)):(i=read(t,'binary'),k('object'==typeof i),i)},u=function(t,i,s){setTimeout((()=>i(d(t))),0)},'undefined'!=typeof scriptArgs?r=scriptArgs:void 0!==arguments&&(r=arguments),'undefined'!=typeof print&&('undefined'==typeof console&&(console={}),console.log=print,console.warn=console.error='undefined'!=typeof printErr?printErr:print)}else{if(!o&&!l)throw new Error('environment detection error');if(l?w=self.location.href:'undefined'!=typeof document&&document.currentScript&&(w=document.currentScript.src),ct&&(w=ct),w=0!==w.indexOf('blob:')?w.substr(0,w.replace(/[?#].*/,"").lastIndexOf('/')+1):'','object'!=typeof window&&'function'!=typeof importScripts)throw new Error('not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)');f=t=>{var i=new XMLHttpRequest;return i.open('GET',t,!1),i.send(null),i.responseText},l&&(d=t=>{var i=new XMLHttpRequest;return i.open('GET',t,!1),i.responseType='arraybuffer',i.send(null),new Uint8Array(i.response)}),u=(t,i,s)=>{var h=new XMLHttpRequest;h.open('GET',t,!0),h.responseType='arraybuffer',h.onload=()=>{200==h.status||0==h.status&&h.response?i(h.response):s()},h.onerror=s,h.send(null)}}e.print||console.log.bind(console);var m,I,E=e.printErr||console.warn.bind(console);function g(t,i){Object.getOwnPropertyDescriptor(e,t)||Object.defineProperty(e,t,{configurable:!0,get:function(){X('Module.'+t+' has been replaced with plain '+i+' (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)')}})}function _(t){return'FS_createPath'===t||'FS_createDataFile'===t||'FS_createPreloadedFile'===t||'FS_unlink'===t||'addRunDependency'===t||'FS_createLazyFile'===t||'FS_createDevice'===t||'removeRunDependency'===t}Object.assign(e,n),n=null,m='fetchSettings',Object.getOwnPropertyDescriptor(e,m)&&X('`Module.'+m+'` was supplied but `'+m+'` not included in INCOMING_MODULE_JS_API'),e.arguments&&(r=e.arguments),g('arguments','arguments_'),e.thisProgram&&e.thisProgram,g('thisProgram','thisProgram'),e.quit&&e.quit,g('quit','quit_'),k(void 0===e.memoryInitializerPrefixURL,'Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead'),k(void 0===e.pthreadMainPrefixURL,'Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead'),k(void 0===e.cdInitializerPrefixURL,'Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead'),k(void 0===e.filePackagePrefixURL,'Module.filePackagePrefixURL option was removed, use Module.locateFile instead'),k(void 0===e.read,'Module.read option was removed (modify read_ in JS)'),k(void 0===e.readAsync,'Module.readAsync option was removed (modify readAsync in JS)'),k(void 0===e.readBinary,'Module.readBinary option was removed (modify readBinary in JS)'),k(void 0===e.setWindowTitle,'Module.setWindowTitle option was removed (modify setWindowTitle in JS)'),k(void 0===e.TOTAL_MEMORY,'Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY'),g('read','read_'),g('readAsync','readAsync'),g('readBinary','readBinary'),g('setWindowTitle','setWindowTitle'),k(!c,"shell environment detected but not enabled at build time.  Add 'shell' to `-sENVIRONMENT` to enable."),e.wasmBinary&&(I=e.wasmBinary),g('wasmBinary','wasmBinary');var C;e.noExitRuntime;g('noExitRuntime','noExitRuntime'),'object'!=typeof WebAssembly&&X('no native wasm support detected');var T,O,b,L,v,R,S,M,x=!1;function k(t,i){t||X('Assertion failed'+(i?': '+i:''))}function D(t){T=t,e.HEAP8=O=new Int8Array(t),e.HEAP16=L=new Int16Array(t),e.HEAP32=v=new Int32Array(t),e.HEAPU8=b=new Uint8Array(t),e.HEAPU16=new Uint16Array(t),e.HEAPU32=R=new Uint32Array(t),e.HEAPF32=S=new Float32Array(t),e.HEAPF64=M=new Float64Array(t)}'undefined'!=typeof TextDecoder&&new TextDecoder('utf8');var N=5242880;e.TOTAL_STACK&&k(N===e.TOTAL_STACK,'the stack size can no longer be determined at runtime');var P=e.INITIAL_MEMORY||16777216;function F(){if(!x){var t=ft(),i=R[t>>2],s=R[t+4>>2];34821223==i&&2310721022==s||X('Stack overflow! Stack cookie has been overwritten at 0x'+t.toString(16)+', expected hex dwords 0x89BACDFE and 0x2135467, but received 0x'+s.toString(16)+' 0x'+i.toString(16)),1668509029!==R[0]&&X('Runtime error: The application has corrupted its heap memory area (address zero)!')}}g('INITIAL_MEMORY','INITIAL_MEMORY'),k(P>=N,'INITIAL_MEMORY should be larger than TOTAL_STACK, was '+P+'! (TOTAL_STACK='+N+')'),k('undefined'!=typeof Int32Array&&'undefined'!=typeof Float64Array&&null!=Int32Array.prototype.subarray&&null!=Int32Array.prototype.set,'JS engine does not provide full typed array support'),k(!e.wasmMemory,'Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally'),k(16777216==P,'Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically'),function(){var t=new Int16Array(1),i=new Int8Array(t.buffer);if(t[0]=25459,115!==i[0]||99!==i[1])throw'Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)'}();var U=[],B=[],G=[],H=!1;k(Math.imul,'This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill'),k(Math.fround,'This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill'),k(Math.clz32,'This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill'),k(Math.trunc,'This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill');var W=0,Y=null,V=null,K={};function X(t){e.onAbort&&e.onAbort(t),E(t='Aborted('+t+')'),x=!0;var i=new WebAssembly.RuntimeError(t);throw h(i),i}var j={error:function(){X('Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with -sFORCE_FILESYSTEM')},init:function(){j.error()},TA:function(){j.error()},OA:function(){j.error()},bA:function(){j.error()},open:function(){j.error()},LA:function(){j.error()},vA:function(){j.error()},RA:function(){j.error()},SA:function(){j.error()},MA:function(){j.error()}};e.FS_createDataFile=j.TA,e.FS_createPreloadedFile=j.OA;var z,Z,q,$,J='data:application/octet-stream;base64,';function Q(t){return t.startsWith(J)}function tt(t){return t.startsWith('file://')}function it(t,i){return function(){var s=t,h=i;return i||(h=e.asm),k(H,'native function `'+s+'` called before runtime initialization'),h[t]||k(h[t],'exported native function `'+s+'` not found'),h[t].apply(null,arguments)}}function st(t){try{if(t==z&&I)return new Uint8Array(I);if(d)return d(t);throw"both async and sync fetching of the wasm failed"}catch(t){X(t)}}function ht(t){this.name='ExitStatus',this.message='Program terminated with exit('+t+')',this.status=t}function et(t){for(;t.length>0;)t.shift()(e)}function nt(t){nt.xA||(nt.xA={}),nt.xA[t]||(nt.xA[t]=1,a&&(t='warning: '+t),E(t))}function rt(t){try{return C.kA(t-T.byteLength+65535>>>16),D(C.buffer),1}catch(i){E('emscripten_realloc_buffer: Attempted to grow heap from '+T.byteLength+' bytes to '+t+' bytes, but got error: '+i)}}e.locateFile?Q(z='tinymidipcm.wasm')||(Z=z,z=e.locateFile?e.locateFile(Z,w):w+Z):z=new URL(s(227),s.b).toString();var ot,lt={"emscripten_memcpy_big":function(t,i,s){b.copyWithin(t,i,i+s)},"emscripten_resize_heap":function(t){var i=b.length;k((t>>>=0)>i);var s,h,e=2147483648;if(t>e)return E('Cannot enlarge memory, asked to go up to '+t+' bytes, but the limit is '+e+' bytes!'),!1;for(var n=1;n<=4;n*=2){var r=i*(1+.2/n);r=Math.min(r,t+100663296);var o=Math.min(e,(s=Math.max(t,r))+((h=65536)-s%h)%h);if(rt(o))return!0}return E('Failed to grow the heap from '+i+' bytes to '+o+' bytes, not enough memory!'),!1}},at=(function(){var t,i={'env':lt,'wasi_snapshot_preview1':lt};function s(t,i){var s,h=t.exports;e.asm=h,k(C=e.asm.memory,"memory not found in wasm exports"),D(C.buffer),k(e.asm.__indirect_function_table,"table not found in wasm exports"),s=e.asm.__wasm_call_ctors,B.unshift(s),function(t){if(W--,e.monitorRunDependencies&&e.monitorRunDependencies(W),t?(k(K[t]),delete K[t]):E('warning: run dependency removed without ID'),0==W&&(null!==Y&&(clearInterval(Y),Y=null),V)){var i=V;V=null,i()}}('wasm-instantiate')}t='wasm-instantiate',W++,e.monitorRunDependencies&&e.monitorRunDependencies(W),t?(k(!K[t]),K[t]=1,null===Y&&'undefined'!=typeof setInterval&&(Y=setInterval((function(){if(x)return clearInterval(Y),void(Y=null);var t=!1;for(var i in K)t||(t=!0,E('still waiting on run dependencies:')),E('dependency: '+i);t&&E('(end of list)')}),1e4))):E('warning: run dependency added without ID');var n=e;function r(t){k(e===n,'the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?'),n=null,s(t.instance)}function c(t){return function(){if(!I&&(o||l)){if('function'==typeof fetch&&!tt(z))return fetch(z,{credentials:'same-origin'}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+z+"'";return t.arrayBuffer()})).catch((function(){return st(z)}));if(u)return new Promise((function(t,i){u(z,(function(i){t(new Uint8Array(i))}),i)}))}return Promise.resolve().then((function(){return st(z)}))}().then((function(t){return WebAssembly.instantiate(t,i)})).then((function(t){return t})).then(t,(function(t){E('failed to asynchronously prepare wasm: '+t),tt(z)&&E('warning: Loading from a file URI ('+z+') is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing'),X(t)}))}if(e.instantiateWasm)try{return e.instantiateWasm(i,s)}catch(t){E('Module.instantiateWasm callback failed with error: '+t),h(t)}(I||'function'!=typeof WebAssembly.instantiateStreaming||Q(z)||tt(z)||a||'function'!=typeof fetch?c(r):fetch(z,{credentials:'same-origin'}).then((function(t){return WebAssembly.instantiateStreaming(t,i).then(r,(function(t){return E('wasm streaming compile failed: '+t),E('falling back to ArrayBuffer instantiation'),c(r)}))}))).catch(h)}(),e.___wasm_call_ctors=it("__wasm_call_ctors"),e._malloc=it("malloc"),e._free=it("free"),e._tsf_load_memory=it("tsf_load_memory"),e._tsf_close=it("tsf_close"),e._tsf_reset=it("tsf_reset"),e._tsf_set_output=it("tsf_set_output"),e._tsf_set_max_voices=it("tsf_set_max_voices"),e._realloc=it("realloc"),e._tsf_channel_set_presetnumber=it("tsf_channel_set_presetnumber"),e._tsf_channel_set_bank_preset=it("tsf_channel_set_bank_preset"),e._tml_load_memory=it("tml_load_memory"),e._midi_render=it("midi_render"),e.___errno_location=it("__errno_location"),e._fflush=it("fflush"),e._emscripten_stack_init=function(){return(at=e._emscripten_stack_init=e.asm.emscripten_stack_init).apply(null,arguments)}),ft=(e._emscripten_stack_get_free=function(){return(e._emscripten_stack_get_free=e.asm.emscripten_stack_get_free).apply(null,arguments)},e._emscripten_stack_get_base=function(){return(e._emscripten_stack_get_base=e.asm.emscripten_stack_get_base).apply(null,arguments)},e._emscripten_stack_get_end=function(){return(ft=e._emscripten_stack_get_end=e.asm.emscripten_stack_get_end).apply(null,arguments)});function ut(){var t;at(),k(!(3&(t=ft()))),R[t>>2]=34821223,R[t+4>>2]=2310721022,R[0]=1668509029}function dt(t){function s(){ot||(ot=!0,e.calledRun=!0,x||(k(!H),H=!0,F(),et(B),i(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),k(!e._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),function(){if(F(),e.postRun)for('function'==typeof e.postRun&&(e.postRun=[e.postRun]);e.postRun.length;)t=e.postRun.shift(),G.unshift(t);var t;et(G)}()))}t=t||r,W>0||(ut(),function(){if(e.preRun)for('function'==typeof e.preRun&&(e.preRun=[e.preRun]);e.preRun.length;)t=e.preRun.shift(),U.unshift(t);var t;et(U)}(),W>0||(e.setStatus?(e.setStatus('Running...'),setTimeout((function(){setTimeout((function(){e.setStatus('')}),1),s()}),1)):s(),F()))}if(e.stackSave=it("stackSave"),e.stackRestore=it("stackRestore"),e.stackAlloc=it("stackAlloc"),e.setValue=function(t,i,s="i8"){switch(s.endsWith('*')&&(s='*'),s){case'i1':case'i8':O[0|t]=i;break;case'i16':L[t>>1]=i;break;case'i32':v[t>>2]=i;break;case'i64':$=[i>>>0,(q=i,+Math.abs(q)>=1?q>0?(0|Math.min(+Math.floor(q/4294967296),4294967295))>>>0:~~+Math.ceil((q-+(~~q>>>0))/4294967296)>>>0:0)],v[t>>2]=$[0],v[t+4>>2]=$[1];break;case'float':S[t>>2]=i;break;case'double':M[t>>3]=i;break;case'*':R[t>>2]=i;break;default:X('invalid type for setValue: '+s)}},e.getValue=function(t,i="i8"){switch(i.endsWith('*')&&(i='*'),i){case'i1':case'i8':return O[0|t];case'i16':return L[t>>1];case'i32':case'i64':return v[t>>2];case'float':return S[t>>2];case'double':return M[t>>3];case'*':return R[t>>2];default:X('invalid type for getValue: '+i)}return null},['run','UTF8ArrayToString','UTF8ToString','stringToUTF8Array','stringToUTF8','lengthBytesUTF8','addOnPreRun','addOnInit','addOnPreMain','addOnExit','addOnPostRun','addRunDependency','removeRunDependency','FS_createFolder','FS_createPath','FS_createDataFile','FS_createPreloadedFile','FS_createLazyFile','FS_createLink','FS_createDevice','FS_unlink','getLEB','getFunctionTables','alignFunctionTables','registerFunctions','prettyPrint','getCompilerSetting','print','printErr','callMain','abort','keepRuntimeAlive','wasmMemory','stackAlloc','stackSave','stackRestore','getTempRet0','setTempRet0','writeStackCookie','checkStackCookie','ptrToString','zeroMemory','stringToNewUTF8','exitJS','getHeapMax','emscripten_realloc_buffer','ENV','ERRNO_CODES','ERRNO_MESSAGES','setErrNo','inetPton4','inetNtop4','inetPton6','inetNtop6','readSockaddr','writeSockaddr','DNS','getHostByName','Protocols','Sockets','getRandomDevice','warnOnce','traverseStack','UNWIND_CACHE','convertPCtoSourceLocation','readAsmConstArgsArray','readAsmConstArgs','mainThreadEM_ASM','jstoi_q','jstoi_s','getExecutableName','listenOnce','autoResumeAudioContext','dynCallLegacy','getDynCaller','dynCall','handleException','runtimeKeepalivePush','runtimeKeepalivePop','callUserCallback','maybeExit','safeSetTimeout','asmjsMangle','asyncLoad','alignMemory','mmapAlloc','writeI53ToI64','writeI53ToI64Clamped','writeI53ToI64Signaling','writeI53ToU64Clamped','writeI53ToU64Signaling','readI53FromI64','readI53FromU64','convertI32PairToI53','convertI32PairToI53Checked','convertU32PairToI53','getCFunc','ccall','cwrap','uleb128Encode','sigToWasmTypes','generateFuncType','convertJsFunctionToWasm','freeTableIndexes','functionsInTableMap','getEmptyTableSlot','updateTableMap','addFunction','removeFunction','reallyNegative','unSign','strLen','reSign','formatString','PATH','PATH_FS','intArrayFromString','intArrayToString','AsciiToString','stringToAscii','UTF16Decoder','UTF16ToString','stringToUTF16','lengthBytesUTF16','UTF32ToString','stringToUTF32','lengthBytesUTF32','allocateUTF8','allocateUTF8OnStack','writeStringToMemory','writeArrayToMemory','writeAsciiToMemory','SYSCALLS','getSocketFromFD','getSocketAddress','JSEvents','registerKeyEventCallback','specialHTMLTargets','maybeCStringToJsString','findEventTarget','findCanvasEventTarget','getBoundingClientRect','fillMouseEventData','registerMouseEventCallback','registerWheelEventCallback','registerUiEventCallback','registerFocusEventCallback','fillDeviceOrientationEventData','registerDeviceOrientationEventCallback','fillDeviceMotionEventData','registerDeviceMotionEventCallback','screenOrientation','fillOrientationChangeEventData','registerOrientationChangeEventCallback','fillFullscreenChangeEventData','registerFullscreenChangeEventCallback','JSEvents_requestFullscreen','JSEvents_resizeCanvasForFullscreen','registerRestoreOldStyle','hideEverythingExceptGivenElement','restoreHiddenElements','setLetterbox','currentFullscreenStrategy','restoreOldWindowedStyle','softFullscreenResizeWebGLRenderTarget','doRequestFullscreen','fillPointerlockChangeEventData','registerPointerlockChangeEventCallback','registerPointerlockErrorEventCallback','requestPointerLock','fillVisibilityChangeEventData','registerVisibilityChangeEventCallback','registerTouchEventCallback','fillGamepadEventData','registerGamepadEventCallback','registerBeforeUnloadEventCallback','fillBatteryEventData','battery','registerBatteryEventCallback','setCanvasElementSize','getCanvasElementSize','demangle','demangleAll','jsStackTrace','stackTrace','ExitStatus','getEnvStrings','checkWasiClock','flush_NO_FILESYSTEM','dlopenMissingError','createDyncallWrapper','setImmediateWrapped','clearImmediateWrapped','polyfillSetImmediate','uncaughtExceptionCount','exceptionLast','exceptionCaught','ExceptionInfo','exception_addRef','exception_decRef','Browser','setMainLoop','wget','FS','MEMFS','TTY','PIPEFS','SOCKFS','_setNetworkCallback','tempFixedLengthArray','miniTempWebGLFloatBuffers','heapObjectForWebGLType','heapAccessShiftForWebGLHeap','GL','emscriptenWebGLGet','computeUnpackAlignedImageSize','emscriptenWebGLGetTexPixelData','emscriptenWebGLGetUniform','webglGetUniformLocation','webglPrepareUniformLocationsBeforeFirstUse','webglGetLeftBracePos','emscriptenWebGLGetVertexAttrib','writeGLArray','AL','SDL_unicode','SDL_ttfContext','SDL_audio','SDL','SDL_gfx','GLUT','EGL','GLFW_Window','GLFW','GLEW','IDBStore','runAndAbortIfError','ALLOC_NORMAL','ALLOC_STACK','allocate'].forEach((function(t){Object.getOwnPropertyDescriptor(e,t)||Object.defineProperty(e,t,{configurable:!0,get:function(){var i="'"+t+"' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the FAQ)";_(t)&&(i+='. Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you'),X(i)}})})),['ptrToString','zeroMemory','stringToNewUTF8','exitJS','setErrNo','inetPton4','inetNtop4','inetPton6','inetNtop6','readSockaddr','writeSockaddr','getHostByName','getRandomDevice','traverseStack','convertPCtoSourceLocation','readAsmConstArgs','mainThreadEM_ASM','jstoi_q','jstoi_s','getExecutableName','listenOnce','autoResumeAudioContext','dynCallLegacy','getDynCaller','dynCall','runtimeKeepalivePush','runtimeKeepalivePop','callUserCallback','maybeExit','safeSetTimeout','asmjsMangle','asyncLoad','alignMemory','mmapAlloc','writeI53ToI64','writeI53ToI64Clamped','writeI53ToI64Signaling','writeI53ToU64Clamped','writeI53ToU64Signaling','readI53FromI64','readI53FromU64','convertI32PairToI53','convertI32PairToI53Checked','convertU32PairToI53','getCFunc','ccall','cwrap','uleb128Encode','sigToWasmTypes','generateFuncType','convertJsFunctionToWasm','getEmptyTableSlot','updateTableMap','addFunction','removeFunction','reallyNegative','unSign','strLen','reSign','formatString','intArrayFromString','intArrayToString','AsciiToString','stringToAscii','UTF16ToString','stringToUTF16','lengthBytesUTF16','UTF32ToString','stringToUTF32','lengthBytesUTF32','allocateUTF8','allocateUTF8OnStack','writeStringToMemory','writeAsciiToMemory','getSocketFromFD','getSocketAddress','registerKeyEventCallback','maybeCStringToJsString','findEventTarget','findCanvasEventTarget','getBoundingClientRect','fillMouseEventData','registerMouseEventCallback','registerWheelEventCallback','registerUiEventCallback','registerFocusEventCallback','fillDeviceOrientationEventData','registerDeviceOrientationEventCallback','fillDeviceMotionEventData','registerDeviceMotionEventCallback','screenOrientation','fillOrientationChangeEventData','registerOrientationChangeEventCallback','fillFullscreenChangeEventData','registerFullscreenChangeEventCallback','JSEvents_requestFullscreen','JSEvents_resizeCanvasForFullscreen','registerRestoreOldStyle','hideEverythingExceptGivenElement','restoreHiddenElements','setLetterbox','softFullscreenResizeWebGLRenderTarget','doRequestFullscreen','fillPointerlockChangeEventData','registerPointerlockChangeEventCallback','registerPointerlockErrorEventCallback','requestPointerLock','fillVisibilityChangeEventData','registerVisibilityChangeEventCallback','registerTouchEventCallback','fillGamepadEventData','registerGamepadEventCallback','registerBeforeUnloadEventCallback','fillBatteryEventData','battery','registerBatteryEventCallback','setCanvasElementSize','getCanvasElementSize','getEnvStrings','checkWasiClock','flush_NO_FILESYSTEM','createDyncallWrapper','setImmediateWrapped','clearImmediateWrapped','polyfillSetImmediate','ExceptionInfo','exception_addRef','exception_decRef','setMainLoop','_setNetworkCallback','heapObjectForWebGLType','heapAccessShiftForWebGLHeap','emscriptenWebGLGet','computeUnpackAlignedImageSize','emscriptenWebGLGetTexPixelData','emscriptenWebGLGetUniform','webglGetUniformLocation','webglPrepareUniformLocationsBeforeFirstUse','webglGetLeftBracePos','emscriptenWebGLGetVertexAttrib','writeGLArray','SDL_unicode','SDL_ttfContext','SDL_audio','GLFW_Window','runAndAbortIfError','ALLOC_NORMAL','ALLOC_STACK','allocate'].forEach((function(t){'undefined'==typeof globalThis||Object.getOwnPropertyDescriptor(globalThis,t)||Object.defineProperty(globalThis,t,{configurable:!0,get:function(){var i='`'+t+'` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line';_(t)&&(i+='. Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you'),nt(i)}})})),V=function t(){ot||dt(),ot||(V=t)},e.preInit)for('function'==typeof e.preInit&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return dt(),t.ready});const ut=class{constructor(t={}){this.DA=void 0,this.NA=0,this.PA=0,this.FA=0,this.UA=t.UA||100,this.sampleRate=t.sampleRate||44100,this.BA=t.BA||2,this.gain=t.gain||0,t.bufferSize?this.bufferSize=t.bufferSize:this.GA(1),this.HA=t.HA||(()=>{}),this.WA=t.WA||(()=>{}),this.YA=void 0,this.test=0}async init(){if(!this.DA){if('undefined'!=typeof process){const{gA:t}=await import('path'),{VA:i}=await import('module');globalThis.__dirname=t("file:///C:/Projects/2004Scape/Client2-Release/src/js/vendor/tinymidipcm/index.js"),globalThis.require=i("file:///C:/Projects/2004Scape/Client2-Release/src/js/vendor/tinymidipcm/index.js")}this.DA=await ft(),this.KA=this.DA._malloc(this.bufferSize),this.XA=this.DA._malloc(8)}}GA(t){this.bufferSize=4*this.sampleRate*this.BA*t}jA(){if(!this.DA)throw new Error(`${this.constructor.name} not initalized. call .init()`)}zA(t){this.jA();const{_malloc:i,_free:s,_tsf_load_memory:h,_tsf_set_output:e,_tsf_channel_set_bank_preset:n,_tsf_set_max_voices:r,_tsf_channel_set_presetnumber:o}=this.DA;s(this.NA),this.NA=i(t.length),this.DA.HEAPU8.set(t,this.NA),this.PA=h(this.NA,t.length),e(this.PA,2===this.BA?0:2,this.sampleRate,this.gain)}ZA(){this.jA();const t=new Uint8Array(this.bufferSize);return t.set(this.DA.HEAPU8.subarray(this.KA,this.KA+this.bufferSize)),t}qA(t){const{_malloc:i,_free:s,_tml_load_memory:h}=this.DA;return s(this.FA),this.FA=i(t.length),this.DA.HEAPU8.set(t,this.FA),h(this.FA,t.length)}$A(t){const{_midi_render:i}=this.DA;return i(this.PA,t,this.BA,this.sampleRate,this.KA,this.bufferSize,this.XA)}JA(t){if(this.jA(),!this.PA)throw new Error('no soundfont buffer set. call .setSoundfont');window.clearTimeout(this.YA);const{setValue:i,getValue:s}=this.DA;i(this.XA,0,'double'),this.DA._tsf_reset(this.PA),this.DA._tsf_channel_set_bank_preset(this.PA,9,128,0),t[0]==='R'.charCodeAt(0)&&(t=t.slice(20));let h=this.qA(t);const e=()=>{h=this.$A(h);const t=this.ZA();this.HA(t),h?this.YA=setTimeout(e,this.UA):this.WA(s(this.XA,'double'))};this.YA=setTimeout(e,16)}};async function dt(t,i={}){const s={env:Object.assign(Object.create(globalThis),i.env||{},{abort(t,i,s,h){t=r(t>>>0),i=r(i>>>0),s>>>=0,h>>>=0,(()=>{throw Error(`${t} in ${i}:${s}:${h}`)})()}})},{exports:h}=await WebAssembly.instantiate(t,s),e=h.memory||i.env.memory,n=Object.setPrototypeOf({read:(t,i,s,n)=>(i=function(t,i,s,n,r){if(null==n)return 0;const o=n.length,l=h.__pin(h.__new(o<<s,i))>>>0;if(r)new r(e.buffer,l,o).set(n);else for(let i=0;i<o;i++)t(l+(i<<s>>>0),n[i]);return h.__unpin(l),l}(l,6,0,i,Int8Array)||function(){throw TypeError("value must not be null")}(),function(t,i,s){if(!s)return null;const h=function(t){try{return o.getUint32(t,!0)}catch{return o=new DataView(e.buffer),o.getUint32(t,!0)}}(s-4)>>>i,n=new Array(h);for(let e=0;e<h;++e)n[e]=t(s+(e<<i>>>0));return n}(a,0,h.read(t,i,s,n)>>>0))},h);function r(t){if(!t)return null;const i=t+new Uint32Array(e.buffer)[t-4>>>2]>>>1,s=new Uint16Array(e.buffer);let h=t>>>1,n="";for(;i-h>1024;)n+=String.fromCharCode(...s.subarray(h,h+=1024));return n+String.fromCharCode(...s.subarray(h,i))}let o=new DataView(e.buffer);function l(t,i){try{o.setUint8(t,i,!0)}catch{o=new DataView(e.buffer),o.setUint8(t,i,!0)}}function a(t){try{return o.getInt8(t,!0)}catch{return o=new DataView(e.buffer),o.getInt8(t,!0)}}return n}!function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(window.audioContext=new window.AudioContext);var t=function(i){if(window.audioContext){var s=window.audioContext.createBuffer(1,1,22050),h=window.audioContext.createBufferSource();h.buffer=s,h.connect(window.audioContext.destination),h.start?h.start(0):h.play?h.play(0):h.noteOn&&h.noteOn(0)}document.removeEventListener('touchstart',t),document.removeEventListener('touchend',t),document.removeEventListener('click',t)};document.addEventListener('touchstart',t),document.addEventListener('touchend',t),document.addEventListener('click',t)}(),(async()=>{let t=new Float32Array,i=window.audioContext.createGain();i.gain.value=.1,i.connect(window.audioContext.destination);let s=window.audioContext.currentTime,h=[];const e=new ut({UA:30,HA:i=>{let s=new Float32Array(i.buffer),h=new Float32Array(t.length+s.length);h.set(t,0),h.set(s,t.length),t=h},WA:t=>{},bufferSize:102400});await e.init();const n=await fetch('./SCC1_Florestan.sf2'),r=new Uint8Array(await n.arrayBuffer());function o(){if(!window.audioContext||!t.length)return;let e=window.audioContext.createBufferSource();const n=t.length/2,r=window.audioContext.createBuffer(2,n,44100);for(let i=0;i<2;i++){const s=r.getChannelData(i);let h=i;for(let i=0;i<n;i++)s[i]=t[h],h+=2}s<window.audioContext.currentTime&&(s=window.audioContext.currentTime),e.buffer=r,e.connect(i),e.start(s),h.push(e),s+=r.duration,t=new Float32Array}let l;e.zA(r),window._tinyMidiStop=async()=>{if(l&&clearInterval(l),t=new Float32Array,h.length){let t=i.gain.value;i.gain.value=0,h.forEach((t=>{t.stop(window.audioContext.currentTime)})),h=[],i.gain.value=t}},window._tinyMidiVolume=(t=1)=>{i.gain.value=t},window._tinyMidiPlay=async(t,i=1)=>{t&&(await window._tinyMidiStop(),-1!=i&&window._tinyMidiVolume(i),s=window.audioContext.currentTime,l=setInterval(o,250),e.JA(t))}})();class wt{static QA=null;static load=async t=>{this.QA=await dt(new WebAssembly.Module(t),{env:void 0})};static read=(t,i,s,h)=>{if(!this.QA)throw new Error('bz2 not found!!');return Int8Array.from(this.QA.read(t,i,s,h))}}class yt{static enabled=!1;static tp=null;static ip=null;static sp=0;static hp=0;static ep=0;static np=0;static rp=0;static op=()=>{this.tp=a.vt(1),this.ip=null,this.sp=performance.now(),this.enabled=!0};static lp=()=>{this.enabled=!1,this.tp=null};static flush=()=>{let t=null;return this.ip&&this.enabled&&(t=this.ip),this.ip=null,t};static stop=()=>{let t=null;return this.tp&&this.tp.bt>0&&this.enabled&&(t=this.tp),this.lp(),t};static ap=(t,i,s)=>{if(!(this.enabled&&t>=0&&t<789&&i>=0&&i<532))return;this.hp++;const h=performance.now();let e=(h-this.sp)/10|0;e>250&&(e=250),this.sp=h,this.cp(5),1===s?this.tp?.p1(1):this.tp?.p1(2),this.tp?.p1(e),this.tp?.p3(t+(i<<10))};static fp=t=>{if(!this.enabled)return;this.hp++;const i=performance.now();let s=(i-this.sp)/10|0;s>250&&(s=250),this.sp=i,this.cp(2),1===t?this.tp?.p1(3):this.tp?.p1(4),this.tp?.p1(s)};static up=(t,i)=>{if(!(this.enabled&&t>=0&&t<789&&i>=0&&i<532))return;const s=performance.now();if(s-this.ep>=50){this.ep=s,this.hp++;let h=(s-this.sp)/10|0;h>250&&(h=250),this.sp=s,t-this.np<8&&t-this.np>=-8&&i-this.rp<8&&i-this.rp>=-8?(this.cp(3),this.tp?.p1(5),this.tp?.p1(h),this.tp?.p1(t+(i-this.rp+8<<4)+8-this.np)):t-this.np<128&&t-this.np>=-128&&i-this.rp<128&&i-this.rp>=-128?(this.cp(4),this.tp?.p1(6),this.tp?.p1(h),this.tp?.p1(t+128-this.np),this.tp?.p1(i+128-this.rp)):(this.cp(5),this.tp?.p1(7),this.tp?.p1(h),this.tp?.p3(t+(i<<10))),this.np=t,this.rp=i}};static dp=t=>{if(!this.enabled)return;this.hp++;const i=performance.now();let s=(i-this.sp)/10|0;s>250&&(s=250),this.sp=i,1e3===t?t=11:1001===t?t=12:1002===t?t=14:1003===t?t=15:t>=1008&&(t-=992),this.cp(3),this.tp?.p1(8),this.tp?.p1(s),this.tp?.p1(t)};static wp=t=>{if(!this.enabled)return;this.hp++;const i=performance.now();let s=(i-this.sp)/10|0;s>250&&(s=250),this.sp=i,1e3===t?t=11:1001===t?t=12:1002===t?t=14:1003===t?t=15:t>=1008&&(t-=992),this.cp(3),this.tp?.p1(9),this.tp?.p1(s),this.tp?.p1(t)};static yp=()=>{if(!this.enabled)return;this.hp++;const t=performance.now();let i=(t-this.sp)/10|0;i>250&&(i=250),this.sp=t,this.cp(2),this.tp?.p1(10),this.tp?.p1(i)};static Ap=()=>{if(!this.enabled)return;this.hp++;const t=performance.now();let i=(t-this.sp)/10|0;i>250&&(i=250),this.sp=t,this.cp(2),this.tp?.p1(11),this.tp?.p1(i)};static pp=()=>{if(!this.enabled)return;this.hp++;const t=performance.now();let i=(t-this.sp)/10|0;i>250&&(i=250),this.sp=t,this.cp(2),this.tp?.p1(12),this.tp?.p1(i)};static mp=()=>{if(!this.enabled)return;this.hp++;const t=performance.now();let i=(t-this.sp)/10|0;i>250&&(i=250),this.sp=t,this.cp(2),this.tp?.p1(13),this.tp?.p1(i)};static cp=t=>{if(this.tp&&this.tp.bt+t>=500){const t=this.tp;this.tp=a.vt(1),this.ip=t}}}class At{level;y;x;z;model;Ip;Ep;gp;_p;Cp;Tp;Op;info;bp=0;Ji=0;constructor(t,i,s,h,e,n,r,o,l,a,c,f,u){this.level=t,this.y=i,this.x=s,this.z=h,this.model=e,this.Ip=n,this.Ep=r,this.gp=o,this._p=l,this.Cp=a,this.Tp=c,this.Op=f,this.info=u}}class pt extends r{level;x;z;Lp;vp;Rp;Sp=null;Mp=null;xp=null;kp=null;Dp=null;Np=null;Pp=null;Fp=0;Up=0;Bp=0;visible=!1;update=!1;Gp=!1;Hp=0;Wp=0;Yp=0;Vp=0;constructor(t,i,s){super(),this.Lp=this.level=t,this.x=i,this.z=s,this.vp=new c(5,null),this.Rp=new Int32Array(5)}}class mt{Kp;Xp;jp;zp;type;zh;Zh;qh;$h;Qh;te;mode=0;Zp=0;qp=0;$p=0;Jp=0;Qp=0;tm=0;constructor(t,i,s,h,e,n,r,o,l,a,c){this.Kp=t,this.Xp=i,this.jp=s,this.zp=h,this.type=e,this.zh=n,this.Zh=r,this.qh=o,this.$h=l,this.Qh=a,this.te=c}}class It{static OPEN=0;static im=1;static sm=2;static hm=4;static nm=8;static rm=It.im<<4;static om=It.sm<<4;static lm=It.hm<<4;static am=It.nm<<4;static fm=256;static um=512;static dm=1024;static wm=2048;static ym=4096;static Am=It.um<<4;static pm=It.dm<<4;static Im=It.wm<<4;static Em=It.ym<<4;static gm=It.fm<<9;static _m=524288;static Cm=2097152;static Tm=It.Cm|It._m;static Om=It.fm|It.Tm;static bm=It.sm|It.Om;static Lm=It.nm|It.Om;static vm=It.sm|It.hm|It.Lm;static Rm=It.om|It.Om;static Sm=It.nm|It.rm|It.Rm;static Mm=It.am|It.Om;static xm=It.im|It.sm|It.Mm;static km=It.om|It.lm|It.Mm;static Dm=16777215}class Et{static fn=1;static un=2;static dn=4;static cn=8}class gt{static Nm=4;static Pm=104;static index=(t,i)=>t*gt.Pm+i;offsetX;Fm;sizeX;sizeZ;flags;constructor(){this.offsetX=0,this.Fm=0,this.sizeX=gt.Pm,this.sizeZ=gt.Pm,this.flags=new Int32Array(this.sizeX*this.sizeZ),this.reset()}reset=()=>{for(let t=0;t<this.sizeX;t++)for(let i=0;i<this.sizeZ;i++){const s=gt.index(t,i);0===t||0===i||t===this.sizeX-1||i===this.sizeZ-1?this.flags[s]=It.Dm:this.flags[s]=It.OPEN}};Um=(t,i)=>{this.flags[gt.index(t-this.offsetX,i-this.Fm)]|=It.Cm};Bm=(t,i)=>{this.flags[gt.index(t-this.offsetX,i-this.Fm)]&=~It.Cm};Gm=(t,i,s,h,e,n)=>{let r=It.fm;n&&(r|=It.gm);const o=t-this.offsetX,l=i-this.Fm;if(e===M.fn||e===M.dn){const t=s;s=h,h=t}for(let t=o;t<o+s;t++)if(t>=0&&t<this.sizeX)for(let i=l;i<l+h;i++)i>=0&&i<this.sizeZ&&this.add(t,i,r)};Hm=(t,i,s,h,e,n)=>{let r=It.fm;n&&(r|=It.gm);const o=t-this.offsetX,l=i-this.Fm;if(e===M.fn||e===M.dn){const t=s;s=h,h=t}for(let t=o;t<o+s;t++)if(t>=0&&t<this.sizeX)for(let i=l;i<l+h;i++)i>=0&&i<this.sizeZ&&this.remove(t,i,r)};Wm=(t,i,s,h,e)=>{const n=t-this.offsetX,r=i-this.Fm,o=e?It.Em:It.am,l=e?It.ym:It.nm,a=e?It.dm:It.sm,c=e?It.pm:It.om,f=e?It.um:It.im,u=e?It.Am:It.rm,d=e?It.wm:It.hm,w=e?It.Im:It.lm;s===S.Be.id?h===M.cn?(this.add(n,r,o),this.add(n-1,r,l)):h===M.fn?(this.add(n,r,a),this.add(n,r+1,c)):h===M.un?(this.add(n,r,l),this.add(n+1,r,o)):h===M.dn&&(this.add(n,r,c),this.add(n,r-1,a)):s===S.Ge.id||s===S.We.id?h===M.cn?(this.add(n,r,f),this.add(n-1,r+1,u)):h===M.fn?(this.add(n,r,d),this.add(n+1,r+1,w)):h===M.un?(this.add(n,r,u),this.add(n+1,r-1,f)):h===M.dn&&(this.add(n,r,w),this.add(n-1,r-1,d)):s===S.He.id&&(h===M.cn?(this.add(n,r,a|o),this.add(n-1,r,l),this.add(n,r+1,c)):h===M.fn?(this.add(n,r,a|l),this.add(n,r+1,c),this.add(n+1,r,o)):h===M.un?(this.add(n,r,c|l),this.add(n+1,r,o),this.add(n,r-1,a)):h===M.dn&&(this.add(n,r,c|o),this.add(n,r-1,a),this.add(n-1,r,l))),e&&this.Wm(t,i,s,h,!1)};Ym=(t,i,s,h,e)=>{const n=t-this.offsetX,r=i-this.Fm,o=e?It.Em:It.am,l=e?It.ym:It.nm,a=e?It.dm:It.sm,c=e?It.pm:It.om,f=e?It.um:It.im,u=e?It.Am:It.rm,d=e?It.wm:It.hm,w=e?It.Im:It.lm;s===S.Be.id?h===M.cn?(this.remove(n,r,o),this.remove(n-1,r,l)):h===M.fn?(this.remove(n,r,a),this.remove(n,r+1,c)):h===M.un?(this.remove(n,r,l),this.remove(n+1,r,o)):h===M.dn&&(this.remove(n,r,c),this.remove(n,r-1,a)):s===S.Ge.id||s===S.We.id?h===M.cn?(this.remove(n,r,f),this.remove(n-1,r+1,u)):h===M.fn?(this.remove(n,r,d),this.remove(n+1,r+1,w)):h===M.un?(this.remove(n,r,u),this.remove(n+1,r-1,f)):h===M.dn&&(this.remove(n,r,w),this.remove(n-1,r-1,d)):s===S.He.id&&(h===M.cn?(this.remove(n,r,a|o),this.remove(n-1,r,l),this.remove(n,r+1,c)):h===M.fn?(this.remove(n,r,a|l),this.remove(n,r+1,c),this.remove(n+1,r,o)):h===M.un?(this.remove(n,r,c|l),this.remove(n+1,r,o),this.remove(n,r-1,a)):h===M.dn&&(this.remove(n,r,c|o),this.remove(n,r-1,a),this.remove(n-1,r,l))),e&&this.Ym(t,i,s,h,!1)};Vm=(t,i,s,h,e,n)=>{if(t===s&&i===h)return!0;const r=t-this.offsetX,o=i-this.Fm,l=s-this.offsetX,a=h-this.Fm,c=gt.index(r,o);if(e===S.Be.id){if(n===M.cn){if(r===l-1&&o===a)return!0;if(r===l&&o===a+1&&(this.flags[c]&It.Rm)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.bm)===It.OPEN)return!0}else if(n===M.fn){if(r===l&&o===a+1)return!0;if(r===l-1&&o===a&&(this.flags[c]&It.Lm)===It.OPEN)return!0;if(r===l+1&&o===a&&(this.flags[c]&It.Mm)===It.OPEN)return!0}else if(n===M.un){if(r===l+1&&o===a)return!0;if(r===l&&o===a+1&&(this.flags[c]&It.Rm)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.bm)===It.OPEN)return!0}else if(n===M.dn){if(r===l&&o===a-1)return!0;if(r===l-1&&o===a&&(this.flags[c]&It.Lm)===It.OPEN)return!0;if(r===l+1&&o===a&&(this.flags[c]&It.Mm)===It.OPEN)return!0}}else if(e===S.He.id){if(n===M.cn){if(r===l-1&&o===a)return!0;if(r===l&&o===a+1)return!0;if(r===l+1&&o===a&&(this.flags[c]&It.Mm)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.bm)===It.OPEN)return!0}else if(n===M.fn){if(r===l-1&&o===a&&(this.flags[c]&It.Lm)===It.OPEN)return!0;if(r===l&&o===a+1)return!0;if(r===l+1&&o===a)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.bm)===It.OPEN)return!0}else if(n===M.un){if(r===l-1&&o===a&&(this.flags[c]&It.Lm)===It.OPEN)return!0;if(r===l&&o===a+1&&(this.flags[c]&It.Rm)===It.OPEN)return!0;if(r===l+1&&o===a)return!0;if(r===l&&o===a-1)return!0}else if(n===M.dn){if(r===l-1&&o===a)return!0;if(r===l&&o===a+1&&(this.flags[c]&It.Rm)===It.OPEN)return!0;if(r===l+1&&o===a&&(this.flags[c]&It.Mm)===It.OPEN)return!0;if(r===l&&o===a-1)return!0}}else if(e===S.ze.id){if(r===l&&o===a+1&&(this.flags[c]&It.om)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.sm)===It.OPEN)return!0;if(r===l-1&&o===a&&(this.flags[c]&It.nm)===It.OPEN)return!0;if(r===l+1&&o===a&&(this.flags[c]&It.am)===It.OPEN)return!0}return!1};Km=(t,i,s,h,e,n)=>{if(t===s&&i===h)return!0;const r=t-this.offsetX,o=i-this.Fm,l=s-this.offsetX,a=h-this.Fm,c=gt.index(r,o);if(e===S.Ke.id||e===S.Xe.id){if(e===S.Xe.id&&(n=n+2&3),n===M.cn){if(r===l+1&&o===a&&(this.flags[c]&It.am)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.sm)===It.OPEN)return!0}else if(n===M.fn){if(r===l-1&&o===a&&(this.flags[c]&It.nm)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.sm)===It.OPEN)return!0}else if(n===M.un){if(r===l-1&&o===a&&(this.flags[c]&It.nm)===It.OPEN)return!0;if(r===l&&o===a+1&&(this.flags[c]&It.om)===It.OPEN)return!0}else if(n===M.dn){if(r===l+1&&o===a&&(this.flags[c]&It.am)===It.OPEN)return!0;if(r===l&&o===a+1&&(this.flags[c]&It.om)===It.OPEN)return!0}}else if(e===S.je.id){if(r===l&&o===a+1&&(this.flags[c]&It.om)===It.OPEN)return!0;if(r===l&&o===a-1&&(this.flags[c]&It.sm)===It.OPEN)return!0;if(r===l-1&&o===a&&(this.flags[c]&It.nm)===It.OPEN)return!0;if(r===l+1&&o===a&&(this.flags[c]&It.am)===It.OPEN)return!0}return!1};Xm=(t,i,s,h,e,n,r)=>{const o=s+e-1,l=h+n-1,a=gt.index(t-this.offsetX,i-this.Fm);return t>=s&&t<=o&&i>=h&&i<=l||(t===s-1&&i>=h&&i<=l&&(this.flags[a]&It.nm)===It.OPEN&&(r&Et.cn)===It.OPEN||(t===o+1&&i>=h&&i<=l&&(this.flags[a]&It.am)===It.OPEN&&(r&Et.un)===It.OPEN||(i===h-1&&t>=s&&t<=o&&(this.flags[a]&It.sm)===It.OPEN&&(r&Et.dn)===It.OPEN||i===l+1&&t>=s&&t<=o&&(this.flags[a]&It.om)===It.OPEN&&(r&Et.fn)===It.OPEN)))};add=(t,i,s)=>{this.flags[gt.index(t,i)]|=s};remove=(t,i,s)=>{this.flags[gt.index(t,i)]&=It.Dm-s}}class _t{y;x;z;model;Op;info;constructor(t,i,s,h,e,n){this.y=t,this.x=i,this.z=s,this.model=h,this.Op=e,this.info=n}}class Ct{y;x;z;jm;zm;Zm;qm;Op;info;constructor(t,i,s,h,e,n,r,o,l){this.y=t,this.x=i,this.z=s,this.jm=h,this.zm=e,this.Zm=n,this.qm=r,this.Op=o,this.info=l}}class Tt{y;x;z;type;angle;model;Op;info;constructor(t,i,s,h,e,n,r,o){this.y=t,this.x=i,this.z=s,this.type=h,this.angle=e,this.model=n,this.Op=r,this.info=o}}class Ot{y;x;z;$m;Jm;Qm;Op;offset;constructor(t,i,s,h,e,n,r,o){this.y=t,this.x=i,this.z=s,this.$m=h,this.Jm=e,this.Qm=n,this.Op=r,this.offset=o}}class bt{tI;iI;sI;hI;eI;color;flat;constructor(t,i,s,h,e,n,r){this.tI=t,this.iI=i,this.sI=s,this.hI=h,this.eI=e,this.color=n,this.flat=r}}class Lt{static nI=new Int32Array(6);static rI=new Int32Array(6);static oI=new Int32Array(6);static lI=new Int32Array(6);static aI=new Int32Array(6);static cI=[Int8Array.of(1,3,5,7),Int8Array.of(1,3,5,7),Int8Array.of(1,3,5,7),Int8Array.of(1,3,5,7,6),Int8Array.of(1,3,5,7,6),Int8Array.of(1,3,5,7,6),Int8Array.of(1,3,5,7,6),Int8Array.of(1,3,5,7,2,6),Int8Array.of(1,3,5,7,2,8),Int8Array.of(1,3,5,7,2,8),Int8Array.of(1,3,5,7,11,12),Int8Array.of(1,3,5,7,11,12),Int8Array.of(1,3,5,7,13,14)];static fI=[Int8Array.of(0,1,2,3,0,0,1,3),Int8Array.of(1,1,2,3,1,0,1,3),Int8Array.of(0,1,2,3,1,0,1,3),Int8Array.of(0,0,1,2,0,0,2,4,1,0,4,3),Int8Array.of(0,0,1,4,0,0,4,3,1,1,2,4),Int8Array.of(0,0,4,3,1,0,1,2,1,0,2,4),Int8Array.of(0,1,2,4,1,0,1,4,1,0,4,3),Int8Array.of(0,4,1,2,0,4,2,5,1,0,4,5,1,0,5,3),Int8Array.of(0,4,1,2,0,4,2,3,0,4,3,5,1,0,4,5),Int8Array.of(0,0,4,5,1,4,1,2,1,4,2,3,1,4,3,5),Int8Array.of(0,0,1,5,0,1,4,5,0,1,2,4,1,0,5,3,1,5,4,3,1,4,2,3),Int8Array.of(1,0,1,5,1,1,4,5,1,1,2,4,0,0,5,3,0,5,4,3,0,4,2,3),Int8Array.of(1,0,5,4,1,0,1,5,0,0,4,3,0,4,5,3,0,5,2,3,0,1,2,5)];static uI=128;static dI=this.uI/2|0;static wI=this.uI/4|0;static yI=3*this.uI/4|0;Fh;Sh;Uh;AI;pI;mI;II;EI;gI;_I;flat;shape;angle;CI;TI;constructor(t,i,s,h,e,n,r,o,l,a,c,f,u,d,w,y,A,p,m){this.flat=!(A!==h||A!==d||A!==o),this.shape=i,this.angle=n,this.CI=u,this.TI=l;const I=Lt.cI[i],E=I.length;this.Fh=new Int32Array(E),this.Sh=new Int32Array(E),this.Uh=new Int32Array(E);const g=new Int32Array(E),_=new Int32Array(E),C=t*Lt.uI,T=p*Lt.uI;for(let t=0;t<E;t++){let i,l,c,u,p,E=I[t];!(1&E)&&E<=8&&(E=1+(E-n-n-1&7)),E>8&&E<=12&&(E=9+(E-n-9&3)),E>12&&E<=16&&(E=13+(E-n-13&3)),1===E?(i=C,l=T,c=A,u=r,p=a):2===E?(i=C+Lt.dI,l=T,c=A+h>>1,u=r+m>>1,p=a+s>>1):3===E?(i=C+Lt.uI,l=T,c=h,u=m,p=s):4===E?(i=C+Lt.uI,l=T+Lt.dI,c=h+d>>1,u=m+e>>1,p=s+w>>1):5===E?(i=C+Lt.uI,l=T+Lt.uI,c=d,u=e,p=w):6===E?(i=C+Lt.dI,l=T+Lt.uI,c=d+o>>1,u=e+y>>1,p=w+f>>1):7===E?(i=C,l=T+Lt.uI,c=o,u=y,p=f):8===E?(i=C,l=T+Lt.dI,c=o+A>>1,u=y+r>>1,p=f+a>>1):9===E?(i=C+Lt.dI,l=T+Lt.wI,c=A+h>>1,u=r+m>>1,p=a+s>>1):10===E?(i=C+Lt.yI,l=T+Lt.dI,c=h+d>>1,u=m+e>>1,p=s+w>>1):11===E?(i=C+Lt.dI,l=T+Lt.yI,c=d+o>>1,u=e+y>>1,p=w+f>>1):12===E?(i=C+Lt.wI,l=T+Lt.dI,c=o+A>>1,u=y+r>>1,p=f+a>>1):13===E?(i=C+Lt.wI,l=T+Lt.wI,c=A,u=r,p=a):14===E?(i=C+Lt.yI,l=T+Lt.wI,c=h,u=m,p=s):15===E?(i=C+Lt.yI,l=T+Lt.yI,c=d,u=e,p=w):(i=C+Lt.wI,l=T+Lt.yI,c=o,u=y,p=f),this.Fh[t]=i,this.Sh[t]=c,this.Uh[t]=l,g[t]=u,_[t]=p}const O=Lt.fI[i],b=O.length/4|0;this.II=new Int32Array(b),this.EI=new Int32Array(b),this.gI=new Int32Array(b),this.AI=new Int32Array(b),this.pI=new Int32Array(b),this.mI=new Int32Array(b),this._I=-1!==c?new Int32Array(b):null;let L=0;for(let t=0;t<b;t++){const i=O[L];let s=O[L+1],h=O[L+2],e=O[L+3];L+=4,s<4&&(s=s-n&3),h<4&&(h=h-n&3),e<4&&(e=e-n&3),this.II[t]=s,this.EI[t]=h,this.gI[t]=e,0===i?(this.AI[t]=g[s],this.pI[t]=g[h],this.mI[t]=g[e],this._I&&(this._I[t]=-1)):(this.AI[t]=_[s],this.pI[t]=_[h],this.mI[t]=_[e],this._I&&(this._I[t]=c))}}}class vt{static OI=0;static bI=1;static LI=2;static vI=3;static RI=4;static SI=5;static dI=6;static wI=7;static yI=8;static MI=9;static xI=10;static kI=11}class Rt{static DI=new d(8,32,51,51,!1);static NI=new c(100,null);static FI=new Int32Array(gt.Nm);static UI=new f(gt.Nm,500,null);static BI=new c(500,null);static GI=new o;static Ji=0;static HI=0;static WI=0;static YI=0;static VI=0;static KI=0;static XI=0;static jI=0;static zI=0;static ZI=0;static qI=0;static $I=0;static JI=0;static QI=0;static tE=0;static iE=0;static sE=0;static hE=0;static eE=0;static nE=0;static rE=0;static oE=0;static lE=!1;static aE=null;static cE=Uint8Array.of(19,55,38,155,255,110,137,205,76);static fE=Uint8Array.of(160,192,80,96,0,144,80,48,160);static uE=Uint8Array.of(76,8,137,4,0,1,38,2,19);static dE=Int8Array.of(0,0,2,0,0,2,1,1,0);static wE=Int8Array.of(2,0,0,2,0,0,0,4,4);static yE=Int8Array.of(0,4,4,8,0,0,8,0,0);static AE=Int8Array.of(1,1,0,0,0,8,0,0,8);static pE=Int8Array.of(53,-53,-53,53);static mE=Int8Array.of(-53,-53,53,53);static IE=Int8Array.of(-45,45,45,-45);static EE=Int8Array.of(45,45,-45,-45);static gE=[new Int8Array(16),Int8Array.of(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),Int8Array.of(1,0,0,0,1,1,0,0,1,1,1,0,1,1,1,1),Int8Array.of(1,1,0,0,1,1,0,0,1,0,0,0,1,0,0,0),Int8Array.of(0,0,1,1,0,0,1,1,0,0,0,1,0,0,0,1),Int8Array.of(0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1),Int8Array.of(1,1,1,0,1,1,1,0,1,1,1,1,1,1,1,1),Int8Array.of(1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0),Int8Array.of(0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0),Int8Array.of(1,1,1,1,1,1,1,1,0,1,1,1,0,0,1,1),Int8Array.of(1,1,1,1,1,1,0,0,1,0,0,0,1,0,0,0),Int8Array.of(0,0,0,0,0,0,1,1,0,1,1,1,0,1,1,1),Int8Array.of(0,0,0,0,0,0,0,0,0,1,1,0,1,1,1,1)];static _E=[Int8Array.of(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15),Int8Array.of(12,8,4,0,13,9,5,1,14,10,6,2,15,11,7,3),Int8Array.of(15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0),Int8Array.of(3,7,11,15,2,6,10,14,1,5,9,13,0,4,8,12)];static CE=Int32Array.of(41,39248,41,4643,41,41,41,41,41,41,41,41,41,41,41,43086,41,41,41,41,41,41,41,8602,41,28992,41,41,41,41,41,5056,41,41,41,41,41,41,41,41,41,41,41,41,41,41,3131,41,41,41);static TE=0;static gh=0;static _h=0;static OE=-1;static bE=-1;static Bi=!0;static init=(t,i,s,h,e)=>{this.HI=0,this.WI=0,this.YI=t,this.VI=i,this.KI=t/2|0,this.XI=i/2|0;const n=new d(9,32,53,53,!1);for(let t=128;t<=384;t+=32)for(let i=0;i<2048;i+=64){this.jI=O.sin[t],this.zI=O.cos[t],this.ZI=O.sin[i],this.qI=O.cos[i];const r=(t-128)/32|0,o=i/64|0;for(let t=-26;t<=26;t++)for(let i=-26;i<=26;i++){const l=128*t,a=128*i;let c=!1;for(let t=-s;t<=h;t+=128)if(this.LE(l,a,e[r]+t)){c=!0;break}n[r][o][t+25+1][i+25+1]=c}}for(let t=0;t<8;t++)for(let i=0;i<32;i++)for(let s=-25;s<25;s++)for(let h=-25;h<25;h++){let e=!1;t:for(let r=-1;r<=1;r++)for(let o=-1;o<=1;o++){if(n[t][i][s+r+25+1][h+o+25+1]){e=!0;break t}if(n[t][(i+1)%31][s+r+25+1][h+o+25+1]){e=!0;break t}if(n[t+1][i][s+r+25+1][h+o+25+1]){e=!0;break t}if(n[t+1][(i+1)%31][s+r+25+1][h+o+25+1]){e=!0;break t}}this.DI[t][i][s+25][h+25]=e}};static ns=()=>{this.NI=null,this.FI=null,this.UI=null,this.GI=null,this.DI=null,this.BI=null,this.aE=null,console.log('World3D unloaded!')};static vE=(t,i,s,h,e,n,r,o)=>{Rt.UI[t][Rt.FI[t]++]=new mt(s/128|0,n/128|0,e/128|0,o/128|0,i,s,n,e,o,h,r)};static LE=(t,i,s)=>{const h=i*this.ZI+t*this.qI>>16,e=i*this.qI-t*this.ZI>>16,n=s*this.jI+e*this.zI>>16,r=s*this.zI-e*this.jI>>16;if(n<50||n>3500)return!1;const o=this.KI+((h<<9)/n|0),l=this.XI+((r<<9)/n|0);return o>=this.HI&&o<=this.YI&&l>=this.WI&&l<=this.VI};RE;Xp;zp;SE;ME;xE;kE;DE;NE;PE=0;FE=0;UE=0;constructor(t,i,s,h){this.RE=s,this.Xp=h,this.zp=i,this.ME=new u(s,h,i,null),this.kE=new A(s,h+1,i+1),this.SE=t,this.xE=new c(5e3,null),this.DE=new Int32Array(1e4),this.NE=new Int32Array(1e4),this.reset()}reset=()=>{for(let t=0;t<this.RE;t++)for(let i=0;i<this.Xp;i++)for(let s=0;s<this.zp;s++)this.ME[t][i][s]=null;for(let t=0;t<gt.Nm;t++){for(let i=0;i<Rt.FI[t];i++)Rt.UI[t][i]=null;Rt.FI[t]=0}for(let t=0;t<this.PE;t++)this.xE[t]=null;this.PE=0,Rt.NI.fill(null)};BE=t=>{this.FE=t;for(let i=0;i<this.Xp;i++)for(let s=0;s<this.zp;s++)this.ME[t][i][s]=new pt(t,i,s)};GE=(t,i)=>{const s=this.ME[0][t][i];for(let s=0;s<3;s++){this.ME[s][t][i]=this.ME[s+1][t][i];const h=this.ME[s][t][i];h&&h.level--}this.ME[0][t][i]||(this.ME[0][t][i]=new pt(0,t,i));const h=this.ME[0][t][i];h&&(h.Pp=s),this.ME[3][t][i]=null};HE=(t,i,s,h)=>{const e=this.ME[t][i][s];e&&(e.Bp=h)};WE=(t,i,s,h,e,n,r,o,l,a,c,f,u,d,w,y,A,p,m,I)=>{if(h===vt.OI){for(let h=t;h>=0;h--)this.ME[h][i][s]||(this.ME[h][i][s]=new pt(h,i,s));const h=this.ME[t][i][s];h&&(h.Sp=new bt(c,f,u,d,-1,m,!1))}else if(h===vt.bI){for(let h=t;h>=0;h--)this.ME[h][i][s]||(this.ME[h][i][s]=new pt(h,i,s));const h=this.ME[t][i][s];h&&(h.Sp=new bt(w,y,A,p,n,I,r===o&&r===l&&r===a))}else{for(let h=t;h>=0;h--)this.ME[h][i][s]||(this.ME[h][i][s]=new pt(h,i,s));const E=this.ME[t][i][s];E&&(E.Mp=new Lt(i,h,y,o,u,e,c,a,I,w,n,p,m,l,A,d,r,s,f))}};YE=(t,i,s,h,e,n,r)=>{this.ME[i][s][h]||(this.ME[i][s][h]=new pt(i,s,h));const o=this.ME[i][s][h];o&&(o.Dp=new _t(e,128*s+64,128*h+64,t,n,r))};VE=(t,i,s)=>{const h=this.ME[t][i][s];h&&(h.Dp=null)};KE=(t,i,s,h,e,n,r,o)=>{let l=0;const a=this.ME[h][t][i];if(a)for(let t=0;t<a.Fp;t++){const i=a.vp[t];if(!i||!i.model)continue;const s=i.model.de;s>l&&(l=s)}else this.ME[h][t][i]=new pt(h,t,i);const c=this.ME[h][t][i];c&&(c.Np=new Ot(s,128*t+64,128*i+64,n,r,o,e,l))};XE=(t,i,s)=>{const h=this.ME[t][i][s];h&&(h.Np=null)};Wm=(t,i,s,h,e,n,r,o,l,a)=>{if(!r&&!o)return;for(let h=t;h>=0;h--)this.ME[h][i][s]||(this.ME[h][i][s]=new pt(h,i,s));const c=this.ME[t][i][s];c&&(c.xp=new Ct(h,128*i+64,128*s+64,e,n,r,o,l,a))};Ym=(t,i,s,h)=>{const e=this.ME[t][i][s];1===h&&e&&(e.xp=null)};jE=(t,i,s,h,e,n,r,o,l,a,c)=>{if(!o)return;for(let h=t;h>=0;h--)this.ME[h][i][s]||(this.ME[h][i][s]=new pt(h,i,s));const f=this.ME[t][i][s];f&&(f.kp=new Tt(h,128*i+e+64,128*s+n+64,c,a,o,r,l))};zE=(t,i,s)=>{const h=this.ME[t][i][s];h&&(h.kp=null)};ZE=(t,i,s,h)=>{const e=this.ME[t][i][s];if(!e)return;const n=e.kp;if(!n)return;const r=128*i+64,o=128*s+64;n.x=r+((n.x-r)*h/16|0),n.z=o+((n.z-o)*h/16|0)};qE=(t,i,s,h)=>{if(!h)return;const e=this.ME[t][i][s];if(!e)return;const n=e.kp;n&&(n.model=h)};$E=(t,i,s,h)=>{if(!h)return;const e=this.ME[t][i][s];if(!e)return;const n=e.Dp;n&&(n.model=h)};JE=(t,i,s,h)=>{if(!h)return;const e=this.ME[t][i][s];if(!e)return;const n=e.xp;n&&(n.Zm=h)};QE=(t,i,s,h,e)=>{if(!h)return;const n=this.ME[s][t][i];if(!n)return;const r=n.xp;r&&(r.Zm=h,r.qm=e)};Gm=(t,i,s,h,e,n,r,o,l,a,c)=>{if(!e&&!n)return!0;const f=128*i+64*l,u=128*s+64*a;return this.tg(f,u,h,t,i,s,l,a,e,n,r,o,c,!1)};ig=(t,i,s,h,e,n,r,o,l,a)=>{if(!e&&!n)return!0;let c=i-l,f=h-l,u=i+l,d=h+l;return a&&(o>640&&o<1408&&(d+=128),o>1152&&o<1920&&(u+=128),(o>1664||o<384)&&(f-=128),o>128&&o<896&&(c-=128)),c=c/128|0,f=f/128|0,u=u/128|0,d=d/128|0,this.tg(i,h,s,t,c,f,u+1-c,d-f+1,e,n,r,0,o,!0)};sg=(t,i,s,h,e,n,r,o,l,a,c,f)=>!l&&!a||this.tg(i,h,s,t,e,n,r+1-e,o-n+1,l,a,c,0,f,!0);Hm=(t,i,s)=>{const h=this.ME[t][i][s];if(h)for(let t=0;t<h.Fp;t++){const e=h.vp[t];if(e&&2==(e.Op>>29&3)&&e.gp===i&&e.Cp===s)return void this.hg(e)}};eg=(t,i,s,h)=>{if(!h)return;const e=this.ME[t][i][s];if(e)for(let t=0;t<e.Fp;t++){const i=e.vp[t];if(i&&2==(i.Op>>29&3))return void(i.model=h)}};ng=()=>{for(let t=0;t<this.PE;t++){const i=this.xE[t];i&&this.hg(i),this.xE[t]=null}this.PE=0};rg=(t,i,s)=>{const h=this.ME[t][i][s];return h&&h.xp?h.xp.Op:0};og=(t,i,s)=>{const h=this.ME[t][s][i];return h&&h.kp?h.kp.Op:0};lg=(t,i,s)=>{const h=this.ME[t][i][s];if(!h)return 0;for(let t=0;t<h.Fp;t++){const e=h.vp[t];if(e&&2==(e.Op>>29&3)&&e.gp===i&&e.Cp===s)return e.Op}return 0};ag=(t,i,s)=>{const h=this.ME[t][i][s];return h&&h.Dp?h.Dp.Op:0};cg=(t,i,s,h)=>{const e=this.ME[t][i][s];if(e){if(e.xp&&e.xp.Op===h)return 255&e.xp.info;if(e.kp&&e.kp.Op===h)return 255&e.kp.info;if(e.Dp&&e.Dp.Op===h)return 255&e.Dp.info;for(let t=0;t<e.Fp;t++){const i=e.vp[t];if(i&&i.Op===h)return 255&i.info}return-1}return-1};fg=(t,i,s,h,e)=>{const n=i*(0|Math.sqrt(s*s+h*h+e*e))>>8;for(let i=0;i<this.RE;i++)for(let r=0;r<this.Xp;r++)for(let o=0;o<this.zp;o++){const l=this.ME[i][r][o];if(!l)continue;const a=l.xp;a&&a.Zm&&a.Zm.Nh&&(this.ug(i,r,o,1,1,a.Zm),a.qm&&a.qm.Nh&&(this.ug(i,r,o,1,1,a.qm),this.dg(a.Zm,a.qm,0,0,0,!1),a.qm.Le(t,n,s,h,e)),a.Zm.Le(t,n,s,h,e));for(let a=0;a<l.Fp;a++){const c=l.vp[a];c&&c.model&&c.model.Nh&&(this.ug(i,r,o,c._p+1-c.gp,c.Tp-c.Cp+1,c.model),c.model.Le(t,n,s,h,e))}const c=l.Dp;c&&c.model&&c.model.Nh&&(this.wg(i,r,o,c.model),c.model.Le(t,n,s,h,e))}};wg=(t,i,s,h)=>{if(i<this.Xp){const e=this.ME[t][i+1][s];e&&e.Dp&&e.Dp.model&&e.Dp.model.Nh&&this.dg(h,e.Dp.model,128,0,0,!0)}if(s<this.Xp){const e=this.ME[t][i][s+1];e&&e.Dp&&e.Dp.model&&e.Dp.model.Nh&&this.dg(h,e.Dp.model,0,0,128,!0)}if(i<this.Xp&&s<this.zp){const e=this.ME[t][i+1][s+1];e&&e.Dp&&e.Dp.model&&e.Dp.model.Nh&&this.dg(h,e.Dp.model,128,0,128,!0)}if(i<this.Xp&&s>0){const e=this.ME[t][i+1][s-1];e&&e.Dp&&e.Dp.model&&e.Dp.model.Nh&&this.dg(h,e.Dp.model,128,0,-128,!0)}};ug=(t,i,s,h,e,n)=>{let r=!0,o=i;const l=i+h,a=s-1,c=s+e;for(let f=t;f<=t+1;f++)if(f!==this.RE){for(let u=o;u<=l;u++)if(!(u<0||u>=this.Xp))for(let o=a;o<=c;o++){if(o<0||o>=this.zp||r&&u<l&&o<c&&(o>=s||u===i))continue;const a=this.ME[f][u][o];if(!a)continue;const d=128*(u-i)+64*(1-h),w=128*(o-s)+64*(1-e),y=((this.SE[f][u][o]+this.SE[f][u+1][o]+this.SE[f][u][o+1]+this.SE[f][u+1][o+1])/4|0)-((this.SE[t][i][s]+this.SE[t][i+1][s]+this.SE[t][i][s+1]+this.SE[t][i+1][s+1])/4|0),A=a.xp;A&&A.Zm&&A.Zm.Nh&&this.dg(n,A.Zm,d,y,w,r),A&&A.qm&&A.qm.Nh&&this.dg(n,A.qm,d,y,w,r);for(let t=0;t<a.Fp;t++){const o=a.vp[t];if(!o||!o.model||!o.model.Nh)continue;const l=o._p+1-o.gp,c=o.Tp+1-o.Cp;this.dg(n,o.model,128*(o.gp-i)+64*(l-h),y,128*(o.Cp-s)+64*(c-e),r)}}o--,r=!1}};dg=(t,i,s,h,e,n)=>{this.UE++;let r=0;const o=i.Fh,l=i.Ts;if(t.Nh&&t.Ph)for(let n=0;n<t.Ts;n++){const a=t.Nh[n],c=t.Ph[n];if(c&&0!==c.w){const f=t.Sh[n]-h;if(f>i.Qh)continue;const u=t.Fh[n]-s;if(u<i.zh||u>i.Zh)continue;const d=t.Uh[n]-e;if(d<i.qh||d>i.$h)continue;if(i.Nh&&i.Ph)for(let t=0;t<l;t++){const s=i.Nh[t],h=i.Ph[t];u!==o[t]||d!==i.Uh[t]||f!==i.Sh[t]||h&&0===h.w||(a&&s&&h&&(a.x+=h.x,a.y+=h.y,a.z+=h.z,a.w+=h.w,s.x+=c.x,s.y+=c.y,s.z+=c.z,s.w+=c.w,r++),this.DE[n]=this.UE,this.NE[t]=this.UE)}}}if(!(r<3)&&n){if(t.Dh)for(let i=0;i<t.Os;i++)this.DE[t.Bh[i]]===this.UE&&this.DE[t.Gh[i]]===this.UE&&this.DE[t.Hh[i]]===this.UE&&(t.Dh[i]=-1);if(i.Dh)for(let t=0;t<i.Os;t++)this.NE[i.Bh[t]]===this.UE&&this.NE[i.Gh[t]]===this.UE&&this.NE[i.Hh[t]]===this.UE&&(i.Dh[t]=-1)}};yg=(t,i,s,h,e,n)=>{const r=this.ME[t][i][s];if(!r)return;const o=r.Sp;if(o){const t=o.color;if(0!==t)for(let i=0;i<4;i++)h[e]=t,h[e+1]=t,h[e+2]=t,h[e+3]=t,e+=n;return}const l=r.Mp;if(!l)return;const a=l.shape,c=l.angle,f=l.CI,u=l.TI,d=Rt.gE[a],w=Rt._E[c];let y=0;if(0===f)for(let t=0;t<4;t++)0!==d[w[y++]]&&(h[e]=u),0!==d[w[y++]]&&(h[e+1]=u),0!==d[w[y++]]&&(h[e+2]=u),0!==d[w[y++]]&&(h[e+3]=u),e+=n;else for(let t=0;t<4;t++)h[e]=0===d[w[y++]]?f:u,h[e+1]=0===d[w[y++]]?f:u,h[e+2]=0===d[w[y++]]?f:u,h[e+3]=0===d[w[y++]]?f:u,e+=n};click=(t,i)=>{Rt.lE=!0,Rt.gh=t,Rt._h=i,Rt.OE=-1,Rt.bE=-1};draw=(t,i,s,h,e,n,r)=>{t<0?t=0:t>=128*this.Xp&&(t=128*this.Xp-1),s<0?s=0:s>=128*this.zp&&(s=128*this.zp-1),Rt.Ji++,Rt.jI=O.sin[n],Rt.zI=O.cos[n],Rt.ZI=O.sin[e],Rt.qI=O.cos[e],Rt.aE=Rt.DI[(n-128)/32|0][e/64|0],Rt.$I=t,Rt.JI=i,Rt.QI=s,Rt.tE=t/128|0,Rt.iE=s/128|0,Rt.rE=h,Rt.sE=Rt.tE-25,Rt.sE<0&&(Rt.sE=0),Rt.eE=Rt.iE-25,Rt.eE<0&&(Rt.eE=0),Rt.hE=Rt.tE+25,Rt.hE>this.Xp&&(Rt.hE=this.Xp),Rt.nE=Rt.iE+25,Rt.nE>this.zp&&(Rt.nE=this.zp),this.Ag(),Rt.oE=0;for(let t=this.FE;t<this.RE;t++){const s=this.ME[t];for(let e=Rt.sE;e<Rt.hE;e++)for(let n=Rt.eE;n<Rt.nE;n++){const r=s[e][n];r&&(r.Bp<=h&&(Rt.aE[e+25-Rt.tE][n+25-Rt.iE]||this.SE[t][e][n]-i>=2e3)?(r.visible=!0,r.update=!0,r.Gp=r.Fp>0,Rt.oE++):(r.visible=!1,r.update=!1,r.Hp=0))}}for(let t=this.FE;t<this.RE;t++){const i=this.ME[t];for(let t=-25;t<=0;t++){const s=Rt.tE+t,h=Rt.tE-t;if(!(s<Rt.sE&&h>=Rt.hE))for(let t=-25;t<=0;t++){const e=Rt.iE+t,n=Rt.iE-t;let o;if(s>=Rt.sE&&(e>=Rt.eE&&(o=i[s][e],o&&o.visible&&this.pg(o,!0,r)),n<Rt.nE&&(o=i[s][n],o&&o.visible&&this.pg(o,!0,r))),h<Rt.hE&&(e>=Rt.eE&&(o=i[h][e],o&&o.visible&&this.pg(o,!0,r)),n<Rt.nE&&(o=i[h][n],o&&o.visible&&this.pg(o,!0,r))),0===Rt.oE)return void(Rt.lE=!1)}}}for(let t=this.FE;t<this.RE;t++){const i=this.ME[t];for(let t=-25;t<=0;t++){const s=Rt.tE+t,h=Rt.tE-t;if(!(s<Rt.sE&&h>=Rt.hE))for(let t=-25;t<=0;t++){const e=Rt.iE+t,n=Rt.iE-t;let o;if(s>=Rt.sE&&(e>=Rt.eE&&(o=i[s][e],o&&o.visible&&this.pg(o,!1,r)),n<Rt.nE&&(o=i[s][n],o&&o.visible&&this.pg(o,!1,r))),h<Rt.hE&&(e>=Rt.eE&&(o=i[h][e],o&&o.visible&&this.pg(o,!1,r)),n<Rt.nE&&(o=i[h][n],o&&o.visible&&this.pg(o,!1,r))),0===Rt.oE)return void(Rt.lE=!1)}}}};tg=(t,i,s,h,e,n,r,o,l,a,c,f,u,d)=>{if(!l&&!a)return!1;for(let t=e;t<e+r;t++)for(let i=n;i<n+o;i++){if(t<0||i<0||t>=this.Xp||i>=this.zp)return!1;const s=this.ME[h][t][i];if(s&&s.Fp>=5)return!1}const w=new At(h,s,t,i,l,a,u,e,e+r-1,n,n+o-1,c,f);for(let t=e;t<e+r;t++)for(let i=n;i<n+o;i++){let s=0;t>e&&(s|=1),t<e+r-1&&(s+=4),i>n&&(s+=8),i<n+o-1&&(s+=2);for(let s=h;s>=0;s--)this.ME[s][t][i]||(this.ME[s][t][i]=new pt(s,t,i));const l=this.ME[h][t][i];l&&(l.vp[l.Fp]=w,l.Rp[l.Fp]=s,l.Up|=s,l.Fp++)}return d&&(this.xE[this.PE++]=w),!0};hg=t=>{for(let i=t.gp;i<=t._p;i++)for(let s=t.Cp;s<=t.Tp;s++){const h=this.ME[t.level][i][s];if(h){for(let i=0;i<h.Fp;i++)if(h.vp[i]===t){h.Fp--;for(let t=i;t<h.Fp;t++)h.vp[t]=h.vp[t+1],h.Rp[t]=h.Rp[t+1];h.vp[h.Fp]=null;break}h.Up=0;for(let t=0;t<h.Fp;t++)h.Up|=h.Rp[t]}}};Ag=()=>{const t=Rt.FI[Rt.rE],i=Rt.UI[Rt.rE];Rt.TE=0;for(let s=0;s<t;s++){const t=i[s];if(!t)continue;let h,e,n,r;if(1===t.type){if(h=t.Kp+25-Rt.tE,h>=0&&h<=50){e=t.jp+25-Rt.iE,e<0&&(e=0),n=t.zp+25-Rt.iE,n>50&&(n=50);let i=!1;for(;e<=n;)if(Rt.aE&&Rt.aE[h][e++]){i=!0;break}if(i){if(r=Rt.$I-t.zh,r>32)t.mode=1;else{if(r>=-32)continue;t.mode=2,r=-r}t.$p=(t.qh-Rt.QI<<8)/r|0,t.Jp=(t.$h-Rt.QI<<8)/r|0,t.Qp=(t.Qh-Rt.JI<<8)/r|0,t.tm=(t.te-Rt.JI<<8)/r|0,Rt.BI[Rt.TE++]=t}}}else if(2===t.type){if(h=t.jp+25-Rt.iE,h>=0&&h<=50){e=t.Kp+25-Rt.tE,e<0&&(e=0),n=t.Xp+25-Rt.tE,n>50&&(n=50);let i=!1;for(;e<=n;)if(Rt.aE&&Rt.aE[e++][h]){i=!0;break}if(i){if(r=Rt.QI-t.qh,r>32)t.mode=3;else{if(r>=-32)continue;t.mode=4,r=-r}t.Zp=(t.zh-Rt.$I<<8)/r|0,t.qp=(t.Zh-Rt.$I<<8)/r|0,t.Qp=(t.Qh-Rt.JI<<8)/r|0,t.tm=(t.te-Rt.JI<<8)/r|0,Rt.BI[Rt.TE++]=t}}}else if(4===t.type&&(h=t.Qh-Rt.JI,h>128&&(e=t.jp+25-Rt.iE,e<0&&(e=0),n=t.zp+25-Rt.iE,n>50&&(n=50),e<=n))){let i=t.Kp+25-Rt.tE;i<0&&(i=0),r=t.Xp+25-Rt.tE,r>50&&(r=50);let s=!1;t:for(let t=i;t<=r;t++)for(let i=e;i<=n;i++)if(Rt.aE&&Rt.aE[t][i]){s=!0;break t}s&&(t.mode=5,t.Zp=(t.zh-Rt.$I<<8)/h|0,t.qp=(t.Zh-Rt.$I<<8)/h|0,t.$p=(t.qh-Rt.QI<<8)/h|0,t.Jp=(t.$h-Rt.QI<<8)/h|0,Rt.BI[Rt.TE++]=t)}}};pg=(t,i,s)=>{for(Rt.GI.rt(t);;){let t;do{if(t=Rt.GI.lt(),!t)return}while(!t.update);const h=t.x,e=t.z,n=t.level,r=t.Lp,o=this.ME[n];if(t.visible){if(i){if(n>0){const t=this.ME[n-1][h][e];if(t&&t.update)continue}if(h<=Rt.tE&&h>Rt.sE){const i=o[h-1][e];if(i&&i.update&&(i.visible||!(1&t.Up)))continue}if(h>=Rt.tE&&h<Rt.hE-1){const i=o[h+1][e];if(i&&i.update&&(i.visible||!(4&t.Up)))continue}if(e<=Rt.iE&&e>Rt.eE){const i=o[h][e-1];if(i&&i.update&&(i.visible||!(8&t.Up)))continue}if(e>=Rt.iE&&e<Rt.nE-1){const i=o[h][e+1];if(i&&i.update&&(i.visible||!(2&t.Up)))continue}}else i=!0;if(t.visible=!1,t.Pp){const i=t.Pp;i.Sp?this.mg(0,h,e)||this.Ig(i.Sp,0,h,e,Rt.jI,Rt.zI,Rt.ZI,Rt.qI):i.Mp&&!this.mg(0,h,e)&&this.Eg(h,e,i.Mp,Rt.jI,Rt.zI,Rt.ZI,Rt.qI);const n=i.xp;n&&n.Zm?.draw(0,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,n.x-Rt.$I,n.y-Rt.JI,n.z-Rt.QI,n.Op);for(let t=0;t<i.Fp;t++){const h=i.vp[t];if(h){let t=h.model;t||(t=h.Ip?.draw(s)??null),t?.draw(h.Ep,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,h.x-Rt.$I,h.y-Rt.JI,h.z-Rt.QI,h.Op)}}}let l=!1;t.Sp?this.mg(r,h,e)||(l=!0,this.Ig(t.Sp,r,h,e,Rt.jI,Rt.zI,Rt.ZI,Rt.qI)):t.Mp&&!this.mg(r,h,e)&&(l=!0,this.Eg(h,e,t.Mp,Rt.jI,Rt.zI,Rt.ZI,Rt.qI));let a=0,c=0;const f=t.xp,u=t.kp;if((f||u)&&(Rt.tE===h?a+=1:Rt.tE<h&&(a+=2),Rt.iE===e?a+=3:Rt.iE>e&&(a+=6),c=Rt.cE[a],t.Vp=Rt.uE[a]),f&&(f.jm&Rt.fE[a]?16===f.jm?(t.Hp=3,t.Wp=Rt.dE[a],t.Yp=3-t.Wp):32===f.jm?(t.Hp=6,t.Wp=Rt.wE[a],t.Yp=6-t.Wp):64===f.jm?(t.Hp=12,t.Wp=Rt.yE[a],t.Yp=12-t.Wp):(t.Hp=9,t.Wp=Rt.AE[a],t.Yp=9-t.Wp):t.Hp=0,f.jm&c&&!this.gg(r,h,e,f.jm)&&f.Zm?.draw(0,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,f.x-Rt.$I,f.y-Rt.JI,f.z-Rt.QI,f.Op),f.zm&c&&!this.gg(r,h,e,f.zm)&&f.qm?.draw(0,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,f.x-Rt.$I,f.y-Rt.JI,f.z-Rt.QI,f.Op)),u&&!this.visible(r,h,e,u.model.te))if(u.type&c)u.model.draw(u.angle,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,u.x-Rt.$I,u.y-Rt.JI,u.z-Rt.QI,u.Op);else if(768&u.type){const t=u.x-Rt.$I,i=u.y-Rt.JI,s=u.z-Rt.QI,h=u.angle;let e,n;if(e=h===M.fn||h===M.un?-t:t,n=h===M.un||h===M.dn?-s:s,256&u.type&&n<e){const e=t+Rt.pE[h],n=s+Rt.mE[h];u.model.draw(512*h+256,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,e,i,n,u.Op)}if(512&u.type&&n>e){const e=t+Rt.IE[h],n=s+Rt.EE[h];u.model.draw(512*h+1280&2047,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,e,i,n,u.Op)}}if(l){const i=t.Dp;i&&i.model?.draw(0,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,i.x-Rt.$I,i.y-Rt.JI,i.z-Rt.QI,i.Op);const s=t.Np;s&&0===s.offset&&(s.Qm&&s.Qm.draw(0,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,s.x-Rt.$I,s.y-Rt.JI,s.z-Rt.QI,s.Op),s.Jm&&s.Jm.draw(0,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,s.x-Rt.$I,s.y-Rt.JI,s.z-Rt.QI,s.Op),s.$m&&s.$m.draw(0,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,s.x-Rt.$I,s.y-Rt.JI,s.z-Rt.QI,s.Op))}const d=t.Up;if(0!==d){if(h<Rt.tE&&4&d){const t=o[h+1][e];t&&t.update&&Rt.GI.rt(t)}if(e<Rt.iE&&2&d){const t=o[h][e+1];t&&t.update&&Rt.GI.rt(t)}if(h>Rt.tE&&1&d){const t=o[h-1][e];t&&t.update&&Rt.GI.rt(t)}if(e>Rt.iE&&8&d){const t=o[h][e-1];t&&t.update&&Rt.GI.rt(t)}}}if(0!==t.Hp){let i=!0;for(let s=0;s<t.Fp;s++){const h=t.vp[s];if(h&&(h.Ji!==Rt.Ji&&(t.Rp[s]&t.Hp)===t.Wp)){i=!1;break}}if(i){const i=t.xp;i&&!this.gg(r,h,e,i.jm)&&i.Zm?.draw(0,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,i.x-Rt.$I,i.y-Rt.JI,i.z-Rt.QI,i.Op),t.Hp=0}}if(t.Gp){const i=t.Fp;t.Gp=!1;let n=0;t:for(let s=0;s<i;s++){const i=t.vp[s];if(!i||i.Ji===Rt.Ji)continue;for(let s=i.gp;s<=i._p;s++)for(let h=i.Cp;h<=i.Tp;h++){const e=o[s][h];if(e){if(!e.visible){if(0===e.Hp)continue;let n=0;if(s>i.gp&&(n+=1),s<i._p&&(n+=4),h>i.Cp&&(n+=8),h<i.Tp&&(n+=2),(n&e.Hp)!==t.Yp)continue}t.Gp=!0;continue t}}Rt.NI[n++]=i;let h=Rt.tE-i.gp;const e=i._p-Rt.tE;e>h&&(h=e);const r=Rt.iE-i.Cp,l=i.Tp-Rt.iE;i.bp=l>r?h+l:h+r}for(;;){let t=-50,i=-1;for(let s=0;s<n;s++){const h=Rt.NI[s];h&&(h.Ji!==Rt.Ji&&h.bp>t&&(t=h.bp,i=s))}if(-1===i)break;const l=Rt.NI[i];if(l){l.Ji=Rt.Ji;let t=l.model;t||(t=l.Ip?.draw(s)??null),t&&!this._g(r,l.gp,l._p,l.Cp,l.Tp,t.te)&&t.draw(l.Ep,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,l.x-Rt.$I,l.y-Rt.JI,l.z-Rt.QI,l.Op);for(let t=l.gp;t<=l._p;t++)for(let i=l.Cp;i<=l.Tp;i++){const s=o[t][i];s&&(0!==s.Hp?Rt.GI.rt(s):t===h&&i===e||!s.update||Rt.GI.rt(s))}}}if(t.Gp)continue}if(!t.update||0!==t.Hp)continue;if(h<=Rt.tE&&h>Rt.sE){const t=o[h-1][e];if(t&&t.update)continue}if(h>=Rt.tE&&h<Rt.hE-1){const t=o[h+1][e];if(t&&t.update)continue}if(e<=Rt.iE&&e>Rt.eE){const t=o[h][e-1];if(t&&t.update)continue}if(e>=Rt.iE&&e<Rt.nE-1){const t=o[h][e+1];if(t&&t.update)continue}t.update=!1,Rt.oE--;const l=t.Np;if(l&&0!==l.offset&&(l.Qm&&l.Qm.draw(0,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,l.x-Rt.$I,l.y-Rt.JI-l.offset,l.z-Rt.QI,l.Op),l.Jm&&l.Jm.draw(0,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,l.x-Rt.$I,l.y-Rt.JI-l.offset,l.z-Rt.QI,l.Op),l.$m&&l.$m.draw(0,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,l.x-Rt.$I,l.y-Rt.JI-l.offset,l.z-Rt.QI,l.Op)),0!==t.Vp){const i=t.kp;if(i&&!this.visible(r,h,e,i.model.te))if(i.type&t.Vp)i.model.draw(i.angle,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,i.x-Rt.$I,i.y-Rt.JI,i.z-Rt.QI,i.Op);else if(768&i.type){const t=i.x-Rt.$I,s=i.y-Rt.JI,h=i.z-Rt.QI,e=i.angle;let n,r;if(n=e===M.fn||e===M.un?-t:t,r=e===M.un||e===M.dn?-h:h,256&i.type&&r>=n){const n=t+Rt.pE[e],r=h+Rt.mE[e];i.model.draw(512*e+256,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,n,s,r,i.Op)}if(512&i.type&&r<=n){const n=t+Rt.IE[e],r=h+Rt.EE[e];i.model.draw(512*e+1280&2047,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,n,s,r,i.Op)}}const s=t.xp;s&&(s.zm&t.Vp&&!this.gg(r,h,e,s.zm)&&s.qm?.draw(0,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,s.x-Rt.$I,s.y-Rt.JI,s.z-Rt.QI,s.Op),s.jm&t.Vp&&!this.gg(r,h,e,s.jm)&&s.Zm?.draw(0,Rt.jI,Rt.zI,Rt.ZI,Rt.qI,s.x-Rt.$I,s.y-Rt.JI,s.z-Rt.QI,s.Op))}if(n<this.RE-1){const t=this.ME[n+1][h][e];t&&t.update&&Rt.GI.rt(t)}if(h<Rt.tE){const t=o[h+1][e];t&&t.update&&Rt.GI.rt(t)}if(e<Rt.iE){const t=o[h][e+1];t&&t.update&&Rt.GI.rt(t)}if(h>Rt.tE){const t=o[h-1][e];t&&t.update&&Rt.GI.rt(t)}if(e>Rt.iE){const t=o[h][e-1];t&&t.update&&Rt.GI.rt(t)}}};Ig=(t,i,s,h,e,n,r,o)=>{let l,a,c,f,u=l=(s<<7)-Rt.$I,d=a=(h<<7)-Rt.QI,w=c=u+128,y=f=d+128,A=this.SE[i][s][h]-Rt.JI,p=this.SE[i][s+1][h]-Rt.JI,m=this.SE[i][s+1][h+1]-Rt.JI,I=this.SE[i][s][h+1]-Rt.JI,E=d*r+u*o>>16;if(d=d*o-u*r>>16,u=E,E=A*n-d*e>>16,d=A*e+d*n>>16,A=E,d<50)return;if(E=a*r+w*o>>16,a=a*o-w*r>>16,w=E,E=p*n-a*e>>16,a=p*e+a*n>>16,p=E,a<50)return;if(E=y*r+c*o>>16,y=y*o-c*r>>16,c=E,E=m*n-y*e>>16,y=m*e+y*n>>16,m=E,y<50)return;if(E=f*r+l*o>>16,f=f*o-l*r>>16,l=E,E=I*n-f*e>>16,f=I*e+f*n>>16,I=E,f<50)return;const g=O.Ki+((u<<9)/d|0),_=O.Xi+((A<<9)/d|0),T=O.Ki+((w<<9)/a|0),b=O.Xi+((p<<9)/a|0),L=O.Ki+((c<<9)/y|0),v=O.Xi+((m<<9)/y|0),R=O.Ki+((l<<9)/f|0),S=O.Xi+((I<<9)/f|0);if(O.alpha=0,(L-R)*(b-S)-(v-S)*(T-R)>0)if(O.zi=L<0||R<0||T<0||L>C.Ai||R>C.Ai||T>C.Ai,Rt.lE&&this.Cg(Rt.gh,Rt._h,v,S,b,L,R,T)&&(Rt.OE=s,Rt.bE=h),-1===t.eI)12345678!==t.sI&&O.As(L,R,T,v,S,b,t.sI,t.hI,t.iI);else if(Rt.Bi){const i=Rt.CE[t.eI];O.As(L,R,T,v,S,b,this.Tg(i,t.sI),this.Tg(i,t.hI),this.Tg(i,t.iI))}else t.flat?O.gs(L,R,T,v,S,b,t.sI,t.hI,t.iI,u,A,d,w,l,p,I,a,f,t.eI):O.gs(L,R,T,v,S,b,t.sI,t.hI,t.iI,c,m,y,l,w,I,p,f,a,t.eI);if(!((g-T)*(S-b)-(_-b)*(R-T)<=0))if(O.zi=g<0||T<0||R<0||g>C.Ai||T>C.Ai||R>C.Ai,Rt.lE&&this.Cg(Rt.gh,Rt._h,_,b,S,g,T,R)&&(Rt.OE=s,Rt.bE=h),-1!==t.eI){if(!Rt.Bi)return void O.gs(g,T,R,_,b,S,t.tI,t.iI,t.hI,u,A,d,w,l,p,I,a,f,t.eI);const i=Rt.CE[t.eI];O.As(g,T,R,_,b,S,this.Tg(i,t.tI),this.Tg(i,t.iI),this.Tg(i,t.hI))}else 12345678!==t.tI&&O.As(g,T,R,_,b,S,t.tI,t.iI,t.hI)};Eg=(t,i,s,h,e,n,r)=>{let o=s.Fh.length;for(let t=0;t<o;t++){let i=s.Fh[t]-Rt.$I,o=s.Sh[t]-Rt.JI,l=s.Uh[t]-Rt.QI,a=l*n+i*r>>16;if(l=l*r-i*n>>16,i=a,a=o*e-l*h>>16,l=o*h+l*e>>16,o=a,l<50)return;s._I&&(Lt.oI[t]=i,Lt.lI[t]=o,Lt.aI[t]=l),Lt.nI[t]=O.Ki+((i<<9)/l|0),Lt.rI[t]=O.Xi+((o<<9)/l|0)}O.alpha=0,o=s.II.length;for(let h=0;h<o;h++){const e=s.II[h],n=s.EI[h],r=s.gI[h],o=Lt.nI[e],l=Lt.nI[n],a=Lt.nI[r],c=Lt.rI[e],f=Lt.rI[n],u=Lt.rI[r];if((o-l)*(u-f)-(c-f)*(a-l)>0)if(O.zi=o<0||l<0||a<0||o>C.Ai||l>C.Ai||a>C.Ai,Rt.lE&&this.Cg(Rt.gh,Rt._h,c,f,u,o,l,a)&&(Rt.OE=t,Rt.bE=i),s._I&&-1!==s._I[h])if(Rt.Bi){const t=Rt.CE[s._I[h]];O.As(o,l,a,c,f,u,this.Tg(t,s.AI[h]),this.Tg(t,s.pI[h]),this.Tg(t,s.mI[h]))}else s.flat?O.gs(o,l,a,c,f,u,s.AI[h],s.pI[h],s.mI[h],Lt.oI[0],Lt.lI[0],Lt.aI[0],Lt.oI[1],Lt.oI[3],Lt.lI[1],Lt.lI[3],Lt.aI[1],Lt.aI[3],s._I[h]):O.gs(o,l,a,c,f,u,s.AI[h],s.pI[h],s.mI[h],Lt.oI[e],Lt.lI[e],Lt.aI[e],Lt.oI[n],Lt.oI[r],Lt.lI[n],Lt.lI[r],Lt.aI[n],Lt.aI[r],s._I[h]);else 12345678!==s.AI[h]&&O.As(o,l,a,c,f,u,s.AI[h],s.pI[h],s.mI[h])}};mg=(t,i,s)=>{const h=this.kE[t][i][s];if(h===-Rt.Ji)return!1;if(h===Rt.Ji)return!0;{const h=i<<7,e=s<<7;return this.Og(h+1,this.SE[t][i][s],e+1)&&this.Og(h+128-1,this.SE[t][i+1][s],e+1)&&this.Og(h+128-1,this.SE[t][i+1][s+1],e+128-1)&&this.Og(h+1,this.SE[t][i][s+1],e+128-1)?(this.kE[t][i][s]=Rt.Ji,!0):(this.kE[t][i][s]=-Rt.Ji,!1)}};gg=(t,i,s,h)=>{if(!this.mg(t,i,s))return!1;const e=i<<7,n=s<<7,r=this.SE[t][i][s]-1,o=r-120,l=r-230,a=r-238;if(h<16){if(1===h){if(e>Rt.$I){if(!this.Og(e,r,n))return!1;if(!this.Og(e,r,n+128))return!1}if(t>0){if(!this.Og(e,o,n))return!1;if(!this.Og(e,o,n+128))return!1}return!!this.Og(e,l,n)&&this.Og(e,l,n+128)}if(2===h){if(n<Rt.QI){if(!this.Og(e,r,n+128))return!1;if(!this.Og(e+128,r,n+128))return!1}if(t>0){if(!this.Og(e,o,n+128))return!1;if(!this.Og(e+128,o,n+128))return!1}return!!this.Og(e,l,n+128)&&this.Og(e+128,l,n+128)}if(4===h){if(e<Rt.$I){if(!this.Og(e+128,r,n))return!1;if(!this.Og(e+128,r,n+128))return!1}if(t>0){if(!this.Og(e+128,o,n))return!1;if(!this.Og(e+128,o,n+128))return!1}return!!this.Og(e+128,l,n)&&this.Og(e+128,l,n+128)}if(8===h){if(n>Rt.QI){if(!this.Og(e,r,n))return!1;if(!this.Og(e+128,r,n))return!1}if(t>0){if(!this.Og(e,o,n))return!1;if(!this.Og(e+128,o,n))return!1}return!!this.Og(e,l,n)&&this.Og(e+128,l,n)}}return!!this.Og(e+64,a,n+64)&&(16===h?this.Og(e,l,n+128):32===h?this.Og(e+128,l,n+128):64===h?this.Og(e+128,l,n):128===h?this.Og(e,l,n):(console.warn('Warning unsupported wall type!'),!0))};visible=(t,i,s,h)=>{if(this.mg(t,i,s)){const e=i<<7,n=s<<7;return this.Og(e+1,this.SE[t][i][s]-h,n+1)&&this.Og(e+128-1,this.SE[t][i+1][s]-h,n+1)&&this.Og(e+128-1,this.SE[t][i+1][s+1]-h,n+128-1)&&this.Og(e+1,this.SE[t][i][s+1]-h,n+128-1)}return!1};_g=(t,i,s,h,e,n)=>{let r,o;if(i!==s||h!==e){for(r=i;r<=s;r++)for(o=h;o<=e;o++)if(this.kE[t][r][o]===-Rt.Ji)return!1;o=1+(i<<7);const l=2+(h<<7),a=this.SE[t][i][h]-n;if(!this.Og(o,a,l))return!1;const c=(s<<7)-1;if(!this.Og(c,a,l))return!1;const f=(e<<7)-1;return!!this.Og(o,a,f)&&this.Og(c,a,f)}return!!this.mg(t,i,h)&&(r=i<<7,o=h<<7,this.Og(r+1,this.SE[t][i][h]-n,o+1)&&this.Og(r+128-1,this.SE[t][i+1][h]-n,o+1)&&this.Og(r+128-1,this.SE[t][i+1][h+1]-n,o+128-1)&&this.Og(r+1,this.SE[t][i][h+1]-n,o+128-1))};Og=(t,i,s)=>{for(let h=0;h<Rt.TE;h++){const e=Rt.BI[h];if(e)if(1===e.mode){const h=e.zh-t;if(h>0){const t=e.qh+(e.$p*h>>8),n=e.$h+(e.Jp*h>>8),r=e.Qh+(e.Qp*h>>8),o=e.te+(e.tm*h>>8);if(s>=t&&s<=n&&i>=r&&i<=o)return!0}}else if(2===e.mode){const h=t-e.zh;if(h>0){const t=e.qh+(e.$p*h>>8),n=e.$h+(e.Jp*h>>8),r=e.Qh+(e.Qp*h>>8),o=e.te+(e.tm*h>>8);if(s>=t&&s<=n&&i>=r&&i<=o)return!0}}else if(3===e.mode){const h=e.qh-s;if(h>0){const s=e.zh+(e.Zp*h>>8),n=e.Zh+(e.qp*h>>8),r=e.Qh+(e.Qp*h>>8),o=e.te+(e.tm*h>>8);if(t>=s&&t<=n&&i>=r&&i<=o)return!0}}else if(4===e.mode){const h=s-e.qh;if(h>0){const s=e.zh+(e.Zp*h>>8),n=e.Zh+(e.qp*h>>8),r=e.Qh+(e.Qp*h>>8),o=e.te+(e.tm*h>>8);if(t>=s&&t<=n&&i>=r&&i<=o)return!0}}else if(5===e.mode){const h=i-e.Qh;if(h>0){const i=e.zh+(e.Zp*h>>8),n=e.Zh+(e.qp*h>>8),r=e.qh+(e.$p*h>>8),o=e.$h+(e.Jp*h>>8);if(t>=i&&t<=n&&s>=r&&s<=o)return!0}}}return!1};Cg=(t,i,s,h,e,n,r,o)=>{if(i<s&&i<h&&i<e)return!1;if(i>s&&i>h&&i>e)return!1;if(t<n&&t<r&&t<o)return!1;if(t>n&&t>r&&t>o)return!1;const l=(i-h)*(o-r)-(t-r)*(e-h);return((i-s)*(r-n)-(t-n)*(h-s))*l>0&&l*((i-e)*(n-o)-(t-o)*(s-e))>0};Tg=(t,i)=>((i=(127-i)*(127&t)/160|0)<2?i=2:i>126&&(i=126),(65408&t)+i)}class St extends t{static count=0;static $t=[];static Jt=t=>{const i=new a(t.read('flo.dat'));this.count=i.St;for(let t=0;t<this.count;t++)this.$t[t]=new St(t).it(i)};static bg=(t,i,s)=>(s>179&&(i=i/2|0),s>192&&(i=i/2|0),s>217&&(i=i/2|0),s>243&&(i=i/2|0),(t/4<<10)+(i/32<<7)+(s/2|0));static Lg=(t,i)=>-1===t?12345678:((i=i*(127&t)/128|0)<2?i=2:i>126&&(i=126),(65408&t)+i);static vg=(t,i)=>-2===t?12345678:-1===t?(i<0?i=0:i>127&&(i=127),127-i):((i=i*(127&t)/128|0)<2?i=2:i>126&&(i=126),(65408&t)+i);Rg=0;texture=-1;Sg=!1;Sn=!0;Mg=0;xg=0;kg=0;Dg=0;Ng=0;Pg=0;decode(t,i){1===t?(this.Rg=i.xt,this.setColor(this.Rg)):2===t?this.texture=i.st:3===t?this.Sg=!0:5===t?this.Sn=!1:6===t?this.tt=i.Ft:console.log('Error unrecognised config code: ',t)}setColor(t){const i=(t>>16&255)/256,s=(t>>8&255)/256,h=(255&t)/256;let e=i;s<i&&(e=s),h<e&&(e=h);let n=i;s>i&&(n=s),h>n&&(n=h);let r=0,o=0;const l=(e+n)/2;e!==n&&(l<.5&&(o=(n-e)/(n+e)),l>=.5&&(o=(n-e)/(2-n-e)),i===n?r=(s-h)/(n-e):s===n?r=(h-i)/(n-e)+2:h===n&&(r=(i-s)/(n-e)+4)),r/=6,this.Mg=256*r|0,this.xg=256*o|0,this.kg=256*l|0,this.xg<0?this.xg=0:this.xg>255&&(this.xg=255),this.kg<0?this.kg=0:this.kg>255&&(this.kg=255),this.Dg=l>.5?(1-l)*o*512|0:l*o*512|0,this.Dg<1&&(this.Dg=1),this.Ng=r*this.Dg|0;let a=this.Mg+(16*Math.random()|0)-8;a<0?a=0:a>255&&(a=255);let c=this.xg+(48*Math.random()|0)-24;c<0?c=0:c>255&&(c=255);let f=this.kg+(48*Math.random()|0)-24;f<0?f=0:f>255&&(f=255),this.Pg=St.bg(a,c,f)}}class Mt extends r{Fg;Ug;Bg;Gg;index;vl;zc;Zc;constructor(t,i,s,h,e,n,r){super(),this.Fg=i,this.Ug=s,this.Bg=h,this.Gg=e,this.index=t,this.vl=n,r&&-1!==n.hi&&this.vl.delay?(this.zc=Math.random()*this.vl.ii|0,this.Zc=Math.random()*this.vl.delay[this.zc]|0):(this.zc=-1,this.Zc=0)}}class xt{static Hg=Int8Array.of(1,2,4,8);static Wg=Uint8Array.of(16,32,64,128);static Yg=Int8Array.of(1,0,-1,0);static Vg=Int8Array.of(0,-1,0,1);static Kg=(17*Math.random()|0)-8;static Xg=(33*Math.random()|0)-16;static Bi=!0;static jg=0;static zg=!1;static Zg=(t,i)=>{let s=this.qg(t+45365,i+91923,4)+(this.qg(t+10294,i+37821,2)-128>>1)+(this.qg(t,i,1)-128>>2)-128;return s=35+(.3*s|0),s<10?s=10:s>60&&(s=60),s};static qg=(t,i,s)=>{const h=t/s|0,e=t&s-1,n=i/s|0,r=i&s-1,o=this.$g(h,n),l=this.$g(h+1,n),a=this.$g(h,n+1),c=this.$g(h+1,n+1),f=this.Jg(o,l,e,s),u=this.Jg(a,c,e,s);return this.Jg(f,u,r,s)};static Jg=(t,i,s,h)=>{const e=65536-O.cos[1024*s/h|0]>>1;return(t*(65536-e)>>16)+(i*e>>16)};static $g=(t,i)=>((this.Zy(t-1,i-1)+this.Zy(t+1,i-1)+this.Zy(t-1,i+1)+this.Zy(t+1,i+1))/16|0)+((this.Zy(t-1,i)+this.Zy(t+1,i)+this.Zy(t,i-1)+this.Zy(t,i+1))/8|0)+(this.Zy(t,i)/4|0);static Zy=(t,i)=>{const s=t+57*i,h=BigInt(s<<13^s);return 255&Number((h*(h*h*15731n+789221n)+1376312589n&0x7fffffffn)>>19n)};static Gm=(t,i,s,h,e,n,r,o,l,a,c)=>{const f=e[c][i][s],u=e[c][i+1][s],d=e[c][i+1][s+1],w=e[c][i][s+1],y=f+u+d+w>>2,A=x.get(o);let p=i+(s<<7)+(o<<14)+1073741824|0;A.active||(p+=-2147483648),p|=0;const m=(a<<6)+l<<24>>24;if(l===S.Ue.id)h?.YE(A.zn(S.Ue.id,a,f,u,d,w,-1),t,i,s,y,p,m),A.bn&&A.active&&r?.Um(i,s),-1!==A.Mn&&n.rt(new Mt(o,t,3,i,s,I.$t[A.Mn],!0));else if(l===S.Ze.id||l===S.qe.id){const e=A.zn(S.Ze.id,a,f,u,d,w,-1);if(e){let n,r,o=0;l===S.qe.id&&(o+=256),a===M.fn||a===M.dn?(n=A.length,r=A.width):(n=A.width,r=A.length),h?.Gm(t,i,s,y,e,null,p,m,n,r,o)}A.bn&&r?.Gm(i,s,A.width,A.length,a,A.Ln),-1!==A.Mn&&n.rt(new Mt(o,t,2,i,s,I.$t[A.Mn],!0))}else if(l>=S.$e.id)h?.Gm(t,i,s,y,A.zn(l,a,f,u,d,w,-1),null,p,m,1,1,0),A.bn&&r?.Gm(i,s,A.width,A.length,a,A.Ln),-1!==A.Mn&&n.rt(new Mt(o,t,2,i,s,I.$t[A.Mn],!0));else if(l===S.Be.id)h?.Wm(t,i,s,y,xt.Hg[a],0,A.zn(S.Be.id,a,f,u,d,w,-1),null,p,m),A.bn&&r?.Wm(i,s,l,a,A.Ln),-1!==A.Mn&&n.rt(new Mt(o,t,0,i,s,I.$t[A.Mn],!0));else if(l===S.Ge.id)h?.Wm(t,i,s,y,xt.Wg[a],0,A.zn(S.Ge.id,a,f,u,d,w,-1),null,p,m),A.bn&&r?.Wm(i,s,l,a,A.Ln),-1!==A.Mn&&n.rt(new Mt(o,t,0,i,s,I.$t[A.Mn],!0));else if(l===S.He.id){const e=a+1&3;h?.Wm(t,i,s,y,xt.Hg[a],xt.Hg[e],A.zn(S.He.id,a+4,f,u,d,w,-1),A.zn(S.He.id,e,f,u,d,w,-1),p,m),A.bn&&r?.Wm(i,s,l,a,A.Ln),-1!==A.Mn&&n.rt(new Mt(o,t,0,i,s,I.$t[A.Mn],!0))}else if(l===S.We.id)h?.Wm(t,i,s,y,xt.Wg[a],0,A.zn(S.We.id,a,f,u,d,w,-1),null,p,m),A.bn&&r?.Wm(i,s,l,a,A.Ln),-1!==A.Mn&&n.rt(new Mt(o,t,0,i,s,I.$t[A.Mn],!0));else if(l===S.ze.id)h?.Gm(t,i,s,y,A.zn(l,a,f,u,d,w,-1),null,p,m,1,1,0),A.bn&&r?.Gm(i,s,A.width,A.length,a,A.Ln),-1!==A.Mn&&n.rt(new Mt(o,t,2,i,s,I.$t[A.Mn],!0));else if(l===S.Ye.id)h?.jE(t,i,s,y,0,0,p,A.zn(S.Ye.id,M.cn,f,u,d,w,-1),m,512*a,xt.Hg[a]),-1!==A.Mn&&n.rt(new Mt(o,t,1,i,s,I.$t[A.Mn],!0));else if(l===S.Ve.id){let e=16;if(h){const n=h.rg(t,i,s);n>0&&(e=x.get(n>>14&32767).kn)}h?.jE(t,i,s,y,xt.Yg[a]*e,xt.Vg[a]*e,p,A.zn(S.Ye.id,M.cn,f,u,d,w,-1),m,512*a,xt.Hg[a]),-1!==A.Mn&&n.rt(new Mt(o,t,1,i,s,I.$t[A.Mn],!0))}else l===S.Ke.id?(h?.jE(t,i,s,y,0,0,p,A.zn(S.Ye.id,M.cn,f,u,d,w,-1),m,a,256),-1!==A.Mn&&n.rt(new Mt(o,t,1,i,s,I.$t[A.Mn],!0))):l===S.Xe.id?(h?.jE(t,i,s,y,0,0,p,A.zn(S.Ye.id,M.cn,f,u,d,w,-1),m,a,512),-1!==A.Mn&&n.rt(new Mt(o,t,1,i,s,I.$t[A.Mn],!0))):l===S.je.id&&(h?.jE(t,i,s,y,0,0,p,A.zn(S.Ye.id,M.cn,f,u,d,w,-1),m,a,768),-1!==A.Mn&&n.rt(new Mt(o,t,1,i,s,I.$t[A.Mn],!0)))};Xp;zp;Qg;t_;i_;s_;h_;e_;n_;r_;o_;l_;a_;c_;f_;u_;constructor(t,i,s,h){this.Xp=t,this.zp=i,this.Qg=s,this.t_=h,this.i_=new w(gt.Nm,t,i),this.s_=new w(gt.Nm,t,i),this.h_=new w(gt.Nm,t,i),this.e_=new w(gt.Nm,t,i),this.u_=new A(gt.Nm,t+1,i+1),this.n_=new w(gt.Nm,t+1,i+1),this.r_=new y(t+1,i+1),this.o_=new Int32Array(i),this.l_=new Int32Array(i),this.a_=new Int32Array(i),this.c_=new Int32Array(i),this.f_=new Int32Array(i)}d_=(t,i)=>{for(let t=0;t<gt.Nm;t++)for(let s=0;s<gt.Pm;s++)for(let h=0;h<gt.Pm;h++)if(!(1&~this.t_[t][s][h])){let e=t;2&~this.t_[1][s][h]||e--,e>=0&&i[e]?.Um(s,h)}xt.Kg+=(5*Math.random()|0)-2,xt.Kg<-8?xt.Kg=-8:xt.Kg>8&&(xt.Kg=8),xt.Xg+=(5*Math.random()|0)-2,xt.Xg<-16?xt.Xg=-16:xt.Xg>16&&(xt.Xg=16);for(let i=0;i<gt.Nm;i++){const s=this.n_[i],h=96,e=-50,n=-10,r=-50,o=768*(0|Math.sqrt(e*e+n*n+r*r))>>8;for(let t=1;t<this.zp-1;t++)for(let l=1;l<this.Xp-1;l++){const a=this.Qg[i][l+1][t]-this.Qg[i][l-1][t],c=this.Qg[i][l][t+1]-this.Qg[i][l][t-1],f=0|Math.sqrt(a*a+c*c+65536),u=h+((e*((a<<8)/f|0)+n*(65536/f|0)+r*((c<<8)/f|0))/o|0),d=(s[l-1][t]>>2)+(s[l+1][t]>>3)+(s[l][t-1]>>2)+(s[l][t+1]>>3)+(s[l][t]>>1);this.r_[l][t]=u-d}for(let t=0;t<this.zp;t++)this.o_[t]=0,this.l_[t]=0,this.a_[t]=0,this.c_[t]=0,this.f_[t]=0;for(let s=-5;s<this.Xp+5;s++){for(let t=0;t<this.zp;t++){const h=s+5;let e;if(h>=0&&h<this.Xp){const s=255&this.i_[i][h][t];if(s>0){const i=St.$t[s-1];this.o_[t]+=i.Ng,this.l_[t]+=i.xg,this.a_[t]+=i.kg,this.c_[t]+=i.Dg,e=this.f_[t]++}}const n=s-5;if(n>=0&&n<this.Xp){const s=255&this.i_[i][n][t];if(s>0){const i=St.$t[s-1];this.o_[t]-=i.Ng,this.l_[t]-=i.xg,this.a_[t]-=i.kg,this.c_[t]-=i.Dg,e=this.f_[t]--}}}if(s>=1&&s<this.Xp-1){let h=0,e=0,n=0,r=0,o=0;for(let l=-5;l<this.zp+5;l++){const a=l+5;a>=0&&a<this.zp&&(h+=this.o_[a],e+=this.l_[a],n+=this.a_[a],r+=this.c_[a],o+=this.f_[a]);const c=l-5;if(c>=0&&c<this.zp&&(h-=this.o_[c],e-=this.l_[c],n-=this.a_[c],r-=this.c_[c],o-=this.f_[c]),l>=1&&l<this.zp-1&&(!xt.Bi||!(16&this.t_[i][s][l])&&this.w_(i,s,l)===xt.jg)){const a=255&this.i_[i][s][l],c=255&this.s_[i][s][l];if(a>0||c>0){const f=this.Qg[i][s][l],u=this.Qg[i][s+1][l],d=this.Qg[i][s+1][l+1],w=this.Qg[i][s][l+1],y=this.r_[s][l],A=this.r_[s+1][l],p=this.r_[s+1][l+1],m=this.r_[s][l+1];let I=-1,E=-1;if(a>0){const t=256*h/r|0,i=e/o|0;let s=n/o|0;I=St.bg(t,i,s);const l=t+xt.Kg&255;s+=xt.Xg,s<0?s=0:s>255&&(s=255),E=St.bg(l,i,s)}if(i>0){let t=0!==a||this.h_[i][s][l]===vt.OI;c>0&&!St.$t[c-1].Sn&&(t=!1),t&&f===u&&f===d&&f===w&&(this.u_[i][s][l]|=2340)}let g=0;if(-1!==I&&(g=O.palette[St.Lg(E,96)]),0===c)t?.WE(i,s,l,vt.OI,M.cn,-1,f,u,d,w,St.Lg(I,y),St.Lg(I,A),St.Lg(I,p),St.Lg(I,m),B.ar,B.ar,B.ar,B.ar,g,B.ar);else{const h=this.h_[i][s][l]+1,e=this.e_[i][s][l],n=St.$t[c-1];let r,o,a=n.texture;a>=0?(o=O.fs(a),r=-1):n.Rg===B.rr?(o=0,r=-2,a=-1):(r=St.bg(n.Mg,n.xg,n.kg),o=O.palette[St.vg(n.Pg,96)]),t?.WE(i,s,l,h,e,a,f,u,d,w,St.Lg(I,y),St.Lg(I,A),St.Lg(I,p),St.Lg(I,m),St.vg(r,y),St.vg(r,A),St.vg(r,p),St.vg(r,m),g,o)}}}}}}for(let s=1;s<this.zp-1;s++)for(let h=1;h<this.Xp-1;h++)t?.HE(i,h,s,this.w_(i,h,s))}xt.zg||t?.fg(64,768,-50,-10,-50);for(let i=0;i<this.Xp;i++)for(let s=0;s<this.zp;s++)2&~this.t_[1][i][s]||t?.GE(i,s);if(!xt.zg){let t=1,i=2,s=4;for(let h=0;h<gt.Nm;h++){h>0&&(t<<=3,i<<=3,s<<=3);for(let e=0;e<=h;e++)for(let n=0;n<=this.zp;n++)for(let r=0;r<=this.Xp;r++){if(this.u_[e][r][n]&t){let i=n,s=n,o=e,l=e;for(;i>0&&this.u_[e][r][i-1]&t;)i--;for(;s<this.zp&&this.u_[e][r][s+1]&t;)s++;t:for(;o>0;){for(let h=i;h<=s;h++)if(!(this.u_[o-1][r][h]&t))break t;o--}t:for(;l<h;){for(let h=i;h<=s;h++)if(!(this.u_[l+1][r][h]&t))break t;l++}if((l+1-o)*(s+1-i)>=8){const e=this.Qg[l][r][i]-240,n=this.Qg[o][r][i];Rt.vE(h,1,128*r,e,128*i,128*r,n,128*s+128);for(let h=o;h<=l;h++)for(let e=i;e<=s;e++)this.u_[h][r][e]&=~t}}if(this.u_[e][r][n]&i){let t=r,s=r,o=e,l=e;for(;t>0&&this.u_[e][t-1][n]&i;)t--;for(;s<this.Xp&&this.u_[e][s+1][n]&i;)s++;t:for(;o>0;){for(let h=t;h<=s;h++)if(!(this.u_[o-1][h][n]&i))break t;o--}t:for(;l<h;){for(let h=t;h<=s;h++)if(!(this.u_[l+1][h][n]&i))break t;l++}if((l+1-o)*(s+1-t)>=8){const e=this.Qg[l][t][n]-240,r=this.Qg[o][t][n];Rt.vE(h,2,128*t,e,128*n,128*s+128,r,128*n);for(let h=o;h<=l;h++)for(let e=t;e<=s;e++)this.u_[h][e][n]&=~i}}if(this.u_[e][r][n]&s){let t=r,i=r,o=n,l=n;for(;o>0&&this.u_[e][r][o-1]&s;)o--;for(;l<this.zp&&this.u_[e][r][l+1]&s;)l++;t:for(;t>0;){for(let i=o;i<=l;i++)if(!(this.u_[e][t-1][i]&s))break t;t--}t:for(;i<this.Xp;){for(let t=o;t<=l;t++)if(!(this.u_[e][i+1][t]&s))break t;i++}if((i+1-t)*(l+1-o)>=4){const n=this.Qg[e][t][o];Rt.vE(h,4,128*t,n,128*o,128*i+128,n,128*l+128);for(let h=t;h<=i;h++)for(let t=o;t<=l;t++)this.u_[e][h][t]&=~s}}}}}};y_=(t,i,s,h)=>{let e=0;for(let t=0;t<St.count;t++)if('water'===St.$t[t].tt?.toLowerCase()){e=t+1<<24>>24;break}for(let n=t;n<t+s;n++)for(let t=i;t<i+h;t++)if(t>=0&&t<this.Xp&&n>=0&&n<this.zp){this.s_[0][t][n]=e;for(let i=0;i<gt.Nm;i++)this.Qg[i][t][n]=0,this.t_[i][t][n]=0}};A_=(t,i,s,h,e)=>{const n=new a(new Uint8Array(e));for(let e=0;e<gt.Nm;e++)for(let r=0;r<64;r++)for(let o=0;o<64;o++){const l=r+s,a=o+h;let c;if(l>=0&&l<gt.Pm&&a>=0&&a<gt.Pm)for(this.t_[e][l][a]=0;;){if(c=n.st,0===c){0===e?this.Qg[0][l][a]=8*-xt.Zg(l+t+932731,a+556238+i):this.Qg[e][l][a]=this.Qg[e-1][l][a]-240;break}if(1===c){let t=n.st;1===t&&(t=0),0===e?this.Qg[0][l][a]=8*-t:this.Qg[e][l][a]=this.Qg[e-1][l][a]-8*t;break}c<=49?(this.s_[e][l][a]=n.Rt,this.h_[e][l][a]=(c-2)/4<<24>>24,this.e_[e][l][a]=(c-2&3)<<24>>24):c<=81?this.t_[e][l][a]=c-49<<24>>24:this.i_[e][l][a]=c-81<<24>>24}else for(;c=n.st,0!==c;){if(1===c){n.st;break}c<=49&&n.st}}};p_=(t,i,s,h,e,n)=>{const r=new a(new Uint8Array(h));let o=-1;for(;;){const h=r.Pt;if(0===h)return;o+=h;let l=0;for(;;){const h=r.Pt;if(0===h)break;l+=h-1;const a=63&l,c=l>>6&63,f=l>>12,u=r.st,d=u>>2,w=3&u,y=c+e,A=a+n;if(y>0&&A>0&&y<gt.Pm-1&&A<gt.Pm-1){let h=f;2&~this.t_[1][y][A]||(h=f-1);let e=null;h>=0&&(e=s[h]),this.Gm(f,y,A,t,i,e,o,d,w)}}}};Gm=(t,i,s,h,e,n,r,o,l)=>{if(xt.Bi){if(16&this.t_[t][i][s])return;if(this.w_(t,i,s)!==xt.jg)return}const a=this.Qg[t][i][s],c=this.Qg[t][i+1][s],f=this.Qg[t][i+1][s+1],u=this.Qg[t][i][s+1],d=a+c+f+u>>2,w=x.get(r);let y=i+(s<<7)+(r<<14)+1073741824|0;w.active||(y+=-2147483648),y|=0;const A=(l<<6)+o<<24>>24;if(o===S.Ue.id)(!xt.Bi||w.active||w.jn)&&(h?.YE(w.zn(S.Ue.id,l,a,c,f,u,-1),t,i,s,d,y,A),w.bn&&w.active&&n?.Um(i,s),-1!==w.Mn&&e.rt(new Mt(r,t,3,i,s,I.$t[w.Mn],!0)));else if(o===S.Ze.id||o===S.qe.id){const p=w.zn(S.Ze.id,l,a,c,f,u,-1);if(p){let e,n,r=0;if(o===S.qe.id&&(r+=256),l===M.fn||l===M.dn?(e=w.length,n=w.width):(e=w.width,n=w.length),h?.Gm(t,i,s,d,p,null,y,A,e,n,r)&&w.Bn)for(let h=0;h<=e;h++)for(let e=0;e<=n;e++){let n=p.Jh/4|0;n>30&&(n=30),n>this.n_[t][i+h][s+e]&&(this.n_[t][i+h][s+e]=n<<24>>24)}}w.bn&&n?.Gm(i,s,w.width,w.length,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,2,i,s,I.$t[w.Mn],!0))}else if(o>=S.$e.id)h?.Gm(t,i,s,d,w.zn(o,l,a,c,f,u,-1),null,y,A,1,1,0),o>=S.$e.id&&o<=S.hn.id&&o!==S.Je.id&&t>0&&(this.u_[t][i][s]|=2340),w.bn&&n?.Gm(i,s,w.width,w.length,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,2,i,s,I.$t[w.Mn],!0));else if(o===S.Be.id)h?.Wm(t,i,s,d,xt.Hg[l],0,w.zn(S.Be.id,l,a,c,f,u,-1),null,y,A),l===M.cn?(w.Bn&&(this.n_[t][i][s]=50,this.n_[t][i][s+1]=50),w.Sn&&(this.u_[t][i][s]|=585)):l===M.fn?(w.Bn&&(this.n_[t][i][s+1]=50,this.n_[t][i+1][s+1]=50),w.Sn&&(this.u_[t][i][s+1]|=1170)):l===M.un?(w.Bn&&(this.n_[t][i+1][s]=50,this.n_[t][i+1][s+1]=50),w.Sn&&(this.u_[t][i+1][s]|=585)):l===M.dn&&(w.Bn&&(this.n_[t][i][s]=50,this.n_[t][i+1][s]=50),w.Sn&&(this.u_[t][i][s]|=1170)),w.bn&&n?.Wm(i,s,o,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,0,i,s,I.$t[w.Mn],!0)),16!==w.kn&&h?.ZE(t,i,s,w.kn);else if(o===S.Ge.id)h?.Wm(t,i,s,d,xt.Wg[l],0,w.zn(S.Ge.id,l,a,c,f,u,-1),null,y,A),w.Bn&&(l===M.cn?this.n_[t][i][s+1]=50:l===M.fn?this.n_[t][i+1][s+1]=50:l===M.un?this.n_[t][i+1][s]=50:l===M.dn&&(this.n_[t][i][s]=50)),w.bn&&n?.Wm(i,s,o,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,0,i,s,I.$t[w.Mn],!0));else if(o===S.He.id){const p=l+1&3;h?.Wm(t,i,s,d,xt.Hg[l],xt.Hg[p],w.zn(S.He.id,l+4,a,c,f,u,-1),w.zn(S.He.id,p,a,c,f,u,-1),y,A),w.Sn&&(l===M.cn?(this.u_[t][i][s]|=265,this.u_[t][i][s+1]|=1170):l===M.fn?(this.u_[t][i][s+1]|=1170,this.u_[t][i+1][s]|=585):l===M.un?(this.u_[t][i+1][s]|=585,this.u_[t][i][s]|=1170):l===M.dn&&(this.u_[t][i][s]|=1170,this.u_[t][i][s]|=585)),w.bn&&n?.Wm(i,s,o,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,0,i,s,I.$t[w.Mn],!0)),16!==w.kn&&h?.ZE(t,i,s,w.kn)}else if(o===S.We.id)h?.Wm(t,i,s,d,xt.Wg[l],0,w.zn(S.We.id,l,a,c,f,u,-1),null,y,A),w.Bn&&(l===M.cn?this.n_[t][i][s+1]=50:l===M.fn?this.n_[t][i+1][s+1]=50:l===M.un?this.n_[t][i+1][s]=50:l===M.dn&&(this.n_[t][i][s]=50)),w.bn&&n?.Wm(i,s,o,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,0,i,s,I.$t[w.Mn],!0));else if(o===S.ze.id)h?.Gm(t,i,s,d,w.zn(o,l,a,c,f,u,-1),null,y,A,1,1,0),w.bn&&n?.Gm(i,s,w.width,w.length,l,w.Ln),-1!==w.Mn&&e.rt(new Mt(r,t,2,i,s,I.$t[w.Mn],!0));else if(o===S.Ye.id)h?.jE(t,i,s,d,0,0,y,w.zn(S.Ye.id,M.cn,a,c,f,u,-1),A,512*l,xt.Hg[l]),-1!==w.Mn&&e.rt(new Mt(r,t,1,i,s,I.$t[w.Mn],!0));else if(o===S.Ve.id){let n=16;if(h){const e=h.rg(t,i,s);e>0&&(n=x.get(e>>14&32767).kn)}h?.jE(t,i,s,d,xt.Yg[l]*n,xt.Vg[l]*n,y,w.zn(S.Ye.id,M.cn,a,c,f,u,-1),A,512*l,xt.Hg[l]),-1!==w.Mn&&e.rt(new Mt(r,t,1,i,s,I.$t[w.Mn],!0))}else o===S.Ke.id?(h?.jE(t,i,s,d,0,0,y,w.zn(S.Ye.id,M.cn,a,c,f,u,-1),A,l,256),-1!==w.Mn&&e.rt(new Mt(r,t,1,i,s,I.$t[w.Mn],!0))):o===S.Xe.id?(h?.jE(t,i,s,d,0,0,y,w.zn(S.Ye.id,M.cn,a,c,f,u,-1),A,l,512),-1!==w.Mn&&e.rt(new Mt(r,t,1,i,s,I.$t[w.Mn],!0))):o===S.je.id&&(h?.jE(t,i,s,d,0,0,y,w.zn(S.Ye.id,M.cn,a,c,f,u,-1),A,l,768),-1!==w.Mn&&e.rt(new Mt(r,t,1,i,s,I.$t[w.Mn],!0)))};w_=(t,i,s)=>8&this.t_[t][i][s]?0:t<=0||!(2&this.t_[1][i][s])?t:t-1}class kt extends r{m_;an;x;z;I_;angle;shape;E_;g_;__;constructor(t,i,s,h,e,n,r,o,l,a){super(),this.m_=t,this.an=i,this.x=s,this.z=h,this.I_=e,this.angle=n,this.shape=r,this.E_=o,this.g_=l,this.__=a}}class Dt extends r{m_;an;x;z;I_;angle;shape;C_;constructor(t,i,s,h,e,n,r,o){super(),this.m_=t,this.an=i,this.x=s,this.z=h,this.I_=e,this.angle=n,this.shape=r,this.C_=o}}class Nt extends r{}class Pt extends Nt{x=0;z=0;Ep=0;T_=!1;size=1;O_=-1;b_=-1;L_=-1;v_=-1;R_=-1;S_=-1;M_=-1;x_=null;k_=100;D_=0;N_=0;P_=0;F_=0;U_=-1e3;B_=0;G_=0;H_=-1;W_=0;Y_=0;V_=-1;K_=0;X_=0;j_=-1;z_=0;Z_=0;q_=0;J_=0;Q_=-1;tC=0;iC=0;sC=0;hC=0;eC=0;nC=0;rC=0;oC=0;lC=0;aC=0;cC=0;Ji=0;height=0;fC=0;pathLength=0;uC=new Int32Array(10);dC=new Int32Array(10);wC=new c(10,!1);yC=0;AC=-1;pC=-1;mC=-1;IC=-1;move(t,i,s){if(-1!==this.j_&&I.$t[this.j_].priority<=1&&(this.j_=-1),!t){const t=i-this.uC[0],h=s-this.dC[0];if(t>=-8&&t<=8&&h>=-8&&h<=8){this.pathLength<9&&this.pathLength++;for(let t=this.pathLength;t>0;t--)this.uC[t]=this.uC[t-1],this.dC[t]=this.dC[t-1],this.wC[t]=this.wC[t-1];return this.uC[0]=i,this.dC[0]=s,void(this.wC[0]=!1)}}this.pathLength=0,this.yC=0,this.uC[0]=i,this.dC[0]=s,this.x=128*this.uC[0]+64*this.size,this.z=128*this.dC[0]+64*this.size}step(t,i){let s=this.uC[0],h=this.dC[0];0===i?(s--,h++):1===i?h++:2===i?(s++,h++):3===i?s--:4===i?s++:5===i?(s--,h--):6===i?h--:7===i&&(s++,h--),-1!==this.j_&&I.$t[this.j_].priority<=1&&(this.j_=-1),this.pathLength<9&&this.pathLength++;for(let t=this.pathLength;t>0;t--)this.uC[t]=this.uC[t-1],this.dC[t]=this.dC[t-1],this.wC[t]=this.wC[t-1];this.uC[0]=s,this.dC[0]=h,this.wC[0]=t}}class Ft extends Pt{static EC=1;static gC=2;static _C=4;static CC=8;static TC=16;static OC=32;static bC=64;static LC=128;static vC=256;static RC=512;static SC=[B.no,B.ro,B.oo,B.lo,B.ao,B.co,B.fo,B.uo,B.do,B.wo,B.yo,B.Ao,B.po,B.mo,B.Io,B.Eo];static MC=[[B.Rr,B.Sr,B.Mr,B.kr,B.Dr,B.Nr,B.Pr,B.Fr,B.Ur,B.Br,B.Gr,B.Hr],[B.Wr,B.Yr,B.Vr,B.Kr,B.Xr,B.jr,B.zr,B.Zr,B.qr,B.$r,B.Jr,B.Qr,B.io,B.so,B.ho,B.eo],[B.eo-1,B.Wr+1,B.Yr,B.Vr,B.Kr,B.Xr,B.jr,B.zr,B.Zr,B.qr,B.$r,B.Jr,B.Qr,B.io,B.so,B.ho],[B._o,B.Co,B.To,B.Oo,B.bo,B.Lo],[B.Ro,B.So,B.Mo,B.xo,B.ko,B.Do,B.No,B.vo]];static Fo=new _(200);name=null;visible=!1;xC=0;kC=0;DC=new Uint16Array(12);NC=new Uint16Array(5);PC=0;FC=0n;y=0;UC=0;BC=0;GC=0;HC=0;WC=0;YC=null;Kp=0;jp=0;Xp=0;zp=0;Bi=!1;draw(t){if(!this.visible)return null;let i=this.Ll();if(this.height=i.te,i.we=!0,this.Bi)return i;if(-1!==this.Q_&&-1!==this.tC){const t=Y.$t[this.Q_],s=v.he(t.zn(),!0,!t.xn,!1);s.translate(-this.hC,0,0),s.me(),t.vl&&t.vl.frames&&s.ge(t.vl.frames[this.tC]),s.le=null,s.oe=null,128===t.Ol&&128===t.bl||s.scale(t.Ol,t.bl,t.Ol),s.be(t.Dn+64,t.Nn+850,-30,-50,-30,!0);const h=[i,s];i=v.ae(h,2)}if(this.YC&&(t>=this.BC&&(this.YC=null),t>=this.UC&&t<this.BC)){const t=this.YC;if(t){t.translate(this.HC-this.y,this.GC-this.x,this.WC-this.z),512===this.fC?(t._e(),t._e(),t._e()):1024===this.fC?(t._e(),t._e()):1536===this.fC&&t._e();const s=[i,t];i=v.ae(s,2),512===this.fC?t._e():1024===this.fC?(t._e(),t._e()):1536===this.fC&&(t._e(),t._e(),t._e()),t.translate(this.y-this.HC,this.x-this.GC,this.z-this.WC)}}return i.we=!0,i}isVisible(){return this.visible}read(t){t.bt=0,this.xC=t.st,this.kC=t.st;for(let i=0;i<12;i++){const s=t.st;this.DC[i]=0===s?0:(s<<8)+t.st}for(let i=0;i<5;i++){let s=t.st;(s<0||s>=Ft.MC[i].length)&&(s=0),this.NC[i]=s}this.O_=t.St,65535===this.O_&&(this.O_=-1),this.b_=t.St,65535===this.b_&&(this.b_=-1),this.L_=t.St,65535===this.L_&&(this.L_=-1),this.v_=t.St,65535===this.v_&&(this.v_=-1),this.R_=t.St,65535===this.R_&&(this.R_=-1),this.S_=t.St,65535===this.S_&&(this.S_=-1),this.M_=t.St,65535===this.M_&&(this.M_=-1),this.name=K.Wl(K.Ul(t.Dt)),this.PC=t.st,this.visible=!0,this.FC=0n;for(let t=0;t<12;t++)this.FC<<=0x4n,this.DC[t]>=256&&(this.FC+=BigInt(this.DC[t])-256n);this.DC[0]>=256&&(this.FC+=BigInt(this.DC[0])-256n>>4n),this.DC[1]>=256&&(this.FC+=BigInt(this.DC[1])-256n>>8n);for(let t=0;t<5;t++)this.FC<<=0x3n,this.FC+=BigInt(this.NC[t]);this.FC<<=0x1n,this.FC+=BigInt(this.xC)}Al(){if(!this.visible)return null;const t=new c(12,null);let i=0;for(let s=0;s<12;s++){const h=this.DC[s];if(h>=256&&h<512&&(t[i++]=W.$t[h-256].Al()),h>=512){const s=G.get(h-512).Al(this.xC);s&&(t[i++]=s)}}const s=v.fe(t,i);for(let t=0;t<5;t++)0!==this.NC[t]&&(s.Te(Ft.MC[t][0],Ft.MC[t][this.NC[t]]),1===t&&s.Te(Ft.SC[0],Ft.SC[this.NC[t]]));return s}Ll(){let t=this.FC,i=-1,s=-1,h=-1,e=-1;if(this.j_>=0&&0===this.q_){const n=I.$t[this.j_];if(n.frames&&(i=n.frames[this.z_]),this.V_>=0&&this.V_!==this.O_){const t=I.$t[this.V_].frames;t&&(s=t[this.K_])}n.ri>=0&&(h=n.ri,t+=BigInt(h-this.DC[5])<<8n),n.oi>=0&&(e=n.oi,t+=BigInt(e-this.DC[3])<<16n)}else if(this.V_>=0){const t=I.$t[this.V_].frames;t&&(i=t[this.K_])}let n=Ft.Fo?.get(t);if(!n){const i=new c(12,null);let s=0;for(let t=0;t<12;t++){let n=this.DC[t];if(e>=0&&3===t&&(n=e),h>=0&&5===t&&(n=h),n>=256&&n<512){const t=W.$t[n-256].zn();t&&(i[s++]=t)}if(n>=512){const t=G.get(n-512).yl(this.xC);t&&(i[s++]=t)}}n=v.fe(i,s);for(let t=0;t<5;t++)0!==this.NC[t]&&(n.Te(Ft.MC[t][0],Ft.MC[t][this.NC[t]]),1===t&&n.Te(Ft.SC[0],Ft.SC[this.NC[t]]));n.me(),n.be(64,850,-30,-50,-30,!0),Ft.Fo?.put(t,n)}if(this.Bi)return n;const r=v.re(n,!0);return-1!==i&&-1!==s?r.Ie(i,s,I.$t[this.j_].ei):-1!==i&&r.ge(i),r.ce(),r.le=null,r.oe=null,r}}class Ut extends Pt{static gC=2;static _C=4;static CC=8;static TC=16;static VC=32;static vC=64;static OC=128;type=null;draw(t){if(!this.type)return null;if(-1===this.Q_||-1===this.tC)return this.Ll();const i=this.Ll();if(!i)return null;const s=Y.$t[this.Q_],h=v.he(s.zn(),!0,!s.xn,!1);h.translate(-this.hC,0,0),h.me(),s.vl&&s.vl.frames&&h.ge(s.vl.frames[this.tC]),h.le=null,h.oe=null,128===s.Ol&&128===s.bl||h.scale(s.Ol,s.bl,s.Ol),h.be(64+s.Dn,850+s.Nn,-30,-50,-30,!0);const e=[i,h],n=v.ae(e,2);return 1===this.type.size&&(n.we=!0),n}isVisible(){return null!==this.type}Ll(){if(!this.type)return null;if(this.j_>=0&&0===this.q_){const t=I.$t[this.j_].frames;if(t){const i=t[this.z_];let s=-1;if(this.V_>=0&&this.V_!==this.O_){const t=I.$t[this.V_].frames;t&&(s=t[this.K_])}return this.type.Ll(i,s,I.$t[this.j_].ei)}}let t=-1;if(this.V_>=0){const i=I.$t[this.V_].frames;i&&(t=i[this.K_])}const i=this.type.Ll(t,-1,null);return i?(this.height=i.te,i):null}}class Bt extends r{index;count;constructor(t,i){super(),this.index=t,this.count=i}}class Gt extends Nt{KC;level;XC;jC;zC;offsetY;ZC;C_;qC;arc;target;mobile=!1;x=0;z=0;y=0;velocityX=0;$C=0;JC=0;velocityY=0;QC=0;Ep=0;pitch=0;zc=0;Zc=0;constructor(t,i,s,h,e,n,r,o,l,a,c){super(),this.KC=Y.$t[t],this.level=i,this.XC=s,this.jC=e,this.zC=h,this.ZC=n,this.C_=r,this.qC=o,this.arc=l,this.target=a,this.offsetY=c}tT(t,i,s,h){if(!this.mobile){const i=t-this.XC,h=s-this.jC,e=Math.sqrt(i*i+h*h);this.x=this.XC+i*this.arc/e,this.z=this.jC+h*this.arc/e,this.y=this.zC}const e=this.C_+1-h;this.velocityX=(t-this.x)/e,this.$C=(s-this.z)/e,this.JC=Math.sqrt(this.velocityX*this.velocityX+this.$C*this.$C),this.mobile||(this.velocityY=-this.JC*Math.tan(.02454369*this.qC)),this.QC=2*(i-this.y-this.velocityY*e)/(e*e)}update(t){if(this.mobile=!0,this.x+=this.velocityX*t,this.z+=this.$C*t,this.y+=this.velocityY*t+.5*this.QC*t*t,this.velocityY+=this.QC*t,this.Ep=325.949*Math.atan2(this.velocityX,this.$C)+1024&2047,this.pitch=325.949*Math.atan2(this.velocityY,this.JC)&2047,this.KC.vl&&this.KC.vl.delay)for(this.Zc+=t;this.Zc>this.KC.vl.delay[this.zc];)this.Zc-=this.KC.vl.delay[this.zc]+1,this.zc++,this.zc>=this.KC.vl.ii&&(this.zc=0)}draw(){const t=this.KC.zn(),i=v.he(t,!0,!this.KC.xn,!1);return this.KC.vl&&this.KC.vl.frames&&(i.me(),i.ge(this.KC.vl.frames[this.zc]),i.le=null,i.oe=null),128===this.KC.Ol&&128===this.KC.bl||i.scale(this.KC.Ol,this.KC.bl,this.KC.Ol),i.Ce(this.pitch),i.be(64+this.KC.Dn,850+this.KC.Nn,-30,-50,-30,!0),i}}class Ht extends Nt{type;level;x;z;y;ZC;iT=!1;zc=0;Zc=0;constructor(t,i,s,h,e,n,r){super(),this.type=Y.$t[t],this.level=i,this.x=s,this.z=h,this.y=e,this.ZC=n+r}update(t){if(this.type.vl&&this.type.vl.delay)for(this.Zc+=t;this.Zc>this.type.vl.delay[this.zc];)this.Zc-=this.type.vl.delay[this.zc]+1,this.zc++,this.zc>=this.type.vl.ii&&(this.zc=0,this.iT=!0)}draw(){const t=this.type.zn(),i=v.he(t,!0,!this.type.xn,!1);return!this.iT&&this.type.vl&&this.type.vl.frames&&(i.me(),i.ge(this.type.vl.frames[this.zc]),i.le=null,i.oe=null),128===this.type.Ol&&128===this.type.bl||i.scale(this.type.Ol,this.type.bl,this.type.Ol),0!==this.type.orientation&&(90===this.type.orientation?i._e():180===this.type.orientation?(i._e(),i._e()):270===this.type.orientation&&(i._e(),i._e(),i._e())),i.be(64+this.type.Dn,850+this.type.Nn,-30,-50,-30,!0),i}}let Wt;async function Yt(t,i){Vt(i);try{const i=await window.audioContext.decodeAudioData(Uint8Array.from(t).buffer);let s=window.audioContext.createBufferSource();s.buffer=i,s.connect(Wt),s.start()}catch(t){console.log(t)}}function Vt(t){Wt||(Wt=window.audioContext.createGain(),Wt.connect(window.audioContext.destination)),Wt.gain.value=t/256}function Kt(t,i){window._tinyMidiPlay&&window._tinyMidiPlay(t,i/256)}function Xt(t){window._tinyMidiVolume&&window._tinyMidiVolume(t/256)}function jt(){window._tinyMidiStop&&window._tinyMidiStop()}class zt{static jf=t=>{let i=0;t=t.toUpperCase();for(let s=0;s<t.length;s++)i=61*i+t.charCodeAt(s)-32|0;return i};buffer;sT;hT;eT;nT;rT;oT;lT=[];constructor(t){t instanceof Uint8Array&&(t=new Int8Array(t));let i=new a(new Uint8Array(t));const s=i.xt,h=i.xt;s===h?(this.buffer=t,this.sT=!1):(this.buffer=wt.read(s,t,h,6),i=new a(new Uint8Array(this.buffer)),this.sT=!0),this.hT=i.St,this.eT=[],this.nT=[],this.rT=[],this.oT=[];let e=i.bt+10*this.hT;for(let t=0;t<this.hT;t++)this.eT.push(i.kt),this.nT.push(i.xt),this.rT.push(i.xt),this.oT.push(e),e+=this.rT[t]}read(t){const i=zt.jf(t),s=this.eT.indexOf(i);return-1===s?null:this.aT(s)}aT(t){if(t<0||t>=this.hT)return null;if(this.lT[t])return this.lT[t];const i=this.oT[t],s=i+this.rT[t];if(this.sT){const h=Uint8Array.from(this.buffer.subarray(i,i+s));return this.lT[t]=h,h}{const i=Uint8Array.from(wt.read(this.nT[t],this.buffer,this.rT[t],this.oT[t]));return this.lT[t]=i,i}}}const Zt=['F11','F12'],qt={'Backspace':{code:8,ch:8},'Enter':{code:10,ch:10},'Shift':{code:16,ch:65535},'Escape':{code:27,ch:27},'Tab':{code:9,ch:9},'CapsLock':{code:20,ch:65535},' ':{code:32,ch:32},'Control':{code:17,ch:65535},'Alt':{code:18,ch:65535},'Meta':{code:524,ch:65535},'ArrowLeft':{code:37,ch:65535},'ArrowRight':{code:39,ch:65535},'ArrowUp':{code:38,ch:65535},'ArrowDown':{code:40,ch:65535},'Insert':{code:155,ch:65535},'Home':{code:36,ch:65535},'PageUp':{code:33,ch:65535},'Delete':{code:127,ch:127},'End':{code:35,ch:65535},'PageDown':{code:34,ch:65535},'`':{code:192,ch:96},'~':{code:192,ch:126},'!':{code:49,ch:33},'@':{code:50,ch:64},'#':{code:51,ch:35},'$':{code:52,ch:36},'%':{code:53,ch:37},'^':{code:54,ch:94},'&':{code:55,ch:38},'*':{code:56,ch:42},'(':{code:57,ch:40},')':{code:48,ch:41},'-':{code:45,ch:45},'_':{code:45,ch:95},'=':{code:61,ch:61},'+':{code:61,ch:43},'[':{code:91,ch:91},'{':{code:91,ch:123},']':{code:93,ch:93},'}':{code:93,ch:125},'\\':{code:92,ch:92},'|':{code:92,ch:124},';':{code:59,ch:59},':':{code:59,ch:58},"'":{code:222,ch:39},'"':{code:222,ch:34},',':{code:44,ch:44},'<':{code:44,ch:60},'.':{code:46,ch:46},'>':{code:46,ch:62},'/':{code:47,ch:47},'?':{code:47,ch:63},'F1':{code:112,ch:65535},'F2':{code:113,ch:65535},'F3':{code:114,ch:65535},'F4':{code:115,ch:65535},'F5':{code:116,ch:65535},'F6':{code:117,ch:65535},'F7':{code:118,ch:65535},'F8':{code:119,ch:65535},'F9':{code:120,ch:65535},'F10':{code:121,ch:65535},'F11':{code:122,ch:65535},'F12':{code:123,ch:65535},0:{code:48,ch:48},1:{code:49,ch:49},2:{code:50,ch:50},3:{code:51,ch:51},4:{code:52,ch:52},5:{code:53,ch:53},6:{code:54,ch:54},7:{code:55,ch:55},8:{code:56,ch:56},9:{code:57,ch:57},'a':{code:65,ch:97},'b':{code:66,ch:98},'c':{code:67,ch:99},'d':{code:68,ch:100},'e':{code:69,ch:101},'f':{code:70,ch:102},'g':{code:71,ch:103},'h':{code:72,ch:104},'i':{code:73,ch:105},'j':{code:74,ch:106},'k':{code:75,ch:107},'l':{code:76,ch:108},'m':{code:77,ch:109},'n':{code:78,ch:110},'o':{code:79,ch:111},'p':{code:80,ch:112},'q':{code:81,ch:113},'r':{code:82,ch:114},'s':{code:83,ch:115},'t':{code:84,ch:116},'u':{code:85,ch:117},'v':{code:86,ch:118},'w':{code:87,ch:119},'x':{code:88,ch:120},'y':{code:89,ch:121},'z':{code:90,ch:122},'A':{code:65,ch:65},'B':{code:66,ch:66},'C':{code:67,ch:67},'D':{code:68,ch:68},'E':{code:69,ch:69},'F':{code:70,ch:70},'G':{code:71,ch:71},'H':{code:72,ch:72},'I':{code:73,ch:73},'J':{code:74,ch:74},'K':{code:75,ch:75},'L':{code:76,ch:76},'M':{code:77,ch:77},'N':{code:78,ch:78},'O':{code:79,ch:79},'P':{code:80,ch:80},'Q':{code:81,ch:81},'R':{code:82,ch:82},'S':{code:83,ch:83},'T':{code:84,ch:84},'U':{code:85,ch:85},'V':{code:86,ch:86},'W':{code:87,ch:87},'X':{code:88,ch:88},'Y':{code:89,ch:89},'Z':{code:90,ch:90}};class $t{static getParameter(t){return new URLSearchParams(window.location.search).get(t)??''}static setParameter(t,i){const s=new URL(window.location.toString());s.searchParams.set(t,i),window.history.pushState(null,'',s.toString())}cT=0;fT=[];uT=0;dT=null;state=0;wT=20;yT=1;AT=[];pT=0;mT=0;IT=[];ET=!0;gT=!1;_T=50;hasFocus=!0;CT=!1;TT=0;OT=0;gh=0;_h=0;bT=0;LT=0;vT=0;RT=[];ST=[];MT=0;xT=0;input=null;kT=!1;DT=!1;NT=!1;time=-1;PT=0;FT=0;UT=0;BT=0;GT=0;HT=0;constructor(t=!1){k.tabIndex=-1,D.fillStyle='black',D.fillRect(0,0,k.width,k.height),this.gT=t,this.gT?this.resize(window.innerWidth,window.innerHeight):this.resize(k.width,k.height)}get width(){return k.width}get height(){return k.height}resize=(t,i)=>{k.width=t,k.height=i,this.dT=new j(t,i),O.rs()};WT=async()=>{k.addEventListener('resize',(()=>{this.gT&&this.resize(window.innerWidth,window.innerHeight)}),!1),k.onmousedown=this.onmousedown,k.onmouseup=this.onmouseup,k.onmouseenter=this.onmouseenter,k.onmouseleave=this.onmouseleave,k.onmousemove=this.onmousemove,window.onbeforeunload=this.ns,k.onfocus=this.onfocus,k.onblur=this.onblur,this.YT?(k.ontouchstart=this.ontouchstart,k.ontouchend=this.ontouchend,k.ontouchmove=this.ontouchmove):(k.onkeydown=this.onkeydown,k.onkeyup=this.onkeyup),k.oncontextmenu=t=>{t.preventDefault()},window.oncontextmenu=t=>{t.preventDefault()},await this.VT(0,'Loading...'),await this.load();for(let t=0;t<10;t++)this.AT[t]=performance.now();let t,s=0,h=256,e=1,n=0;for(;this.state>=0;){if(this.state>0&&(this.state--,0===this.state))return void this.KT();const r=h,o=e;h=300,e=1,t=performance.now();const l=this.AT[s];if(0===l?(h=r,e=o):t>l&&(h=2560*this.wT/(t-l)|0),h<25?h=25:h>256&&(h=256,e=this.wT-(t-l)/10|0),this.AT[s]=t,s=(s+1)%10,e>1)for(let t=0;t<10;t++)0!==this.AT[t]&&(this.AT[t]+=e);for(e<this.yT&&(e=this.yT),await i(e);n<256;)await this.update(),this.bT=0,this.MT=this.xT,n+=h;n&=255,this.wT>0&&(this.pT=1e3*h/(256*this.wT)|0);const a=performance.now();if(this.ET&&this.refresh(),await this.draw(),this.IT[this.mT]=(performance.now()-a)/1e3,this.mT=(this.mT+1)%this.IT.length,this._T<50){const s=1e3/this._T-(performance.now()-t);s>0&&await i(s)}}-1===this.state&&this.KT()};KT=()=>{this.state=-2,this.ns()};XT=t=>{this.wT=1e3/t|0};jT=t=>{this._T=Math.max(Math.min(50,0|t),0)};start=()=>{this.state>=0&&(this.state=0)};stop=()=>{this.state>=0&&(this.state=4e3/this.wT|0)};destroy=()=>{this.state=-1};load=async()=>{};update=async()=>{};ns=()=>{};draw=async()=>{};refresh=()=>{};async VT(t,s){const h=this.width,e=this.height;this.ET&&(D.fillStyle='black',D.fillRect(0,0,h,e),this.ET=!1);const n=e/2-18;D.fillStyle='rgb(140, 17, 17)',D.rect((h/2|0)-152,n,304,34),D.fillRect((h/2|0)-150,n+2,3*t,30),D.fillStyle='black',D.fillRect((h/2|0)-150+3*t,n+2,300-3*t,30),D.font='bold 13px helvetica, sans-serif',D.textAlign='center',D.fillStyle='white',D.fillText(s,h/2|0,n+22),await i(5)}zT=()=>{let t=-1;return this.xT!==this.MT&&(t=this.ST[this.MT],this.MT=this.MT+1&127),t};get ms(){const t=this.IT.length;let i=0;for(let s=0;s<t;s++)i+=this.IT[s];const s=i/t*1e3;return s>this.cT&&(this.cT=s),this.fT[this.uT]=s,this.uT=(this.uT+1)%250,s}get ZT(){return this.fT.reduce(((t,i)=>t+i),0)/250}onkeydown=t=>{const i=t.key;this.TT=0;const s=qt[i];if(!s||0===t.code.length&&!t.isTrusted)return void console.warn(`Unhandled key: ${i}`);const h=s.code;let e=s.ch;t.ctrlKey&&(e>='A'.charCodeAt(0)&&e<=']'.charCodeAt(0)||e=='_'.charCodeAt(0)?e-='A'.charCodeAt(0)-1:e>='a'.charCodeAt(0)&&e<='z'.charCodeAt(0)&&(e-='a'.charCodeAt(0)-1)),e<30&&(e=0),h===qt.ArrowLeft.code?e=1:h===qt.ArrowRight.code?e=2:h===qt.ArrowUp.code?e=3:h===qt.ArrowDown.code?e=4:h===qt.Control.code?e=5:h===qt.Shift.code?e=6:h===qt.Alt.code?e=7:h===qt.Backspace.code||h===qt.Delete.code?e=8:h===qt.Tab.code?e=9:h===qt.Enter.code?e=10:h>=qt.F1.code&&h<=qt.F12.code?e=h+1008-qt.F1.code:h===qt.Home.code?e=1e3:h===qt.End.code?e=1001:h===qt.PageUp.code?e=1002:h===qt.PageDown.code&&(e=1003),e>0&&e<128&&(this.RT[e]=1),e>4&&(this.ST[this.xT]=e,this.xT=this.xT+1&127),yt.enabled&&yt.dp(e),Zt.includes(i)||t.preventDefault()};onkeyup=t=>{const i=t.key;this.TT=0;const s=qt[i];if(!s||0===t.code.length&&!t.isTrusted)return void console.warn(`Unhandled key: ${i}`);const h=s.code;let e=s.ch;e<30&&(e=0),h===qt.ArrowLeft.code?e=1:h===qt.ArrowRight.code?e=2:h===qt.ArrowUp.code?e=3:h===qt.ArrowDown.code?e=4:h===qt.Control.code?e=5:h===qt.Shift.code?e=6:h===qt.Alt.code?e=7:h===qt.Backspace.code||h===qt.Delete.code?e=8:h===qt.Tab.code?e=9:h===qt.Enter.code?e=10:h>=qt.F1.code&&h<=qt.F12.code?e=h+1008-qt.F1.code:h===qt.Home.code?e=1e3:h===qt.End.code?e=1001:h===qt.PageUp.code?e=1002:h===qt.PageDown.code&&(e=1003),e>0&&e<128&&(this.RT[e]=0),yt.enabled&&yt.wp(e),Zt.includes(i)||t.preventDefault()};onmousedown=t=>{if(this.kT=!1,(t.clientX>0||t.clientY>0)&&this.qT(t),this.TT=0,this.LT=this.gh,this.vT=this._h,this.YT&&!this.$T){if(this.JT()||this.QT()||this.tO())return this.bT=1,void(this.OT=1);t.timeStamp>=this.time+500?(this.bT=2,this.OT=2):(this.bT=1,this.OT=1)}else 2===t.button?(this.bT=2,this.OT=2):(this.bT=1,this.OT=1);yt.enabled&&yt.ap(this.LT,this.vT,t.buttons)};onmouseup=t=>{this.qT(t),this.TT=0,this.OT=0,yt.enabled&&yt.fp(t.buttons)};onmouseenter=t=>{this.qT(t),yt.enabled&&yt.pp()};onmouseleave=t=>{this.qT(t),this.TT=0,this.gh=-1,this._h=-1,this.OT=0,this.LT=-1,this.vT=-1,yt.enabled&&yt.mp()};onmousemove=t=>{this.qT(t),this.TT=0,yt.enabled&&yt.up(this.gh,this._h)};onfocus=t=>{this.hasFocus=!0,this.ET=!0,this.refresh(),yt.enabled&&yt.yp()};onblur=t=>{this.hasFocus=!1,yt.enabled&&yt.Ap()};ontouchstart=t=>{if(!this.YT)return;null!==this.input&&(this.input.parentNode?.removeChild(this.input),this.input=null),this.kT=!0;const i=t.changedTouches[0],s=0|i.clientX,h=0|i.clientY;this.onmousemove(new MouseEvent('mousemove',{clientX:s,clientY:h})),this.PT=this.GT=this.UT=0|i.screenX,this.FT=this.HT=this.BT=0|i.screenY,this.time=t.timeStamp,this.DT=this.iO(),this.NT=this.sO()};ontouchend=t=>{if(!this.YT||!this.kT)return;const i=t.changedTouches[0],s=0|i.clientX,h=0|i.clientY;if(this.onmousemove(new MouseEvent('mousemove',{clientX:s,clientY:h})),this.GT=0|i.screenX,this.HT=0|i.screenY,this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowLeft',code:'ArrowLeft'})),this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowUp',code:'ArrowUp'})),this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowRight',code:'ArrowRight'})),this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowDown',code:'ArrowDown'})),this.DT&&!this.iO())return void(this.kT=!1);if(this.NT&&!this.sO())return void(this.kT=!1);if(this.JT()||this.hO()||this.QT()||this.tO()){null!==this.input&&(this.input.parentNode?.contains(this.input)&&this.input.parentNode?.removeChild(this.input),this.input=null);const t=document.createElement('input');return this.QT()?(t.setAttribute('id','username'),t.setAttribute('placeholder','Username')):this.tO()?(t.setAttribute('id','password'),t.setAttribute('placeholder','Password')):this.JT()?(t.setAttribute('id','chatinput'),t.setAttribute('placeholder','Chatinput')):this.hO()&&(t.setAttribute('id','chatpopup'),t.setAttribute('placeholder','Chatpopup')),this.eO?t.setAttribute('type','password'):t.setAttribute('type',this.tO()?'password':'text'),t.setAttribute('autofocus','autofocus'),t.setAttribute('spellcheck','false'),t.setAttribute('autocomplete','off'),t.setAttribute('style',`position: fixed; left: ${s}px; top: ${h}px; width: 1px; height: 1px; opacity: 0;`),document.body.appendChild(t),t.focus(),t.click(),this.eO&&(t.oninput=t=>{if(!(t instanceof InputEvent))return;const i=t,s=i.data;null!==s&&'insertText'===i.inputType&&this.onkeydown(new KeyboardEvent('keydown',{key:s,code:s}))}),t.onkeydown=t=>{this.eO&&'Enter'!==t.key&&'Backspace'!==t.key||this.onkeydown(new KeyboardEvent('keydown',{key:t.key,code:t.key}))},t.onkeyup=t=>{this.eO&&'Enter'!==t.key&&'Backspace'!==t.key||this.onkeyup(new KeyboardEvent('keyup',{key:t.key,code:t.key}))},t.onfocus=t=>{this.input?.parentNode?.removeChild(this.input),this.input=null,this.onfocus(t)},this.input=t,void(this.kT=!1)}const e=t.timeStamp>=this.time+500,n=Math.abs(this.PT-this.GT)>16||Math.abs(this.FT-this.HT)>16;e&&!n?(this.kT=!0,this.onmousedown(new MouseEvent('mousedown',{buttons:2}))):(this.OT=0,this.kT=!1)};ontouchmove=t=>{if(!this.YT||!this.kT)return;const i=t.changedTouches[0],s=0|i.clientX,h=0|i.clientY;this.onmousemove(new MouseEvent('mousemove',{clientX:s,clientY:h})),this.GT=0|i.screenX,this.HT=0|i.screenY,this.DT&&-1===this.nO()?(this.UT-this.GT>0?this.rotate(2):this.UT-this.GT<0&&this.rotate(0),this.BT-this.HT>0?this.rotate(3):this.BT-this.HT<0&&this.rotate(1)):(this.NT||-1!==this.nO())&&this.onmousedown(new MouseEvent('mousedown',{buttons:1})),this.UT=this.GT,this.BT=this.HT};get YT(){return['Android','webOS','iPhone','iPad','iPod','BlackBerry','Windows Phone'].some((t=>navigator.userAgent.includes(t)))}get eO(){return['Android'].some((t=>navigator.userAgent.includes(t)))}get $T(){return['Capacitor'].some((t=>navigator.userAgent.includes(t)))}iO=()=>this.CT&&this.gh>=8&&this.gh<=520&&this._h>=11&&this._h<=345;JT=()=>this.CT&&-1===this.rO()&&!this.oO()&&!this.lO()&&this.gh>=11&&this.gh<=506&&this._h>=449&&this._h<=482;hO=()=>this.CT&&(this.oO()||this.lO())&&this.gh>=11&&this.gh<=506&&this._h>=383&&this._h<=482;sO=()=>this.CT&&this.gh>=562&&this.gh<=752&&this._h>=231&&this._h<=492;QT=()=>!this.CT&&2===this.aO()&&this.gh>=301&&this.gh<=562&&this._h>=262&&this._h<=279;tO=()=>!this.CT&&2===this.aO()&&this.gh>=301&&this.gh<=562&&this._h>=279&&this._h<=296;rotate=t=>{0===t?(this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowRight',code:'ArrowRight'})),this.onkeydown(new KeyboardEvent('keydown',{key:'ArrowLeft',code:'ArrowLeft'}))):1===t?(this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowDown',code:'ArrowDown'})),this.onkeydown(new KeyboardEvent('keydown',{key:'ArrowUp',code:'ArrowUp'}))):2===t?(this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowLeft',code:'ArrowLeft'})),this.onkeydown(new KeyboardEvent('keydown',{key:'ArrowRight',code:'ArrowRight'}))):3===t&&(this.onkeyup(new KeyboardEvent('keyup',{key:'ArrowUp',code:'ArrowUp'})),this.onkeydown(new KeyboardEvent('keydown',{key:'ArrowDown',code:'ArrowDown'})))};cO=()=>null!==document.fullscreenElement;qT=t=>{if(this.cO()){const i=t.target.getBoundingClientRect(),s=window.innerHeight/k.height,h=(window.innerWidth-k.width*s)/2;this.gh=0|this.fO(t.clientX-i.left-h,0,k.width*s,0,789),this._h=0|this.fO(t.clientY-i.top,0,k.height*s,0,532)}else{const i=k.getBoundingClientRect(),s=k.width/i.width,h=k.height/i.height;this.gh=(t.clientX-i.left)*s|0,this._h=(t.clientY-i.top)*h|0}this.gh<0&&(this.gh=0),this._h<0&&(this._h=0),this.gh>789&&(this.gh=789),this._h>532&&(this._h=532)};fO=(t,i,s,h,e)=>(t-i)*(e-h)/(s-i)+h}class Jt extends $t{static uO=225;static dO=10;static portOffset=0;static members=!0;static Bi=!1;static wO='';static yO='';static AO=!1;static pO=2;static mO=!1;static IO='https://raw.githubusercontent.com/2004scape/Server/main';static exponent=58778699976184461502525193738213253649000149147835990136706041084440742975821n;static EO=7162900525229798032761816791230527296329313291232324290237849263501208207972894053929065636522363163621000728841182238772712427862772219676577293600221789n;static gO=0;static _O=0;static CO=0;static TO=0;static OO=0;static bO=0;static LO=0;static vO=0;static RO=0;static SO=0;static MO=0;static xO=0;static kO=0;static DO=0;static NO=0;static PO=()=>{Rt.Bi=!1,O.Bi=!1,Jt.Bi=!1,xt.Bi=!1};static FO=()=>{Rt.Bi=!0,O.Bi=!0,Jt.Bi=!0,xt.Bi=!0};UO=2048;BO=2047;GO=!1;HO=!1;WO=!1;YO=!1;db=null;VO=0;KO=[];stream=null;in=a.vt(1);XO=a.vt(1);jO=a.vt(1);zO=0n;ZO=0;qO=0;$O=0;JO=null;QO=0;packetSize=0;tb=0;ib=0;sb=0;hb=null;eb=!0;nb=0;rb=0;ob=null;lb=null;ab=null;cb=null;fb=null;ub=null;wb=null;yb=null;Ab=null;pb=null;mb=null;Ib='';Eb='';username='';password='';gb=null;_b=null;Cb=null;Tb=null;Ob=[];bb=!1;Lb=null;vb=null;Rb=null;Sb=null;Mb=null;xb=null;kb=null;Db=null;Nb=null;Pb=null;Fb=new Int32Array(256);Ub=0;Bb=0;Gb=0;Hb=null;Wb=null;Yb=null;Vb=null;Kb=null;Xb=null;jb=null;zb=null;Zb=null;qb=null;$b=null;Jb=null;Qb=null;tL=null;iL=null;sL=null;hL=null;eL=null;nL=null;rL=null;oL=null;lL=new Int32Array(33);aL=new Int32Array(33);cL=new Int32Array(151);fL=new Int32Array(151);uL=null;dL=null;wL=null;yL=null;AL=null;pL=null;mL=new c(13,null);IL=null;EL=null;gL=new c(50,null);_L=new c(50,null);CL=new c(20,null);TL=new c(20,null);OL=null;bL=new c(8,null);LL=null;vL=null;RL=null;SL=null;ML=null;xL=null;kL=null;DL=null;NL=null;PL=null;FL=null;UL=null;BL=null;GL=null;HL=null;WL=null;YL=null;VL=null;KL=new c(1e3,null);XL=!1;jL=!1;zL=!1;ZL=!1;qL=-1;$L=0;JL=0;QL=0;tv=0;iv=0;sv=0;hv=!1;ev=0;nv=0;rv=0;ov=0;lv=0;av=0;cv=[];fv=-1;uv=-1;dv=new X;wv=78;yv=0;Av=0;pv=[];mv=0;Iv=0;Ev=0;gv=0;_v=0;Cv=0;Tv=0;Ov=0;bv=[];Lv=[];vv=[];Rv=[];Sv=null;Mv=-1;xv=3;kv=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];Dv=0;Nv=0;Pv=0;Fv=!1;Uv=0;Bv=!1;Gv='';Hv='';Wv=0;Yv='';Vv=!1;Kv=-1;Xv=new c(100,null);jv=new c(100,null);messageType=new Int32Array(100);zv=new Int32Array(100);Zv=0;qv=0;$v=0;Jv='';Qv=0;tR=0;iR=0;sR=0;hR=0;eR=0;nR=0;rR=0;oR=0;lR=!1;aR=0;cR=0;fR=0;uR=0;dR=null;wR=0;yR=0;AR=0;pR=0;mR=!1;IR=[];ER=[];gR=0;_R=0;CR=0;TR=null;OR=0;bR=new Int32Array(500);LR=new Int32Array(500);vR=new Int32Array(500);RR=new Int32Array(500);SR=0;MR=0;xR=0;kR='';DR=!1;NR=-1;PR=0;FR=0;UR=0;BR=0;GR=0;HR=new Int32Array(1e3);WR=new Int32Array(1e3);YR=null;VR=0;KR=0;XR=0;jR=0;zR=0;ZR=!1;qR=0;$R=0;JR=0;QR=0;tS=2;iS=2;sS=1;hS=new Int32Array(5);eS=new c(5,!1);nS=new Int32Array(5);rS=new Int32Array(5);oS=new Int32Array(5);lS=0;aS=0;cS=0;fS=0;uS=0;dS=0;wS=0;yS=0;AS=0;pS=1;mS=2;IS=-1;ph=0;Ih=0;ES=0;gS=0;_S=0;CS=0;TS=null;OS=null;bS=null;LS=0;vS=0;RS=new Int8Array(16384);SS=new c(gt.Nm,null);MS=0;xS=0;kS=128;DS=0;NS=0;PS=0;FS=0;US=0;Qg=null;t_=null;BS=new y(gt.Pm,gt.Pm);GS=0;HS=0;WS=0;YS=0;VS=0;KS=0;XS=0;jS=0;zS=0;ZS=0;qS=0;$S=0;JS=new c(this.UO,null);QS=0;tM=new Int32Array(this.UO);iM=0;sM=0;hM=new Int32Array(this.UO);eM=new Int32Array(1e3);nM=new c(this.UO,null);rM=new c(8192,null);oM=0;lM=new Int32Array(8192);aM=new o;cM=new o;fM=new o;xE=new o;uM=new u(gt.Nm,gt.Pm,gt.Pm,null);dM=new o;wM=new Int32Array(4e3);yM=new Int32Array(4e3);AM=new Int32Array(gt.Pm*gt.Pm);pM=new Int32Array(gt.Pm*gt.Pm);mM=0;IM=null;EM=0;gM=0;_M=-1;CM=0;TM=0;OM=0;bM=0;LM=!1;vM=!0;RM=!1;SM=new Int32Array(7);MM=new Int32Array(5);xM=0;kM=0;static DM=50;NM=new Int32Array(Jt.DM);PM=new Int32Array(Jt.DM);FM=new Int32Array(Jt.DM);UM=new Int32Array(Jt.DM);BM=new Int32Array(Jt.DM);GM=new Int32Array(Jt.DM);HM=new Int32Array(Jt.DM);WM=new c(Jt.DM,null);YM=new c(100,null);VM=new BigInt64Array(100);KM=new Int32Array(100);XM=null;jM=0;zM=!0;ZM=new Int32Array(50);qM=new Int32Array(50);$M=new Int32Array(50);JM=192;QM=-1;tx=-1;ix=0;sx=0;hx=0;nx=!0;ox=null;lx=0;ux=0;wx=192;yx=new c(16,null);Ax=0;mx=!1;ns=()=>{try{this.stream&&this.stream.close()}catch(t){}this.stream=null,jt(),this.XO=null,this.jO=null,this.in=null,this.bS=null,this.TS=null,this.OS=null,this.Qg=null,this.t_=null,this.YR=null,this.SS=null,this.AM=null,this.pM=null,this.wM=null,this.yM=null,this.RS=null,this.Wb=null,this.Yb=null,this.Vb=null,this.Kb=null,this.Xb=null,this.jb=null,this.zb=null,this.Zb=null,this.qb=null,this.$b=null,this.Jb=null,this.Qb=null,this.tL=null,this.iL=null,this.sL=null,this.hL=null,this.eL=null,this.uL=null,this.wL=null,this.dL=null,this.yL=null,this.AL=null,this.pL=null,this.mL=null,this.kL=null,this.DL=null,this.NL=null,this.PL=null,this.FL=null,this.UL=null,this.BL=null,this.GL=null,this.HL=null,this.WL=null,this.EL=null,this.CL=null,this.TL=null,this.bL=null,this.LL=null,this.vL=null,this.RL=null,this.SL=null,this.gL=null,this._L=null,this.BS=null,this.JS=null,this.tM=null,this.hM=null,this.nM=null,this.eM=null,this.rM=null,this.lM=null,this.uM=null,this.dM=null,this.xE=null,this.aM=null,this.cM=null,this.fM=null,this.vR=null,this.RR=null,this.bR=null,this.LR=null,this.cv=null,this.IR=null,this.HR=null,this.WR=null,this.KL=null,this.IL=null,this.YM=null,this.VM=null,this.KM=null,this.cb=null,this.fb=null,this.ob=null,this.lb=null,this.ab=null,this.ub=null,this.wb=null,this.yb=null,this.Ab=null,this.Ix(),x.ns(),H.ns(),G.ns(),St.$t=null,W.$t=null,X.$t=null,I.$t=null,Y.$t=null,Y.Fo=null,V.$t=null,this.dT=null,Ft.Fo=null,O.ns(),Rt.ns(),v.ns(),p.$t=[],m.$t=[]};aO(){return this.nb}oO(){return this.Vv}lO(){return this.Bv}rO(){return this.uv}nO(){return this.qL}Ix=()=>{this.bb=!1,this.Hb&&(clearInterval(this.Hb),this.Hb=null),this.pb=null,this.mb=null,this.Ob=[],this.kb=null,this.Db=null,this.Nb=null,this.Pb=null,this.Sb=null,this.Rb=null,this.Mb=null,this.xb=null,this.Lb=null,this.vb=null};Ex=async(t,s,h,n)=>{let r=5,o=await(this.db?.Kf(t));if(o&&a.Ot(o)!==h&&(o=void 0),o)return new zt(o);for(;!o;){await this.VT(n,`Requesting ${s}`);try{o=await e(`${Jt.yO}/${t}${h}`)}catch(t){o=void 0;for(let t=r;t>0;t--)await this.VT(n,`Error loading - Will retry in ${t} secs.`),await i(1e3);r*=2,r>60&&(r=60)}}return await(this.db?.Xf(t,o)),new zt(o)};gx=async(t,i,s)=>{let h=await(this.db?.Kf(t+'.mid'));if(h&&12345678!==i&&a.Ot(h)!==i&&(h=void 0),!h)try{h=await e(`${Jt.yO}/${t}_${i}.mid`),s!==h.length&&(h=h.slice(0,s))}catch(t){}if(!h)return;await(this.db?.Xf(t+'.mid',h));const n=new a(Uint8Array.from(h)).kt;Kt(wt.read(n,h,s,4),this.wx)};_x=()=>{if(D.fillStyle='black',D.fillRect(0,0,this.width,this.height),this.XT(1),this.WO){this.bb=!1,D.font='bold 16px helvetica, sans-serif',D.textAlign='left',D.fillStyle='yellow';let t=35;D.fillText('Sorry, an error has occured whilst loading RuneScape',30,t),t+=50,D.fillStyle='white',D.fillText('To fix this try the following (in order):',30,t),t+=50,D.font='bold 12px helvetica, sans-serif',D.fillText('1: Try closing ALL open web-browser windows, and reloading',30,t),t+=30,D.fillText('2: Try clearing your web-browsers cache from tools->internet options',30,t),t+=30,D.fillText('3: Try using a different game-world',30,t),t+=30,D.fillText('4: Try rebooting your computer',30,t),t+=30,D.fillText('5: Try selecting a different version of Java from the play-game menu',30,t)}if(this.YO&&(this.bb=!1,D.font='bold 20px helvetica, sans-serif',D.textAlign='left',D.fillStyle='white',D.fillText('Error - unable to load game!',50,50),D.fillText('To play RuneScape make sure you play from',50,100),D.fillText('https://2004scape.org',50,150)),this.HO){this.bb=!1,D.font='bold 13px helvetica, sans-serif',D.textAlign='left',D.fillStyle='yellow';let t=35;D.fillText('Error a copy of RuneScape already appears to be loaded',30,t),t+=50,D.fillStyle='white',D.fillText('To fix this try the following (in order):',30,t),t+=50,D.font='bold 12px helvetica, sans-serif',D.fillText('1: Try closing ALL open web-browser windows, and reloading',30,t),t+=30,D.fillText('2: Try rebooting your computer, and reloading',30,t)}};Cx=t=>{if(!t.yc)return!1;for(let i=0;i<t.yc.length;i++){const s=this.Tx(t,i);if(!t.Ac)return!1;const h=t.Ac[i];if(2===t.yc[i]){if(s>=h)return!1}else if(3===t.yc[i]){if(s<=h)return!1}else if(4===t.yc[i]){if(s===h)return!1}else if(s!==h)return!1}return!0};Ox=(t,i,s,h,e)=>{this.ML?.draw(t,i),this.xL?.draw(t,i+e-16),C.fillRect(t,i+16,16,e-32,B._r);let n=(e-32)*e/h|0;n<8&&(n=8);const r=(e-n-32)*s/(h-e)|0;C.fillRect(t,i+r+16,16,n,B.Cr),C.Ci(t,i+r+16,B.Tr,n),C.Ci(t+1,i+r+16,B.Tr,n),C._i(t,i+r+16,B.Tr,16),C._i(t,i+r+17,B.Tr,16),C.Ci(t+15,i+r+16,B.Or,n),C.Ci(t+14,i+r+17,B.Or,n-1),C._i(t,i+r+n+15,B.Or,16),C._i(t+1,i+r+n+14,B.Or,15)};bx=(t,i)=>{let s=!1;const h=X.$t[t];if(!h.mc)return!1;for(let t=0;t<h.mc.length&&-1!==h.mc[t];t++){const e=X.$t[h.mc[t]];if(1===e.type&&(s||=this.bx(e.id,i)),6===e.type&&(-1!==e.Mn||-1!==e.Hc)){let t;if(t=this.Cx(e)?e.Hc:e.Mn,-1!==t){const h=I.$t[t];if(e.Zc+=i,h.delay)for(;e.Zc>h.delay[e.zc];)e.Zc-=h.delay[e.zc]+1,e.zc++,e.zc>=h.ii&&(e.zc-=h.hi,(e.zc<0||e.zc>=h.ii)&&(e.zc=0)),s=!0}}}return s};Lx=(t,i,s,h,e=!1)=>{if(0!==t.type||!t.mc||t.hide&&this.Qv!==t.id&&this.tR!==t.id&&this.iR!==t.id)return;const n=C.left,r=C.top,o=C.right,l=C.bottom;C.Ii(i,s,i+t.width,s+t.height);const a=t.mc.length;for(let n=0;n<a;n++){if(!t.Ic||!t.Ec)continue;let r=t.Ic[n]+i,o=t.Ec[n]+s-h;const l=X.$t[t.mc[n]];if(r+=l.x,o+=l.y,e&&C.gi(r,o,l.width,l.height,B.lr),l.dc>0&&this.vx(l),l.type===X.Kl)l.jc>l.scroll-l.height&&(l.jc=l.scroll-l.height),l.jc<0&&(l.jc=0),this.Lx(l,r,o,l.jc,e),l.scroll>l.height&&this.Ox(r+l.width,o,l.jc,l.scroll,l.height);else if(l.type===X.jl){let t=0;for(let i=0;i<l.height;i++)for(let s=0;s<l.width;s++){if(!(l.Lc&&l.vc&&l.gc&&l._c))continue;let h=r+s*(l.Oc+32),e=o+i*(l.bc+32);if(t<20&&(h+=l.Lc[t],e+=l.vc[t]),l.gc[t]>0){let i=0,s=0;const n=l.gc[t]-1;if(h>=-32&&h<=512&&e>=-32&&e<=334||0!==this.eR&&this.hR===t){const r=G.Wo(n,l._c[t]);if(0!==this.eR&&this.hR===t&&this.sR===l.id?(i=this.gh-this.nR,s=this._h-this.rR,i<5&&i>-5&&(i=0),s<5&&s>-5&&(s=0),this.oR<5&&(i=0,s=0),r.$n(128,h+i,e+s)):0!==this.wR&&this.yR===t&&this.AR===l.id?r.$n(128,h,e):r.draw(h,e),33===r.Si||1!==l._c[t]){const n=l._c[t];this.gb?.uf(h+i+1,e+10+s,this.Rx(n),B.ar),this.gb?.uf(h+i,e+9+s,this.Rx(n),B.er)}}}else if(l.Rc&&t<20){const i=l.Rc[t];i?.draw(h,e)}t++}}else if(l.type===X.zl)l.fill?C.fillRect(r,o,l.width,l.height,l.Nc):C.gi(r,o,l.width,l.height,l.Nc);else if(l.type===X.Zl){const t=l.font;let i=l.Nc,s=l.text;if(this.iR!==l.id&&this.tR!==l.id&&this.Qv!==l.id||0===l.Fc||(i=l.Fc),this.Cx(l)&&(i=l.Pc,l.Dc&&l.Dc.length>0&&(s=l.Dc)),l.uc===X.ea&&this.mR&&(s='Please wait...',i=l.Nc),!t||!s)continue;for(let h=o+t.height;s.length>0;h+=t.height){if(-1!==s.indexOf('%')){for(;;){const t=s.indexOf('%1');if(-1===t)break;s=s.substring(0,t)+this.Sx(this.Tx(l,0))+s.substring(t+2)}for(;;){const t=s.indexOf('%2');if(-1===t)break;s=s.substring(0,t)+this.Sx(this.Tx(l,1))+s.substring(t+2)}for(;;){const t=s.indexOf('%3');if(-1===t)break;s=s.substring(0,t)+this.Sx(this.Tx(l,2))+s.substring(t+2)}for(;;){const t=s.indexOf('%4');if(-1===t)break;s=s.substring(0,t)+this.Sx(this.Tx(l,3))+s.substring(t+2)}for(;;){const t=s.indexOf('%5');if(-1===t)break;s=s.substring(0,t)+this.Sx(this.Tx(l,4))+s.substring(t+2)}}const e=s.indexOf('\\n');let n;-1!==e?(n=s.substring(0,e),s=s.substring(e+2)):(n=s,s=''),l.xc?t.pf(r+(l.width/2|0),h,n,i,l.kc):t.wf(r,h,n,i,l.kc)}}else if(l.type===X.ql){let t;t=this.Cx(l)?l.Bc:l.Uc,t?.draw(r,o)}else if(l.type===X.$l){const t=O.Ki,i=O.Xi;O.Ki=r+(l.width/2|0),O.Xi=o+(l.height/2|0);const s=O.sin[l.Wc]*l.zoom>>16,h=O.cos[l.Wc]*l.zoom>>16,e=this.Cx(l);let n;n=e?l.Hc:l.Mn;let a=null;if(-1===n)a=l.zn(-1,-1,e);else{const t=I.$t[n];t.frames&&t.si&&(a=l.zn(t.frames[l.zc],t.si[l.zc],e))}a&&a.Re(0,l.Yc,0,l.Wc,0,s,h),O.Ki=t,O.Xi=i}else if(l.type===X.Jl){const t=l.font;if(!t||!l.gc||!l._c)continue;let i=0;for(let s=0;s<l.height;s++)for(let h=0;h<l.width;h++){if(l.gc[i]>0){const e=G.get(l.gc[i]-1);let n=e.name;if((e.Qo||1!==l._c[i])&&(n=n+' x'+this.Mx(l._c[i])),!n)continue;const a=r+h*(l.Oc+115),c=o+s*(l.bc+12);l.xc?t.pf(a+(l.width/2|0),c,n,l.Nc,l.kc):t.wf(a,c,n,l.Nc,l.kc)}i++}}}C.Ii(n,r,o,l)};vx=t=>{let i=t.dc;if(i>=X.na&&i<=X.ra)i--,i>=this.xM?(t.text='',t.uc=0):(t.text=this.YM[i],t.uc=1);else if(i>=X.oa&&i<=X.la)i-=X.oa,i>=this.xM?(t.text='',t.uc=0):(0===this.KM[i]?t.text='@red@Offline':this.KM[i]===Jt.dO?t.text='@gre@World-'+(this.KM[i]-9):t.text='@yel@World-'+(this.KM[i]-9),t.uc=1);else if(i===X.fa)t.scroll=15*this.xM+20,t.scroll<=t.height&&(t.scroll=t.height+1);else if(i>=X.Ha&&i<=X.Wa)i-=X.Ha,i>=this.Av?(t.text='',t.uc=0):(t.text=K.Wl(K.Ul(this.pv[i])),t.uc=1);else if(i===X.Ka)t.scroll=15*this.Av+20,t.scroll<=t.height&&(t.scroll=t.height+1);else if(i===X.Ga){if(t.Wc=150,t.Yc=256*Math.sin(this.VO/40)&2047,this.RM){this.RM=!1;const i=new c(7,null);let s=0;for(let t=0;t<7;t++){const h=this.SM[t];h>=0&&(i[s++]=W.$t[h].zn())}const h=v.fe(i,s);for(let t=0;t<5;t++)0!==this.MM[t]&&(h.Te(Ft.MC[t][0],Ft.MC[t][this.MM[t]]),1===t&&h.Te(Ft.SC[0],Ft.SC[this.MM[t]]));if(this.IM){const i=I.$t[this.IM.O_].frames;i&&(h.me(),h.ge(i[0]),h.be(64,850,-30,-50,-30,!0),t.model=h)}}}else if(i===X.Fa)this.YL||(this.YL=t.Uc,this.VL=t.Bc),this.vM?t.Uc=this.VL:t.Uc=this.YL;else if(i===X.Ua)this.YL||(this.YL=t.Uc,this.VL=t.Bc),this.vM?t.Uc=this.YL:t.Uc=this.VL;else if(i===X.Xa)t.text=this.kR,this.VO%20<10?t.text=t.text+'|':t.text=t.text+' ';else if(i===X.nc)this.LM?this.DR?(t.Nc=B.RED,t.text='Moderator option: Mute player for 48 hours: <ON>'):(t.Nc=B.lr,t.text='Moderator option: Mute player for 48 hours: <OFF>'):t.text='';else if(i===X.rc||i===X.fc)if(0===this.PR)t.text='';else{let i;i=0===this.FR?'earlier today':1===this.FR?'yesterday':this.FR+' days ago',t.text='You last logged in '+i+' from: '+K.Hl(this.PR)}else if(i===X.oc)0===this.BR&&(t.text='0 unread messages',t.Nc=B.er),1===this.BR&&(t.text='1 unread message',t.Nc=B.GREEN),this.BR>1&&(t.text=this.BR+' unread messages',t.Nc=B.GREEN);else if(i===X.lc)if(201===this.UR)t.text='';else if(200===this.UR)t.text='You have not yet set any password recovery questions.';else{let i;i=0===this.UR?'Earlier today':1===this.UR?'Yesterday':this.UR+' days ago',t.text=i+' you changed your recovery questions'}else i===X.ac?201===this.UR?t.text='':200===this.UR?t.text='We strongly recommend you do so now to secure your account.':t.text='If you do not remember making this change then cancel it immediately':i===X.cc&&(201===this.UR?t.text='':(this.UR,t.text="Do this from the 'account management' area on our front webpage"))};Tx=(t,i)=>{if(!t.scripts||i>=t.scripts.length)return-2;try{const s=t.scripts[i];if(!s)return-1;let h=0,e=0;for(;;){const t=s[e++];if(0===t)return h;if(1===t)h+=this.Lv[s[e++]];else if(2===t)h+=this.vv[s[e++]];else if(3===t)h+=this.bv[s[e++]];else if(4===t){const t=X.$t[s[e++]],i=s[e++]+1;if(t.gc&&t._c)for(let s=0;s<t.gc.length;s++)t.gc[s]===i&&(h+=t._c[s]);else h+=0}else if(5===t)h+=this.IR[s[e++]];else if(6===t)h+=this.Rv[this.vv[s[e++]]-1];else if(7===t)h+=100*this.IR[s[e++]]/46875|0;else if(8===t)h+=this.IM?.PC||0;else if(9===t)for(let t=0;t<19;t++)18===t&&(t=20),h+=this.vv[t];else if(10===t){const t=X.$t[s[e++]],i=s[e++]+1;for(let s=0;s<t.gc.length;s++)if(t.gc[s]===i){h+=999999999;break}}else if(11===t)h+=this.EM;else if(12===t)h+=this.CM;else if(13===t){const t=this.IR[s[e++]];h+=t&1<<s[e++]?1:0}}}catch(t){return-1}};Sx=t=>t<999999999?String(t):'*';Mx=t=>{let i=String(t);for(let t=i.length-3;t>0;t-=3)i=i.substring(0,t)+','+i.substring(t);return i.length>8?i='@gre@'+i.substring(0,i.length-8)+' million @whi@('+i+')':i.length>4&&(i='@cya@'+i.substring(0,i.length-4)+'K @whi@('+i+')'),' '+i};Rx=t=>t<1e5?String(t):t<1e7?(t/1e3|0)+'K':(t/1e6|0)+'M'}class Qt extends Jt{constructor(t,i,s,h){if(super(),console.log(`RS2 user client - release #${Jt.uO}`),void 0!==t){Jt.dO=t;const i=new URL(window.location.href);Jt.wO=`${i.protocol}//${i.hostname}`,Jt.yO=`${i.protocol}//${i.hostname}:${i.port}`}void 0!==i&&(Jt.portOffset=i),void 0!==h&&(Jt.members=h),void 0!==s&&(s?Jt.FO():Jt.PO()),this.WT()}load=async()=>{if(this.YT&&Jt.Bi&&(this._T=30),this.GO)this.HO=!0;else{this.GO=!0;try{await this.VT(10,'Connecting to fileserver'),await wt.load(await(await fetch('bz2.wasm')).arrayBuffer()),this.db=new st(await st.openDatabase());const t=new a(new Uint8Array(await e(`${Jt.yO}/crc`)));for(let i=0;i<9;i++)this.KO[i]=t.kt;Jt.Bi||await this.gx('scape_main',12345678,4e4);const i=await this.Ex('title','title screen',this.KO[1],10);this.hb=i,this.gb=Z.xi(i,'p11'),this._b=Z.xi(i,'p12'),this.Cb=Z.xi(i,'b12'),this.Tb=Z.xi(i,'q8'),await this.xx(),this.kx();const s=await this.Ex('config','config',this.KO[2],15),h=await this.Ex('interface','interface',this.KO[3],20),n=await this.Ex('media','2d graphics',this.KO[4],30),r=await this.Ex('models','3d graphics',this.KO[5],40),o=await this.Ex('textures','textures',this.KO[6],60),l=await this.Ex('wordenc','chat system',this.KO[7],65),c=await this.Ex('sounds','sound effects',this.KO[8],70);this.t_=new w(gt.Nm,gt.Pm,gt.Pm),this.Qg=new A(gt.Nm,gt.Pm+1,gt.Pm+1),this.Qg&&(this.YR=new Rt(this.Qg,gt.Pm,gt.Nm,gt.Pm));for(let t=0;t<gt.Nm;t++)this.SS[t]=new gt;this.IL=new U(512,512),await this.VT(75,'Unpacking media'),this.uL=T.xi(n,'invback',0),this.dL=T.xi(n,'chatback',0),this.wL=T.xi(n,'mapback',0),this.yL=T.xi(n,'backbase1',0),this.AL=T.xi(n,'backbase2',0),this.pL=T.xi(n,'backhmid1',0);for(let t=0;t<13;t++)this.mL[t]=T.xi(n,'sideicons',t);this.EL=U.xi(n,'compass',0);try{for(let t=0;t<50;t++)22!==t&&(this.gL[t]=T.xi(n,'mapscene',t))}catch(t){}try{for(let t=0;t<50;t++)this._L[t]=U.xi(n,'mapfunction',t)}catch(t){}try{for(let t=0;t<20;t++)this.CL[t]=U.xi(n,'hitmarks',t)}catch(t){}try{for(let t=0;t<20;t++)this.TL[t]=U.xi(n,'headicons',t)}catch(t){}this.OL=U.xi(n,'mapflag',0);for(let t=0;t<8;t++)this.bL[t]=U.xi(n,'cross',t);this.LL=U.xi(n,'mapdots',0),this.vL=U.xi(n,'mapdots',1),this.RL=U.xi(n,'mapdots',2),this.SL=U.xi(n,'mapdots',3),this.ML=T.xi(n,'scrollbar',0),this.xL=T.xi(n,'scrollbar',1),this.kL=T.xi(n,'redstone1',0),this.DL=T.xi(n,'redstone2',0),this.NL=T.xi(n,'redstone3',0),this.PL=T.xi(n,'redstone1',0),this.PL?.Di(),this.FL=T.xi(n,'redstone2',0),this.FL?.Di(),this.UL=T.xi(n,'redstone1',0),this.UL?.Ni(),this.BL=T.xi(n,'redstone2',0),this.BL?.Ni(),this.GL=T.xi(n,'redstone3',0),this.GL?.Ni(),this.HL=T.xi(n,'redstone1',0),this.HL?.Di(),this.HL?.Ni(),this.WL=T.xi(n,'redstone2',0),this.WL?.Di(),this.WL?.Ni();const f=U.xi(n,'backleft1',0);this.Zb=new j(f.width,f.height),f.Qn(0,0);const u=U.xi(n,'backleft2',0);this.qb=new j(u.width,u.height),u.Qn(0,0);const d=U.xi(n,'backright1',0);this.$b=new j(d.width,d.height),d.Qn(0,0);const y=U.xi(n,'backright2',0);this.Jb=new j(y.width,y.height),y.Qn(0,0);const E=U.xi(n,'backtop1',0);this.Qb=new j(E.width,E.height),E.Qn(0,0);const g=U.xi(n,'backtop2',0);this.tL=new j(g.width,g.height),g.Qn(0,0);const _=U.xi(n,'backvmid1',0);this.iL=new j(_.width,_.height),_.Qn(0,0);const C=U.xi(n,'backvmid2',0);this.sL=new j(C.width,C.height),C.Qn(0,0);const b=U.xi(n,'backvmid3',0);this.hL=new j(b.width,b.height),b.Qn(0,0);const L=U.xi(n,'backhmid2',0);this.eL=new j(L.width,L.height),L.Qn(0,0);const R=(21*Math.random()|0)-10,S=(21*Math.random()|0)-10,M=(21*Math.random()|0)-10,k=(41*Math.random()|0)-20;for(let t=0;t<50;t++)this._L[t]&&this._L[t]?.translate(R+k,S+k,M+k),this.gL[t]&&this.gL[t]?.translate(R+k,S+k,M+k);await this.VT(80,'Unpacking textures'),O.cs(o),O.ds(.8),O.ys(20),await this.VT(83,'Unpacking models'),v.Jt(r),p.Jt(r),m.Jt(r),await this.VT(86,'Unpacking config'),I.Jt(s),x.Jt(s),St.Jt(s),G.Jt(s,Jt.members),H.Jt(s),W.Jt(s),Y.Jt(s),V.Jt(s),Jt.Bi||(await this.VT(90,'Unpacking sounds'),at.Jt(c)),await this.VT(92,'Unpacking interfaces'),X.Jt(h,n,[this.gb,this._b,this.Cb,this.Tb]),await this.VT(97,'Preparing game engine');for(let t=0;t<33;t++){let i=999,s=0;for(let h=0;h<35;h++)if(0===this.wL.di[h+t*this.wL.width])999===i&&(i=h);else if(999!==i){s=h;break}this.lL[t]=i,this.aL[t]=s-i}for(let t=9;t<160;t++){let i=999,s=0;for(let h=10;h<168;h++)if(0===this.wL.di[h+t*this.wL.width]&&(h>34||t>34))999===i&&(i=h);else if(999!==i){s=h;break}this.cL[t-9]=i-21,this.fL[t-9]=s-i}O.os(479,96),this.nL=O.Vi,O.os(190,261),this.rL=O.Vi,O.os(512,334),this.oL=O.Vi;const D=new Int32Array(9);for(let t=0;t<9;t++){const i=32*t+128+15,s=3*i+600,h=O.sin[i];D[t]=s*h>>16}Rt.init(512,334,500,800,D),nt.Jt(l),this.Dx()}catch(t){console.error(t),this.WO=!0}}};update=async()=>{this.HO||this.WO||this.YO||(this.VO++,this.CT?await this.Nx():await this.Px())};draw=async()=>{this.HO||this.WO||this.YO?this._x():(this.CT?this.Fx():await this.Ux(),this.$L=0)};refresh=()=>{this.eb=!0};VT=async(t,s)=>{if(console.log(`${t}%: ${s}`),await this.Bx(),!this.hb)return void await super.VT(t,s);this.ab?.bind();this.Cb?.mf(180,54,'RuneScape is loading - please wait...',B.lr);C.gi(28,62,304,34,B.Er),C.gi(29,63,302,32,B.ar),C.fillRect(30,64,3*t,30,B.Er),C.fillRect(30+3*t,64,300-3*t,30,B.ar),this.Cb?.mf(180,85,s,B.lr),this.ab?.draw(214,186),this.eb&&(this.eb=!1,this.bb||(this.cb?.draw(0,0),this.fb?.draw(661,0)),this.ob?.draw(128,0),this.lb?.draw(214,386),this.ub?.draw(0,265),this.wb?.draw(574,265),this.yb?.draw(128,186),this.Ab?.draw(574,186)),await i(5)};Gx=()=>{this.bb&&(this.Hx(),this.Hx(),this.Wx())};Bx=async()=>{this.ob||(this.dT=null,this.Kb=null,this.Yb=null,this.Wb=null,this.Vb=null,this.Xb=null,this.jb=null,this.zb=null,this.cb=new j(128,265),C.clear(),this.fb=new j(128,265),C.clear(),this.ob=new j(533,186),C.clear(),this.lb=new j(360,146),C.clear(),this.ab=new j(360,200),C.clear(),this.ub=new j(214,267),C.clear(),this.wb=new j(215,267),C.clear(),this.yb=new j(86,79),C.clear(),this.Ab=new j(87,79),C.clear(),this.hb&&(await this.xx(),this.kx()),this.eb=!0)};xx=async()=>{if(!this.hb)return;const t=await U.Zn(this.hb,'title');this.cb?.bind(),t.Qn(0,0),this.fb?.bind(),t.Qn(-661,0),this.ob?.bind(),t.Qn(-128,0),this.lb?.bind(),t.Qn(-214,-386),this.ab?.bind(),t.Qn(-214,-186),this.ub?.bind(),t.Qn(0,-265),this.wb?.bind(),t.Qn(-128,-186),this.yb?.bind(),t.Qn(-128,-186),this.Ab?.bind(),t.Qn(-574,-186),t.Di(),this.cb?.bind(),t.Qn(394,0),this.fb?.bind(),t.Qn(-267,0),this.ob?.bind(),t.Qn(266,0),this.lb?.bind(),t.Qn(180,-386),this.ab?.bind(),t.Qn(180,-186),this.ub?.bind(),t.Qn(394,-265),this.wb?.bind(),t.Qn(-180,-265),this.yb?.bind(),t.Qn(212,-186),this.Ab?.bind(),t.Qn(-180,-186);const i=U.xi(this.hb,'logo');this.ob?.bind(),i.draw((this.width/2|0)-(i.width/2|0)-128,18)};Yx=t=>{if(!this.Sb||!this.Rb)return;this.Sb.fill(0);for(let t=0;t<5e3;t++){const t=128*Math.random()*256|0;this.Sb[t]=256*Math.random()|0}for(let t=0;t<20;t++){for(let t=1;t<255;t++)for(let i=1;i<127;i++){const s=i+(t<<7);this.Rb[s]=(this.Sb[s-1]+this.Sb[s+1]+this.Sb[s-128]+this.Sb[s+128])/4|0}const t=this.Sb;this.Sb=this.Rb,this.Rb=t}if(t){let i=0;for(let s=0;s<t.height;s++)for(let h=0;h<t.width;h++)if(0!==t.di[i++]){const i=h+t.vi+16+(s+t.Ri+16<<7);this.Sb[i]=0}}};kx=()=>{if(this.hb){this.pb=T.xi(this.hb,'titlebox'),this.mb=T.xi(this.hb,'titlebutton');for(let t=0;t<12;t++)this.Ob[t]=T.xi(this.hb,'runes',t);this.Lb=new U(128,265),this.vb=new U(128,265),this.cb&&n(this.cb.di,0,this.Lb.di,0,33920),this.fb&&n(this.fb.di,0,this.vb.di,0,33920),this.Db=new Int32Array(256);for(let t=0;t<64;t++)this.Db[t]=262144*t;for(let t=0;t<64;t++)this.Db[t+64]=1024*t+B.RED;for(let t=0;t<64;t++)this.Db[t+128]=4*t+B.er;for(let t=0;t<64;t++)this.Db[t+192]=B.lr;this.Nb=new Int32Array(256);for(let t=0;t<64;t++)this.Nb[t]=1024*t;for(let t=0;t<64;t++)this.Nb[t+64]=4*t+B.GREEN;for(let t=0;t<64;t++)this.Nb[t+128]=262144*t+B.nr;for(let t=0;t<64;t++)this.Nb[t+192]=B.lr;this.Pb=new Int32Array(256);for(let t=0;t<64;t++)this.Pb[t]=4*t;for(let t=0;t<64;t++)this.Pb[t+64]=262144*t+B.BLUE;for(let t=0;t<64;t++)this.Pb[t+128]=1024*t+B.rr;for(let t=0;t<64;t++)this.Pb[t+192]=B.lr;this.kb=new Int32Array(256),this.Sb=new Int32Array(32768),this.Rb=new Int32Array(32768),this.Yx(null),this.Mb=new Int32Array(32768),this.xb=new Int32Array(32768),this.VT(10,'Connecting to fileserver').then((()=>{this.bb||(this.bb=!0,this.Hb=setInterval(this.Gx,35))}))}};Px=async()=>{if(0===this.nb){let t=(this.width/2|0)-80,i=20+(this.height/2|0);i+=20,1===this.bT&&this.LT>=t-75&&this.LT<=t+75&&this.vT>=i-20&&this.vT<=i+20&&(this.nb=3,this.rb=0),t=80+(this.width/2|0),1===this.bT&&this.LT>=t-75&&this.LT<=t+75&&this.vT>=i-20&&this.vT<=i+20&&(this.Ib='',this.Eb='Enter your username & password.',this.nb=2,this.rb=0)}else if(2===this.nb){let t=(this.height/2|0)-40;t+=30,t+=25,1===this.bT&&this.vT>=t-15&&this.vT<t&&(this.rb=0),t+=15,1===this.bT&&this.vT>=t-15&&this.vT<t&&(this.rb=1);let i=(this.width/2|0)-80,s=50+(this.height/2|0);for(s+=20,1===this.bT&&this.LT>=i-75&&this.LT<=i+75&&this.vT>=s-20&&this.vT<=s+20&&await this.Vx(this.username,this.password,!1),i=80+(this.width/2|0),1===this.bT&&this.LT>=i-75&&this.LT<=i+75&&this.vT>=s-20&&this.vT<=s+20&&(this.nb=0,this.username='',this.password='');;){const t=this.zT();if(-1===t)return;let i=!1;for(let s=0;s<Z.sf.length;s++)if(String.fromCharCode(t)===Z.sf.charAt(s)){i=!0;break}0===this.rb?(8===t&&this.username.length>0&&(this.username=this.username.substring(0,this.username.length-1)),9!==t&&10!==t&&13!==t||(this.rb=1),i&&(this.username=this.username+String.fromCharCode(t)),this.username.length>12&&(this.username=this.username.substring(0,12))):1===this.rb&&(8===t&&this.password.length>0&&(this.password=this.password.substring(0,this.password.length-1)),9!==t&&10!==t&&13!==t||(this.rb=0),i&&(this.password=this.password+String.fromCharCode(t)),this.password.length>20&&(this.password=this.password.substring(0,20)))}}else if(3===this.nb){const t=this.width/2|0;let i=50+(this.height/2|0);i+=20,1===this.bT&&this.LT>=t-75&&this.LT<=t+75&&this.vT>=i-20&&this.vT<=i+20&&(this.nb=0)}};Ux=async()=>{await this.Bx(),this.ab?.bind(),this.pb?.draw(0,0);if(0===this.nb){let t=180,i=80;this.Cb?.pf(t,i,'Welcome to RuneScape',B.er,!0),t=100,i=120,this.mb?.draw(t-73,i-20),this.Cb?.pf(t,i+5,'New user',B.lr,!0),t=260,this.mb?.draw(t-73,i-20),this.Cb?.pf(t,i+5,'Existing User',B.lr,!0)}else if(2===this.nb){let t=100,i=60;this.Ib.length>0?(this.Cb?.pf(180,i-15,this.Ib,B.er,!0),this.Cb?.pf(180,i,this.Eb,B.er,!0),i+=30):(this.Cb?.pf(180,i-7,this.Eb,B.er,!0),i+=30),this.Cb?.wf(90,i,`Username: ${this.username}${0===this.rb&&this.VO%40<20?'@yel@|':''}`,B.lr,!0),i+=15,this.Cb?.wf(92,i,`Password: ${K.Gl(this.password)}${1===this.rb&&this.VO%40<20?'@yel@|':''}`,B.lr,!0),i=150,this.mb?.draw(t-73,i-20),this.Cb?.pf(t,i+5,'Login',B.lr,!0),t=260,this.mb?.draw(t-73,i-20),this.Cb?.pf(t,i+5,'Cancel',B.lr,!0)}else if(3===this.nb){this.Cb?.pf(180,40,'Create a free account',B.er,!0);const t=180;let i=65;this.Cb?.pf(180,i,'To create a new account you need to',B.lr,!0),i+=15,this.Cb?.pf(180,i,'go back to the main RuneScape webpage',B.lr,!0),i+=15,this.Cb?.pf(180,i,"and choose the red 'create account'",B.lr,!0),i+=15,this.Cb?.pf(180,i,'button at the top right of that page.',B.lr,!0),i=150,this.mb?.draw(t-73,i-20),this.Cb?.pf(t,i+5,'Cancel',B.lr,!0)}this.ab?.draw(214,186),this.eb&&(this.eb=!1,this.ob?.draw(128,0),this.lb?.draw(214,386),this.ub?.draw(0,265),this.wb?.draw(574,265),this.yb?.draw(128,186),this.Ab?.draw(574,186))};Vx=async(t,s,h)=>{try{h||(this.Ib='',this.Eb='Connecting to server...',await this.Ux()),this.stream=new q(await q.Rf({host:Jt.wO,port:43594+Jt.portOffset})),await(this.stream?.xf(this.in.data,0,8)),this.in.bt=0,this.zO=this.in.Dt;const e=new Int32Array([Math.floor(99999999*Math.random()),Math.floor(99999999*Math.random()),Number(this.zO>>32n),Number(this.zO&BigInt(4294967295))]);this.XO.bt=0,this.XO.p1(10),this.XO.p4(e[0]),this.XO.p4(e[1]),this.XO.p4(e[2]),this.XO.p4(e[3]),this.XO.p4(0),this.XO.Vt(t),this.XO.Vt(s),this.XO.qt(Jt.EO,Jt.exponent),this.jO.bt=0,h?this.jO.p1(18):this.jO.p1(16),this.jO.p1(this.XO.bt+36+1+1),this.jO.p1(Jt.uO),this.jO.p1(Jt.Bi?1:0);for(let t=0;t<9;t++)this.jO.p4(this.KO[t]);this.jO.Kt(this.XO.data,this.XO.bt,0),this.XO.random=new it(e);for(let t=0;t<4;t++)e[t]+=50;this.JO=new it(e),this.stream?.write(this.jO.data,this.jO.bt);const n=await this.stream.read();if(1===n)return await i(2e3),void await this.Vx(t,s,h);if(2===n||18===n){this.LM=18===n,yt.lp(),this.CT=!0,this.XO.bt=0,this.in.bt=0,this.QO=-1,this.tb=-1,this.ib=-1,this.sb=-1,this.packetSize=0,this.ZO=0,this.$O=0,this.qO=0,this.mv=0,this.av=0,this.hv=!1,this.TT=0;for(let t=0;t<100;t++)this.Xv[t]=null;this.aR=0,this.gR=0,this.VR=0,this.jM=0,this.$R=(100*Math.random()|0)-50,this.JR=(110*Math.random()|0)-55,this.QR=(80*Math.random()|0)-40,this.yS=(120*Math.random()|0)-60,this.AS=(30*Math.random()|0)-20,this.DS=(20*Math.random()|0)-10&2047,this.IS=-1,this.jR=0,this.zR=0,this.QS=0,this.oM=0;for(let t=0;t<this.UO;t++)this.JS[t]=null,this.nM[t]=null;for(let t=0;t<8192;t++)this.rM[t]=null;this.IM=this.JS[this.BO]=new Ft,this.aM.clear(),this.cM.clear(),this.xE.clear();for(let t=0;t<gt.Nm;t++)for(let i=0;i<gt.Pm;i++)for(let s=0;s<gt.Pm;s++)this.uM[t][i][s]=null;this.dM=new o,this.xM=0,this.Kv=-1,this.uv=-1,this.qL=-1,this.fv=-1,this.mR=!1,this.xv=3,this.Vv=!1,this.hv=!1,this.Bv=!1,this.Sv=null,this.gM=0,this.Mv=-1,this.vM=!0,this.Kx();for(let t=0;t<5;t++)this.MM[t]=0;return jt(),Jt.LO=0,Jt.vO=0,Jt.RO=0,Jt.SO=0,Jt.MO=0,Jt.xO=0,Jt.kO=0,Jt.DO=0,Jt.NO=0,void this.Xx()}if(3===n)return this.Ib='',void(this.Eb='Invalid username or password.');if(4===n)return this.Ib='Your account has been disabled.',void(this.Eb='Please check your message-centre for details.');if(5===n)return this.Ib='Your account is already logged in.',void(this.Eb='Try again in 60 secs...');if(6===n)return this.Ib='RuneScape has been updated!',void(this.Eb='Please reload this page.');if(7===n)return this.Ib='This world is full.',void(this.Eb='Please use a different world.');if(8===n)return this.Ib='Unable to connect.',void(this.Eb='Login server offline.');if(9===n)return this.Ib='Login limit exceeded.',void(this.Eb='Too many connections from your address.');if(10===n)return this.Ib='Unable to connect.',void(this.Eb='Bad session id.');if(11===n)return this.Eb='Login server rejected session.',void(this.Eb='Please try again.');if(12===n)return this.Ib='You need a members account to login to this world.',void(this.Eb='Please subscribe, or use a different world.');if(13===n)return this.Ib='Could not complete login.',void(this.Eb='Please try using a different world.');if(14===n)return this.Ib='The server is being updated.',void(this.Eb='Please wait 1 minute and try again.');if(15===n)return this.CT=!0,this.XO.bt=0,this.in.bt=0,this.QO=-1,this.tb=-1,this.ib=-1,this.sb=-1,this.packetSize=0,this.ZO=0,this.$O=0,this.av=0,void(this.hv=!1);if(16===n)return this.Ib='Login attempts exceeded.',void(this.Eb='Please wait 1 minute and try again.');17===n&&(this.Ib='You are standing in a members-only area.',this.Eb='To play on this world move to a free area first')}catch(t){console.log(t),this.Ib='',this.Eb='Error connecting to server.'}};Nx=async()=>{if(null!==this.JS){this.$O>1&&this.$O--,this.qO>0&&this.qO--;for(let t=0;t<5&&await this.read();t++);if(this.CT){for(let t=0;t<this.jM;t++)if(this.$M[t]<=0){try{const i=at.uA(this.ZM[t],this.qM[t]);if(!i)throw new Error;Date.now()+(i.bt/22|0)>this.sx+(this.ix/22|0)&&(this.ix=i.bt,this.sx=Date.now(),this.QM=this.ZM[t],this.tx=this.qM[t],await Yt(i.data.slice(0,i.bt),this.JM))}catch(t){console.error(t)}this.jM--;for(let i=t;i<this.jM;i++)this.ZM[i]=this.ZM[i+1],this.qM[i]=this.qM[i+1],this.$M[i]=this.$M[i+1];t--}else this.$M[t]--;this.hx>0&&(this.hx-=20,this.hx<0&&(this.hx=0),0===this.hx&&this.nx&&!Jt.Bi&&this.ox&&await this.gx(this.ox,this.lx,this.ux));const t=yt.flush();if(t&&(this.XO.Bt(et.Ad),this.XO.p2(t.bt),this.XO.Kt(t.data,t.bt,0),t.release()),this.ZO++,this.ZO>750&&await this.jx(),this.zx(),this.Zx(),this.qx(),this.$x(),(1===this.RT[1]||1===this.RT[2]||1===this.RT[3]||1===this.RT[4])&&this.xS++>5&&(this.xS=0,this.XO.Bt(et.pd),this.XO.p2(this.kS),this.XO.p2(this.DS),this.XO.p1(this.yS),this.XO.p1(this.AS)),this.KR++,0!==this.JL&&(this.QL+=20,this.QL>=400&&(this.JL=0)),0!==this.wR&&(this.pR++,this.pR>=15&&(2===this.wR&&(this.XL=!0),3===this.wR&&(this.jL=!0),this.wR=0)),0!==this.eR&&(this.oR++,(this.gh>this.nR+5||this.gh<this.nR-5||this._h>this.rR+5||this._h<this.rR-5)&&(this.lR=!0),0===this.OT)){if(2===this.eR&&(this.XL=!0),3===this.eR&&(this.jL=!0),this.eR=0,this.lR&&this.oR>=5){if(this.SR=-1,this.Jx(),this.SR===this.sR&&this.MR!==this.hR){const t=X.$t[this.sR];if(t.gc){const i=t.gc[this.MR];t.gc[this.MR]=t.gc[this.hR],t.gc[this.hR]=i}if(t._c){const i=t._c[this.MR];t._c[this.MR]=t._c[this.hR],t._c[this.hR]=i}this.XO.Bt(et.bw),this.XO.p2(this.sR),this.XO.p2(this.hR),this.XO.p2(this.MR)}}else(1===this.OR||this.Qx(this.av-1))&&this.av>2?this.tk():this.av>0&&await this.ik(this.av-1);this.pR=10,this.bT=0}if(Jt.CO++,Jt.CO>127&&(Jt.CO=0,this.XO.Bt(et.Rd),this.XO.p3(4991788)),-1!==Rt.OE&&this.IM){const t=Rt.OE,i=Rt.bE,s=this.sk(this.IM.uC[0],this.IM.dC[0],t,i,0,0,0,0,0,0,!0);Rt.OE=-1,s&&(this.tv=this.LT,this.iv=this.vT,this.JL=1,this.QL=0)}1===this.bT&&this.Sv&&(this.Sv=null,this.jL=!0,this.bT=0),await this.hk(),this.ek(),this.nk(),this.rk(),1!==this.OT&&1!==this.bT||this.$L++,2===this.VR&&(Jt.mO?this.lk():this.ak()),2===this.VR&&this.ZR&&this.ck();for(let t=0;t<5;t++)this.hS[t]++;if(await this.fk(),this.TT++,this.TT>4500&&(this.qO=250,this.TT-=500,this.XO.Bt(et.yd)),this.qR++,this.qR>500){this.qR=0;const t=8*Math.random()|0;1&~t||(this.$R+=this.tS),2&~t||(this.JR+=this.iS),4&~t||(this.QR+=this.sS)}if(this.$R<-50&&(this.tS=2),this.$R>50&&(this.tS=-2),this.JR<-55&&(this.iS=2),this.JR>55&&(this.iS=-2),this.QR<-40&&(this.sS=1),this.QR>40&&(this.sS=-1),this.wS++,this.wS>500){this.wS=0;const t=8*Math.random()|0;1&~t||(this.yS+=this.mS),2&~t||(this.AS+=this.pS)}this.yS<-60&&(this.mS=2),this.yS>60&&(this.mS=-2),this.AS<-20&&(this.pS=1),this.AS>10&&(this.pS=-1),Jt.TO++,Jt.TO>110&&(Jt.TO=0,this.XO.Bt(et.Sd),this.XO.p4(0)),this.TM++,this.TM>50&&this.XO.Bt(et.wd);try{this.stream&&this.XO.bt>0&&(this.stream.write(this.XO.data,this.XO.bt),this.XO.bt=0,this.TM=0)}catch(t){console.log(t),await this.jx()}}}};Fx=()=>{if(null===this.JS)return;this.eb&&(this.eb=!1,this.Zb?.draw(0,11),this.qb?.draw(0,375),this.$b?.draw(729,5),this.Jb?.draw(752,231),this.Qb?.draw(0,0),this.tL?.draw(561,0),this.iL?.draw(520,11),this.sL?.draw(520,231),this.hL?.draw(501,375),this.eL?.draw(0,345),this.XL=!0,this.jL=!0,this.zL=!0,this.ZL=!0,2!==this.VR&&(this.Vb?.draw(8,11),this.Yb?.draw(561,5))),2===this.VR&&this.uk(),this.hv&&1===this.ev&&(this.XL=!0);let t=!1;if(-1!==this.fv&&(t=this.bx(this.fv,this.KR),t&&(this.XL=!0)),2===this.wR&&(this.XL=!0),2===this.eR&&(this.XL=!0),this.XL&&(this.dk(),this.XL=!1),-1===this.uv){this.dv.jc=this.wv-this.yv-77,this.gh>453&&this.gh<565&&this._h>350&&this.wk(this.gh-22,this._h-375,this.wv,77,!1,463,0,this.dv);let t=this.wv-this.dv.jc-77;t<0&&(t=0),t>this.wv-77&&(t=this.wv-77),this.yv!==t&&(this.yv=t,this.jL=!0)}-1!==this.uv&&(t=this.bx(this.uv,this.KR),t&&(this.jL=!0)),3===this.wR&&(this.jL=!0),3===this.eR&&(this.jL=!0),this.Sv&&(this.jL=!0),this.hv&&2===this.ev&&(this.jL=!0),this.jL&&(this.yk(),this.jL=!1),2===this.VR&&(this.Ak(),this.Yb?.draw(561,5)),-1!==this.Mv&&(this.zL=!0),this.zL&&(-1!==this.Mv&&this.Mv===this.xv&&(this.Mv=-1,this.XO.Bt(et._w),this.XO.p1(this.xv)),this.zL=!1,this.zb?.bind(),this.pL?.draw(0,0),-1===this.fv&&(-1!==this.kv[this.xv]&&(0===this.xv?this.kL?.draw(29,30):1===this.xv?this.DL?.draw(59,29):2===this.xv?this.DL?.draw(87,29):3===this.xv?this.NL?.draw(115,29):4===this.xv?this.FL?.draw(156,29):5===this.xv?this.FL?.draw(184,29):6===this.xv&&this.PL?.draw(212,30)),-1!==this.kv[0]&&(0!==this.Mv||this.VO%20<10)&&this.mL[0]?.draw(35,34),-1!==this.kv[1]&&(1!==this.Mv||this.VO%20<10)&&this.mL[1]?.draw(59,32),-1!==this.kv[2]&&(2!==this.Mv||this.VO%20<10)&&this.mL[2]?.draw(86,32),-1!==this.kv[3]&&(3!==this.Mv||this.VO%20<10)&&this.mL[3]?.draw(121,33),-1!==this.kv[4]&&(4!==this.Mv||this.VO%20<10)&&this.mL[4]?.draw(157,34),-1!==this.kv[5]&&(5!==this.Mv||this.VO%20<10)&&this.mL[5]?.draw(185,32),-1!==this.kv[6]&&(6!==this.Mv||this.VO%20<10)&&this.mL[6]?.draw(212,34)),this.zb?.draw(520,165),this.jb?.bind(),this.AL?.draw(0,0),-1===this.fv&&(-1!==this.kv[this.xv]&&(7===this.xv?this.UL?.draw(49,0):8===this.xv?this.BL?.draw(81,0):9===this.xv?this.BL?.draw(108,0):10===this.xv?this.GL?.draw(136,1):11===this.xv?this.WL?.draw(178,0):12===this.xv?this.WL?.draw(205,0):13===this.xv&&this.HL?.draw(233,0)),-1!==this.kv[8]&&(8!==this.Mv||this.VO%20<10)&&this.mL[7]?.draw(80,2),-1!==this.kv[9]&&(9!==this.Mv||this.VO%20<10)&&this.mL[8]?.draw(107,3),-1!==this.kv[10]&&(10!==this.Mv||this.VO%20<10)&&this.mL[9]?.draw(142,4),-1!==this.kv[11]&&(11!==this.Mv||this.VO%20<10)&&this.mL[10]?.draw(179,2),-1!==this.kv[12]&&(12!==this.Mv||this.VO%20<10)&&this.mL[11]?.draw(206,2),-1!==this.kv[13]&&(13!==this.Mv||this.VO%20<10)&&this.mL[12]?.draw(230,2)),this.jb?.draw(501,492),this.Vb?.bind()),this.ZL&&(this.ZL=!1,this.Xb?.bind(),this.yL?.draw(0,0),this._b?.pf(57,33,'Public chat',B.lr,!0),0===this.Dv&&this._b?.pf(57,46,'On',B.GREEN,!0),1===this.Dv&&this._b?.pf(57,46,'Friends',B.er,!0),2===this.Dv&&this._b?.pf(57,46,'Off',B.RED,!0),3===this.Dv&&this._b?.pf(57,46,'Hide',B.nr,!0),this._b?.pf(186,33,'Private chat',B.lr,!0),0===this.Nv&&this._b?.pf(186,46,'On',B.GREEN,!0),1===this.Nv&&this._b?.pf(186,46,'Friends',B.er,!0),2===this.Nv&&this._b?.pf(186,46,'Off',B.RED,!0),this._b?.pf(326,33,'Trade/duel',B.lr,!0),0===this.Pv&&this._b?.pf(326,46,'On',B.GREEN,!0),1===this.Pv&&this._b?.pf(326,46,'Friends',B.er,!0),2===this.Pv&&this._b?.pf(326,46,'Off',B.RED,!0),this._b?.pf(462,38,'Report abuse',B.lr,!0),this.Xb?.draw(0,471),this.Vb?.bind()),this.KR=0};uk=()=>{if(this.XR++,this.pk(),this.mk(),this.Ik(),this.Ek(),this.gk(),!this.ZR){let t=this.kS;(this.dS/256|0)>t&&(t=this.dS/256|0),this.eS[4]&&this.rS[4]+128>t&&(t=this.rS[4]+128);const i=this.DS+this.QR&2047;if(this.IM&&this._k(this.FS,this.Ck(this.MS,this.IM.x,this.IM.z)-50,this.US,i,t,3*t+600),Jt._O++,Jt._O>1802){Jt._O=0,this.XO.Bt(et.vd),this.XO.p1(0);const t=this.XO.bt;this.XO.p2(29711),this.XO.p1(70),this.XO.p1(256*Math.random()|0),this.XO.p1(242),this.XO.p1(186),this.XO.p1(39),this.XO.p1(61),2*Math.random()|0||this.XO.p1(13),2*Math.random()|0||this.XO.p2(57856),this.XO.p2(65536*Math.random()|0),this.XO.Xt(this.XO.bt-t)}}let t;t=this.ZR?this.Tk():this.Ok();const i=this.lS,s=this.aS,h=this.cS,e=this.fS,n=this.uS;let r;for(let t=0;t<5;t++)this.eS[t]&&(r=Math.random()*(2*this.nS[t]+1)-this.nS[t]+Math.sin(this.hS[t]*(this.oS[t]/100))*this.rS[t]|0,0===t&&(this.lS+=r),1===t&&(this.aS+=r),2===t&&(this.cS+=r),3===t&&(this.uS=this.uS+r&2047),4===t&&(this.fS+=r,this.fS<128&&(this.fS=128),this.fS>383&&(this.fS=383)));r=O.Ji,v.Eh=!0,v.Ch=0,v.gh=this.gh-8,v._h=this._h-11,C.clear(),this.YR?.draw(this.lS,this.aS,this.cS,t,this.uS,this.fS,this.VO),this.YR?.ng(),this.bk(),this.Lk(),Jt.AO&&this.vk(),this.Rk(r),this.Sk(),this.Vb?.draw(8,11),this.lS=i,this.aS=s,this.cS=h,this.fS=e,this.uS=n};Mk=()=>{x.pn?.clear(),x.mn?.clear(),H.Fo?.clear(),G.Fo?.clear(),G.Uo?.clear(),Ft.Fo?.clear(),Y.Fo?.clear()};xk=(t,i)=>{this.kk(t.x,i,t.z)};kk=(t,i,s)=>{if(t<128||s<128||t>13056||s>13056)return this.GS=-1,void(this.HS=-1);const h=this.Ck(this.MS,t,s)-i;this.Dk(t,h,s)};Dk=(t,i,s)=>{let h=t-this.lS,e=i-this.aS,n=s-this.cS;const r=O.sin[this.fS],o=O.cos[this.fS],l=O.sin[this.uS],a=O.cos[this.uS];let c=n*l+h*a>>16;n=n*a-h*l>>16,h=c,c=e*o-n*r>>16,n=e*r+n*o>>16,e=c,n>=50?(this.GS=O.Ki+((h<<9)/n|0),this.HS=O.Xi+((e<<9)/n|0)):(this.GS=-1,this.HS=-1)};bk=()=>{this.kM=0;for(let t=-1;t<this.QS+this.oM;t++){let i=null;if(i=-1===t?this.IM:t<this.QS?this.JS[this.tM[t]]:this.rM[this.lM[t-this.QS]],i&&i.isVisible()){if(t<this.QS){let s=30;const h=i;if(0!==h.kC&&(this.xk(i,i.height+15),this.GS>-1))for(let t=0;t<8;t++)h.kC&1<<t&&(this.TL[t]?.draw(this.GS-12,this.HS-s),s-=25);t>=0&&10===this.mv&&this._v===this.tM[t]&&(this.xk(i,i.height+15),this.GS>-1&&this.TL[7]?.draw(this.GS-12,this.HS-s))}else 1===this.mv&&this.Iv===this.lM[t-this.QS]&&this.VO%20<10&&(this.xk(i,i.height+15),this.GS>-1&&this.TL[2]?.draw(this.GS-12,this.HS-28));if(i.x_&&(t>=this.QS||0===this.Dv||3===this.Dv||1===this.Dv&&this.Nk(i.name))&&(this.xk(i,i.height),this.GS>-1&&this.kM<Jt.DM&&this.Cb&&(this.UM[this.kM]=this.Cb.Af(i.x_)/2|0,this.FM[this.kM]=this.Cb.height,this.NM[this.kM]=this.GS,this.PM[this.kM]=this.HS,this.BM[this.kM]=i.D_,this.GM[this.kM]=i.N_,this.HM[this.kM]=i.k_,this.WM[this.kM++]=i.x_,0===this.$v&&1===i.N_&&(this.FM[this.kM]+=10,this.PM[this.kM]+=5),0===this.$v&&2===i.N_&&(this.UM[this.kM]=60))),i.U_>this.VO+100&&(this.xk(i,i.height+15),this.GS>-1)){let t=30*i.B_/i.G_|0;t>30&&(t=30),C.fillRect(this.GS-15,this.HS-3,t,5,B.GREEN),C.fillRect(this.GS-15+t,this.HS-3,30-t,5,B.RED)}if(i.U_>this.VO+330&&(this.xk(i,i.height/2|0),this.GS>-1&&(this.CL[i.F_]?.draw(this.GS-12,this.HS-12),this.gb?.mf(this.GS,this.HS+4,i.P_.toString(),B.ar),this.gb?.mf(this.GS-1,this.HS+3,i.P_.toString(),B.lr))),Jt.AO){if(i.pathLength>0||i.lC>=this.VO||i.aC>this.VO){const t=64*i.size;this.Pk(128*i.uC[0]+t,128*i.dC[0]+t,this.MS,i.size,65535,!1)}this.Pk(i.x,i.z,this.MS,i.size,6710886,!1);let s=0;if(this.xk(i,i.height+30),t<this.QS){const t=i;if(this.gb?.mf(this.GS,this.HS+s,t.name,B.lr),s-=15,-1!==t.AC&&this.VO-t.pC<30){if((t.AC&Ft.EC)===Ft.EC&&(this.gb?.mf(this.GS,this.HS+s,'Appearance Update',B.lr),s-=15),(t.AC&Ft.gC)===Ft.gC&&(this.gb?.mf(this.GS,this.HS+s,'Play Seq: '+t.j_,B.lr),s-=15),(t.AC&Ft._C)===Ft._C){let i=t.H_;i>32767&&(i-=32768),this.gb?.mf(this.GS,this.HS+s,'Face Entity: '+i,B.lr),s-=15}(t.AC&Ft.CC)===Ft.CC&&(this.gb?.mf(this.GS,this.HS+s,'Say',B.lr),s-=15),(t.AC&Ft.TC)===Ft.TC&&(this.gb?.mf(this.GS,this.HS+s,'Hit: Type '+t.F_+' Amount '+t.P_+' HP '+t.B_+'/'+t.G_,B.lr),s-=15),(t.AC&Ft.OC)===Ft.OC&&(this.gb?.mf(this.GS,this.HS+s,'Face Coord: '+t.mC/2+' '+t.IC/2,B.lr),s-=15),(t.AC&Ft.bC)===Ft.bC&&(this.gb?.mf(this.GS,this.HS+s,'Chat',B.lr),s-=15),(t.AC&Ft.vC)===Ft.vC&&(this.gb?.mf(this.GS,this.HS+s,'Play Spotanim: '+t.Q_,B.lr),s-=15),(t.AC&Ft.RC)===Ft.RC&&(this.gb?.mf(this.GS,this.HS+s,'Exact Move',B.lr),s-=15)}}else{const t=i;let s=0;if(this.xk(i,i.height+30),this.gb?.mf(this.GS,this.HS+s,t.type?.name??null,B.lr),s-=15,-1!==t.AC&&this.VO-t.pC<30){if((t.AC&Ut.gC)===Ut.gC&&(this.gb?.mf(this.GS,this.HS+s,'Play Seq: '+t.j_,B.lr),s-=15),(t.AC&Ut._C)===Ut._C){let i=t.H_;i>32767&&(i-=32768),this.gb?.mf(this.GS,this.HS+s,'Face Entity: '+i,B.lr),s-=15}(t.AC&Ut.CC)===Ut.CC&&(this.gb?.mf(this.GS,this.HS+s,'Say',B.lr),s-=15),(t.AC&Ut.TC)===Ut.TC&&(this.gb?.mf(this.GS,this.HS+s,'Hit: Type '+t.F_+' Amount '+t.P_+' HP '+t.B_+'/'+t.G_,B.lr),s-=15),(t.AC&Ut.VC)===Ut.VC&&(this.gb?.mf(this.GS,this.HS+s,'Change Type: '+t.type?.id??null,B.lr),s-=15),(t.AC&Ut.vC)===Ut.vC&&(this.gb?.mf(this.GS,this.HS+s,'Play Spotanim: '+t.Q_,B.lr),s-=15),(t.AC&Ut.OC)===Ut.OC&&(this.gb?.mf(this.GS,this.HS+s,'Face Coord: '+t.mC/2+' '+t.IC/2,B.lr),s-=15)}}}}}if(Jt.AO)for(let t=0;t<this.yx.length;t++){const i=this.yx[t];!i||i.level!==this.MS||i.x<0||i.z<0||i.x>=104||i.z>=104||this.Pk(128*i.x+64,128*i.z+64,i.level,1,16776960,!1)}for(let t=0;t<this.kM;t++){const i=this.NM[t];let s=this.PM[t];const h=this.UM[t],e=this.FM[t];let n=!0;for(;n;){n=!1;for(let r=0;r<t;r++)s+2>this.PM[r]-this.FM[r]&&s-e<this.PM[r]+2&&i-h<this.NM[r]+this.UM[r]&&i+h>this.NM[r]-this.UM[r]&&this.PM[r]-this.FM[r]<s&&(s=this.PM[r]-this.FM[r],n=!0)}this.GS=this.NM[t],this.HS=this.PM[t]=s;const r=this.WM[t];if(0===this.$v){let i=B.er;if(this.BM[t]<6&&(i=B.vr[this.BM[t]]),6===this.BM[t]&&(i=this.XR%20<10?B.RED:B.er),7===this.BM[t]&&(i=this.XR%20<10?B.BLUE:B.nr),8===this.BM[t]&&(i=this.XR%20<10?45056:8454016),9===this.BM[t]){const s=150-this.HM[t];s<50?i=1280*s+B.RED:s<100?i=B.er-327680*(s-50):s<150&&(i=5*(s-100)+B.GREEN)}if(10===this.BM[t]){const s=150-this.HM[t];s<50?i=5*s+B.RED:s<100?i=B.rr-327680*(s-50):s<150&&(i=327680*(s-100)+B.BLUE-5*(s-100))}if(11===this.BM[t]){const s=150-this.HM[t];s<50?i=B.lr-327685*s:s<100?i=327685*(s-50)+B.GREEN:s<150&&(i=B.lr-327680*(s-100))}if(0===this.GM[t]&&(this.Cb?.mf(this.GS,this.HS+1,r,B.ar),this.Cb?.mf(this.GS,this.HS,r,i)),1===this.GM[t]&&(this.Cb?._f(this.GS,this.HS+1,r,B.ar,this.XR),this.Cb?._f(this.GS,this.HS,r,i,this.XR)),2===this.GM[t]){const s=this.Cb?.Af(r)??0,h=(150-this.HM[t])*(s+100)/150;C.Ii(334,this.GS+50,0,this.GS-50),this.Cb?.uf(this.GS+50-h,this.HS+1,r,B.ar),this.Cb?.uf(this.GS+50-h,this.HS,r,i),C.Ei()}}else this.Cb?.mf(this.GS,this.HS+1,r,B.ar),this.Cb?.mf(this.GS,this.HS,r,B.er)}};Lk=()=>{2===this.mv&&this.TL[2]&&(this.kk((this.Cv-this._S<<7)+this.Ev,2*this.Ov,(this.Tv-this.CS<<7)+this.gv),this.GS>-1&&this.VO%20<10&&this.TL[2].draw(this.GS-12,this.HS-28))};vk=()=>{const t=507;let i=13;this.mx?this.gb?.gf(t,i,'tock',B.er,!0):this.Cb?.gf(t,i,'tick',B.er,!0),i+=13,this.gb?.gf(t,i,`Fps: ${this.pT}, ${this.wT} ms`,B.er,!0),i+=13,this.gb?.gf(t,i,`Draw: ${this.ms.toFixed(1)}, Avg: ${this.ZT.toFixed(1)}, Slow: ${this.cT.toFixed(1)} ms`,B.er,!0),i+=13,this.gb?.gf(t,i,`Occluders: ${Rt.FI[Rt.rE]} Active: ${Rt.TE}`,B.er,!0),i+=13,this.gb?.gf(t,i,'Local Pos: '+(this.IM?.x??-1)+', '+(this.IM?.z??-1)+', '+(this.IM?.y??-1),B.er,!0),i+=13,this.gb?.gf(t,i,'Camera Pos: '+this.lS+', '+this.cS+', '+this.aS,B.er,!0),i+=13,this.gb?.gf(t,i,'Camera Angle: '+this.uS+', '+this.fS,B.er,!0),i+=13,this.gb?.gf(t,i,'Cutscene Source: '+this.jS+', '+this.zS+' '+this.ZS+'; '+this.qS+', '+this.$S,B.er,!0),i+=13,this.gb?.gf(t,i,'Cutscene Destination: '+this.WS+', '+this.YS+' '+this.VS+'; '+this.KS+', '+this.XS,B.er,!0),Jt.mO&&(i+=13,this.gb?.gf(t,i,'Instructions:',B.er,!0),i+=13,this.gb?.gf(t,i,'- Arrows to move Camera',B.er,!0),i+=13,this.gb?.gf(t,i,'- Shift to control Source or Dest',B.er,!0),i+=13,this.gb?.gf(t,i,'- Alt to control Height',B.er,!0),i+=13,this.gb?.gf(t,i,'- Ctrl to control Modifier',B.er,!0))};Pk=(t,i,s,h,e,n)=>{const r=this.Ck(s,t,i),o=64*h;this.Dk(t-o,r,i-o);const l=this.GS,a=this.HS;this.Dk(t+o,r,i-o);const c=this.GS,f=this.HS;this.Dk(t-o,r,i+o);const u=this.GS,d=this.HS;this.Dk(t+o,r,i+o);const w=this.GS,y=this.HS;-1!==l&&-1!==c&&-1!==u&&-1!==w&&(n&&(C.Ti(l,a,w,y,(16711422&e)>>1),C.Ti(c,f,u,d,(16711422&e)>>1)),C.Ti(l,a,c,f,e),C.Ti(l,a,u,d,e),C.Ti(c,f,w,y,e),C.Ti(u,d,w,y,e))};lk(){const t=1==this.RT[5]?2:1;1==this.RT[6]?(1==this.RT[1]?(this.WS-=t,this.WS<1&&(this.WS=1)):1==this.RT[2]&&(this.WS+=t,this.WS>102&&(this.WS=102)),1==this.RT[3]?1==this.RT[7]?this.VS+=2*t:(this.YS+=1,this.YS>102&&(this.YS=102)):1==this.RT[4]&&(1==this.RT[7]?this.VS-=2*t:(this.YS-=1,this.YS<1&&(this.YS=1)))):(1==this.RT[1]?(this.jS-=t,this.jS<1&&(this.jS=1)):1==this.RT[2]&&(this.jS+=t,this.jS>102&&(this.jS=102)),1==this.RT[3]?1==this.RT[7]?this.ZS+=2*t:(this.zS+=t,this.zS>102&&(this.zS=102)):1==this.RT[4]&&(1==this.RT[7]?this.ZS-=2*t:(this.zS-=t,this.zS<1&&(this.zS=1)))),this.lS=128*this.jS+64,this.cS=128*this.zS+64,this.aS=this.Ck(this.MS,this.jS,this.zS)-this.ZS;const i=128*this.WS+64,s=128*this.YS+64,h=this.Ck(this.MS,this.WS,this.YS)-this.VS,e=i-this.lS,n=h-this.aS,r=s-this.cS,o=0|Math.sqrt(e*e+r*r);this.fS=325.949*Math.atan2(n,o)&2047,this.uS=-325.949*Math.atan2(e,r)&2047,this.fS<128&&(this.fS=128),this.fS>383&&(this.fS=383)}Sk=()=>{if(this.Fk(),1===this.JL&&this.bL[this.QL/100|0]?.draw(this.tv-8-8,this.iv-8-11),2===this.JL&&this.bL[4+(this.QL/100|0)]?.draw(this.tv-8-8,this.iv-8-11),-1!==this.qL&&(this.bx(this.qL,this.KR),this.Lx(X.$t[this.qL],0,0,0)),this.Uk(),this.hv?0===this.ev&&this.Bk():(this.Jx(),this.Gk()),1===this.gM&&(this.OM>0||1===this.bM?this.TL[1]?.draw(472,258):this.TL[1]?.draw(472,296)),this.OM>0&&(this.TL[0]?.draw(472,296),this._b?.mf(484,329,'Level: '+this.OM,B.er)),1===this.bM&&(this.TL[6]?.draw(472,296),this._b?.mf(484,329,'Arena',B.er)),0!==this.$O){let t=this.$O/50|0;const i=t/60|0;t%=60,t<10?this._b?.uf(4,329,'System update in: '+i+':0'+t,B.er):this._b?.uf(4,329,'System update in: '+i+':'+t,B.er)}};Fk=()=>{if(0===this.qv)return;const t=this._b;let i=0;0!==this.$O&&(i=1);for(let s=0;s<100;s++){if(!this.Xv[s])continue;const h=this.messageType[s];let e;if((3===h||7===h)&&(7===h||0===this.Nv||1===this.Nv&&this.Nk(this.jv[s]))&&(e=329-13*i,t?.uf(4,e,'From '+this.jv[s]+': '+this.Xv[s],B.ar),t?.uf(4,e-1,'From '+this.jv[s]+': '+this.Xv[s],B.nr),i++,i>=5))return;if(5===h&&this.Nv<2&&(e=329-13*i,t?.uf(4,e,this.Xv[s],B.ar),t?.uf(4,e-1,this.Xv[s],B.nr),i++,i>=5))return;if(6===h&&this.Nv<2&&(e=329-13*i,t?.uf(4,e,'To '+this.jv[s]+': '+this.Xv[s],B.ar),t?.uf(4,e-1,'To '+this.jv[s]+': '+this.Xv[s],B.nr),i++,i>=5))return}};Uk=()=>{if(!this.IM)return;const t=(this.IM.x>>7)+this._S,i=(this.IM.z>>7)+this.CS;if(this.OM=t>=2944&&t<3392&&i>=3520&&i<6400?1+((i-3520)/8|0):t>=2944&&t<3392&&i>=9920&&i<12800?1+((i-9920)/8|0):0,this.bM=0,t>=3328&&t<3392&&i>=3200&&i<3264){const s=63&t,h=63&i;(s>=4&&s<=29&&h>=44&&h<=58||s>=36&&s<=61&&h>=44&&h<=58||s>=4&&s<=29&&h>=25&&h<=39||s>=36&&s<=61&&h>=25&&h<=39||s>=4&&s<=29&&h>=6&&h<=20||s>=36&&s<=61&&h>=6&&h<=20)&&(this.bM=1)}0===this.bM&&t>=3328&&t<=3393&&i>=3203&&i<=3325&&(this.bM=2),this.sv=0,(t>=3053&&t<=3156&&i>=3056&&i<=3136||t>=3072&&t<=3118&&i>=9492&&i<=9535)&&(this.sv=1),1===this.sv&&t>=3139&&t<=3199&&i>=3008&&i<=3062&&(this.sv=0)};dk=()=>{this.Wb?.bind(),this.rL&&(O.Vi=this.rL),this.uL?.draw(0,0),-1!==this.fv?this.Lx(X.$t[this.fv],0,0,0):-1!==this.kv[this.xv]&&this.Lx(X.$t[this.kv[this.xv]],0,0,0),this.hv&&1===this.ev&&this.Bk(),this.Wb?.draw(562,231),this.Vb?.bind(),this.oL&&(O.Vi=this.oL)};yk=()=>{if(this.Kb?.bind(),this.nL&&(O.Vi=this.nL),this.dL?.draw(0,0),this.Bv)this.Cb?.mf(239,40,this.Gv,B.ar),this.Cb?.mf(239,60,this.Hv+'*',B.dr);else if(this.Vv)this.Cb?.mf(239,40,'Enter amount:',B.ar),this.Cb?.mf(239,60,this.Yv+'*',B.dr);else if(this.Sv)this.Cb?.mf(239,40,this.Sv,B.ar),this.Cb?.mf(239,60,'Click to continue',B.dr);else if(-1!==this.uv)this.Lx(X.$t[this.uv],0,0,0);else if(-1===this.Kv){let t=this._b;0===Jt.pO&&(t=this.Tb);let i=0;C.Ii(0,0,463,77);for(let s=0;s<100;s++){const h=this.Xv[s];if(!h)continue;const e=this.messageType[s],n=this.yv+70-14*i;0===e&&(n>0&&n<110&&t?.uf(4,n,h,B.ar),i++),1===e&&(n>0&&n<110&&(t?.uf(4,n,this.jv[s]+':',B.lr),t?.uf(t.Af(this.jv[s])+12,n,h,B.BLUE)),i++),2===e&&(0===this.Dv||1===this.Dv&&this.Nk(this.jv[s]))&&(n>0&&n<110&&(t?.uf(4,n,this.jv[s]+':',B.ar),t?.uf(t.Af(this.jv[s])+12,n,h,B.BLUE)),i++),3!==e&&7!==e||0!==this.qv||!(7===e||0===this.Nv||1===this.Nv&&this.Nk(this.jv[s]))||(n>0&&n<110&&(t?.uf(4,n,'From '+this.jv[s]+':',B.ar),t?.uf(t.Af('From '+this.jv[s])+12,n,h,B.ur)),i++),4===e&&(0===this.Pv||1===this.Pv&&this.Nk(this.jv[s]))&&(n>0&&n<110&&t?.uf(4,n,this.jv[s]+' '+this.Xv[s],B.br),i++),5===e&&0===this.qv&&this.Nv<2&&(n>0&&n<110&&t?.uf(4,n,h,B.ur),i++),6===e&&0===this.qv&&this.Nv<2&&(n>0&&n<110&&(t?.uf(4,n,'To '+this.jv[s]+':',B.ar),t?.uf(t.Af('To '+this.jv[s])+12,n,h,B.ur)),i++),8===e&&(0===this.Pv||1===this.Pv&&this.Nk(this.jv[s]))&&(n>0&&n<110&&t?.uf(4,n,this.jv[s]+' '+this.Xv[s],B.Lr),i++)}C.Ei(),this.wv=14*i+7,this.wv<78&&(this.wv=78),this.Ox(463,0,this.wv-this.yv-77,this.wv,77),0==Jt.pO?t?.uf(3,90,this.Jv+'*',B.ar):1==Jt.pO?t?.uf(3,90,this.Jv+'*',B.BLUE):(t?.uf(4,90,K.Wl(this.username)+':',B.ar),t?.uf(t.Af(this.username+': ')+6,90,this.Jv+'*',B.BLUE)),C._i(0,77,B.ar,479)}else this.Lx(X.$t[this.Kv],0,0,0);this.hv&&2===this.ev&&this.Bk(),this.Kb?.draw(22,375),this.Vb?.bind(),this.oL&&(O.Vi=this.oL)};Ak=()=>{if(this.Yb?.bind(),!this.IM)return;const t=this.DS+this.yS&2047;let i=48+(this.IM.x/32|0),s=464-(this.IM.z/32|0);this.IL?.ir(21,9,146,151,this.cL,this.fL,i,s,t,this.AS+256),this.EL?.ir(0,0,33,33,this.lL,this.aL,25,25,this.DS,256);for(let t=0;t<this.GR;t++)i=4*this.HR[t]+2-(this.IM.x/32|0),s=4*this.WR[t]+2-(this.IM.z/32|0),this.Hk(s,this.KL[t],i);for(let t=0;t<gt.Pm;t++)for(let h=0;h<gt.Pm;h++){this.uM[this.MS][t][h]&&(i=4*t+2-(this.IM.x/32|0),s=4*h+2-(this.IM.z/32|0),this.Hk(s,this.LL,i))}for(let t=0;t<this.oM;t++){const h=this.rM[this.lM[t]];h&&h.isVisible()&&h.type&&h.type.Cl&&(i=(h.x/32|0)-(this.IM.x/32|0),s=(h.z/32|0)-(this.IM.z/32|0),this.Hk(s,this.vL,i))}for(let t=0;t<this.QS;t++){const h=this.JS[this.tM[t]];if(h&&h.isVisible()&&h.name){i=(h.x/32|0)-(this.IM.x/32|0),s=(h.z/32|0)-(this.IM.z/32|0);let t=!1;const e=K.Fl(h.name);for(let i=0;i<this.xM;i++)if(e===this.VM[i]&&0!==this.KM[i]){t=!0;break}t?this.Hk(s,this.SL,i):this.Hk(s,this.RL,i)}}0!==this.jR&&(i=4*this.jR+2-(this.IM.x/32|0),s=4*this.zR+2-(this.IM.z/32|0),this.Hk(s,this.OL,i)),C.fillRect(93,82,3,3,B.lr),this.Vb?.bind()};Hk=(t,i,s)=>{if(!i)return;const h=this.DS+this.yS&2047,e=s*s+t*t;if(e>6400)return;let n=O.sin[h],r=O.cos[h];n=256*n/(this.AS+256)|0,r=256*r/(this.AS+256)|0;const o=t*n+s*r>>16,l=t*r-s*n>>16;e>2500&&this.wL?i.sr(o+94-(i.Si/2|0),83-l-(i.Mi/2|0),this.wL):i.draw(o+94-(i.Si/2|0),83-l-(i.Mi/2|0))};Wk=t=>{if(!this.IL)return;const i=this.IL.di,s=i.length;for(let t=0;t<s;t++)i[t]=0;for(let s=1;s<gt.Pm-1;s++){let h=512*(gt.Pm-1-s)*4+24628;for(let e=1;e<gt.Pm-1;e++)!this.t_||24&this.t_[t][e][s]||this.YR?.yg(t,e,s,i,h,512),t<3&&this.t_&&8&this.t_[t+1][e][s]&&this.YR?.yg(t+1,e,s,i,h,512),h+=4}const h=(238+(20*Math.random()|0)-10<<16)+(238+(20*Math.random()|0)-10<<8)+(20*Math.random()|0)+238-10,e=238+(20*Math.random()|0)-10<<16;this.IL.bind();for(let i=1;i<gt.Pm-1;i++)for(let s=1;s<gt.Pm-1;s++)!this.t_||24&this.t_[t][s][i]||this.Yk(s,i,t,h,e),t<3&&this.t_&&8&this.t_[t+1][s][i]&&this.Yk(s,i,t+1,h,e);this.Vb?.bind(),this.GR=0;for(let t=0;t<gt.Pm;t++)for(let i=0;i<gt.Pm;i++){let s=this.YR?.ag(this.MS,t,i)??0;if(0===s)continue;s=s>>14&32767;const h=x.get(s).Pn;if(h<0)continue;let e=t,n=i;if(22!==h&&29!==h&&34!==h&&36!==h&&46!==h&&47!==h&&48!==h){const s=gt.Pm,h=gt.Pm,r=this.SS[this.MS];if(r){const o=r.flags;for(let r=0;r<10;r++){const r=4*Math.random()|0;0===r&&e>0&&e>t-3&&(o[gt.index(e-1,n)]&It.Lm)===It.OPEN&&e--,1===r&&e<s-1&&e<t+3&&(o[gt.index(e+1,n)]&It.Mm)===It.OPEN&&e++,2===r&&n>0&&n>i-3&&(o[gt.index(e,n-1)]&It.bm)===It.OPEN&&n--,3===r&&n<h-1&&n<i+3&&(o[gt.index(e,n+1)]&It.Rm)===It.OPEN&&n++}}}this.KL[this.GR]=this._L[h],this.HR[this.GR]=e,this.WR[this.GR]=n,this.GR++}};Yk=(t,i,s,h,e)=>{if(!this.YR||!this.IL)return;let n=this.YR.rg(s,t,i);if(0!==n){const r=this.YR.cg(s,t,i,n),o=r>>6&3,l=31&r;let a=h;n>0&&(a=e);const c=this.IL.di,f=4*t+512*(103-i)*4+24624,u=n>>14&32767,d=x.get(u);if(-1===d.Fn)l!==S.Be.id&&l!==S.He.id||(o===M.cn?(c[f]=a,c[f+512]=a,c[f+1024]=a,c[f+1536]=a):o===M.fn?(c[f]=a,c[f+1]=a,c[f+2]=a,c[f+3]=a):o===M.un?(c[f+3]=a,c[f+3+512]=a,c[f+3+1024]=a,c[f+3+1536]=a):o===M.dn&&(c[f+1536]=a,c[f+1536+1]=a,c[f+1536+2]=a,c[f+1536+3]=a)),l===S.We.id&&(o===M.cn?c[f]=a:o===M.fn?c[f+3]=a:o===M.un?c[f+3+1536]=a:o===M.dn&&(c[f+1536]=a)),l===S.He.id&&(o===M.dn?(c[f]=a,c[f+512]=a,c[f+1024]=a,c[f+1536]=a):o===M.cn?(c[f]=a,c[f+1]=a,c[f+2]=a,c[f+3]=a):o===M.fn?(c[f+3]=a,c[f+3+512]=a,c[f+3+1024]=a,c[f+3+1536]=a):o===M.un&&(c[f+1536]=a,c[f+1536+1]=a,c[f+1536+2]=a,c[f+1536+3]=a));else{const s=this.gL[d.Fn];if(s){const h=(4*d.width-s.width)/2|0,e=(4*d.length-s.height)/2|0;s.draw(4*t+48+h,4*(gt.Pm-i-d.length)+e+48)}}}if(n=this.YR.lg(s,t,i),0!==n){const h=this.YR.cg(s,t,i,n),e=h>>6&3,r=31&h,o=n>>14&32767,l=x.get(o);if(-1!==l.Fn){const s=this.gL[l.Fn];if(s){const h=(4*l.width-s.width)/2|0,e=(4*l.length-s.height)/2|0;s.draw(4*t+48+h,4*(gt.Pm-i-l.length)+e+48)}}else if(r===S.ze.id){let s=15658734;n>0&&(s=15597568);const h=this.IL.di,r=4*t+512*(gt.Pm-1-i)*4+24624;e===M.cn||e===M.un?(h[r+1536]=s,h[r+1024+1]=s,h[r+512+2]=s,h[r+3]=s):(h[r]=s,h[r+512+1]=s,h[r+1024+2]=s,h[r+1536+3]=s)}}if(n=this.YR.ag(s,t,i),0!==n){const s=x.get(n>>14&32767);if(-1!==s.Fn){const h=this.gL[s.Fn];if(h){const e=(4*s.width-h.width)/2|0,n=(4*s.length-h.height)/2|0;h.draw(4*t+48+e,4*(gt.Pm-i-s.length)+n+48)}}}};Gk=()=>{if(this.av<2&&0===this.aR&&0===this.gR)return;let t;t=1===this.aR&&this.av<2?'Use '+this.dR+' with...':1===this.gR&&this.av<2?this.TR+'...':this.cv[this.av-1],this.av>2&&(t=t+'@whi@ / '+(this.av-2)+' more options'),this.Cb?.If(4,15,t,B.lr,!0,this.VO/1e3|0)};Bk=()=>{const t=this.nv,i=this.rv,s=this.ov,h=this.lv,e=B.gr;C.fillRect(t,i,s,h,e),C.fillRect(t+1,i+1,s-2,16,B.ar),C.gi(t+1,i+18,s-2,h-19,B.ar),this.Cb?.uf(t+3,i+14,'Choose Option',e);let n=this.gh,r=this._h;0===this.ev&&(n-=8,r-=11),1===this.ev&&(n-=562,r-=231),2===this.ev&&(n-=22,r-=375);for(let h=0;h<this.av;h++){const e=i+15*(this.av-1-h)+31;let o=B.lr;n>t&&n<t+s&&r>e-13&&r<e+3&&(o=B.er),this.Cb?.wf(t+3,e,this.cv[h],o,!0)}};hk=async()=>{if(0!==this.eR)return;let t=this.bT;if(1===this.gR&&this.LT>=520&&this.vT>=165&&this.LT<=788&&this.vT<=230&&(t=0),this.hv){if(1!==t){let t=this.gh,i=this._h;0===this.ev?(t-=8,i-=11):1===this.ev?(t-=562,i-=231):2===this.ev&&(t-=22,i-=375),(t<this.nv-10||t>this.nv+this.ov+10||i<this.rv-10||i>this.rv+this.lv+10)&&(this.hv=!1,1===this.ev&&(this.XL=!0),2===this.ev&&(this.jL=!0))}if(1===t){const t=this.nv,i=this.rv,s=this.ov;let h=this.LT,e=this.vT;0===this.ev?(h-=8,e-=11):1===this.ev?(h-=562,e-=231):2===this.ev&&(h-=22,e-=375);let n=-1;for(let r=0;r<this.av;r++){const o=i+15*(this.av-1-r)+31;h>t&&h<t+s&&e>o-13&&e<o+3&&(n=r)}-1!==n&&await this.ik(n),this.hv=!1,1===this.ev?this.XL=!0:2===this.ev&&(this.jL=!0)}}else{if(1===t&&this.av>0){const t=this.bR[this.av-1];if(602===t||596===t||22===t||892===t||415===t||405===t||38===t||422===t||478===t||347===t||188===t){const t=this.vR[this.av-1],i=this.RR[this.av-1];if(X.$t[i].draggable)return this.lR=!1,this.oR=0,this.sR=i,this.hR=t,this.eR=2,this.nR=this.LT,this.rR=this.vT,X.$t[i].an===this.qL&&(this.eR=1),void(X.$t[i].an===this.uv&&(this.eR=3))}}if(1===t&&(1===this.OR||this.Qx(this.av-1))&&this.av>2&&(t=2),1===t&&this.av>0&&await this.ik(this.av-1),2!==t||this.av<=0)return;this.tk()}};ek=()=>{if(1===this.bT&&this.IM){let t=this.LT-21-561,i=this.vT-9-5;if(t>=0&&i>=0&&t<146&&i<151){t-=73,i-=75;const s=this.DS+this.yS&2047;let h=O.sin[s],e=O.cos[s];h=h*(this.AS+256)>>8,e=e*(this.AS+256)>>8;const n=i*h+t*e>>11,r=i*e-t*h>>11,o=this.IM.x+n>>7,l=this.IM.z-r>>7;this.sk(this.IM.uC[0],this.IM.dC[0],o,l,1,0,0,0,0,0,!0)&&(this.XO.p1(t),this.XO.p1(i),this.XO.p2(this.DS),this.XO.p1(57),this.XO.p1(this.yS),this.XO.p1(this.AS),this.XO.p1(89),this.XO.p2(this.IM.x),this.XO.p2(this.IM.z),this.XO.p1(this.mM),this.XO.p1(63))}}};Qx=t=>{if(t<0)return!1;let i=this.bR[t];return i>=2e3&&(i-=2e3),406===i};ik=async t=>{if(t<0)return;this.Vv&&(this.Vv=!1,this.jL=!0);let i=this.bR[t];const s=this.LR[t],h=this.vR[t],e=this.RR[t];if(i>=2e3&&(i-=2e3),903===i||363===i){let s=this.cv[t];const h=s.indexOf('@whi@');if(-1!==h){s=s.substring(h+5).trim();const t=K.Wl(K.Ul(K.Fl(s)));let e=!1;for(let s=0;s<this.QS;s++){const h=this.JS[this.tM[s]];if(h&&h.name&&h.name.toLowerCase()===t.toLowerCase()&&this.IM){this.sk(this.IM.uC[0],this.IM.dC[0],h.uC[0],h.dC[0],2,1,1,0,0,0,!1),903===i?this.XO.Bt(et.hw):363===i&&this.XO.Bt(et.tw),this.XO.p2(this.tM[s]),e=!0;break}}e||this.Vk(0,'Unable to find '+t,'')}}else if(450===i&&this.Kk(et.Qd,h,e,s))this.XO.p2(this.uR),this.XO.p2(this.cR),this.XO.p2(this.fR);else if(405===i||38===i||422===i||478===i||347===i)478===i?(3&h||Jt.MO++,Jt.MO>=90&&this.XO.Bt(et._d),this.XO.Bt(et.aw)):347===i?this.XO.Bt(et.cw):422===i?this.XO.Bt(et.lw):405===i?(Jt.RO+=s,Jt.RO>=97&&(this.XO.Bt(et.Ed),this.XO.p3(14953816)),this.XO.Bt(et.rw)):38===i&&this.XO.Bt(et.ow),this.XO.p2(s),this.XO.p2(h),this.XO.p2(e),this.pR=0,this.AR=e,this.yR=h,this.wR=2,X.$t[e].an===this.qL&&(this.wR=1),X.$t[e].an===this.uv&&(this.wR=3);else if(728===i||542===i||6===i||963===i||245===i){const t=this.rM[s];t&&this.IM&&(this.sk(this.IM.uC[0],this.IM.dC[0],t.uC[0],t.dC[0],2,1,1,0,0,0,!1),this.tv=this.LT,this.iv=this.vT,this.JL=2,this.QL=0,542===i?this.XO.Bt(et.Hd):6===i?(3&s||Jt.vO++,Jt.vO>=124&&(this.XO.Bt(et.Id),this.XO.p4(0)),this.XO.Bt(et.Wd)):963===i?this.XO.Bt(et.Yd):728===i?this.XO.Bt(et.Gd):245===i&&(3&s||Jt.SO++,Jt.SO>=85&&(this.XO.Bt(et.gd),this.XO.p2(39596)),this.XO.Bt(et.Vd)),this.XO.p2(s))}else if(217===i){if(this.IM){this.sk(this.IM.uC[0],this.IM.dC[0],h,e,2,0,0,0,0,0,!1)||this.sk(this.IM.uC[0],this.IM.dC[0],h,e,2,1,1,0,0,0,!1),this.tv=this.LT,this.iv=this.vT,this.JL=2,this.QL=0,this.XO.Bt(et.Bd),this.XO.p2(h+this._S),this.XO.p2(e+this.CS),this.XO.p2(s),this.XO.p2(this.uR),this.XO.p2(this.cR),this.XO.p2(this.fR)}}else if(1175===i){const t=s>>14&32767,i=x.get(t);let h;h=i.Cn?i.Cn:"It's a "+i.name+'.',this.Vk(0,h,'')}else if(285===i)this.Kk(et.jd,h,e,s);else if(881===i)this.XO.Bt(et.uw),this.XO.p2(s),this.XO.p2(h),this.XO.p2(e),this.XO.p2(this.uR),this.XO.p2(this.cR),this.XO.p2(this.fR),this.pR=0,this.AR=e,this.yR=h,this.wR=2,X.$t[e].an===this.qL&&(this.wR=1),X.$t[e].an===this.uv&&(this.wR=3);else if(391===i)this.XO.Bt(et.fw),this.XO.p2(s),this.XO.p2(h),this.XO.p2(e),this.XO.p2(this._R),this.pR=0,this.AR=e,this.yR=h,this.wR=2,X.$t[e].an===this.qL&&(this.wR=1),X.$t[e].an===this.uv&&(this.wR=3);else if(660===i)this.hv?this.YR?.click(h-8,e-11):this.YR?.click(this.LT-8,this.vT-11);else{if(188===i)return this.aR=1,this.cR=h,this.fR=e,this.uR=s,this.dR=G.get(s).name,void(this.gR=0);if(44===i)this.mR||(this.XO.Bt(et.Iw),this.XO.p2(e),this.mR=!0);else if(1773===i){const t=G.get(s);let i;i=e>=1e5?e+' x '+t.name:t.Cn?t.Cn:"It's a "+t.name+'.',this.Vk(0,i,'')}else if(900===i){const t=this.rM[s];t&&this.IM&&(this.sk(this.IM.uC[0],this.IM.dC[0],t.uC[0],t.dC[0],2,1,1,0,0,0,!1),this.tv=this.LT,this.iv=this.vT,this.JL=2,this.QL=0,this.XO.Bt(et.Xd),this.XO.p2(s),this.XO.p2(this.uR),this.XO.p2(this.cR),this.XO.p2(this.fR))}else if(1373===i||1544===i||151===i||1101===i){const t=this.JS[s];t&&this.IM&&(this.sk(this.IM.uC[0],this.IM.dC[0],t.uC[0],t.dC[0],2,1,1,0,0,0,!1),this.tv=this.LT,this.iv=this.vT,this.JL=2,this.QL=0,1101===i?this.XO.Bt(et.tw):151===i?(Jt.DO++,Jt.DO>=90&&(this.XO.Bt(et.Od),this.XO.p2(31114)),this.XO.Bt(et.iw)):1373===i?this.XO.Bt(et.hw):1544===i&&this.XO.Bt(et.sw),this.XO.p2(s))}else if(265===i){const t=this.rM[s];t&&this.IM&&(this.sk(this.IM.uC[0],this.IM.dC[0],t.uC[0],t.dC[0],2,1,1,0,0,0,!1),this.tv=this.LT,this.iv=this.vT,this.JL=2,this.QL=0,this.XO.Bt(et.Kd),this.XO.p2(s),this.XO.p2(this._R))}else if(679===i){const i=this.cv[t],s=i.indexOf('@whi@');if(-1!==s){const t=K.Fl(i.substring(s+5).trim());let h=-1;for(let i=0;i<this.xM;i++)if(this.VM[i]===t){h=i;break}-1!==h&&this.KM[h]>0&&(this.jL=!0,this.Vv=!1,this.Bv=!0,this.Hv='',this.Wv=3,this.XM=this.VM[h],this.Gv='Enter message to send to '+this.YM[h])}}else if(55===i)this.Kk(et.Jd,h,e,s)&&this.XO.p2(this._R);else if(224===i||993===i||99===i||746===i||877===i){if(this.IM){this.sk(this.IM.uC[0],this.IM.dC[0],h,e,2,0,0,0,0,0,!1)||this.sk(this.IM.uC[0],this.IM.dC[0],h,e,2,1,1,0,0,0,!1),this.tv=this.LT,this.iv=this.vT,this.JL=2,this.QL=0,224===i?this.XO.Bt(et.kd):746===i?this.XO.Bt(et.Pd):877===i?this.XO.Bt(et.Fd):99===i?this.XO.Bt(et.Nd):993===i&&this.XO.Bt(et.Dd),this.XO.p2(h+this._S),this.XO.p2(e+this.CS),this.XO.p2(s)}}else if(1607===i){const t=this.rM[s];if(t&&t.type){let i;i=t.type.Cn?t.type.Cn:"It's a "+t.type.name+'.',this.Vk(0,i,'')}}else if(504===i)this.Kk(et.zd,h,e,s);else{if(930===i){const t=X.$t[e];this.gR=1,this._R=e,this.CR=t.Kc,this.aR=0;let i=t.Vc;i&&-1!==i.indexOf(' ')&&(i=i.substring(0,i.indexOf(' ')));let s=t.Vc;return s&&-1!==s.indexOf(' ')&&(s=s.substring(s.indexOf(' ')+1)),this.TR=i+' '+t.action+' '+s,void(16===this.CR&&(this.XL=!0,this.xv=3,this.zL=!0))}if(951===i){const t=X.$t[e];let i=!0;t.dc>0&&(i=this.Xk(t)),i&&(this.XO.Bt(et.mw),this.XO.p2(e))}else if(602===i||596===i||22===i||892===i||415===i)22===i?this.XO.Bt(et.yw):415===i?(3&e||Jt.kO++,Jt.kO>=55&&(this.XO.Bt(et.Td),this.XO.p4(0)),this.XO.Bt(et.pw)):602===i?this.XO.Bt(et.dw):892===i?(3&h||Jt.NO++,Jt.NO>=130&&(this.XO.Bt(et.bd),this.XO.p1(177)),this.XO.Bt(et.Aw)):596===i&&this.XO.Bt(et.ww),this.XO.p2(s),this.XO.p2(h),this.XO.p2(e),this.pR=0,this.AR=e,this.yR=h,this.wR=2,X.$t[e].an===this.qL&&(this.wR=1),X.$t[e].an===this.uv&&(this.wR=3);else if(581===i)3&s||Jt.LO++,Jt.LO>=99&&(this.XO.Bt(et.md),this.XO.p4(0)),this.Kk(et.qd,h,e,s);else if(965===i){if(this.IM){this.sk(this.IM.uC[0],this.IM.dC[0],h,e,2,0,0,0,0,0,!1)||this.sk(this.IM.uC[0],this.IM.dC[0],h,e,2,1,1,0,0,0,!1),this.tv=this.LT,this.iv=this.vT,this.JL=2,this.QL=0,this.XO.Bt(et.Ud),this.XO.p2(h+this._S),this.XO.p2(e+this.CS),this.XO.p2(s),this.XO.p2(this._R)}}else if(1501===i)Jt.xO+=this.CS,Jt.xO>=92&&(this.XO.Bt(et.Cd),this.XO.p4(0)),this.Kk(et.$d,h,e,s);else if(364===i)this.Kk(et.Zd,h,e,s);else if(1102===i){const t=G.get(s);let i;i=t.Cn?t.Cn:"It's a "+t.name+'.',this.Vk(0,i,'')}else if(960===i){this.XO.Bt(et.mw),this.XO.p2(e);const t=X.$t[e];if(t.scripts&&t.scripts[0]&&5===t.scripts[0][0]){const i=t.scripts[0][1];t.Ac&&this.IR[i]!==t.Ac[0]&&(this.IR[i]=t.Ac[0],await this.jk(i),this.XL=!0)}}else if(34===i){const i=this.cv[t],s=i.indexOf('@whi@');if(-1!==s){this.zk(),this.kR=i.substring(s+5).trim(),this.DR=!1;for(let t=0;t<X.$t.length;t++)if(X.$t[t]&&X.$t[t].dc===X.Xa){this.NR=this.qL=X.$t[t].an;break}}}else if(947===i)this.zk();else if(367===i){const t=this.JS[s];t&&this.IM&&(this.sk(this.IM.uC[0],this.IM.dC[0],t.uC[0],t.dC[0],2,1,1,0,0,0,!1),this.tv=this.LT,this.iv=this.vT,this.JL=2,this.QL=0,this.XO.Bt(et.nw),this.XO.p2(s),this.XO.p2(this.uR),this.XO.p2(this.cR),this.XO.p2(this.fR))}else if(465===i){this.XO.Bt(et.mw),this.XO.p2(e);const t=X.$t[e];if(t.scripts&&t.scripts[0]&&5===t.scripts[0][0]){const i=t.scripts[0][1];this.IR[i]=1-this.IR[i],await this.jk(i),this.XL=!0}}else if(406===i||436===i||557===i||556===i){const s=this.cv[t],h=s.indexOf('@whi@');if(-1!==h){const t=K.Fl(s.substring(h+5).trim());406===i?this.Zk(t):436===i?this.qk(t):557===i?this.$k(t):556===i&&this.Jk(t)}}else if(651===i){const t=this.JS[s];t&&this.IM&&(this.sk(this.IM.uC[0],this.IM.dC[0],t.uC[0],t.dC[0],2,1,1,0,0,0,!1),this.tv=this.LT,this.iv=this.vT,this.JL=2,this.QL=0,this.XO.Bt(et.ew),this.XO.p2(s),this.XO.p2(this._R))}}}this.aR=0,this.gR=0};Xk=t=>{const i=t.dc;if(i===X.aa&&(this.jL=!0,this.Vv=!1,this.Bv=!0,this.Hv='',this.Wv=1,this.Gv='Enter name of friend to add to list'),i===X.ca&&(this.jL=!0,this.Vv=!1,this.Bv=!0,this.Hv='',this.Wv=2,this.Gv='Enter name of friend to delete from list'),i===X.ua)return this.qO=250,!0;if(i===X.Ya&&(this.jL=!0,this.Vv=!1,this.Bv=!0,this.Hv='',this.Wv=4,this.Gv='Enter name of player to add to list'),i===X.Va&&(this.jL=!0,this.Vv=!1,this.Bv=!0,this.Hv='',this.Wv=5,this.Gv='Enter name of player to delete from list'),i>=X.da&&i<=X.ba){const t=(i-300)/2|0,s=1&i;let h=this.SM[t];if(-1!==h)for(;;)if(0===s&&(h--,h<0&&(h=W.count-1)),1===s&&(h++,h>=W.count&&(h=0)),!W.$t[h].disable&&W.$t[h].type===t+(this.vM?0:7)){this.SM[t]=h,this.RM=!0;break}}if(i>=X.La&&i<=X.Pa){const t=(i-314)/2|0,s=1&i;let h=this.MM[t];0===s&&(h--,h<0&&(h=Ft.MC[t].length-1)),1===s&&(h++,h>=Ft.MC[t].length&&(h=0)),this.MM[t]=h,this.RM=!0}if(i!==X.Fa||this.vM||(this.vM=!0,this.Kx()),i===X.Ua&&this.vM&&(this.vM=!1,this.Kx()),i===X.Ba){this.XO.Bt(et.Sw),this.XO.p1(this.vM?0:1);for(let t=0;t<7;t++)this.XO.p1(this.SM[t]);for(let t=0;t<5;t++)this.XO.p1(this.MM[t]);return!0}return i===X.nc&&(this.DR=!this.DR),i>=X.ja&&i<=X.ec&&(this.zk(),this.kR.length>0&&(this.XO.Bt(et.Tw),this.XO.Yt(K.Fl(this.kR)),this.XO.p1(i-601),this.XO.p1(this.DR?1:0))),!1};Kx=()=>{this.RM=!0;for(let t=0;t<7;t++){this.SM[t]=-1;for(let i=0;i<W.count;i++)if(!W.$t[i].disable&&W.$t[i].type===t+(this.vM?0:7)){this.SM[t]=i;break}}};Kk=(t,i,s,h)=>{if(!this.IM||!this.YR)return!1;const e=h>>14&32767,n=this.YR.cg(this.MS,i,s,h);if(-1===n)return!1;const r=31&n,o=n>>6&3;if(r===S.Ze.id||r===S.qe.id||r===S.Ue.id){const t=x.get(e);let h,n;o===M.cn||o===M.un?(h=t.width,n=t.length):(h=t.length,n=t.width);let r=t.Yn;0!==o&&(r=(r<<o&15)+(r>>4-o)),this.sk(this.IM.uC[0],this.IM.dC[0],i,s,2,h,n,0,0,r,!1)}else this.sk(this.IM.uC[0],this.IM.dC[0],i,s,2,0,0,o,r+1,0,!1);return this.tv=this.LT,this.iv=this.vT,this.JL=2,this.QL=0,this.XO.Bt(t),this.XO.p2(i+this._S),this.XO.p2(s+this.CS),this.XO.p2(e),!0};nk=()=>{1===this.bT&&(this.LT>=549&&this.LT<=583&&this.vT>=195&&this.vT<231&&-1!==this.kv[0]?(this.XL=!0,this.xv=0,this.zL=!0):this.LT>=579&&this.LT<=609&&this.vT>=194&&this.vT<231&&-1!==this.kv[1]?(this.XL=!0,this.xv=1,this.zL=!0):this.LT>=607&&this.LT<=637&&this.vT>=194&&this.vT<231&&-1!==this.kv[2]?(this.XL=!0,this.xv=2,this.zL=!0):this.LT>=635&&this.LT<=679&&this.vT>=194&&this.vT<229&&-1!==this.kv[3]?(this.XL=!0,this.xv=3,this.zL=!0):this.LT>=676&&this.LT<=706&&this.vT>=194&&this.vT<231&&-1!==this.kv[4]?(this.XL=!0,this.xv=4,this.zL=!0):this.LT>=704&&this.LT<=734&&this.vT>=194&&this.vT<231&&-1!==this.kv[5]?(this.XL=!0,this.xv=5,this.zL=!0):this.LT>=732&&this.LT<=766&&this.vT>=195&&this.vT<231&&-1!==this.kv[6]?(this.XL=!0,this.xv=6,this.zL=!0):this.LT>=550&&this.LT<=584&&this.vT>=492&&this.vT<528&&-1!==this.kv[7]?(this.XL=!0,this.xv=7,this.zL=!0):this.LT>=582&&this.LT<=612&&this.vT>=492&&this.vT<529&&-1!==this.kv[8]?(this.XL=!0,this.xv=8,this.zL=!0):this.LT>=609&&this.LT<=639&&this.vT>=492&&this.vT<529&&-1!==this.kv[9]?(this.XL=!0,this.xv=9,this.zL=!0):this.LT>=637&&this.LT<=681&&this.vT>=493&&this.vT<528&&-1!==this.kv[10]?(this.XL=!0,this.xv=10,this.zL=!0):this.LT>=679&&this.LT<=709&&this.vT>=492&&this.vT<529&&-1!==this.kv[11]?(this.XL=!0,this.xv=11,this.zL=!0):this.LT>=706&&this.LT<=736&&this.vT>=492&&this.vT<529&&-1!==this.kv[12]?(this.XL=!0,this.xv=12,this.zL=!0):this.LT>=734&&this.LT<=768&&this.vT>=492&&this.vT<528&&-1!==this.kv[13]&&(this.XL=!0,this.xv=13,this.zL=!0),Jt.gO++,Jt.gO>150&&(Jt.gO=0,this.XO.Bt(et.Ld),this.XO.p1(43)))};fk=async()=>{for(;;){let t;do{for(;;){if(t=this.zT(),-1===t)return;if(-1!==this.qL&&this.qL===this.NR){8===t&&this.kR.length>0&&(this.kR=this.kR.substring(0,this.kR.length-1));break}if(this.Bv){if(t>=32&&t<=122&&this.Hv.length<80&&(this.Hv=this.Hv+String.fromCharCode(t),this.jL=!0),8===t&&this.Hv.length>0&&(this.Hv=this.Hv.substring(0,this.Hv.length-1),this.jL=!0),13===t||10===t){let t;if(this.Bv=!1,this.jL=!0,1===this.Wv&&(t=K.Fl(this.Hv),this.Zk(t)),2===this.Wv&&this.xM>0&&(t=K.Fl(this.Hv),this.$k(t)),3===this.Wv&&this.Hv.length>0&&this.XM){this.XO.Bt(et.Lu),this.XO.p1(0);const t=this.XO.bt;this.XO.Yt(this.XM),rt.Ky(this.XO,this.Hv),this.XO.Xt(this.XO.bt-t),this.Hv=K.Bl(this.Hv),this.Hv=nt.filter(this.Hv),this.Vk(6,this.Hv,K.Wl(K.Ul(this.XM))),2===this.Nv&&(this.Nv=1,this.ZL=!0,this.XO.Bt(et.Mw),this.XO.p1(this.Dv),this.XO.p1(this.Nv),this.XO.p1(this.Pv))}4===this.Wv&&this.Av<100&&(t=K.Fl(this.Hv),this.qk(t)),5===this.Wv&&this.Av>0&&(t=K.Fl(this.Hv),this.Jk(t))}}else if(this.Vv){if(t>=48&&t<=57&&this.Yv.length<10&&(this.Yv=this.Yv+String.fromCharCode(t),this.jL=!0),8===t&&this.Yv.length>0&&(this.Yv=this.Yv.substring(0,this.Yv.length-1),this.jL=!0),13===t||10===t){if(this.Yv.length>0){let t=0;try{t=parseInt(this.Yv,10)}catch(t){}this.XO.Bt(et.gw),this.XO.p4(t)}this.Vv=!1,this.jL=!0}}else if(-1===this.uv&&(t>=32&&t<=122&&this.Jv.length<80&&(this.Jv=this.Jv+String.fromCharCode(t),this.jL=!0),8===t&&this.Jv.length>0&&(this.Jv=this.Jv.substring(0,this.Jv.length-1),this.jL=!0),(13===t||10===t)&&this.Jv.length>0)){if('::clientdrop'===this.Jv)await this.jx();else if(this.LM&&'::noclip'===this.Jv)for(let t=0;t<gt.Nm;t++)for(let i=1;i<gt.Pm-1;i++)for(let s=1;s<gt.Pm-1;s++){const h=this.SS[t];h&&(h.flags[gt.index(i,s)]=0)}else if('::debug'===this.Jv)Jt.AO=!Jt.AO;else if('::chat'===this.Jv)Jt.pO=(Jt.pO+1)%3;else if(this.Jv.startsWith('::fps '))try{this.jT(parseInt(this.Jv.substring(6),10))}catch(t){}else if(this.Jv.startsWith('::camera'))Jt.mO=!Jt.mO,this.ZR=Jt.mO,this.WS=52,this.YS=52,this.jS=52,this.zS=52,this.ZS=1e3,this.VS=1e3;else if(this.Jv.startsWith('::camsrc ')){const t=this.Jv.split(' ');3===t.length?(this.jS=parseInt(t[1],10),this.zS=parseInt(t[2],10)):4===t.length&&(this.jS=parseInt(t[1],10),this.zS=parseInt(t[2],10),this.ZS=parseInt(t[3],10))}else if(this.Jv.startsWith('::camdst ')){const t=this.Jv.split(' ');3===t.length?(this.WS=parseInt(t[1],10),this.YS=parseInt(t[2],10)):4===t.length&&(this.WS=parseInt(t[1],10),this.YS=parseInt(t[2],10),this.VS=parseInt(t[3],10))}if(this.Jv.startsWith('::'))this.XO.Bt(et.Dw),this.XO.p1(this.Jv.length-1),this.XO.Vt(this.Jv.substring(2));else{let t=0;this.Jv.startsWith('yellow:')?(t=0,this.Jv=this.Jv.substring(7)):this.Jv.startsWith('red:')?(t=1,this.Jv=this.Jv.substring(4)):this.Jv.startsWith('green:')?(t=2,this.Jv=this.Jv.substring(6)):this.Jv.startsWith('cyan:')?(t=3,this.Jv=this.Jv.substring(5)):this.Jv.startsWith('purple:')?(t=4,this.Jv=this.Jv.substring(7)):this.Jv.startsWith('white:')?(t=5,this.Jv=this.Jv.substring(6)):this.Jv.startsWith('flash1:')?(t=6,this.Jv=this.Jv.substring(7)):this.Jv.startsWith('flash2:')?(t=7,this.Jv=this.Jv.substring(7)):this.Jv.startsWith('flash3:')?(t=8,this.Jv=this.Jv.substring(7)):this.Jv.startsWith('glow1:')?(t=9,this.Jv=this.Jv.substring(6)):this.Jv.startsWith('glow2:')?(t=10,this.Jv=this.Jv.substring(6)):this.Jv.startsWith('glow3:')&&(t=11,this.Jv=this.Jv.substring(6));let i=0;this.Jv.startsWith('wave:')&&(i=1,this.Jv=this.Jv.substring(5)),this.Jv.startsWith('scroll:')&&(i=2,this.Jv=this.Jv.substring(7)),this.XO.Bt(et.Nw),this.XO.p1(0);const s=this.XO.bt;this.XO.p1(t),this.XO.p1(i),rt.Ky(this.XO,this.Jv),this.XO.Xt(this.XO.bt-s),this.Jv=K.Bl(this.Jv),this.Jv=nt.filter(this.Jv),this.IM&&this.IM.name&&(this.IM.x_=this.Jv,this.IM.D_=t,this.IM.N_=i,this.IM.k_=150,this.Vk(2,this.IM.x_,this.IM.name)),2===this.Dv&&(this.Dv=3,this.ZL=!0,this.XO.Bt(et.Mw),this.XO.p1(this.Dv),this.XO.p1(this.Nv),this.XO.p1(this.Pv))}this.Jv='',this.jL=!0}}}while((t<97||t>122)&&(t<65||t>90)&&(t<48||t>57)&&32!==t);this.kR.length<12&&(this.kR=this.kR+String.fromCharCode(t))}};rk=()=>{if(1===this.bT)if(this.LT>=8&&this.LT<=108&&this.vT>=490&&this.vT<=522)this.Dv=(this.Dv+1)%4,this.ZL=!0,this.jL=!0,this.XO.Bt(et.Mw),this.XO.p1(this.Dv),this.XO.p1(this.Nv),this.XO.p1(this.Pv);else if(this.LT>=137&&this.LT<=237&&this.vT>=490&&this.vT<=522)this.Nv=(this.Nv+1)%3,this.ZL=!0,this.jL=!0,this.XO.Bt(et.Mw),this.XO.p1(this.Dv),this.XO.p1(this.Nv),this.XO.p1(this.Pv);else if(this.LT>=275&&this.LT<=375&&this.vT>=490&&this.vT<=522)this.Pv=(this.Pv+1)%3,this.ZL=!0,this.jL=!0,this.XO.Bt(et.Mw),this.XO.p1(this.Dv),this.XO.p1(this.Nv),this.XO.p1(this.Pv);else if(this.LT>=416&&this.LT<=516&&this.vT>=490&&this.vT<=522){this.zk(),this.kR='',this.DR=!1;for(let t=0;t<X.$t.length;t++)if(X.$t[t]&&600===X.$t[t].dc)return void(this.NR=this.qL=X.$t[t].an)}};wk=(t,i,s,h,e,n,r,o)=>{if(this.Fv?this.Uv=32:this.Uv=0,this.Fv=!1,t>=n&&t<n+16&&i>=r&&i<r+16)o.jc-=4*this.$L,e&&(this.XL=!0);else if(t>=n&&t<n+16&&i>=r+h-16&&i<r+h)o.jc+=4*this.$L,e&&(this.XL=!0);else if(t>=n-this.Uv&&t<n+this.Uv+16&&i>=r+16&&i<r+h-16&&this.$L>0){let t=(h-32)*h/s|0;t<8&&(t=8);const n=i-r-(t/2|0)-16,l=h-t-32;o.jc=(s-h)*n/l|0,e&&(this.XL=!0),this.Fv=!0}};Xx=()=>{this.Kb||(this.Ix(),this.dT=null,this.ob=null,this.lb=null,this.ab=null,this.cb=null,this.fb=null,this.ub=null,this.wb=null,this.yb=null,this.Ab=null,this.Kb=new j(479,96),this.Yb=new j(168,160),C.clear(),this.wL?.draw(0,0),this.Wb=new j(190,261),this.Vb=new j(512,334),C.clear(),this.Xb=new j(501,61),this.jb=new j(288,40),this.zb=new j(269,66),this.eb=!0)};Nk=t=>{if(!t)return!1;for(let i=0;i<this.xM;i++)if(t.toLowerCase()===this.YM[i]?.toLowerCase())return!0;return!!this.IM&&t.toLowerCase()===this.IM.name?.toLowerCase()};Zk=t=>{if(0n===t)return;if(this.xM>=100)return void this.Vk(0,'Your friends list is full. Max of 100 hit','');const i=K.Wl(K.Ul(t));for(let s=0;s<this.xM;s++)if(this.VM[s]===t)return void this.Vk(0,i+' is already on your friend list','');for(let s=0;s<this.Av;s++)if(this.pv[s]===t)return void this.Vk(0,'Please remove '+i+' from your ignore list first','');this.IM&&this.IM.name&&i!==this.IM.name&&(this.YM[this.xM]=i,this.VM[this.xM]=t,this.KM[this.xM]=0,this.xM++,this.XL=!0,this.XO.Bt(et.kw),this.XO.Yt(t))};$k=t=>{if(0n!==t)for(let i=0;i<this.xM;i++)if(this.VM[i]===t){this.xM--,this.XL=!0;for(let t=i;t<this.xM;t++)this.YM[t]=this.YM[t+1],this.KM[t]=this.KM[t+1],this.VM[t]=this.VM[t+1];return this.XO.Bt(et.xw),void this.XO.Yt(t)}};qk=t=>{if(0n===t)return;if(this.Av>=100)return void this.Vk(0,'Your ignore list is full. Max of 100 hit','');const i=K.Wl(K.Ul(t));for(let s=0;s<this.Av;s++)if(this.pv[s]===t)return void this.Vk(0,i+' is already on your ignore list','');for(let s=0;s<this.xM;s++)if(this.VM[s]===t)return void this.Vk(0,'Please remove '+i+' from your friend list first','');this.pv[this.Av++]=t,this.XL=!0,this.XO.Bt(et.Rw),this.XO.Yt(t)};Jk=t=>{if(0n!==t)for(let i=0;i<this.Av;i++)if(this.pv[i]===t){this.Av--,this.XL=!0;for(let t=i;t<this.Av;t++)this.pv[t]=this.pv[t+1];return this.XO.Bt(et.Lw),void this.XO.Yt(t)}};Qk=(t,i)=>{const s=this.uM[this.MS][t][i];if(!s)return void this.YR?.XE(this.MS,t,i);let h=-99999999,e=null;for(let t=s.head();t;t=s.next()){const i=G.get(t.index);let s=i.sl;i.Qo&&(s*=t.count+1),s>h&&(h=s,e=t)}if(!e)return;s.ot(e);let n=-1,r=-1,o=0,l=0;for(let t=s.head();t;t=s.next())t.index!==e.index&&-1===n&&(n=t.index,o=t.count),t.index!==e.index&&t.index!==n&&-1===r&&(r=t.index,l=t.count);let a=null;-1!==n&&(a=G.get(n).Ko(o));let c=null;-1!==r&&(c=G.get(r).Ko(l));const f=t+(i<<7)+1610612736|0,u=G.get(e.index);this.YR?.KE(t,i,this.Ck(this.MS,128*t+64,128*i+64),this.MS,f,u.Ko(e.count),c,a)};Gm=(t,i,s,h,e,n,r)=>{if(i<1||s<1||i>102||s>102)return;if(Jt.Bi&&t!==this.MS)return;if(!this.YR)return;let o=0;if(r===R.Ne&&(o=this.YR.rg(t,i,s)),r===R.Pe&&(o=this.YR.og(t,s,i)),r===R.Fe&&(o=this.YR.lg(t,i,s)),r===R.Ue&&(o=this.YR.ag(t,i,s)),0!==o){const h=this.YR.cg(t,i,s,o),e=o>>14&32767,n=31&h,l=h>>6;if(r===R.Ne){this.YR?.Ym(t,i,s,1);const h=x.get(e);h.bn&&this.SS[t]?.Ym(i,s,n,l,h.Ln)}if(r===R.Pe&&this.YR?.zE(t,i,s),r===R.Fe){this.YR.Hm(t,i,s);const h=x.get(e);if(i+h.width>gt.Pm-1||s+h.width>gt.Pm-1||i+h.length>gt.Pm-1||s+h.length>gt.Pm-1)return;h.bn&&this.SS[t]?.Hm(i,s,h.width,h.length,l,h.Ln)}if(r===R.Ue){this.YR?.VE(t,i,s);const h=x.get(e);h.bn&&h.active&&this.SS[t]?.Bm(i,s)}}if(h>=0){let r=t;this.t_&&t<3&&!(2&~this.t_[1][i][s])&&(r=t+1),this.Qg&&xt.Gm(t,i,s,this.YR,this.Qg,this.fM,this.SS[t],h,n,e,r)}};zk=()=>{this.XO.Bt(et.Ew),-1!==this.fv&&(this.fv=-1,this.XL=!0,this.mR=!1,this.zL=!0),-1!==this.uv&&(this.uv=-1,this.jL=!0,this.mR=!1),this.qL=-1};jx=async()=>{this.qO>0?await this.tD():(this.Vb?.bind(),this._b?.mf(257,144,'Connection lost',B.ar),this._b?.mf(256,143,'Connection lost',B.lr),this._b?.mf(257,159,'Please wait - attempting to reestablish',B.ar),this._b?.mf(256,158,'Please wait - attempting to reestablish',B.lr),this.Vb?.draw(8,11),this.jR=0,this.stream?.close(),this.CT=!1,await this.Vx(this.username,this.password,!0),this.CT||await this.tD())};tD=async()=>{this.stream&&this.stream.close(),this.stream=null,this.CT=!1,this.nb=0,this.username='',this.password='',yt.lp(),this.Mk(),this.YR?.reset();for(let t=0;t<gt.Nm;t++)this.SS[t]?.reset();jt(),this.ox=null,this.hx=0,Jt.Bi||await this.gx('scape_main',12345678,4e4)};read=async()=>{if(!this.stream)return!1;try{let t=this.stream.available;if(0===t)return!1;if(-1===this.QO&&(await this.stream.xf(this.in.data,0,1),this.QO=255&this.in.data[0],this.JO&&(this.QO=this.QO-this.JO.Gt&255),this.packetSize=tt.Hf[this.QO],t--),-1===this.packetSize){if(t<=0)return!1;await this.stream.xf(this.in.data,0,1),this.packetSize=255&this.in.data[0],t--}if(-2===this.packetSize){if(t<=1)return!1;await this.stream.xf(this.in.data,0,2),this.in.bt=0,this.packetSize=this.in.St,t-=2}if(t<this.packetSize)return!1;if(this.in.bt=0,await this.stream.xf(this.in.data,0,this.packetSize),this.ZO=0,this.sb=this.ib,this.ib=this.tb,this.tb=this.QO,this.QO===ht.Xu){const t=this.in.St,i=this.in.Rt;return this.ER[t]=i,this.IR[t]!==i&&(this.IR[t]=i,await this.jk(t),this.XL=!0,-1!==this.Kv&&(this.jL=!0)),this.QO=-1,!0}if(this.QO===ht.vu){const t=this.in.Dt,i=this.in.st;let s=K.Wl(K.Ul(t));for(let h=0;h<this.xM;h++)if(t===this.VM[h]){this.KM[h]!==i&&(this.KM[h]=i,this.XL=!0,i>0&&this.Vk(5,s+' has logged in.',''),0===i&&this.Vk(5,s+' has logged out.','')),s=null;break}s&&this.xM<100&&(this.VM[this.xM]=t,this.YM[this.xM]=s,this.KM[this.xM]=i,this.xM++,this.XL=!0);let h=!1;for(;!h;){h=!0;for(let t=0;t<this.xM-1;t++)if(this.KM[t]!==Jt.dO&&this.KM[t+1]===Jt.dO||0===this.KM[t]&&0!==this.KM[t+1]){const i=this.KM[t];this.KM[t]=this.KM[t+1],this.KM[t+1]=i;const s=this.YM[t];this.YM[t]=this.YM[t+1],this.YM[t+1]=s;const e=this.VM[t];this.VM[t]=this.VM[t+1],this.VM[t+1]=e,this.XL=!0,h=!1}}return this.QO=-1,!0}if(this.QO===ht.xu)return this.$O=30*this.in.St,this.QO=-1,!0;if(this.QO===ht.Wu){const t=this.in.st,i=this.in.st;let s=-1;if(this.bS)for(let h=0;h<this.bS.length;h++)this.bS[h]===(t<<8)+i&&(s=h);if(-1!==s){const h=this.TS;if(h){const e=h[s];-1!==s&&e&&(this.db?.Xf(`m${t}_${i}`,e),this.VR=1)}}return this.QO=-1,!0}if(this.QO===ht.Eu)return this.iD(this.in,this.packetSize),this.QO=-1,!0;if(this.QO===ht.Ku){const t=this.in.St,i=this.in.St;if(this.ES===t&&this.gS===i&&0!==this.VR)return this.QO=-1,!0;this.ES=t,this.gS=i,this._S=8*(this.ES-6),this.CS=8*(this.gS-6),this.VR=1,this.Vb?.bind(),this._b?.mf(257,151,'Loading - please wait.',B.ar),this._b?.mf(256,150,'Loading - please wait.',B.lr),this.Vb?.draw(8,11);const s=(this.packetSize-2)/10|0;this.TS=new c(s,null),this.OS=new c(s,null),this.bS=new Int32Array(s),this.XO.Bt(et.dd),this.XO.p1(0);let h=0;for(let t=0;t<s;t++){const i=this.in.st,s=this.in.st,e=this.in.kt,n=this.in.kt;let r;this.bS[t]=(i<<8)+s,0!==e&&(r=await(this.db?.Kf(`m${i}_${s}`)),r&&a.Ot(r)!==e&&(r=void 0),r?this.TS[t]=r:(this.VR=0,this.XO.p1(0),this.XO.p1(i),this.XO.p1(s),h+=3)),0!==n&&(r=await(this.db?.Kf(`l${i}_${s}`)),r&&a.Ot(r)!==n&&(r=void 0),r?this.OS[t]=r:(this.VR=0,this.XO.p1(1),this.XO.p1(i),this.XO.p1(s),h+=3))}this.XO.Xt(h),this.Vb?.bind(),0===this.VR&&(this._b?.mf(257,166,'Map area updated since last visit, so load will take longer this time only',B.ar),this._b?.mf(256,165,'Map area updated since last visit, so load will take longer this time only',B.lr)),this.Vb?.draw(8,11);const e=this._S-this.LS,n=this.CS-this.vS;this.LS=this._S,this.vS=this.CS;for(let t=0;t<8192;t++){const i=this.rM[t];if(i){for(let t=0;t<10;t++)i.uC[t]-=e,i.dC[t]-=n;i.x-=128*e,i.z-=128*n}}for(let t=0;t<this.UO;t++){const i=this.JS[t];if(i){for(let t=0;t<10;t++)i.uC[t]-=e,i.dC[t]-=n;i.x-=128*e,i.z-=128*n}}let r=0,o=gt.Pm,l=1;e<0&&(r=gt.Pm-1,o=-1,l=-1);let f=0,u=gt.Pm,d=1;n<0&&(f=gt.Pm-1,u=-1,d=-1);for(let t=r;t!==o;t+=l)for(let i=f;i!==u;i+=d){const s=t+e,h=i+n;for(let e=0;e<gt.Nm;e++)s>=0&&h>=0&&s<gt.Pm&&h<gt.Pm?this.uM[e][t][i]=this.uM[e][s][h]:this.uM[e][t][i]=null}for(let t=this.dM.head();t;t=this.dM.next())t.x-=e,t.z-=n,(t.x<0||t.z<0||t.x>=gt.Pm||t.z>=gt.Pm)&&t.et();return 0!==this.jR&&(this.jR-=e,this.zR-=n),this.ZR=!1,this.QO=-1,!0}if(this.QO===ht.ou)return X.$t[this.in.St].model=this.IM?.Al()||null,this.QO=-1,!0;if(this.QO===ht.Mu)return this.mv=this.in.st,1===this.mv&&(this.Iv=this.in.St),this.mv>=2&&this.mv<=6&&(2===this.mv&&(this.Ev=64,this.gv=64),3===this.mv&&(this.Ev=0,this.gv=64),4===this.mv&&(this.Ev=128,this.gv=64),5===this.mv&&(this.Ev=64,this.gv=0),6===this.mv&&(this.Ev=64,this.gv=128),this.mv=2,this.Cv=this.in.St,this.Tv=this.in.St,this.Ov=this.in.st),10===this.mv&&(this._v=this.in.St),this.QO=-1,!0;if(this.QO===ht.qu){const t=this.in.Ft,i=this.in.kt,s=this.in.kt;return t!==this.ox&&this.nx&&!Jt.Bi&&await this.gx(t,i,s),this.ox=t,this.lx=i,this.ux=s,this.hx=0,this.QO=-1,!0}if(this.QO===ht.Uu)return await this.tD(),this.QO=-1,!1;if(this.QO===ht.Hu){const t=this.in.st,i=this.in.st;let s=-1;if(this.bS)for(let h=0;h<this.bS.length;h++)this.bS[h]===(t<<8)+i&&(s=h);if(-1!==s){const h=this.OS;if(h){const e=h[s];-1!==s&&e&&(this.db?.Xf(`l${t}_${i}`,e),this.VR=1)}}return this.QO=-1,!0}if(this.QO===ht.Ru)return this.jR=0,this.QO=-1,!0;if(this.QO===ht.Pu)return this._M=this.in.St,this.QO=-1,!0;if(this.QO===ht.ad||this.QO===ht.sd||this.QO===ht.nd||this.QO===ht.fd||this.QO===ht.od||this.QO===ht.ed||this.QO===ht.ud||this.QO===ht.hd||this.QO===ht.ld||this.QO===ht.rd)return this.sD(this.in,this.QO),this.QO=-1,!0;if(this.QO===ht.Zf){const t=this.in.St,i=this.in.St;return-1!==this.uv&&(this.uv=-1,this.jL=!0),this.Vv&&(this.Vv=!1,this.jL=!0),this.qL=t,this.fv=i,this.XL=!0,this.zL=!0,this.mR=!1,this.QO=-1,!0}if(this.QO===ht.ju){const t=this.in.St,i=this.in.kt;return this.ER[t]=i,this.IR[t]!==i&&(this.IR[t]=i,await this.jk(t),this.XL=!0,-1!==this.Kv&&(this.jL=!0)),this.QO=-1,!0}if(this.QO===ht.ru){const t=this.in.St;return X.$t[t].Mn=this.in.St,this.QO=-1,!0}if(this.QO===ht.$f){let t=this.in.St;const i=this.in.st;return 65535===t&&(t=-1),this.kv[i]=t,this.XL=!0,this.zL=!0,this.QO=-1,!0}if(this.QO===ht.Vu){const t=this.in.st,i=this.in.st,s=this.in.St,h=this.in.St;let e=-1;if(this.bS)for(let s=0;s<this.bS.length;s++)this.bS[s]===(t<<8)+i&&(e=s);if(-1!==e&&this.OS){this.OS[e]&&this.OS[e]?.length===h||(this.OS[e]=new Int8Array(h));const t=this.OS[e];t&&this.in.Ut(this.packetSize-6,s,t)}return this.QO=-1,!0}if(this.QO===ht._u){const t=yt.stop();return t&&(this.XO.Bt(et.Ad),this.XO.p2(t.bt),this.XO.Kt(t.data,t.bt,0),t.release()),this.QO=-1,!0}if(this.QO===ht.wu){this.XL=!0;const t=this.in.St,i=X.$t[t],s=this.in.st;if(i.gc&&i._c){for(let t=0;t<s;t++){i.gc[t]=this.in.St;let s=this.in.st;255===s&&(s=this.in.kt),i._c[t]=s}for(let t=s;t<i.gc.length;t++)i.gc[t]=0,i._c[t]=0}else for(let t=0;t<s;t++)this.in.St,255===this.in.st&&this.in.kt;return this.QO=-1,!0}if(this.QO===ht.Cu)return yt.op(),this.QO=-1,!0;if(this.QO===ht.Bu)return this.Bv=!1,this.Vv=!0,this.Yv='',this.jL=!0,this.QO=-1,!0;if(this.QO===ht.du){const t=X.$t[this.in.St];if(t.gc)for(let i=0;i<t.gc.length;i++)t.gc[i]=-1,t.gc[i]=0;return this.QO=-1,!0}if(this.QO===ht.Fu){if(this.PR=this.in.kt,this.FR=this.in.St,this.UR=this.in.st,this.BR=this.in.St,0!==this.PR&&-1===this.qL){this.zk();let t=650;201!==this.UR&&(t=655),this.kR='',this.DR=!1;for(let i=0;i<X.$t.length;i++)if(X.$t[i]&&X.$t[i].dc===t){this.qL=X.$t[i].an;break}}return this.QO=-1,!0}if(this.QO===ht.fu)return this.Mv=this.in.st,this.Mv===this.xv&&(3===this.Mv?this.xv=1:this.xv=3,this.XL=!0),this.QO=-1,!0;if(this.QO===ht.$u){if(this.nx&&!Jt.Bi){const t=this.in.St,i=this.in.kt,s=this.packetSize-6;Kt(wt.read(i,Int8Array.from(this.in.data),s,this.in.bt),this.wx),this.hx=t}return this.QO=-1,!0}if(this.QO===ht.Gu)return this.gM=this.in.st,this.QO=-1,!0;if(this.QO===ht.Zu){const t=this.in.St,i=this.in.st,s=this.in.St;return this.zM&&!Jt.Bi&&this.jM<50&&(this.ZM[this.jM]=t,this.qM[this.jM]=i,this.$M[this.jM]=s+at.wA[t],this.jM++),this.QO=-1,!0}if(this.QO===ht.au){const t=this.in.St,i=this.in.St,s=H.get(i);return X.$t[t].model=s.Al(),this.QO=-1,!0}if(this.QO===ht.Ju)return this.ph=this.in.st,this.Ih=this.in.st,this.QO=-1,!0;if(this.QO===ht.nu){const t=this.in.St,i=this.in.St,s=this.in.St,h=X.$t[t].model;return h?.Te(i,s),this.QO=-1,!0}if(this.QO===ht.bu)return this.Dv=this.in.st,this.Nv=this.in.st,this.Pv=this.in.st,this.ZL=!0,this.jL=!0,this.QO=-1,!0;if(this.QO===ht.Qf){const t=this.in.St;return this.hD(t),-1!==this.uv&&(this.uv=-1,this.jL=!0),this.Vv&&(this.Vv=!1,this.jL=!0),this.fv=t,this.XL=!0,this.zL=!0,this.qL=-1,this.mR=!1,this.QO=-1,!0}if(this.QO===ht.zf){const t=this.in.St;return this.hD(t),-1!==this.fv&&(this.fv=-1,this.XL=!0,this.zL=!0),this.uv=t,this.jL=!0,this.qL=-1,this.mR=!1,this.QO=-1,!0}if(this.QO===ht.cu){const t=this.in.St,i=this.in.Mt,s=this.in.Mt,h=X.$t[t];return h.x=i,h.y=s,this.QO=-1,!0}if(this.QO===ht.mu)return this.ZR=!0,this.jS=this.in.st,this.zS=this.in.st,this.ZS=this.in.St,this.qS=this.in.st,this.$S=this.in.st,this.$S>=100&&(this.lS=128*this.jS+64,this.cS=128*this.zS+64,this.aS=this.Ck(this.MS,this.jS,this.zS)-this.ZS),this.QO=-1,!0;if(this.QO===ht.Qu){this.ph=this.in.st,this.Ih=this.in.st;for(let t=this.ph;t<this.ph+8;t++)for(let i=this.Ih;i<this.Ih+8;i++)this.uM[this.MS][t][i]&&(this.uM[this.MS][t][i]=null,this.Qk(t,i));for(let t=this.dM.head();t;t=this.dM.next())t.x>=this.ph&&t.x<this.ph+8&&t.z>=this.Ih&&t.z<this.Ih+8&&t.m_===this.MS&&(this.Gm(t.m_,t.x,t.z,t.E_,t.g_,t.__,t.an),t.et());return this.QO=-1,!0}if(this.QO===ht.Yu){const t=this.in.st,i=this.in.st,s=this.in.St,h=this.in.St;let e=-1;if(this.bS)for(let s=0;s<this.bS.length;s++)this.bS[s]===(t<<8)+i&&(e=s);if(-1!==e&&this.TS){this.TS[e]&&this.TS[e]?.length===h||(this.TS[e]=new Int8Array(h));const t=this.TS[e];t&&this.in.Ut(this.packetSize-6,s,t)}return this.QO=-1,!0}if(this.QO===ht.Lu){const t=this.in.Dt,i=this.in.kt,s=this.in.st;let h=!1;for(let t=0;t<100;t++)if(this.zv[t]===i){h=!0;break}if(s<=1)for(let i=0;i<this.Av;i++)if(this.pv[i]===t){h=!0;break}if(!h&&0===this.sv)try{this.zv[this.Zv]=i,this.Zv=(this.Zv+1)%100;const h=rt.Jt(this.in,this.packetSize-13),e=nt.filter(h);s>1?this.Vk(7,e,K.Wl(K.Ul(t))):this.Vk(3,e,K.Wl(K.Ul(t)))}catch(t){}return this.QO=-1,!0}if(this.QO===ht.zu){for(let t=0;t<this.IR.length;t++)this.IR[t]!==this.ER[t]&&(this.IR[t]=this.ER[t],await this.jk(t),this.XL=!0);return this.QO=-1,!0}if(this.QO===ht.eu){const t=this.in.St,i=this.in.St;return X.$t[t].model=v.model(i),this.QO=-1,!0}if(this.QO===ht.uu)return this.Kv=this.in.Mt,this.jL=!0,this.QO=-1,!0;if(this.QO===ht.Du)return 12===this.xv&&(this.XL=!0),this.EM=this.in.st,this.QO=-1,!0;if(this.QO===ht.Au){if(this.ZR=!0,this.WS=this.in.st,this.YS=this.in.st,this.VS=this.in.St,this.KS=this.in.st,this.XS=this.in.st,this.XS>=100){const t=128*this.WS+64,i=128*this.YS+64,s=this.Ck(this.MS,this.WS,this.YS)-this.VS,h=t-this.lS,e=s-this.aS,n=i-this.cS,r=0|Math.sqrt(h*h+n*n);this.fS=325.949*Math.atan2(e,r)&2047,this.uS=-325.949*Math.atan2(h,n)&2047,this.fS<128&&(this.fS=128),this.fS>383&&(this.fS=383)}return this.QO=-1,!0}if(this.QO===ht.hu)return this.xv=this.in.st,this.XL=!0,this.zL=!0,this.QO=-1,!0;if(this.QO===ht.Tu){const t=this.in.Ft;let i;if(t.endsWith(':tradereq:')){const s=t.substring(0,t.indexOf(':'));i=K.Fl(s);let h=!1;for(let t=0;t<this.Av;t++)if(this.pv[t]===i){h=!0;break}h||0!==this.sv||this.Vk(4,'wishes to trade with you.',s)}else if(t.endsWith(':duelreq:')){const s=t.substring(0,t.indexOf(':'));i=K.Fl(s);let h=!1;for(let t=0;t<this.Av;t++)if(this.pv[t]===i){h=!0;break}h||0!==this.sv||this.Vk(8,'wishes to duel with you.',s)}else this.Vk(0,t,'');return this.QO=-1,!0}if(this.QO===ht.su){const t=this.in.St,i=this.in.St,s=this.in.St,h=G.get(i);return X.$t[t].model=h.Ko(50),X.$t[t].Wc=h.Xo,X.$t[t].Yc=h.zo,X.$t[t].zoom=100*h.jo/s|0,this.QO=-1,!0}if(this.QO===ht.Jf){const t=this.in.St;return this.hD(t),-1!==this.fv&&(this.fv=-1,this.XL=!0,this.zL=!0),-1!==this.uv&&(this.uv=-1,this.jL=!0),this.Vv&&(this.Vv=!1,this.jL=!0),this.qL=t,this.mR=!1,this.QO=-1,!0}if(this.QO===ht.tu){const t=this.in.St,i=this.in.St,s=i>>10&31,h=i>>5&31,e=31&i;return X.$t[t].Nc=(s<<19)+(h<<11)+(e<<3),this.QO=-1,!0}if(this.QO===ht.Nu){for(let t=0;t<this.JS.length;t++){const i=this.JS[t];i&&(i.j_=-1)}for(let t=0;t<this.rM.length;t++){const i=this.rM[t];i&&(i.j_=-1)}return this.QO=-1,!0}if(this.QO===ht.iu){const t=this.in.St;return X.$t[t].hide=1===this.in.st,this.QO=-1,!0}if(this.QO===ht.Ou){this.Av=this.packetSize/8|0;for(let t=0;t<this.Av;t++)this.pv[t]=this.in.Dt;return this.QO=-1,!0}if(this.QO===ht.Iu){this.ZR=!1;for(let t=0;t<5;t++)this.eS[t]=!1;return this.QO=-1,!0}if(this.QO===ht.qf)return-1!==this.fv&&(this.fv=-1,this.XL=!0,this.zL=!0),-1!==this.uv&&(this.uv=-1,this.jL=!0),this.Vv&&(this.Vv=!1,this.jL=!0),this.qL=-1,this.mR=!1,this.QO=-1,!0;if(this.QO===ht.lu){const t=this.in.St;return X.$t[t].text=this.in.Ft,X.$t[t].an===this.kv[this.xv]&&(this.XL=!0),this.QO=-1,!0}if(this.QO===ht.ku){this.XL=!0;const t=this.in.st,i=this.in.kt,s=this.in.st;this.bv[t]=i,this.Lv[t]=s,this.vv[t]=1;for(let s=0;s<98;s++)i>=this.Rv[s]&&(this.vv[t]=s+2);return this.QO=-1,!0}if(this.QO===ht.td){for(this.ph=this.in.st,this.Ih=this.in.st;this.in.bt<this.packetSize;){const t=this.in.st;this.sD(this.in,t)}return this.QO=-1,!0}if(this.QO===ht.Su)return 12===this.xv&&(this.XL=!0),this.CM=this.in.Mt,this.QO=-1,!0;if(this.QO===ht.pu){const t=this.in.st,i=this.in.st,s=this.in.st,h=this.in.st;return this.eS[t]=!0,this.nS[t]=i,this.rS[t]=s,this.oS[t]=h,this.hS[t]=0,this.QO=-1,!0}if(this.QO===ht.yu){this.XL=!0;const t=this.in.St,i=X.$t[t];for(;this.in.bt<this.packetSize;){const t=this.in.st,s=this.in.St;let h=this.in.st;255===h&&(h=this.in.kt),i.gc&&i._c&&t>=0&&t<i.gc.length&&(i.gc[t]=s,i._c[t]=h)}return this.QO=-1,!0}if(this.QO===ht.gu)return this.mx=!this.mx,this.eD(this.in,this.packetSize),1===this.VR&&(this.VR=2,xt.jg=this.MS,this.nD()),Jt.Bi&&2===this.VR&&xt.jg!==this.MS&&(this.Vb?.bind(),this._b?.mf(257,151,'Loading - please wait.',B.ar),this._b?.mf(256,150,'Loading - please wait.',B.lr),this.Vb?.draw(8,11),xt.jg=this.MS,this.nD()),this.MS!==this.IS&&2===this.VR&&(this.IS=this.MS,this.Wk(this.MS)),this.QO=-1,!0;await this.tD()}catch(t){console.log(t),await this.jx()}return!0};nD=()=>{try{this.IS=-1,this.xE.clear(),this.fM.clear(),this.cM.clear(),this.aM.clear(),O.ls(),this.Mk(),this.YR?.reset();for(let t=0;t<gt.Nm;t++)this.SS[t]?.reset();const t=new xt(gt.Pm,gt.Pm,this.Qg,this.t_);xt.Bi=Jt.Bi;const i=this.TS?.length??0;if(this.bS)for(let t=0;t<i;t++){const i=this.bS[t]>>8,s=255&this.bS[t];if(33===i&&s>=71&&s<=73){xt.Bi=!1;break}}if(Jt.Bi?this.YR?.BE(this.MS):this.YR?.BE(0),this.bS&&this.TS){this.XO.Bt(et.wd);for(let s=0;s<i;s++){const i=64*(this.bS[s]>>8)-this._S,h=64*(255&this.bS[s])-this.CS,e=this.TS[s];if(e){const s=new a(new Uint8Array(e)).kt,n=wt.read(s,e,e.length-4,4);t.A_(8*(this.ES-6),8*(this.gS-6),i,h,n)}else this.gS<800&&t.y_(h,i,64,64)}}if(this.bS&&this.OS){this.XO.Bt(et.wd);for(let s=0;s<i;s++){const i=this.OS[s];if(i){const h=new a(new Uint8Array(i)).kt,e=wt.read(h,i,i.length-4,4),n=64*(this.bS[s]>>8)-this._S,r=64*(255&this.bS[s])-this.CS;t.p_(this.YR,this.fM,this.SS,e,n,r)}}}this.XO.Bt(et.wd),t.d_(this.YR,this.SS),this.Vb?.bind(),this.XO.Bt(et.wd);for(let t=this.fM.head();t;t=this.fM.next())2===(this.t_&&2&this.t_[1][t.Bg][t.Gg])&&(t.Fg--,t.Fg<0&&t.et());for(let t=0;t<gt.Pm;t++)for(let i=0;i<gt.Pm;i++)this.Qk(t,i);for(let t=this.dM.head();t;t=this.dM.next())this.Gm(t.m_,t.x,t.z,t.I_,t.angle,t.shape,t.an)}catch(t){}x.pn?.clear(),O.ys(20)};hD=t=>{const i=X.$t[t];if(i.mc)for(let t=0;t<i.mc.length&&-1!==i.mc[t];t++){const s=X.$t[i.mc[t]];1===s.type&&this.hD(s.id),s.zc=0,s.Zc=0}};Dx=()=>{let t=0;for(let i=0;i<99;i++){const s=i+1;t+=s+300*Math.pow(2,s/7)|0,this.Rv[i]=t/4|0}};Vk=(t,i,s)=>{0===t&&-1!==this.Kv&&(this.Sv=i,this.bT=0),-1===this.uv&&(this.jL=!0);for(let t=99;t>0;t--)this.messageType[t]=this.messageType[t-1],this.jv[t]=this.jv[t-1],this.Xv[t]=this.Xv[t-1];Jt.AO&&0===t&&(i='['+(this.VO/30|0)+']: '+i),this.messageType[0]=t,this.jv[0]=s,this.Xv[0]=i};jk=async t=>{const i=V.$t[t].xl;if(0!==i){const s=this.IR[t];if(1===i&&(1===s&&O.ds(.9),2===s&&O.ds(.8),3===s&&O.ds(.7),4===s&&O.ds(.6),G.Uo?.clear(),this.eb=!0),3===i){const t=this.nx;0===s&&(this.wx=256,Xt(256),this.nx=!0),1===s&&(this.wx=192,Xt(192),this.nx=!0),2===s&&(this.wx=128,Xt(128),this.nx=!0),3===s&&(this.wx=64,Xt(64),this.nx=!0),4===s&&(this.nx=!1),this.nx!==t&&(this.nx&&this.ox?await this.gx(this.ox,this.lx,this.ux):jt(),this.hx=0)}4===i&&(0===s&&(this.JM=256,Vt(256),this.zM=!0),1===s&&(this.JM=192,Vt(192),this.zM=!0),2===s&&(this.JM=128,Vt(128),this.zM=!0),3===s&&(this.JM=64,Vt(64),this.zM=!0),4===s&&(this.zM=!1)),5===i&&(this.OR=s),6===i&&(this.$v=s),8===i&&(this.qv=s,this.jL=!0)}};rD=(t,i)=>{let s=0;for(let t=0;t<100;t++){if(!this.Xv[t])continue;const h=this.messageType[t],e=this.yv+70+4-14*s;if(e<-20)break;0===h&&s++,1!==h&&2!==h||!(1===h||0===this.Dv||1===this.Dv&&this.Nk(this.jv[t]))||(i>e-14&&i<=e&&this.IM&&this.jv[t]!==this.IM.name&&(this.LM&&(this.cv[this.av]='Report abuse @whi@'+this.jv[t],this.bR[this.av]=34,this.av++),this.cv[this.av]='Add ignore @whi@'+this.jv[t],this.bR[this.av]=436,this.av++,this.cv[this.av]='Add friend @whi@'+this.jv[t],this.bR[this.av]=406,this.av++),s++),3!==h&&7!==h||0!==this.qv||!(7===h||0===this.Nv||1===this.Nv&&this.Nk(this.jv[t]))||(i>e-14&&i<=e&&(this.LM&&(this.cv[this.av]='Report abuse @whi@'+this.jv[t],this.bR[this.av]=34,this.av++),this.cv[this.av]='Add ignore @whi@'+this.jv[t],this.bR[this.av]=436,this.av++,this.cv[this.av]='Add friend @whi@'+this.jv[t],this.bR[this.av]=406,this.av++),s++),4===h&&(0===this.Pv||1===this.Pv&&this.Nk(this.jv[t]))&&(i>e-14&&i<=e&&(this.cv[this.av]='Accept trade @whi@'+this.jv[t],this.bR[this.av]=903,this.av++),s++),(5===h||6===h)&&0===this.qv&&this.Nv<2&&s++,8===h&&(0===this.Pv||1===this.Pv&&this.Nk(this.jv[t]))&&(i>e-14&&i<=e&&(this.cv[this.av]='Accept duel @whi@'+this.jv[t],this.bR[this.av]=363,this.av++),s++)}};oD=t=>{if(0===this.qv)return;let i=0;0!==this.$O&&(i=1);for(let s=0;s<100;s++)if(null!==this.Xv[s]){const h=this.messageType[s];if((3===h||7===h)&&(7===h||0===this.Nv||1===this.Nv&&this.Nk(this.jv[s]))){const h=329-13*i;if(this.gh>8&&this.gh<520&&t-11>h-10&&t-11<=h+3&&(this.LM&&(this.cv[this.av]='Report abuse @whi@'+this.jv[s],this.bR[this.av]=2034,this.av++),this.cv[this.av]='Add ignore @whi@'+this.jv[s],this.bR[this.av]=2436,this.av++,this.cv[this.av]='Add friend @whi@'+this.jv[s],this.bR[this.av]=2406,this.av++),i++,i>=5)return}if((5===h||6===h)&&this.Nv<2&&(i++,i>=5))return}};lD=(t,i,s,h,e,n)=>{if(0!==t.type||!t.mc||t.hide||i<h||s<e||i>h+t.width||s>e+t.height||!t.Ic||!t.Ec)return;const r=t.mc.length;for(let o=0;o<r;o++){let r=t.Ic[o]+h,l=t.Ec[o]+e-n;const a=X.$t[t.mc[o]];if(r+=a.x,l+=a.y,(a.wc>=0||0!==a.Fc)&&i>=r&&s>=l&&i<r+a.width&&s<l+a.height&&(a.wc>=0?this.xR=a.wc:this.xR=a.id),0===a.type)this.lD(a,i,s,r,l,a.jc),a.scroll>a.height&&this.wk(i,s,a.scroll,a.height,!0,r+a.width,l,a);else if(2===a.type){let t=0;for(let h=0;h<a.height;h++)for(let e=0;e<a.width;e++){let n=r+e*(a.Oc+32),o=l+h*(a.bc+32);if(t<20&&a.Lc&&a.vc&&(n+=a.Lc[t],o+=a.vc[t]),i<n||s<o||i>=n+32||s>=o+32){t++;continue}if(this.MR=t,this.SR=a.id,!a.gc||a.gc[t]<=0){t++;continue}const c=G.get(a.gc[t]-1);if(1===this.aR&&a.Cc)a.id===this.fR&&t===this.cR||(this.cv[this.av]='Use '+this.dR+' with @lre@'+c.name,this.bR[this.av]=881,this.LR[this.av]=c.id,this.vR[this.av]=t,this.RR[this.av]=a.id,this.av++);else if(1===this.gR&&a.Cc)16&~this.CR||(this.cv[this.av]=this.TR+' @lre@'+c.name,this.bR[this.av]=391,this.LR[this.av]=c.id,this.vR[this.av]=t,this.RR[this.av]=a.id,this.av++);else{if(a.Cc)for(let i=4;i>=3;i--)c.Ho&&c.Ho[i]?(this.cv[this.av]=c.Ho[i]+' @lre@'+c.name,3===i?this.bR[this.av]=478:4===i&&(this.bR[this.av]=347),this.LR[this.av]=c.id,this.vR[this.av]=t,this.RR[this.av]=a.id,this.av++):4===i&&(this.cv[this.av]='Drop @lre@'+c.name,this.bR[this.av]=347,this.LR[this.av]=c.id,this.vR[this.av]=t,this.RR[this.av]=a.id,this.av++);if(a.Tc&&(this.cv[this.av]='Use @lre@'+c.name,this.bR[this.av]=188,this.LR[this.av]=c.id,this.vR[this.av]=t,this.RR[this.av]=a.id,this.av++),a.Cc&&c.Ho)for(let i=2;i>=0;i--)c.Ho[i]&&(this.cv[this.av]=c.Ho[i]+' @lre@'+c.name,0===i?this.bR[this.av]=405:1===i?this.bR[this.av]=38:2===i&&(this.bR[this.av]=422),this.LR[this.av]=c.id,this.vR[this.av]=t,this.RR[this.av]=a.id,this.av++);if(a.Mc)for(let i=4;i>=0;i--)a.Mc[i]&&(this.cv[this.av]=a.Mc[i]+' @lre@'+c.name,0===i?this.bR[this.av]=602:1===i?this.bR[this.av]=596:2===i?this.bR[this.av]=22:3===i?this.bR[this.av]=892:4===i&&(this.bR[this.av]=415),this.LR[this.av]=c.id,this.vR[this.av]=t,this.RR[this.av]=a.id,this.av++);this.cv[this.av]='Examine @lre@'+c.name,Jt.AO&&(this.cv[this.av]+='@whi@ ('+c.id+')'),this.bR[this.av]=1773,this.LR[this.av]=c.id,a._c&&(this.RR[this.av]=a._c[t]),this.av++}t++}}else if(i>=r&&s>=l&&i<r+a.width&&s<l+a.height)if(a.uc===X.Ql){let t=!1;0!==a.dc&&(t=this.aD(a)),!t&&a.Xc&&(this.cv[this.av]=a.Xc,this.bR[this.av]=951,this.RR[this.av]=a.id,this.av++)}else if(a.uc===X.ta&&0===this.gR){let t=a.Vc;t&&-1!==t.indexOf(' ')&&(t=t.substring(0,t.indexOf(' '))),this.cv[this.av]=t+' @gre@'+a.action,this.bR[this.av]=930,this.RR[this.av]=a.id,this.av++}else a.uc===X.ia?(this.cv[this.av]='Close',this.bR[this.av]=947,this.RR[this.av]=a.id,this.av++):a.uc===X.sa&&a.Xc?(this.cv[this.av]=a.Xc,this.bR[this.av]=465,this.RR[this.av]=a.id,this.av++):a.uc===X.ha&&a.Xc?(this.cv[this.av]=a.Xc,this.bR[this.av]=960,this.RR[this.av]=a.id,this.av++):a.uc===X.ea&&!this.mR&&a.Xc&&(this.cv[this.av]=a.Xc,this.bR[this.av]=44,this.RR[this.av]=a.id,this.av++)}};aD=t=>{let i=t.dc;return i>=X.na&&i<=X.la?(i>=X.oa?i-=X.oa:i--,this.cv[this.av]='Remove @whi@'+this.YM[i],this.bR[this.av]=557,this.av++,this.cv[this.av]='Message @whi@'+this.YM[i],this.bR[this.av]=679,this.av++,!0):i>=X.Ha&&i<=X.Wa&&(this.cv[this.av]='Remove @whi@'+t.text,this.bR[this.av]=556,this.av++,!0)};cD=()=>{0===this.aR&&0===this.gR&&(this.cv[this.av]='Walk here',this.bR[this.av]=660,this.vR[this.av]=this.gh,this.RR[this.av]=this._h,this.av++);let t=-1;for(let i=0;i<v.Ch;i++){const s=v.Th[i],h=127&s,e=s>>7&127,n=s>>29&3,r=s>>14&32767;if(s!==t){if(t=s,2===n&&this.YR&&this.YR.cg(this.MS,h,e,s)>=0){const t=x.get(r);if(1===this.aR)this.cv[this.av]='Use '+this.dR+' with @cya@'+t.name,this.bR[this.av]=450,this.LR[this.av]=s,this.vR[this.av]=h,this.RR[this.av]=e,this.av++;else if(1!==this.gR){if(t.gn)for(let i=4;i>=0;i--)t.gn[i]&&(this.cv[this.av]=t.gn[i]+' @cya@'+t.name,0===i&&(this.bR[this.av]=285),1===i&&(this.bR[this.av]=504),2===i&&(this.bR[this.av]=364),3===i&&(this.bR[this.av]=581),4===i&&(this.bR[this.av]=1501),this.LR[this.av]=s,this.vR[this.av]=h,this.RR[this.av]=e,this.av++);this.cv[this.av]='Examine @cya@'+t.name,Jt.AO&&(this.cv[this.av]+='@whi@ ('+t.id+')'),this.bR[this.av]=1175,this.LR[this.av]=s,this.vR[this.av]=h,this.RR[this.av]=e,this.av++}else 4&~this.CR||(this.cv[this.av]=this.TR+' @cya@'+t.name,this.bR[this.av]=55,this.LR[this.av]=s,this.vR[this.av]=h,this.RR[this.av]=e,this.av++)}if(1===n){const t=this.rM[r];if(t&&t.type&&1===t.type.size&&64==(127&t.x)&&64==(127&t.z))for(let i=0;i<this.oM;i++){const s=this.rM[this.lM[i]];s&&s!==t&&s.type&&1===s.type.size&&s.x===t.x&&s.z===t.z&&this.fD(s.type,this.lM[i],h,e)}t&&t.type&&this.fD(t.type,r,h,e)}if(0===n){const t=this.JS[r];if(t&&64==(127&t.x)&&64==(127&t.z)){for(let i=0;i<this.oM;i++){const s=this.rM[this.lM[i]];s&&s.type&&1===s.type.size&&s.x===t.x&&s.z===t.z&&this.fD(s.type,this.lM[i],h,e)}for(let i=0;i<this.QS;i++){const s=this.JS[this.tM[i]];s&&s!==t&&s.x===t.x&&s.z===t.z&&this.uD(s,this.tM[i],h,e)}}t&&this.uD(t,r,h,e)}if(3===n){const t=this.uM[this.MS][h][e];if(!t)continue;for(let i=t.ct();i;i=t.ht()){const t=G.get(i.index);if(1===this.aR)this.cv[this.av]='Use '+this.dR+' with @lre@'+t.name,this.bR[this.av]=217,this.LR[this.av]=i.index,this.vR[this.av]=h,this.RR[this.av]=e,this.av++;else if(1!==this.gR){for(let s=4;s>=0;s--)t.gn&&t.gn[s]?(this.cv[this.av]=t.gn[s]+' @lre@'+t.name,0===s&&(this.bR[this.av]=224),1===s&&(this.bR[this.av]=993),2===s&&(this.bR[this.av]=99),3===s&&(this.bR[this.av]=746),4===s&&(this.bR[this.av]=877),this.LR[this.av]=i.index,this.vR[this.av]=h,this.RR[this.av]=e,this.av++):2===s&&(this.cv[this.av]='Take @lre@'+t.name,this.bR[this.av]=99,this.LR[this.av]=i.index,this.vR[this.av]=h,this.RR[this.av]=e,this.av++);this.cv[this.av]='Examine @lre@'+t.name,Jt.AO&&(this.cv[this.av]+='@whi@ ('+i.index+')'),this.bR[this.av]=1102,this.LR[this.av]=i.index,this.vR[this.av]=h,this.RR[this.av]=e,this.av++}else 1&~this.CR||(this.cv[this.av]=this.TR+' @lre@'+t.name,this.bR[this.av]=965,this.LR[this.av]=i.index,this.vR[this.av]=h,this.RR[this.av]=e,this.av++)}}}}};fD=(t,i,s,h)=>{if(this.av>=400)return;let e=t.name;if(0!==t.Tl&&this.IM&&(e=e+this.dD(this.IM.PC,t.Tl)+' (level-'+t.Tl+')'),1===this.aR)this.cv[this.av]='Use '+this.dR+' with @yel@'+e,this.bR[this.av]=900,this.LR[this.av]=i,this.vR[this.av]=s,this.RR[this.av]=h,this.av++;else if(1!==this.gR){let n;if(t.gn)for(n=4;n>=0;n--)t.gn[n]&&'attack'!==t.gn[n]?.toLowerCase()&&(this.cv[this.av]=t.gn[n]+' @yel@'+e,0===n?this.bR[this.av]=728:1===n?this.bR[this.av]=542:2===n?this.bR[this.av]=6:3===n?this.bR[this.av]=963:4===n&&(this.bR[this.av]=245),this.LR[this.av]=i,this.vR[this.av]=s,this.RR[this.av]=h,this.av++);if(t.gn)for(n=4;n>=0;n--)if(t.gn[n]&&'attack'===t.gn[n]?.toLowerCase()){let r=0;this.IM&&t.Tl>this.IM.PC&&(r=2e3),this.cv[this.av]=t.gn[n]+' @yel@'+e,0===n?this.bR[this.av]=r+728:1===n?this.bR[this.av]=r+542:2===n?this.bR[this.av]=r+6:3===n?this.bR[this.av]=r+963:4===n&&(this.bR[this.av]=r+245),this.LR[this.av]=i,this.vR[this.av]=s,this.RR[this.av]=h,this.av++}this.cv[this.av]='Examine @yel@'+e,Jt.AO&&(this.cv[this.av]+='@whi@ ('+t.id+')'),this.bR[this.av]=1607,this.LR[this.av]=i,this.vR[this.av]=s,this.RR[this.av]=h,this.av++}else 2&~this.CR||(this.cv[this.av]=this.TR+' @yel@'+e,this.bR[this.av]=265,this.LR[this.av]=i,this.vR[this.av]=s,this.RR[this.av]=h,this.av++)};uD=(t,i,s,h)=>{if(t===this.IM||this.av>=400)return;let e=null;this.IM&&(e=t.name+this.dD(this.IM.PC,t.PC)+' (level-'+t.PC+')'),1===this.aR?(this.cv[this.av]='Use '+this.dR+' with @whi@'+e,this.bR[this.av]=367,this.LR[this.av]=i,this.vR[this.av]=s,this.RR[this.av]=h,this.av++):1!==this.gR?(this.cv[this.av]='Follow @whi@'+e,this.bR[this.av]=1544,this.LR[this.av]=i,this.vR[this.av]=s,this.RR[this.av]=h,this.av++,0===this.sv&&(this.cv[this.av]='Trade with @whi@'+e,this.bR[this.av]=1373,this.LR[this.av]=i,this.vR[this.av]=s,this.RR[this.av]=h,this.av++),this.OM>0&&(this.cv[this.av]='Attack @whi@'+e,this.IM&&this.IM.PC>=t.PC?this.bR[this.av]=151:this.bR[this.av]=2151,this.LR[this.av]=i,this.vR[this.av]=s,this.RR[this.av]=h,this.av++),1===this.bM&&(this.cv[this.av]='Fight @whi@'+e,this.bR[this.av]=151,this.LR[this.av]=i,this.vR[this.av]=s,this.RR[this.av]=h,this.av++),2===this.bM&&(this.cv[this.av]='Duel-with @whi@'+e,this.bR[this.av]=1101,this.LR[this.av]=i,this.vR[this.av]=s,this.RR[this.av]=h,this.av++)):8&~this.CR||(this.cv[this.av]=this.TR+' @whi@'+e,this.bR[this.av]=651,this.LR[this.av]=i,this.vR[this.av]=s,this.RR[this.av]=h,this.av++);for(let t=0;t<this.av;t++)if(660===this.bR[t])return void(this.cv[t]='Walk here @whi@'+e)};dD=(t,i)=>{const s=t-i;return s<-9?'@red@':s<-6?'@or3@':s<-3?'@or2@':s<0?'@or1@':s>9?'@gre@':s>6?'@gr3@':s>3?'@gr2@':s>0?'@gr1@':'@yel@'};Jx=()=>{if(0===this.eR){this.cv[0]='Cancel',this.bR[0]=1252,this.av=1,this.oD(this._h),this.xR=0,this.gh>8&&this._h>11&&this.gh<520&&this._h<345&&(-1===this.qL?this.cD():this.lD(X.$t[this.qL],this.gh,this._h,8,11,0)),this.xR!==this.Qv&&(this.Qv=this.xR),this.xR=0,this.gh>562&&this._h>231&&this.gh<752&&this._h<492&&(-1!==this.fv?this.lD(X.$t[this.fv],this.gh,this._h,562,231,0):-1!==this.kv[this.xv]&&this.lD(X.$t[this.kv[this.xv]],this.gh,this._h,562,231,0)),this.xR!==this.tR&&(this.XL=!0,this.tR=this.xR),this.xR=0,this.gh>22&&this._h>375&&this.gh<431&&this._h<471&&(-1===this.uv?this.rD(this.gh-22,this._h-375):this.lD(X.$t[this.uv],this.gh,this._h,22,375,0)),-1!==this.uv&&this.xR!==this.iR&&(this.jL=!0,this.iR=this.xR);let t=!1;for(;!t;){t=!0;for(let i=0;i<this.av-1;i++)if(this.bR[i]<1e3&&this.bR[i+1]>1e3){const s=this.cv[i];this.cv[i]=this.cv[i+1],this.cv[i+1]=s;const h=this.bR[i];this.bR[i]=this.bR[i+1],this.bR[i+1]=h;const e=this.vR[i];this.vR[i]=this.vR[i+1],this.vR[i+1]=e;const n=this.RR[i];this.RR[i]=this.RR[i+1],this.RR[i+1]=n;const r=this.LR[i];this.LR[i]=this.LR[i+1],this.LR[i+1]=r,t=!1}}}};tk=()=>{let t=0;if(this.Cb){let i;t=this.Cb.Af('Choose Option');for(let s=0;s<this.av;s++)i=this.Cb.Af(this.cv[s]),i>t&&(t=i)}t+=8;const i=15*this.av+21;let s,h;this.LT>8&&this.vT>11&&this.LT<520&&this.vT<345&&(s=this.LT-(t/2|0)-8,s+t>512?s=512-t:s<0&&(s=0),h=this.vT-11,h+i>334?h=334-i:h<0&&(h=0),this.hv=!0,this.ev=0,this.nv=s,this.rv=h,this.ov=t,this.lv=15*this.av+22),this.LT>562&&this.vT>231&&this.LT<752&&this.vT<492&&(s=this.LT-(t/2|0)-562,s<0?s=0:s+t>190&&(s=190-t),h=this.vT-231,h<0?h=0:h+i>261&&(h=261-i),this.hv=!0,this.ev=1,this.nv=s,this.rv=h,this.ov=t,this.lv=15*this.av+22),this.LT>22&&this.vT>375&&this.LT<501&&this.vT<471&&(s=this.LT-(t/2|0)-22,s<0?s=0:s+t>479&&(s=479-t),h=this.vT-375,h<0?h=0:h+i>96&&(h=96-i),this.hv=!0,this.ev=2,this.nv=s,this.rv=h,this.ov=t,this.lv=15*this.av+22)};sk=(t,i,s,h,e,n,r,o,l,a,c)=>{const f=this.SS[this.MS];if(!f)return!1;const u=gt.Pm,d=gt.Pm;for(let t=0;t<u;t++)for(let i=0;i<d;i++){const s=gt.index(t,i);this.AM[s]=0,this.pM[s]=99999999}let w=t,y=i;const A=gt.index(t,i);this.AM[A]=99,this.pM[A]=0;let p=0,m=0;this.wM[p]=t,this.yM[p++]=i;let I=!1,E=this.wM.length;const g=f.flags;for(;m!==p;){if(w=this.wM[m],y=this.yM[m],m=(m+1)%E,w===s&&y===h){I=!0;break}if(l!==S.Be.id){if((l<S.Ve.id||l===S.Ze.id)&&f.Vm(w,y,s,h,l-1,o)){I=!0;break}if(l<S.Ze.id&&f.Km(w,y,s,h,l-1,o)){I=!0;break}}if(0!==n&&0!==r&&f.Xm(w,y,s,h,n,r,a)){I=!0;break}const t=this.pM[gt.index(w,y)]+1;let i=gt.index(w-1,y);w>0&&0===this.AM[i]&&(g[i]&It.Lm)===It.OPEN&&(this.wM[p]=w-1,this.yM[p]=y,p=(p+1)%E,this.AM[i]=2,this.pM[i]=t),i=gt.index(w+1,y),w<u-1&&0===this.AM[i]&&(g[i]&It.Mm)===It.OPEN&&(this.wM[p]=w+1,this.yM[p]=y,p=(p+1)%E,this.AM[i]=8,this.pM[i]=t),i=gt.index(w,y-1),y>0&&0===this.AM[i]&&(g[i]&It.bm)===It.OPEN&&(this.wM[p]=w,this.yM[p]=y-1,p=(p+1)%E,this.AM[i]=1,this.pM[i]=t),i=gt.index(w,y+1),y<d-1&&0===this.AM[i]&&(g[i]&It.Rm)===It.OPEN&&(this.wM[p]=w,this.yM[p]=y+1,p=(p+1)%E,this.AM[i]=4,this.pM[i]=t),i=gt.index(w-1,y-1),w>0&&y>0&&0===this.AM[i]&&!(g[i]&It.vm)&&(g[gt.index(w-1,y)]&It.Lm)===It.OPEN&&(g[gt.index(w,y-1)]&It.bm)===It.OPEN&&(this.wM[p]=w-1,this.yM[p]=y-1,p=(p+1)%E,this.AM[i]=3,this.pM[i]=t),i=gt.index(w+1,y-1),w<u-1&&y>0&&0===this.AM[i]&&!(g[i]&It.xm)&&(g[gt.index(w+1,y)]&It.Mm)===It.OPEN&&(g[gt.index(w,y-1)]&It.bm)===It.OPEN&&(this.wM[p]=w+1,this.yM[p]=y-1,p=(p+1)%E,this.AM[i]=9,this.pM[i]=t),i=gt.index(w-1,y+1),w>0&&y<d-1&&0===this.AM[i]&&!(g[i]&It.Sm)&&(g[gt.index(w-1,y)]&It.Lm)===It.OPEN&&(g[gt.index(w,y+1)]&It.Rm)===It.OPEN&&(this.wM[p]=w-1,this.yM[p]=y+1,p=(p+1)%E,this.AM[i]=6,this.pM[i]=t),i=gt.index(w+1,y+1),w<u-1&&y<d-1&&0===this.AM[i]&&!(g[i]&It.km)&&(g[gt.index(w+1,y)]&It.Mm)===It.OPEN&&(g[gt.index(w,y+1)]&It.Rm)===It.OPEN&&(this.wM[p]=w+1,this.yM[p]=y+1,p=(p+1)%E,this.AM[i]=12,this.pM[i]=t)}if(this.mM=0,!I){if(c){let t=100;for(let i=1;i<2;i++){for(let e=s-i;e<=s+i;e++)for(let s=h-i;s<=h+i;s++){const i=gt.index(e,s);e>=0&&s>=0&&e<gt.Pm&&s<gt.Pm&&this.pM[i]<t&&(t=this.pM[i],w=e,y=s,this.mM=1,I=!0)}if(I)break}}if(!I)return!1}m=0,this.wM[m]=w,this.yM[m++]=y;let _=this.AM[gt.index(w,y)],C=_;for(;w!==t||y!==i;)C!==_&&(_=C,this.wM[m]=w,this.yM[m++]=y),C&Et.un?w++:C&Et.cn&&w--,C&Et.fn?y++:C&Et.dn&&y--,C=this.AM[gt.index(w,y)];if(m>0){E=Math.min(m,25),m--;const t=this.wM[m],i=this.yM[m];if(Jt.AO&&1===this.RT[6]&&1===this.RT[7]){for(let t=0;t<this.yx.length;t++){const i=this.yx[t];if(i&&i.x===Rt.OE&&i.z===Rt.bE)return this.yx[t]=null,!1}return this.yx[this.Ax]=new pt(this.MS,Rt.OE,Rt.bE),this.Ax=this.Ax+1&this.yx.length-1,!1}0===e?(this.XO.Bt(et.Pw),this.XO.p1(E+E+3)):1===e?(this.XO.Bt(et.Ow),this.XO.p1(E+E+3+14)):2===e&&(this.XO.Bt(et.Cw),this.XO.p1(E+E+3)),1===this.RT[5]?this.XO.p1(1):this.XO.p1(0),this.XO.p2(t+this._S),this.XO.p2(i+this.CS),this.jR=this.wM[0],this.zR=this.yM[0];for(let s=1;s<E;s++)m--,this.XO.p1(this.wM[m]-t),this.XO.p1(this.yM[m]-i);return!0}return 1!==e};eD=(t,i)=>{this.sM=0,this.iM=0,this.wD(t),this.yD(t),this.AD(t,i),this.pD(t);for(let t=0;t<this.sM;t++){const i=this.eM[t],s=this.JS[i];s&&(s.Ji!==this.VO&&(this.JS[i]=null))}if(t.bt!==i)throw new Error(`eek! Error packet size mismatch in getplayer pos:${t.bt} psize:${i}`);for(let t=0;t<this.QS;t++)if(!this.JS[this.tM[t]])throw new Error(`eek! ${this.username} null entry in pl list - pos:${t} size:${this.QS}`)};wD=t=>{t.jt();if(0!==t.Zt(1)){const i=t.Zt(2);if(0===i)this.hM[this.iM++]=this.BO;else if(1===i){const i=t.Zt(3);this.IM?.step(!1,i);1===t.Zt(1)&&(this.hM[this.iM++]=this.BO)}else if(2===i){const i=t.Zt(3);this.IM?.step(!0,i);const s=t.Zt(3);this.IM?.step(!0,s);1===t.Zt(1)&&(this.hM[this.iM++]=this.BO)}else if(3===i){this.MS=t.Zt(2);const i=t.Zt(7),s=t.Zt(7),h=t.Zt(1);this.IM?.move(1===h,i,s);1===t.Zt(1)&&(this.hM[this.iM++]=this.BO)}}};yD=t=>{const i=t.Zt(8);if(i<this.QS)for(let t=i;t<this.QS;t++)this.eM[this.sM++]=this.tM[t];if(i>this.QS)throw new Error(`eek! ${this.username} Too many players`);this.QS=0;for(let s=0;s<i;s++){const i=this.tM[s],h=this.JS[i];if(0===t.Zt(1))this.tM[this.QS++]=i,h&&(h.Ji=this.VO);else{const s=t.Zt(2);if(0===s)this.tM[this.QS++]=i,h&&(h.Ji=this.VO),this.hM[this.iM++]=i;else if(1===s){this.tM[this.QS++]=i,h&&(h.Ji=this.VO);const s=t.Zt(3);h?.step(!1,s);1===t.Zt(1)&&(this.hM[this.iM++]=i)}else if(2===s){this.tM[this.QS++]=i,h&&(h.Ji=this.VO);const s=t.Zt(3);h?.step(!0,s);const e=t.Zt(3);h?.step(!0,e);1===t.Zt(1)&&(this.hM[this.iM++]=i)}else 3===s&&(this.eM[this.sM++]=i)}}};AD=(t,i)=>{let s;for(;t.Lt+10<8*i&&(s=t.Zt(11),2047!==s);){if(!this.JS[s]){this.JS[s]=new Ft;const t=this.nM[s];t&&this.JS[s]?.read(t)}this.tM[this.QS++]=s;const i=this.JS[s];i&&(i.Ji=this.VO);let h=t.Zt(5);h>15&&(h-=32);let e=t.Zt(5);e>15&&(e-=32);const n=t.Zt(1);this.IM&&i?.move(1===n,this.IM.uC[0]+h,this.IM.dC[0]+e);1===t.Zt(1)&&(this.hM[this.iM++]=s)}t.zt()};pD=t=>{for(let i=0;i<this.iM;i++){const s=this.hM[i],h=this.JS[s];if(!h)continue;let e=t.st;(e&Ft.LC)===Ft.LC&&(e+=t.st<<8),this.mD(h,s,e,t)}};mD=(t,i,s,h)=>{if(t.AC=s,t.pC=this.VO,(s&Ft.EC)===Ft.EC){const s=h.st,e=new Uint8Array(s),n=new a(e);h.Ut(s,0,e),this.nM[i]=n,t.read(n)}if((s&Ft.gC)===Ft.gC){let i=h.St;65535===i&&(i=-1),i===t.j_&&(t.J_=0);const s=h.st;(-1===i||-1===t.j_||I.$t[i].priority>I.$t[t.j_].priority||0===I.$t[t.j_].priority)&&(t.j_=i,t.z_=0,t.Z_=0,t.q_=s,t.J_=0)}if((s&Ft._C)===Ft._C&&(t.H_=h.St,65535===t.H_&&(t.H_=-1)),(s&Ft.CC)===Ft.CC&&(t.x_=h.Ft,t.D_=0,t.N_=0,t.k_=150,t.name&&this.Vk(2,t.x_,t.name)),(s&Ft.TC)===Ft.TC&&(t.P_=h.st,t.F_=h.st,t.U_=this.VO+400,t.B_=h.st,t.G_=h.st),(s&Ft.OC)===Ft.OC&&(t.W_=h.St,t.Y_=h.St,t.mC=t.W_,t.IC=t.Y_),(s&Ft.bC)===Ft.bC){const i=h.St,s=h.st,e=h.st,n=h.bt;if(t.name){const n=K.Fl(t.name);let r=!1;if(s<=1)for(let t=0;t<this.Av;t++)if(this.pv[t]===n){r=!0;break}if(!r&&0===this.sv)try{const n=rt.Jt(h,e),r=nt.filter(n);t.x_=r,t.D_=i>>8,t.N_=255&i,t.k_=150,s>1?this.Vk(1,r,t.name):this.Vk(2,r,t.name)}catch(t){}}h.bt=n+e}if((s&Ft.vC)===Ft.vC){t.Q_=h.St;const i=h.kt;t.hC=i>>16,t.sC=this.VO+(65535&i),t.tC=0,t.iC=0,t.sC>this.VO&&(t.tC=-1),65535===t.Q_&&(t.Q_=-1)}(s&Ft.RC)===Ft.RC&&(t.eC=h.st,t.rC=h.st,t.nC=h.st,t.oC=h.st,t.lC=h.St+this.VO,t.aC=h.St+this.VO,t.cC=h.st,t.pathLength=0,t.uC[0]=t.nC,t.dC[0]=t.oC)};iD=(t,i)=>{this.sM=0,this.iM=0,this.ID(t),this.ED(t,i),this.gD(t);for(let t=0;t<this.sM;t++){const i=this.eM[t],s=this.rM[i];s&&(s.Ji!==this.VO&&(s.type=null,this.rM[i]=null))}if(t.bt!==i)throw new Error(`eek! ${this.username} size mismatch in getnpcpos - pos:${t.bt} psize:${i}`);for(let t=0;t<this.oM;t++)if(!this.rM[this.lM[t]])throw new Error(`eek! ${this.username} null entry in npc list - pos:${t} size:${this.oM}`)};ID=t=>{t.jt();const i=t.Zt(8);if(i<this.oM)for(let t=i;t<this.oM;t++)this.eM[this.sM++]=this.lM[t];if(i>this.oM)throw new Error(`eek! ${this.username} Too many npcs`);this.oM=0;for(let s=0;s<i;s++){const i=this.lM[s],h=this.rM[i];if(0===t.Zt(1))this.lM[this.oM++]=i,h&&(h.Ji=this.VO);else{const s=t.Zt(2);if(0===s)this.lM[this.oM++]=i,h&&(h.Ji=this.VO),this.hM[this.iM++]=i;else if(1===s){this.lM[this.oM++]=i,h&&(h.Ji=this.VO);const s=t.Zt(3);h?.step(!1,s);1===t.Zt(1)&&(this.hM[this.iM++]=i)}else if(2===s){this.lM[this.oM++]=i,h&&(h.Ji=this.VO);const s=t.Zt(3);h?.step(!0,s);const e=t.Zt(3);h?.step(!0,e);1===t.Zt(1)&&(this.hM[this.iM++]=i)}else 3===s&&(this.eM[this.sM++]=i)}}};ED=(t,i)=>{for(;t.Lt+21<8*i;){const i=t.Zt(13);if(8191===i)break;this.rM[i]||(this.rM[i]=new Ut);const s=this.rM[i];this.lM[this.oM++]=i,s?(s.Ji=this.VO,s.type=H.get(t.Zt(11)),s.size=s.type.size,s.L_=s.type.Il,s.v_=s.type.El,s.R_=s.type.gl,s.S_=s.type._l,s.O_=s.type.ml):t.Zt(11);let h=t.Zt(5);h>15&&(h-=32);let e=t.Zt(5);e>15&&(e-=32),this.IM&&s?.move(!1,this.IM.uC[0]+h,this.IM.dC[0]+e);1===t.Zt(1)&&(this.hM[this.iM++]=i)}t.zt()};gD=t=>{for(let i=0;i<this.iM;i++){const s=this.hM[i],h=this.rM[s];if(!h)continue;const e=t.st;if(h.AC=e,h.pC=this.VO,(e&Ut.gC)===Ut.gC){let i=t.St;65535===i&&(i=-1),i===h.j_&&(h.J_=0);const s=t.st;(-1===i||-1===h.j_||I.$t[i].priority>I.$t[h.j_].priority||0===I.$t[h.j_].priority)&&(h.j_=i,h.z_=0,h.Z_=0,h.q_=s,h.J_=0)}if((e&Ut._C)===Ut._C&&(h.H_=t.St,65535===h.H_&&(h.H_=-1)),(e&Ut.CC)===Ut.CC&&(h.x_=t.Ft,h.k_=100),(e&Ut.TC)===Ut.TC&&(h.P_=t.st,h.F_=t.st,h.U_=this.VO+400,h.B_=t.st,h.G_=t.st),(e&Ut.VC)===Ut.VC&&(h.type=H.get(t.St),h.L_=h.type.Il,h.v_=h.type.El,h.R_=h.type.gl,h.S_=h.type._l,h.O_=h.type.ml),(e&Ut.vC)===Ut.vC){h.Q_=t.St;const i=t.kt;h.hC=i>>16,h.sC=this.VO+(65535&i),h.tC=0,h.iC=0,h.sC>this.VO&&(h.tC=-1),65535===h.Q_&&(h.Q_=-1)}(e&Ut.OC)===Ut.OC&&(h.W_=t.St,h.Y_=t.St,h.mC=h.W_,h.IC=h.Y_)}};zx=()=>{for(let t=-1;t<this.QS;t++){let i;i=-1===t?this.BO:this.tM[t];const s=this.JS[i];s&&this._D(s)}if(Jt.bO++,Jt.bO>1406){Jt.bO=0,this.XO.Bt(et.xd),this.XO.p1(0);const t=this.XO.bt;this.XO.p1(162),this.XO.p1(22),2*Math.random()|0||this.XO.p1(84),this.XO.p2(31824),this.XO.p2(13490),2*Math.random()|0||this.XO.p1(123),2*Math.random()|0||this.XO.p1(134),this.XO.p1(100),this.XO.p1(94),this.XO.p2(35521),this.XO.Xt(this.XO.bt-t)}};_D=t=>{(t.x<128||t.z<128||t.x>=13184||t.z>=13184)&&(t.j_=-1,t.Q_=-1,t.lC=0,t.aC=0,t.x=128*t.uC[0]+64*t.size,t.z=128*t.dC[0]+64*t.size,t.pathLength=0),t===this.IM&&(t.x<1536||t.z<1536||t.x>=11776||t.z>=11776)&&(t.j_=-1,t.Q_=-1,t.lC=0,t.aC=0,t.x=128*t.uC[0]+64*t.size,t.z=128*t.dC[0]+64*t.size,t.pathLength=0),t.lC>this.VO?this.CD(t):t.aC>=this.VO?this.TD(t):this.OD(t),this.bD(t),this.LD(t)};pk=()=>{if(this.IM){this.IM.x>>7===this.jR&&this.IM.z>>7===this.zR&&(this.jR=0);for(let t=-1;t<this.QS;t++){let i,s;if(-1===t?(i=this.IM,s=this.BO<<14):(i=this.JS[this.tM[t]],s=this.tM[t]<<14),!i||!i.isVisible())continue;i.Bi=(Jt.Bi&&this.QS>50||this.QS>200)&&-1!==t&&i.V_===i.O_;const h=i.x>>7,e=i.z>>7;if(!(h<0||h>=gt.Pm||e<0||e>=gt.Pm))if(!i.YC||this.VO<i.UC||this.VO>=i.BC){if(64==(127&i.x)&&64==(127&i.z)){if(this.BS[h][e]===this.XR)continue;this.BS[h][e]=this.XR}i.y=this.Ck(this.MS,i.x,i.z),this.YR?.ig(this.MS,i.x,i.y,i.z,null,i,s,i.Ep,60,i.T_)}else i.Bi=!1,i.y=this.Ck(this.MS,i.x,i.z),this.YR?.sg(this.MS,i.x,i.y,i.z,i.Kp,i.jp,i.Xp,i.zp,null,i,s,i.Ep)}}};Zx=()=>{for(let t=0;t<this.oM;t++){const i=this.lM[t],s=this.rM[i];s&&s.type&&this._D(s)}};mk=()=>{for(let t=0;t<this.oM;t++){const i=this.rM[this.lM[t]],s=536870912+(this.lM[t]<<14)|0;if(!i||!i.isVisible())continue;const h=i.x>>7,e=i.z>>7;if(!(h<0||h>=gt.Pm||e<0||e>=gt.Pm)){if(1===i.size&&64==(127&i.x)&&64==(127&i.z)){if(this.BS[h][e]===this.XR)continue;this.BS[h][e]=this.XR}this.YR?.ig(this.MS,i.x,this.Ck(this.MS,i.x,i.z),i.z,null,i,s,i.Ep,64*(i.size-1)+60,i.T_)}}};Ik=()=>{for(let t=this.aM.head();t;t=this.aM.next())if(t.level!==this.MS||this.VO>t.C_)t.et();else if(this.VO>=t.ZC){if(t.target>0){const i=this.rM[t.target-1];i&&t.tT(i.x,this.Ck(t.level,i.x,i.z)-t.offsetY,i.z,this.VO)}if(t.target<0){const i=-t.target-1;let s;s=i===this._M?this.IM:this.JS[i],s&&t.tT(s.x,this.Ck(t.level,s.x,s.z)-t.offsetY,s.z,this.VO)}t.update(this.KR),this.YR?.ig(this.MS,0|t.x,0|t.y,0|t.z,null,t,-1,t.Ep,60,!1)}};Ek=()=>{for(let t=this.cM.head();t;t=this.cM.next())t.level!==this.MS||t.iT?t.et():this.VO>=t.ZC&&(t.update(this.KR),t.iT?t.et():this.YR?.ig(t.level,t.x,t.y,t.z,null,t,-1,0,60,!1))};gk=()=>{for(let t=this.fM.head();t;t=this.fM.next()){let i=!1;if(t.Zc+=this.KR,-1===t.zc&&(t.zc=0,i=!0),t.vl.delay)for(;t.Zc>t.vl.delay[t.zc];)if(t.Zc-=t.vl.delay[t.zc]+1,t.zc++,i=!0,t.zc>=t.vl.ii&&(t.zc-=t.vl.hi,t.zc<0||t.zc>=t.vl.ii)){t.et(),i=!1;break}if(i&&this.YR){const i=t.Fg,s=t.Bg,h=t.Gg;let e=0;if(0===t.Ug?e=this.YR.rg(i,s,h):1===t.Ug?e=this.YR.og(i,h,s):2===t.Ug?e=this.YR.lg(i,s,h):3===t.Ug&&(e=this.YR.ag(i,s,h)),this.Qg&&0!==e&&(e>>14&32767)===t.index){const n=this.Qg[i][s][h],r=this.Qg[i][s+1][h],o=this.Qg[i][s+1][h+1],l=this.Qg[i][s][h+1],a=x.get(t.index);let c=-1;if(-1!==t.zc&&t.vl.frames&&(c=t.vl.frames[t.zc]),2===t.Ug){const t=this.YR.cg(i,s,h,e);let f=31&t;const u=t>>6;f===S.qe.id&&(f=S.Ze.id),this.YR?.eg(i,s,h,a.zn(f,u,n,r,o,l,c))}else if(1===t.Ug)this.YR?.qE(i,s,h,a.zn(S.Ye.id,0,n,r,o,l,c));else if(0===t.Ug){const t=this.YR.cg(i,s,h,e),f=31&t,u=t>>6;if(f===S.He.id){const t=u+1&3;this.YR?.QE(s,h,i,a.zn(S.He.id,u+4,n,r,o,l,c),a.zn(S.He.id,t,n,r,o,l,c))}else this.YR?.JE(i,s,h,a.zn(f,u,n,r,o,l,c))}else if(3===t.Ug){const t=this.YR.cg(i,s,h,e)>>6;this.YR?.$E(i,s,h,a.zn(S.Ue.id,t,n,r,o,l,c))}}else t.et()}}};qx=()=>{for(let t=-1;t<this.QS;t++){let i;i=-1===t?this.BO:this.tM[t];const s=this.JS[i];s&&s.k_>0&&(s.k_--,0===s.k_&&(s.x_=null))}for(let t=0;t<this.oM;t++){const i=this.lM[t],s=this.rM[i];s&&s.k_>0&&(s.k_--,0===s.k_&&(s.x_=null))}};$x=()=>{if(2===this.VR){for(let t=this.xE.head();t;t=this.xE.next())this.VO>=t.C_&&(this.Gm(t.m_,t.x,t.z,t.I_,t.angle,t.shape,t.an),t.et());Jt.OO++,Jt.OO>85&&(Jt.OO=0,this.XO.Bt(et.Md))}};CD=t=>{const i=t.lC-this.VO,s=128*t.eC+64*t.size,h=128*t.rC+64*t.size;t.x+=(s-t.x)/i|0,t.z+=(h-t.z)/i|0,t.yC=0,0===t.cC&&(t.fC=1024),1===t.cC&&(t.fC=1536),2===t.cC&&(t.fC=0),3===t.cC&&(t.fC=512)};TD=t=>{if(t.aC===this.VO||-1===t.j_||0!==t.q_||t.Z_+1>I.$t[t.j_].delay[t.z_]){const i=t.aC-t.lC,s=this.VO-t.lC,h=128*t.eC+64*t.size,e=128*t.rC+64*t.size,n=128*t.nC+64*t.size,r=128*t.oC+64*t.size;t.x=(h*(i-s)+n*s)/i|0,t.z=(e*(i-s)+r*s)/i|0}t.yC=0,0===t.cC&&(t.fC=1024),1===t.cC&&(t.fC=1536),2===t.cC&&(t.fC=0),3===t.cC&&(t.fC=512),t.Ep=t.fC};bD=t=>{if(-1!==t.H_&&t.H_<32768){const i=this.rM[t.H_];if(i){const s=t.x-i.x,h=t.z-i.z;0===s&&0===h||(t.fC=325.949*Math.atan2(s,h)&2047)}}if(t.H_>=32768){let i=t.H_-32768;i===this._M&&(i=this.BO);const s=this.JS[i];if(s){const i=t.x-s.x,h=t.z-s.z;0===i&&0===h||(t.fC=325.949*Math.atan2(i,h)&2047)}}if((0!==t.W_||0!==t.Y_)&&(0===t.pathLength||t.yC>0)){const i=t.x-64*(t.W_-this._S-this._S),s=t.z-64*(t.Y_-this.CS-this.CS);0===i&&0===s||(t.fC=325.949*Math.atan2(i,s)&2047),t.W_=0,t.Y_=0}const i=t.fC-t.Ep&2047;if(0!==i&&(i<32||i>2016?t.Ep=t.fC:i>1024?t.Ep-=32:t.Ep+=32,t.Ep&=2047,t.V_===t.O_&&t.Ep!==t.fC)){if(-1!==t.b_)return void(t.V_=t.b_);t.V_=t.L_}};LD=t=>{let i;if(t.T_=!1,-1!==t.V_&&(i=I.$t[t.V_],t.X_++,i.delay&&t.K_<i.ii&&t.X_>i.delay[t.K_]&&(t.X_=0,t.K_++),t.K_>=i.ii&&(t.X_=0,t.K_=0)),-1!==t.j_&&0===t.q_){for(i=I.$t[t.j_],t.Z_++;i.delay&&t.z_<i.ii&&t.Z_>i.delay[t.z_];)t.Z_-=i.delay[t.z_],t.z_++;t.z_>=i.ii&&(t.z_-=i.hi,t.J_++,t.J_>=i.li&&(t.j_=-1),(t.z_<0||t.z_>=i.ii)&&(t.j_=-1)),t.T_=i.ni}if(t.q_>0&&t.q_--,-1!==t.Q_&&this.VO>=t.sC){for(t.tC<0&&(t.tC=0),i=Y.$t[t.Q_].vl,t.iC++;i&&i.delay&&t.tC<i.ii&&t.iC>i.delay[t.tC];)t.iC-=i.delay[t.tC],t.tC++;i&&t.tC>=i.ii&&(t.tC<0||t.tC>=i.ii)&&(t.Q_=-1)}};OD=t=>{if(t.V_=t.O_,0===t.pathLength)return void(t.yC=0);if(-1!==t.j_&&0===t.q_){if(!I.$t[t.j_].ei)return void t.yC++}const i=t.x,s=t.z,h=128*t.uC[t.pathLength-1]+64*t.size,e=128*t.dC[t.pathLength-1]+64*t.size;if(h-i<=256&&h-i>=-256&&e-s<=256&&e-s>=-256){t.fC=i<h?s<e?1280:s>e?1792:1536:i>h?s<e?768:s>e?256:512:s<e?1024:0;let n=t.fC-t.Ep&2047;n>1024&&(n-=2048);let r=t.v_;n>=-256&&n<=256?r=t.L_:n>=256&&n<768?r=t.S_:n>=-768&&n<=-256&&(r=t.R_),-1===r&&(r=t.L_),t.V_=r;let o=4;t.Ep!==t.fC&&-1===t.H_&&(o=2),t.pathLength>2&&(o=6),t.pathLength>3&&(o=8),t.yC>0&&t.pathLength>1&&(o=8,t.yC--),t.wC[t.pathLength-1]&&(o<<=1),o>=8&&t.V_===t.L_&&-1!==t.M_&&(t.V_=t.M_),i<h?(t.x+=o,t.x>h&&(t.x=h)):i>h&&(t.x-=o,t.x<h&&(t.x=h)),s<e?(t.z+=o,t.z>e&&(t.z=e)):s>e&&(t.z-=o,t.z<e&&(t.z=e)),t.x===h&&t.z===e&&t.pathLength--}else t.x=h,t.z=e};Ok=()=>{let t=3;if(this.fS<310&&this.IM){let i=this.lS>>7,s=this.cS>>7;const h=this.IM.x>>7,e=this.IM.z>>7;let n,r,o,l;if(this.t_&&4&this.t_[this.MS][i][s]&&(t=this.MS),n=h>i?h-i:i-h,r=e>s?e-s:s-e,n>r)for(o=65536*r/n|0,l=32768;i!==h;)i<h?i++:i>h&&i--,this.t_&&4&this.t_[this.MS][i][s]&&(t=this.MS),l+=o,l>=65536&&(l-=65536,s<e?s++:s>e&&s--,this.t_&&4&this.t_[this.MS][i][s]&&(t=this.MS));else for(o=65536*n/r|0,l=32768;s!==e;)s<e?s++:s>e&&s--,this.t_&&4&this.t_[this.MS][i][s]&&(t=this.MS),l+=o,l>=65536&&(l-=65536,i<h?i++:i>h&&i--,this.t_&&4&this.t_[this.MS][i][s]&&(t=this.MS))}return this.IM&&this.t_&&4&this.t_[this.MS][this.IM.x>>7][this.IM.z>>7]&&(t=this.MS),t};Tk=()=>{if(!this.t_)return 0;return this.Ck(this.MS,this.lS,this.cS)-this.aS>=800||!(4&this.t_[this.MS][this.lS>>7][this.cS>>7])?3:this.MS};Ck=(t,i,s)=>{if(!this.Qg)return 0;const h=Math.min(i>>7,gt.Pm-1),e=Math.min(s>>7,gt.Pm-1);let n=t;t<3&&this.t_&&!(2&~this.t_[1][h][e])&&(n=t+1);const r=127&i,o=127&s;return(this.Qg[n][h][e]*(128-r)+this.Qg[n][h+1][e]*r>>7)*(128-o)+(this.Qg[n][h][e+1]*(128-r)+this.Qg[n][h+1][e+1]*r>>7)*o>>7};_k=(t,i,s,h,e,n)=>{const r=2048-e&2047,o=2048-h&2047;let l,a,c,f=0,u=0,d=n;0!==r&&(l=O.sin[r],a=O.cos[r],c=u*a-n*l>>16,d=u*l+n*a>>16,u=c),0!==o&&(l=O.sin[o],a=O.cos[o],c=d*l+f*a>>16,d=d*a-f*l>>16,f=c),this.lS=t-f,this.aS=i-u,this.cS=s-d,this.fS=e,this.uS=h};ak=()=>{if(!this.IM)return;const t=this.IM.x+this.$R,i=this.IM.z+this.JR;(this.FS-t<-500||this.FS-t>500||this.US-i<-500||this.US-i>500)&&(this.FS=t,this.US=i),this.FS!==t&&(this.FS+=(t-this.FS)/16|0),this.US!==i&&(this.US+=(i-this.US)/16|0),1===this.RT[1]?this.NS+=(-this.NS-24)/2|0:1===this.RT[2]?this.NS+=(24-this.NS)/2|0:this.NS=this.NS/2|0,1===this.RT[3]?this.PS+=(12-this.PS)/2|0:1===this.RT[4]?this.PS+=(-this.PS-12)/2|0:this.PS=this.PS/2|0,this.DS=this.DS+this.NS/2&2047,this.kS+=this.PS/2|0,this.kS<128&&(this.kS=128),this.kS>383&&(this.kS=383);const s=this.FS>>7,h=this.US>>7,e=this.Ck(this.MS,this.FS,this.US);let n=0;if(this.Qg&&s>3&&h>3&&s<100&&h<100)for(let t=s-4;t<=s+4;t++)for(let i=h-4;i<=h+4;i++){let s=this.MS;s<3&&this.t_&&!(2&~this.t_[1][t][i])&&s++;const h=e-this.Qg[s][t][i];h>n&&(n=h)}let r=192*n;r>98048&&(r=98048),r<32768&&(r=32768),r>this.dS?this.dS+=(r-this.dS)/24|0:r<this.dS&&(this.dS+=(r-this.dS)/80|0)};ck=()=>{let t=128*this.jS+64,i=128*this.zS+64,s=this.Ck(this.MS,this.jS,this.zS)-this.ZS;this.lS<t&&(this.lS+=this.qS+((t-this.lS)*this.$S/1e3|0),this.lS>t&&(this.lS=t)),this.lS>t&&(this.lS-=this.qS+((this.lS-t)*this.$S/1e3|0),this.lS<t&&(this.lS=t)),this.aS<s&&(this.aS+=this.qS+((s-this.aS)*this.$S/1e3|0),this.aS>s&&(this.aS=s)),this.aS>s&&(this.aS-=this.qS+((this.aS-s)*this.$S/1e3|0),this.aS<s&&(this.aS=s)),this.cS<i&&(this.cS+=this.qS+((i-this.cS)*this.$S/1e3|0),this.cS>i&&(this.cS=i)),this.cS>i&&(this.cS-=this.qS+((this.cS-i)*this.$S/1e3|0),this.cS<i&&(this.cS=i)),t=128*this.WS+64,i=128*this.YS+64,s=this.Ck(this.MS,this.WS,this.YS)-this.VS;const h=t-this.lS,e=s-this.aS,n=i-this.cS,r=0|Math.sqrt(h*h+n*n);let o=325.949*Math.atan2(e,r)&2047;const l=-325.949*Math.atan2(h,n)&2047;o<128&&(o=128),o>383&&(o=383),this.fS<o&&(this.fS+=this.KS+((o-this.fS)*this.XS/1e3|0),this.fS>o&&(this.fS=o)),this.fS>o&&(this.fS-=this.KS+((this.fS-o)*this.XS/1e3|0),this.fS<o&&(this.fS=o));let a=l-this.uS;a>1024&&(a-=2048),a<-1024&&(a+=2048),a>0&&(this.uS+=this.KS+(a*this.XS/1e3|0),this.uS&=2047),a<0&&(this.uS-=this.KS+(-a*this.XS/1e3|0),this.uS&=2047);let c=l-this.uS;c>1024&&(c-=2048),c<-1024&&(c+=2048),(c<0&&a>0||c>0&&a<0)&&(this.uS=l)};sD=(t,i)=>{const s=t.st;let h=this.ph+(s>>4&7),e=this.Ih+(7&s);if(i===ht.rd||i===ht.ld){const s=t.st,n=s>>2,r=3&s,o=S.of(n).an;let l;if(l=i===ht.ld?-1:t.St,h>=0&&e>=0&&h<gt.Pm&&e<gt.Pm){let t=null;for(let i=this.dM.head();i;i=this.dM.next())if(i.m_===this.MS&&i.x===h&&i.z===e&&i.an===o){t=i;break}if(!t&&this.YR){let i=0,s=-1,n=0,r=0;if(o===R.Ne?i=this.YR.rg(this.MS,h,e):o===R.Pe?i=this.YR.og(this.MS,e,h):o===R.Fe?i=this.YR.lg(this.MS,h,e):o===R.Ue&&(i=this.YR.ag(this.MS,h,e)),0!==i){const t=this.YR.cg(this.MS,h,e,i);s=i>>14&32767,n=31&t,r=t>>6}t=new kt(this.MS,o,h,e,0,M.cn,S.Be.id,s,r,n),this.dM.rt(t)}t&&(t.I_=l,t.shape=n,t.angle=r),this.Gm(this.MS,h,e,l,r,n,o)}}else if(i===ht.hd){const i=t.st>>2,s=S.of(i).an,n=t.St;if(h>=0&&e>=0&&h<gt.Pm&&e<gt.Pm&&this.YR){let t=0;if(s===R.Ne?t=this.YR.rg(this.MS,h,e):s===R.Pe?t=this.YR.og(this.MS,e,h):s===R.Fe?t=this.YR.lg(this.MS,h,e):s===R.Ue&&(t=this.YR.ag(this.MS,h,e)),0!==t){const i=new Mt(t>>14&32767,this.MS,s,h,e,I.$t[n],!1);this.fM.rt(i)}}}else if(i===ht.ud){const i=t.St,s=t.St;if(h>=0&&e>=0&&h<gt.Pm&&e<gt.Pm){const t=new Bt(i,s);this.uM[this.MS][h][e]||(this.uM[this.MS][h][e]=new o),this.uM[this.MS][h][e]?.rt(t),this.Qk(h,e)}}else if(i===ht.ed){const i=t.St;if(h>=0&&e>=0&&h<gt.Pm&&e<gt.Pm){const t=this.uM[this.MS][h][e];if(t){for(let s=t.head();s;s=t.next())if(s.index===(32767&i)){s.et();break}t.head()||(this.uM[this.MS][h][e]=null),this.Qk(h,e)}}}else if(i===ht.od){let i=h+t.Rt,s=e+t.Rt;const n=t.Mt,r=t.St,o=t.st,l=t.st,a=t.St,c=t.St,f=t.st,u=t.st;if(h>=0&&e>=0&&h<gt.Pm&&e<gt.Pm&&i>=0&&s>=0&&i<gt.Pm&&s<gt.Pm){h=128*h+64,e=128*e+64,i=128*i+64,s=128*s+64;const t=new Gt(r,this.MS,h,this.Ck(this.MS,h,e)-o,e,a+this.VO,c+this.VO,f,u,n,l);t.tT(i,this.Ck(this.MS,i,s)-l,s,a+this.VO),this.aM.rt(t)}}else if(i===ht.fd){const i=t.St,s=t.st,n=t.St;if(h>=0&&e>=0&&h<gt.Pm&&e<gt.Pm){h=128*h+64,e=128*e+64;const t=new Ht(i,this.MS,h,e,this.Ck(this.MS,h,e)-s,this.VO,n);this.cM.rt(t)}}else if(i===ht.nd){const i=t.St,s=t.St,n=t.St;if(h>=0&&e>=0&&h<gt.Pm&&e<gt.Pm&&n!==this._M){const t=new Bt(i,s);this.uM[this.MS][h][e]||(this.uM[this.MS][h][e]=new o),this.uM[this.MS][h][e]?.rt(t),this.Qk(h,e)}}else if(i===ht.sd){const i=t.st,s=i>>2,n=3&i,r=S.of(s).an,o=t.St,l=t.St,a=t.St,c=t.St;let f,u=t.Rt,d=t.Rt,w=t.Rt,y=t.Rt;if(f=c===this._M?this.IM:this.JS[c],f&&this.Qg){const t=new Dt(this.MS,r,h,e,-1,n,s,l+this.VO);this.xE.rt(t);const i=new Dt(this.MS,r,h,e,o,n,s,a+this.VO);this.xE.rt(i);const c=this.Qg[this.MS][h][e],A=this.Qg[this.MS][h+1][e],p=this.Qg[this.MS][h+1][e+1],m=this.Qg[this.MS][h][e+1],I=x.get(o);f.UC=l+this.VO,f.BC=a+this.VO,f.YC=I.zn(s,n,c,A,p,m,-1);let E,g=I.width,_=I.length;n!==M.fn&&n!==M.dn||(g=I.length,_=I.width),f.GC=128*h+64*g,f.WC=128*e+64*_,f.HC=this.Ck(this.MS,f.GC,f.WC),u>w&&(E=u,u=w,w=E),d>y&&(E=d,d=y,y=E),f.Kp=h+u,f.Xp=h+w,f.jp=e+d,f.zp=e+y}}else if(i===ht.ad){const i=t.St,s=t.St,n=t.St;if(h>=0&&e>=0&&h<gt.Pm&&e<gt.Pm){const t=this.uM[this.MS][h][e];if(t){for(let h=t.head();h;h=t.next())if(h.index===(32767&i)&&h.count===s){h.count=n;break}this.Qk(h,e)}}}};Rk=t=>{if(!Jt.Bi){if(O.Qi[17]>=t){const t=O.Wi[17];if(!t)return;const i=t.width*t.height-1,s=t.width*this.KR*2,h=t.di,e=this.RS;for(let t=0;t<=i;t++)e[t]=h[t-s&i];t.di=e,this.RS=h,O.ws(17)}if(O.Qi[24]>=t){const t=O.Wi[24];if(!t)return;const i=t.width*t.height-1,s=t.width*this.KR*2,h=t.di,e=this.RS;for(let t=0;t<=i;t++)e[t]=h[t-s&i];t.di=e,this.RS=h,O.ws(24)}}};Hx=()=>{if(!(this.Mb&&this.xb&&this.Sb&&this.Fb))return;for(let t=10;t<117;t++){(100*Math.random()|0)<50&&(this.Mb[t+32512]=255)}for(let t=0;t<100;t++){const t=2+(124*Math.random()|0)+(128+(128*Math.random()|0)<<7);this.Mb[t]=192}for(let t=1;t<255;t++)for(let i=1;i<127;i++){const s=i+(t<<7);this.xb[s]=(this.Mb[s-1]+this.Mb[s+1]+this.Mb[s-128]+this.Mb[s+128])/4|0}this.Ub+=128,this.Ub>this.Sb.length&&(this.Ub-=this.Sb.length,this.Yx(this.Ob[12*Math.random()|0]));for(let t=1;t<255;t++)for(let i=1;i<127;i++){const s=i+(t<<7);let h=this.xb[s+128]-(this.Sb[s+this.Ub&this.Sb.length-1]/5|0);h<0&&(h=0),this.Mb[s]=h}for(let t=0;t<255;t++)this.Fb[t]=this.Fb[t+1];if(this.Fb[255]=16*Math.sin(this.VO/14)+14*Math.sin(this.VO/15)+12*Math.sin(this.VO/16)|0,this.Bb>0&&(this.Bb-=4),this.Gb>0&&(this.Gb-=4),0===this.Bb&&0===this.Gb){const t=2e3*Math.random()|0;0===t?this.Bb=1024:1===t&&(this.Gb=1024)}};vD=(t,i,s)=>{const h=256-i;return((16711935&t)*h+(16711935&s)*i&4278255360)+((65280&t)*h+(65280&s)*i&16711680)>>8};Wx=()=>{if(!(this.kb&&this.Db&&this.Nb&&this.Pb&&this.Fb&&this.Mb))return;const t=256;if(this.Bb>0)for(let t=0;t<256;t++)this.Bb>768?this.kb[t]=this.vD(this.Db[t],1024-this.Bb,this.Nb[t]):this.Bb>256?this.kb[t]=this.Nb[t]:this.kb[t]=this.vD(this.Nb[t],256-this.Bb,this.Db[t]);else if(this.Gb>0)for(let t=0;t<256;t++)this.Gb>768?this.kb[t]=this.vD(this.Db[t],1024-this.Gb,this.Pb[t]):this.Gb>256?this.kb[t]=this.Pb[t]:this.kb[t]=this.vD(this.Pb[t],256-this.Gb,this.Db[t]);else for(let t=0;t<256;t++)this.kb[t]=this.Db[t];for(let t=0;t<33920;t++)this.cb&&this.Lb&&(this.cb.di[t]=this.Lb.di[t]);let i=0,s=1152;for(let h=1;h<255;h++){let e=(this.Fb[h]*(t-h)/t|0)+22;e<0&&(e=0),i+=e;for(let t=e;t<128;t++){let t=this.Mb[i++];if(0===t)s++;else{const i=t,h=256-t;if(t=this.kb[t],this.cb){const e=this.cb.di[s];this.cb.di[s++]=((16711935&t)*i+(16711935&e)*h&4278255360)+((65280&t)*i+(65280&e)*h&16711680)>>8}}}s+=e}this.cb?.draw(0,0);for(let t=0;t<33920;t++)this.fb&&this.vb&&(this.fb.di[t]=this.vb.di[t]);i=0,s=1176;for(let h=1;h<255;h++){const e=this.Fb[h]*(t-h)/t|0,n=103-e;s+=e;for(let t=0;t<n;t++){let t=this.Mb[i++];if(0===t)s++;else{const i=t,h=256-t;if(t=this.kb[t],this.fb){const e=this.fb.di[s];this.fb.di[s++]=((16711935&t)*i+(16711935&e)*h&4278255360)+((65280&t)*i+(65280&e)*h&16711680)>>8}}}i+=128-n,s+=128-n-e}this.fb?.draw(661,0)}}})(),h=h.default})()));