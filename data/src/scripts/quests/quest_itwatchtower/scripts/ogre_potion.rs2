[opheldu,ground_bat_bones]
if(last_useitem = vial_water | last_useitem = unf_guam_potion) {
  if(%itwatchtower_progress < 9) { // this check is also one way
    ~chatplayer("<p,confused>Hmmm. Perhaps I shouldn't try and mix these items together. It might have unpredictable results...");
    return;
  }
  @ogrepotion_add_bat_bones(last_useitem);
}
~displaymessage(^dm_default);

[opheldu,jangerberries]
if(last_useitem = vial_water | last_useitem = unf_guam_potion) {
    if(%itwatchtower_progress < 9) {
        ~chatplayer("<p,confused>Hmm, perhaps I shouldn't mix these together. It might have unpredictable results...");
        return;
    }
}
~displaymessage(^dm_default);

[label,ogrepotion_add_bat_bones](obj $secondary)
if(stat(herblore) < 14) {
  mes("You need a Herblore level of 14 or above to make this potion.");
  return;
}
switch_obj($secondary) {
  case vial_water :
    inv_del(inv, ground_bat_bones, 1);
    inv_del(inv, vial_water, 1);
    inv_add(inv, vial_empty, 1);
    ~chatplayer("<p,sad>Oh dear, the mixture has evaporated.");
  case unf_guam_potion : ~potion_explosion(ground_bat_bones, unf_guam_potion, "You mix the ground bones into the liquid.");

}


/** Potion explosion */
[proc,potion_explosion](namedobj $ingredient, namedobj $solvent, string $message)
mes($message);
mes("You mixed the ingredients incorrectly and the mixure exploded.");
inv_del(inv, $ingredient, 1);
inv_del(inv, $solvent, 1);
inv_add(inv, vial_empty, 1);
anim(explodingvial, 0);
spotanim_pl(explodingvial, 92, 0);
sound_synth(explosion, 0, 0);
def_int $damage = 5;
if (stat(hitpoints) <= 8) {
    $damage = calc(stat(hitpoints) / 2);
}
~damage_self($damage);