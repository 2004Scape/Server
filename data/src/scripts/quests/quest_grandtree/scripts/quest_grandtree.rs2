[oploc1,loc_2446]
mes("The trapdoor won't open!");

[opheld1,hazelmeres_scroll] @scroll_hazelmere;
[opheld1,lumber_order] @scroll_lumber_order;

[oploc1,loc_2447]
p_arrivedelay;
if(stat(agility) < 25) {
    ~mesbox("You need at least 25 Agility to climb the tree.");
    return;
}
~agility_climb_up(0, movecoord(loc_coord, 2, 1, 1));

[oploc1,loc_2448] 
p_arrivedelay;
~agility_climb_up(0, movecoord(loc_coord, -1, -1, -1));

[oploc1,loc_2444]
~mesbox("The trapdoor won't open.");

[oploc1,loc_2436]
~mesbox("The chest is locked.");

[oploc2,loc_2434] @open_cupboard(false);

[oploc2,loc_2435]
if(%grandtree_progress >= ^grandtree_spoken_prisoner & inv_total(inv, gloughs_journal) = 0) {
    // https://youtu.be/LFvLBRCxFwk?si=7pHYoJgRRdwxc3nu&t=598
    ~objbox(gloughs_journal, "You've found Glough's Journal!");
    inv_add(inv, gloughs_journal, 1);
    if(%grandtree_progress = ^grandtree_spoken_prisoner) %grandtree_progress = ^grandtree_found_journal;
}
mes("You search the cupboard but you find nothing.");

[oploc3,loc_2435] 
@close_cupboard(false);

[oploc1,_shipyard_gate]
if(%grandtree_progress = ^grandtree_released_prison | %grandtree_progress = ^grandtree_obtained_lumber_order) {
    if(coordx(coord) < coordx(loc_coord) & npc_find(coord, grandtree_shipyard_worker, 5, 0) = true) {
        @shipyard_worker_gate;
    } else {
        @open_shipyard_gate;
    }
}
~mesbox("The gate is locked.");


[label,open_shipyard_gate]
if(coordx(coord) < coordx(loc_coord)) { 
    p_teleport(loc_coord);
} else {
    p_teleport(movecoord(loc_coord, -1, 0, 0));
}
loc_findallzone(coord);
while(loc_findnext = true) {
     if(loc_category = shipyard_gate) {
            def_coord $central_coord = loc_coord;
            def_int $orig_angle = loc_angle;
            def_loc $type = loc_type;
            loc_change(loc_83, 2);
            if($type = loc_2438) {
                loc_add(movecoord($central_coord, -1, 0, 0), loc_49, 3, loc_shape, 2);
                loc_add(movecoord($central_coord, -2, 0, 0), loc_50, 3, loc_shape, 2); 
            }
     }
}
p_delay(0);

[oploc1,loc_2451]
anim(human_push, 0);
if(%grandtree_progress ! ^grandtree_complete) {
    p_delay(0);
    ~mesbox("You push against the roots but they push back at you!");
    return;
}
sound_synth(tanglevine_appear, 0, 0);
loc_anim(seq_452);
p_delay(2);
if(coordz(coord) < coordz(loc_coord)) {
    ~forcemove(movecoord(coord, 0, 0, 2));
} else {
    ~forcemove(movecoord(coord, 0, 0, -2));
}
loc_anim(seq_453);