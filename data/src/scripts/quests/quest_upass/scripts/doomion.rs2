[ai_queue3,doomion]
gosub(npc_death);
if (npc_findhero = true) {
    obj_add(npc_coord, ashes, 1, ^lootdrop_duration);
    if(p_finduid(uid) = true) { // get protected access, if not then queue
        @defeat_doomion;
    }
    queue(queue_defeat_doomion, 0, npc_uid);
}


[queue,queue_defeat_doomion](npc_uid $npc)
if(npc_finduid($npc) = false) {
    return;
}
@defeat_doomion;

[label,defeat_doomion]
if(%upass_progress = ^upass_found_doll & inv_total(inv, amulet_of_doomion) = 0) {
    obj_add(npc_coord, amulet_of_doomion, 1, ^lootdrop_duration);
}
